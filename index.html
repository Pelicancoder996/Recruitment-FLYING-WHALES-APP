<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simulateur Salaire - Flying Whales</title>

<!-- ‚úÖ Tailwind avec dark mode activ√© -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    darkMode: 'class'
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("‚úÖ Service Worker enregistr√©"))
        .catch(err => console.error("Erreur SW:", err));
    }
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }
  </script>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:50; }
    .modal-content { background:white; padding:2rem; border-radius:1rem; max-width:700px; }
    .dark .modal-content { background:#1f2937; color:white; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
  <header class="w-full py-6 bg-[#00AEEF] text-white dark:bg-[#003366] flex justify-between px-8 items-center transition-colors duration-300">
    <h1 class="text-2xl font-bold">‚úàÔ∏è Simulateur Salaire - Flying Whales</h1>
    <div class="flex gap-2">
      <button onclick="toggleDarkMode()" class="px-3 py-1 bg-white text-[#003366] rounded-lg">üåô/‚òÄÔ∏è</button>
      <button onclick="openModal()" class="px-3 py-1 bg-white text-[#003366] rounded-lg">‚ùì Aide</button>
    </div>
  </header>

  <!-- Modal d'aide -->
  <div id="helpModal" class="modal flex">
    <div class="modal-content">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4 transition-colors duration-300">
‚ÑπÔ∏è Aide & FAQ</h2>
      <p><b>üåç March√© :</b> donn√©es nationales (√©coles, universit√©s, fonctions, +2,3%/an, coefficients).</p>
      <p><b>üè¢ Flying Whales :</b> packages internes FW.</p>
      <p><b>‚öñÔ∏è Crois√©e :</b> combinaison 60% FW, 40% march√©.</p>
      <p><b>Graphique :</b> √©volution projet√©e sur 40 ans.</p>
      <button onclick="closeModal()" class="mt-4 px-4 py-2 bg-[#00AEEF] text-white rounded">Fermer</button>
    </div>
  </div>

  <!-- Formulaire -->
  <main class="max-w-5xl mx-auto p-6">
    <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow mb-6 transition-colors duration-300">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìù Renseigne ton profil</h2>
      
      <label>üìö Origine acad√©mique</label>
      <select id="origin" class="w-full mb-4 p-2 border rounded">
        <option value="ingenieur">√âcole d‚Äôing√©nieur</option>
        <option value="commerce">Grande √©cole de commerce</option>
        <option value="scpo">Sciences Po</option>
        <option value="universite">Universit√©</option>
      </select>

      <label>üè´ √âcole</label>
      <select id="school" class="w-full mb-4 p-2 border rounded"></select>

      <label>üíº Fonction transverse</label>
      <select id="fonction" class="w-full mb-4 p-2 border rounded"></select>

      <label>üìÖ Exp√©rience: <span id="expVal">3</span> ans</label>
      <input type="range" id="experience" min="0" max="40" value="3" class="w-full mb-4">

      <label>üî¨ Sous-domaine (ing√©nierie uniquement)</label>
      <select id="subdomain" class="w-full mb-4 p-2 border rounded"></select>

      <label>üëî R√¥le / Statut</label>
      <select id="role" class="w-full mb-4 p-2 border rounded"></select>

      <label>üè∑Ô∏è Classification interne</label>
      <select id="classification" class="w-full mb-4 p-2 border rounded">
        <option value="">-- Optionnelle --</option>
        <option value="I1">I1 - Ing√©nieur D√©butant</option>
        <option value="I2">I2 - Ing√©nieur Confirm√©</option>
        <option value="I3">I3 - Ing√©nieur Senior</option>
        <option value="I4">I4 - Ing√©nieur Expert</option>
        <option value="M1">M1 - Manager Niveau 1</option>
        <option value="M2">M2 - Manager Niveau 2</option>
        <option value="M3">M3 - Leader D√©partement</option>
        <option value="RLot">Responsable de Lot</option>
        <option value="DirecteurTechnique">Directeur Technique</option>
      </select>

      <label>üåç R√©gion</label>
      <select id="region" class="w-full mb-4 p-2 border rounded">
        <option value="IDF">√éle-de-France</option>
        <option value="hors">Hors √éle-de-France</option>
      </select>

      <label>üè¢ Taille entreprise</label>
      <select id="companySize" class="w-full mb-4 p-2 border rounded">
        <option value="startup">Startup</option>
        <option value="PME">PME</option>
        <option value="ETI">ETI</option>
        <option value="grand-groupe">Grand Groupe</option>
      </select>

      <label>üìä Source des donn√©es</label>
      <select id="source" class="w-full mb-4 p-2 border rounded">
        <option value="marche">üåç March√©</option>
        <option value="fw">üè¢ Flying Whales (interne)</option>
        <option value="croisee">‚öñÔ∏è Donn√©es crois√©es</option>
      </select>
    </section>

    <section id="result" class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hidden">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìä R√©sultats</h2>
      <p><b>R√©f√©rence √©cole :</b> <span id="schoolRange"></span></p>
      <p><b>M√©dian √©cole :</b> <span id="schoolMedian"></span></p>
      <hr class="my-4">
      <p><b>Estimation personnalis√©e :</b></p>
      <p>M√©dian: <span id="median"></span></p>
      <p>Fourchette: <span id="range"></span></p>
      <canvas id="salaryChart" class="mt-6"></canvas>
    </section>
  </main>

  <script>
    // ===============================
// Bloc 2 : √âcoles d‚Äôing√©nieurs (71 + Hors liste)
// Donn√©es = salaires sortie d‚Äô√©cole (brut annuel) avec mini-fourchette
// ===============================
const schoolsIngenieur = [
  { Ecole:"Polytechnique", p25:54000, p50:57000, p75:60000 },
  { Ecole:"Mines Paris", p25:44000, p50:45750, p75:47500 },
  { Ecole:"CentraleSup√©lec", p25:45000, p50:47000, p75:49000 },
  { Ecole:"ISAE-Supa√©ro", p25:42000, p50:43500, p75:45000 },
  { Ecole:"T√©l√©com Paris", p25:45000, p50:46300, p75:48000 },
  { Ecole:"ESTP", p25:44000, p50:46000, p75:48000 },
  { Ecole:"ESTACA", p25:42000, p50:44600, p75:47000 },
  { Ecole:"Efrei", p25:47000, p50:48700, p75:50500 },
  { Ecole:"IMT Atlantique", p25:44000, p50:44900, p75:46000 },
  { Ecole:"Centrale Nantes", p25:39500, p50:41165, p75:43000 },
  { Ecole:"Centrale Lyon", p25:43000, p50:44500, p75:46000 },
  { Ecole:"Centrale Marseille", p25:42000, p50:44000, p75:46000 },
  { Ecole:"Centrale Lille", p25:42000, p50:44000, p75:46000 },
  { Ecole:"Centrale Paris", p25:45000, p50:47000, p75:49000 },
  { Ecole:"ENSAM Arts et M√©tiers", p25:39000, p50:41000, p75:43000 },
  { Ecole:"Mines Nancy", p25:40000, p50:42000, p75:44000 },
  { Ecole:"Mines Saint-√âtienne", p25:40000, p50:42000, p75:44000 },
  { Ecole:"Mines Al√®s", p25:38000, p50:40000, p75:42000 },
  { Ecole:"Mines Douai", p25:38000, p50:40000, p75:42000 },
  { Ecole:"ENSTA Paris", p25:43000, p50:45000, p75:47000 },
  { Ecole:"ENSTA Bretagne", p25:38000, p50:40000, p75:42000 },
  { Ecole:"T√©l√©com SudParis", p25:39000, p50:41000, p75:43000 },
  { Ecole:"T√©l√©com Nancy", p25:38000, p50:40000, p75:42000 },
  { Ecole:"INSA Lyon", p25:38000, p50:40000, p75:42000 },
  { Ecole:"INSA Toulouse", p25:37000, p50:39000, p75:41000 },
  { Ecole:"INSA Rennes", p25:37000, p50:39000, p75:41000 },
  { Ecole:"INSA Strasbourg", p25:37000, p50:39000, p75:41000 },
  { Ecole:"INSA Rouen", p25:36000, p50:38000, p75:40000 },
  { Ecole:"UTC Compi√®gne", p25:37000, p50:39000, p75:41000 },
  { Ecole:"UTT Troyes", p25:36000, p50:38000, p75:40000 },
  { Ecole:"UTBM Belfort", p25:36000, p50:38000, p75:40000 },
  { Ecole:"Polytech Grenoble", p25:35000, p50:37000, p75:39000 },
  { Ecole:"Polytech Nantes", p25:35000, p50:37000, p75:39000 },
  { Ecole:"Polytech Orl√©ans", p25:35000, p50:37000, p75:39000 },
  { Ecole:"Polytech Sorbonne", p25:35000, p50:37000, p75:39000 },
  { Ecole:"Polytech Nice", p25:35000, p50:37000, p75:39000 },
  { Ecole:"Polytech Lyon", p25:35000, p50:37000, p75:39000 },
  { Ecole:"Polytech Lille", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ESILV", p25:45000, p50:46800, p75:48500 },
  { Ecole:"ESME Sudria", p25:37000, p50:39000, p75:41000 },
  { Ecole:"EPF", p25:36000, p50:38000, p75:40000 },
  { Ecole:"ECE Paris", p25:36000, p50:38000, p75:40000 },
  { Ecole:"ESIEA", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ESIEE Paris", p25:36000, p50:38000, p75:40000 },
  { Ecole:"ISEN", p25:36000, p50:38000, p75:40000 },
  { Ecole:"HEI Lille", p25:36000, p50:38000, p75:40000 },
  { Ecole:"EIGSI La Rochelle", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ENSTA", p25:42000, p50:44000, p75:46000 },
  { Ecole:"ENSICAEN", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ENSC Rennes", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ENSAM Metz", p25:37000, p50:39000, p75:41000 },
  { Ecole:"ENSAIA", p25:34000, p50:36000, p75:38000 },
  { Ecole:"AgroParisTech", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ISA Lille", p25:34000, p50:36000, p75:38000 },
  { Ecole:"EI Purpan", p25:34000, p50:36000, p75:38000 },
  { Ecole:"ESA Angers", p25:34000, p50:36000, p75:38000 },
  { Ecole:"ESIGELEC", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ENSEA", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ESEO Angers", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ENSMA Poitiers", p25:36000, p50:38000, p75:40000 },
  { Ecole:"ENSI Poitiers", p25:35000, p50:37000, p75:39000 },
  { Ecole:"ENISE Saint-√âtienne", p25:34000, p50:36000, p75:38000 },
  { Ecole:"SUPAERO Toulouse", p25:42000, p50:43500, p75:45000 },
  { Ecole:"ENAC Toulouse", p25:40000, p50:42000, p75:44000 },
  { Ecole:"ENSGTI Pau", p25:34000, p50:36000, p75:38000 },
  { Ecole:"ENSGSI Nancy", p25:34000, p50:36000, p75:38000 },
  { Ecole:"ESPCI Paris", p25:43000, p50:45000, p75:47000 },
  { Ecole:"ENS Cachan", p25:42000, p50:44000, p75:46000 },
  { Ecole:"ENS Lyon", p25:42000, p50:44000, p75:46000 },
  { Ecole:"ENS Paris-Saclay", p25:42000, p50:44000, p75:46000 },
  { Ecole:"ENS Ulm", p25:43000, p50:45000, p75:47000 },
  { Ecole:"Hors liste", p25:33000, p50:35000, p75:37000 }
];

    // ===============================
    // Bloc 3 : Grandes √©coles de commerce (30)
    // ===============================
    const schoolsCommerce = [
      {Ecole:"HEC Paris", p25:48000, p50:55000, p75:65000},
      {Ecole:"ESSEC Business School", p25:45000, p50:52000, p75:62000},
      {Ecole:"ESCP Business School", p25:44000, p50:51000, p75:60000},
      {Ecole:"EDHEC Business School", p25:42000, p50:49000, p75:58000},
      {Ecole:"emlyon Business School", p25:43000, p50:50000, p75:59000},
      {Ecole:"Audencia Business School", p25:40000, p50:47000, p75:56000},
      {Ecole:"Skema Business School", p25:38000, p50:45000, p75:53000},
      {Ecole:"NEOMA Business School", p25:37000, p50:44000, p75:52000},
      {Ecole:"Kedge Business School", p25:35000, p50:42000, p75:50000},
      {Ecole:"TBS Education", p25:36000, p50:43000, p75:51000},
      {Ecole:"Grenoble EM", p25:37000, p50:44000, p75:52000},
      {Ecole:"Montpellier BS", p25:35000, p50:42000, p75:50000},
      {Ecole:"Rennes SB", p25:34000, p50:41000, p75:49000},
      {Ecole:"ICN Business School", p25:34000, p50:40000, p75:48000},
      {Ecole:"EM Strasbourg", p25:34000, p50:40000, p75:48000},
      {Ecole:"Excelia Business School", p25:33000, p50:39000, p75:47000},
      {Ecole:"ISC Paris", p25:33000, p50:39000, p75:46000},
      {Ecole:"INSEEC Grande √âcole", p25:32000, p50:38000, p75:45000},
      {Ecole:"PSB (Paris School of Business)", p25:32000, p50:38000, p75:45000},
      {Ecole:"EMLV (√âcole de Management L√©onard de Vinci)", p25:31000, p50:37000, p75:44000},
      {Ecole:"ISG (Institut Sup√©rieur de Gestion)", p25:31000, p50:37000, p75:43000},
      {Ecole:"ESC Clermont BS", p25:31000, p50:36000, p75:42000},
      {Ecole:"Burgundy School of Business (BSB Dijon)", p25:31000, p50:36000, p75:42000},
      {Ecole:"IMT-BS (Institut Mines-T√©l√©com Business School)", p25:30000, p50:36000, p75:42000},
      {Ecole:"ESC Pau Business School", p25:30000, p50:35000, p75:41000},
      {Ecole:"SCBS (South Champagne Business School)", p25:30000, p50:35000, p75:40000},
      {Ecole:"Brest Business School", p25:29000, p50:34000, p75:39000},
      {Ecole:"ISCID-CO (Boulogne/Calais)", p25:28000, p50:33000, p75:38000},
      {Ecole:"ICD Business School", p25:28000, p50:33000, p75:38000},
      {Ecole:"ESLSCA Business School Paris", p25:28000, p50:33000, p75:38000}
    ];
    // ===============================
    // Bloc 4 : Sciences Po (10 IEP)
    // ===============================
    const schoolsScPo = [
      {Ecole:"Sciences Po Paris", p25:36000, p50:40000, p75:45000},
      {Ecole:"Sciences Po Bordeaux", p25:34000, p50:37000, p75:42000},
      {Ecole:"Sciences Po Grenoble", p25:33500, p50:36500, p75:41000},
      {Ecole:"Sciences Po Lille", p25:34000, p50:37000, p75:42000},
      {Ecole:"Sciences Po Lyon", p25:34500, p50:37500, p75:42500},
      {Ecole:"Sciences Po Rennes", p25:33000, p50:36000, p75:41000},
      {Ecole:"Sciences Po Strasbourg", p25:33500, p50:36500, p75:41500},
      {Ecole:"Sciences Po Toulouse", p25:33500, p50:36500, p75:41500},
      {Ecole:"Sciences Po Saint-Germain-en-Laye", p25:32000, p50:35000, p75:40000},
      {Ecole:"Sciences Po Aix", p25:33000, p50:36000, p75:41000}
    ];
    // ===============================
    // Bloc 5 : Universit√©s (Top 20)
    // ===============================
    const schoolsUniversite = [
      {Ecole:"Sorbonne Universit√©", p25:35000, p50:39000, p75:43000},
      {Ecole:"Universit√© Paris-Saclay", p25:35000, p50:39000, p75:43000},
      {Ecole:"Universit√© PSL (Paris Sciences & Lettres)", p25:35000, p50:39500, p75:43500},
      {Ecole:"Universit√© Paris Cit√©", p25:34000, p50:38000, p75:42000},
      {Ecole:"Universit√© de Montpellier", p25:33500, p50:37500, p75:41500},
      {Ecole:"Universit√© de Strasbourg", p25:33500, p50:37500, p75:41500},
      {Ecole:"Universit√© Grenoble Alpes", p25:33500, p50:37500, p75:41500},
      {Ecole:"Aix-Marseille Universit√©", p25:33000, p50:37000, p75:41000},
      {Ecole:"Universit√© de Bordeaux", p25:33000, p50:37000, p75:41000},
      {Ecole:"Universit√© de Lyon", p25:33000, p50:37000, p75:41000},
      {Ecole:"Universit√© de Lille", p25:32500, p50:36500, p75:40500},
      {Ecole:"Universit√© Toulouse III - Paul Sabatier", p25:32500, p50:36500, p75:40500},
      {Ecole:"Universit√© de Nantes", p25:32000, p50:36000, p75:40000},
      {Ecole:"Universit√© de Rennes 1", p25:32000, p50:36000, p75:40000},
      {Ecole:"Universit√© de Lorraine", p25:32000, p50:36000, p75:40000},
      {Ecole:"Universit√© C√¥te d‚ÄôAzur (Nice)", p25:31500, p50:35500, p75:39500},
      {Ecole:"Universit√© de Tours", p25:31000, p50:35000, p75:39000},
      {Ecole:"Universit√© d‚ÄôAngers", p25:31000, p50:35000, p75:39000},
      {Ecole:"Universit√© de Clermont Auvergne", p25:31000, p50:35000, p75:39000},
      {Ecole:"Universit√© de Reims Champagne-Ardenne", p25:30500, p50:34500, p75:38500}
    ];
    // ===============================
    // Bloc 6 : Fonctions transverses
    // ===============================

    // Achats
    const functionsAchats = {
      "Acheteur Junior": { p25:38000, p50:42000, p75:47000 },
      "Acheteur Confirm√©": { p25:45000, p50:50000, p75:55000 },
      "Responsable Achats": { p25:55000, p50:65000, p75:80000 },
      "Directeur Achats": { p25:80000, p50:95000, p75:120000 }
    };

    // Immobilier
    const functionsImmo = {
      "Charg√© de Gestion Immobili√®re": { p25:32000, p50:38000, p75:45000 },
      "Property Manager": { p25:40000, p50:52000, p75:65000 },
      "Responsable Immobilier": { p25:55000, p50:72000, p75:90000 },
      "Directeur Immobilier": { p25:80000, p50:100000, p75:125000 }
    };

    // Ressources Humaines
    const functionsRH = {
      "Charg√© RH": { p25:34000, p50:39000, p75:45000 },
      "Charg√© de Recrutement": { 
        p25:37000, 
        p50:42000, 
        p75:47000,
        fwBase: { exp: 5, salaire: 46987 } // Donn√©e FW int√©gr√©e
      },
      "Responsable Recrutement": { p25:45000, p50:53000, p75:60000 },
      "Responsable RH / HRBP": { p25:47000, p50:55250, p75:66000 },
      "Directeur des Ressources Humaines": { p25:70000, p50:95000, p75:120000 }
    };

    // Finance
    const functionsFinance = {
      "Comptable": { p25:32000, p50:37000, p75:42000 },
      "Contr√¥leur de Gestion": { p25:42000, p50:49400, p75:60000 },
      "Auditeur Interne": { p25:40000, p50:47000, p75:55000 },
      "Tr√©sorier": { p25:45000, p50:52000, p75:60000 },
      "Responsable Financier": { p25:55000, p50:65000, p75:80000 },
      "Directeur Administratif et Financier (DAF)": { p25:80000, p50:110000, p75:140000 }
    };

    // Commerciaux
    const functionsCommerciaux = {
      "Business Developer Junior": { p25:30000, p50:35000, p75:40000 },
      "Business Developer Confirm√©": { p25:38000, p50:42000, p75:48000 },
      "Ing√©nieur d‚ÄôAffaires": { p25:45000, p50:50000, p75:60000 },
      "Responsable Commercial": { p25:55000, p50:60000, p75:75000 },
      "Directeur Commercial": { p25:75000, p50:85000, p75:110000 }
    };
<!-- =============================== -->
<!-- Bloc 7 : Logique principale corrig√©e finale -->
<!-- =============================== -->

const subdomainCoef = {
  "Calculs & Simulation": 1.10,
  "Conception": 1.05,
  "√âlectronique": 1.08,
  "Avionique": 1.08,
  "Mat√©riaux": 1.05,
  "Propulsion": 1.08,
  "M√©thodes": 1.02,         
  "Production": 1.02,
  "Maintenance": 1.05,      
  "Qualit√©": 1.06,          
  "Supply Chain": 1.06,     
  "Gestion de Projet": 1.05,
  "Ing√©nierie Syst√®mes": 1.08,
  "Gestion de Programme": 1.08,
  "Support Client": 1.02,   
  "Thermique": 1.09,
  "Dynamique de Vol": 1.11,
  "√âlectrique": 1.11,
  "Test": 1.05
};

const roles = [
  "Ing√©nieur Standard","Expert Technique","Architecte Syst√®me","Chef de Projet",
  "Manager d‚Äô√âquipe","Directeur de Programme"
];

function populateMenus() {
  const originSel=document.getElementById("origin");
  const schoolSel=document.getElementById("school");
  const fonctionSel=document.getElementById("fonction");
  const subSel=document.getElementById("subdomain");
  const roleSel=document.getElementById("role");

  function updateSchoolList() {
    schoolSel.innerHTML="";
    if(originSel.value==="ingenieur") schoolsIngenieur.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
    if(originSel.value==="commerce") schoolsCommerce.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
    if(originSel.value==="scpo") schoolsScPo.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
    if(originSel.value==="universite") schoolsUniversite.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
  }
  originSel.addEventListener("change", ()=>{updateSchoolList(); calculateSalary();});
  updateSchoolList();

  fonctionSel.innerHTML="";
  fonctionSel.add(new Option("-- Pas de fonction transverse --",""));
  const allFunctions = {
    ...functionsAchats, ...functionsImmo, ...functionsRH, ...functionsFinance, ...functionsCommerciaux
  };
  Object.keys(allFunctions).forEach(k=>fonctionSel.add(new Option(k,k)));

  subSel.innerHTML="";
  subSel.add(new Option("-- Pas de sous-domaine --",""));
  Object.keys(subdomainCoef).forEach(k=>subSel.add(new Option(k,k)));

  roles.forEach(r=>roleSel.add(new Option(r,r)));

  document.querySelectorAll("#school, #fonction, #subdomain, #role, #classification, #region, #companySize, #source")
    .forEach(el => el.addEventListener("change", calculateSalary));
  document.getElementById("experience").addEventListener("input", e=>{
    document.getElementById("expVal").innerText=e.target.value; 
    calculateSalary();
  });

  calculateSalary();
}

let chart;

function interpolateFW(exp, minExp, maxExp, minVal, maxVal) {
  if (exp <= minExp) return minVal;
  if (exp >= maxExp) return maxVal;
  const ratio = (exp - minExp) / (maxExp - minExp);
  return minVal + ratio * (maxVal - minVal);
}

function calculateSalary() {
  const origin=document.getElementById("origin").value;
  const exp=parseInt(document.getElementById("experience").value);
  let p25=0,p50=0,p75=0;
  let refP25=0,refP50=0,refP75=0; // ‚úÖ sortie √©cole brute

  // === Cas 1 : √âcole seule ===
  if(origin!=="fonction"){
    const sch=document.getElementById("school").value;
    if(sch){
      if(origin==="ingenieur"){ const school=schoolsIngenieur[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
      if(origin==="commerce"){ const school=schoolsCommerce[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
      if(origin==="scpo"){ const school=schoolsScPo[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
      if(origin==="universite"){ const school=schoolsUniversite[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
    }
  }

  // === Cas 2 : Fonction transverse seule ===
  if(origin==="fonction"){
    const fn=document.getElementById("fonction").value;
    if(fn){
      const allFunctions={...functionsAchats,...functionsImmo,...functionsRH,...functionsFinance,...functionsCommerciaux};
      const f=allFunctions[fn];
      if(f){
        p25=f.p25; p50=f.p50; p75=f.p75;
        if(f.fwBase){
          const baseExp=f.fwBase.exp;
          const baseSalary=f.fwBase.salaire;
          const factor=Math.pow(1.023,exp-baseExp);
          p25=baseSalary*0.9*factor;
          p50=baseSalary*factor;
          p75=baseSalary*1.1*factor;
        }
      }
    }
  }

  // === Cas 3 : Hybride (√©cole + fonction transverse) ===
  if(origin!=="fonction"){
    const fn=document.getElementById("fonction").value;
    if(fn){ 
      const allFunctions={...functionsAchats,...functionsImmo,...functionsRH,...functionsFinance,...functionsCommerciaux};
      const f=allFunctions[fn];
      if(f){
        p25 = 0.6*p25 + 0.4*f.p25;
        p50 = 0.6*p50 + 0.4*f.p50;
        p75 = 0.6*p75 + 0.4*f.p75;
      }
    }
  }

  // ‚úÖ Affichage r√©f√©rence sortie √©cole brute
  if(refP50>0){
    document.getElementById("schoolRange").innerText=Math.round(refP25)+"‚Ç¨ ‚Äì "+Math.round(refP75)+"‚Ç¨";
    document.getElementById("schoolMedian").innerText=Math.round(refP50)+"‚Ç¨";
  } else {
    document.getElementById("schoolRange").innerText="N/A";
    document.getElementById("schoolMedian").innerText="N/A";
  }

  // Exp√©rience (+2,3%/an)
  let factor=Math.pow(1.023,exp);
  p25*=factor; p50*=factor; p75*=factor;

  // Coeffs
  const sd=subdomainCoef[document.getElementById("subdomain").value]||1;
  const regionCoef=document.getElementById("region").value==="hors"?0.86:1.14; 
  const sizeCoef={startup:0.9,PME:1.0,ETI:1.05,"grand-groupe":1.15}[document.getElementById("companySize").value]||1;
  let coef=sd*regionCoef*sizeCoef;

  // R√¥le / classification
  const classification=document.getElementById("classification").value;
  let roleCoef=1;
  if (classification==="M1") roleCoef=1.10;
  if (classification==="M2") roleCoef=1.15;
  if (classification==="M3") roleCoef=1.20; // Leader d√©partement
  if (classification==="RLot") roleCoef=1.07;
  if (classification==="DirecteurTechnique") roleCoef=1.25;

  // Source
  const source=document.getElementById("source").value;
  let median,low,high;
  if(source==="marche"){
    median=p50; low=p25; high=p75;
  }else if(source==="fw"){
    median=p50*0.95; low=p25*0.95; high=p75*0.95;
  }else{
    median=(p50*0.4 + p50*0.95*0.6);
    low=(p25*0.4 + p25*0.95*0.6);
    high=(p75*0.4 + p75*0.95*0.6);
  }

  // appliquer region + taille + r√¥le
  median*=coef*roleCoef;
  low*=coef*roleCoef;
  high*=coef*roleCoef;

  // Planchers FW I1‚ÄìI4
  let fwP25=null, fwP50=null, fwP75=null;
  if (classification==="I1") {
    fwP25 = interpolateFW(exp,1,3,38000,44000);
    fwP50 = interpolateFW(exp,1,3,38000,48000);
    fwP75 = interpolateFW(exp,1,3,40000,50000);
  }
  if (classification==="I2") {
    fwP25 = interpolateFW(exp,3,5,48000,53000);
    fwP50 = interpolateFW(exp,3,5,48000,59000);
    fwP75 = interpolateFW(exp,3,5,50000,61000);
  }
  if (classification==="I3") {
    fwP25 = interpolateFW(exp,6,8,59000,68000);
    fwP50 = interpolateFW(exp,6,8,59000,73330);
    fwP75 = interpolateFW(exp,6,8,61000,76000);
  }
  if (classification==="I4") {
    const base = 73330*1.02;
    const factorI4 = Math.pow(1.023,Math.max(0,exp-10));
    fwP25 = base*0.95*factorI4;
    fwP50 = base*factorI4;
    fwP75 = base*1.10*factorI4;
  }

  if(fwP25&&fwP50&&fwP75){
    fwP25 *= regionCoef*sizeCoef;
    fwP50 *= regionCoef*sizeCoef;
    fwP75 *= regionCoef*sizeCoef;
    low=Math.max(low,fwP25);
    median=Math.max(median,fwP50);
    high=Math.max(high,fwP75);
  }

  // ‚úÖ Affichage estimation personnalis√©e
  document.getElementById("median").innerText=Math.round(median)+"‚Ç¨";
  document.getElementById("range").innerText=Math.round(low)+"‚Ç¨ ‚Äì "+Math.round(high)+"‚Ç¨";
  document.getElementById("result").classList.remove("hidden");

  // Graphique
  const ctx=document.getElementById("salaryChart").getContext("2d");
  if(chart) chart.destroy();
  const years=[...Array(41).keys()];
  const projection=years.map(y=>median*Math.pow(1.023,y));
  chart=new Chart(ctx,{
    type:"line",
    data:{labels:years,datasets:[{label:"Projection Salaire m√©dian",data:projection,borderColor:"#003366",fill:false}]},
    options:{responsive:true,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:false}}}
  });
}

// üåô/‚òÄÔ∏è Dark/Light toggle
if (localStorage.getItem('theme') === 'dark') {
  document.documentElement.classList.add('dark');
}
function toggleDarkMode() {
  const html=document.documentElement;
  if(html.classList.contains('dark')){
    html.classList.remove('dark');
    localStorage.setItem('theme','light');
    alert("‚òÄÔ∏è Mode clair activ√©");
  } else {
    html.classList.add('dark');
    localStorage.setItem('theme','dark');
    alert("üåô Mode sombre activ√©");
  }
}

function openModal(){document.getElementById("helpModal").style.display="flex";}
function closeModal(){document.getElementById("helpModal").style.display="none";}

window.onload=populateMenus;
</script>
</body>
</html>
