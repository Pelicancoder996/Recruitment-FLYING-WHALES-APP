<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulateur Salaire - Flying Whales</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
  <meta name="theme-color" content="#00AEEF">

  <!-- ‚úÖ Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>

  <!-- ‚úÖ Librairies externes -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- ‚úÖ Police -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- ‚úÖ Style global + animation -->
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      transition: background 0.4s ease, color 0.4s ease;
    }

    /* Animation douce pour apparition */
    .fade-in {
      animation: fadeIn 0.8s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Animation pr√©visualisation salaire */
    .pulse {
      animation: pulseAnim 1.5s infinite;
    }
    @keyframes pulseAnim {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.05); }
    }

    /* Correction Dark Mode */
    .dark select, .dark input, .dark textarea {
      background-color: #1f2937 !important;
      color: #f3f4f6 !important;
      border-color: #374151 !important;
    }

    .dark option {
      background-color: #1f2937;
      color: #f3f4f6;
    }
  </style>

  <!-- ‚úÖ Dark mode persistant -->
  <script>
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }
  </script>
</head>

<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
  <!-- ‚úÖ HEADER -->
  <header class="w-full py-6 bg-[#00AEEF] dark:bg-[#003366] text-white flex justify-between px-8 items-center shadow-md">
    <h1 class="text-2xl font-bold">‚úàÔ∏è Simulateur Salaire - Flying Whales</h1>
    <div class="flex gap-2">
      <button onclick="toggleDarkMode()" class="px-3 py-1 bg-white text-[#003366] rounded-lg hover:opacity-80 transition">üåô/‚òÄÔ∏è</button>
      <button onclick="openModal()" class="px-3 py-1 bg-white text-[#003366] rounded-lg hover:opacity-80 transition">‚ùì Aide</button>
    </div>
  </header>

  <!-- ‚úÖ MODAL AIDE -->
  <div id="helpModal" class="fixed inset-0 hidden bg-black/60 z-50 items-center justify-center">
    <div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 p-6 rounded-xl max-w-xl fade-in">
      <h2 class="text-xl font-bold mb-4 text-[#003366] dark:text-[#00AEEF]">‚ÑπÔ∏è Aide & FAQ</h2>
      <ul class="space-y-2 text-sm">
        <li><b>üåç March√© :</b> Donn√©es nationales (√©coles, universit√©s, IT, design...)</li>
        <li><b>üè¢ Flying Whales :</b> Packages internes FW</li>
        <li><b>‚öñÔ∏è Crois√©e :</b> 60 % FW / 40 % March√©</li>
        <li><b>üìä Graphique :</b> √âvolution projet√©e sur 40 ans</li>
      </ul>
      <div class="text-right mt-6">
        <button onclick="closeModal()" class="bg-[#00AEEF] text-white px-4 py-2 rounded hover:bg-[#008FCC] transition">Fermer</button>
      </div>
    </div>
  </div>

  <main class="max-w-5xl mx-auto p-6 space-y-6">

    <!-- ‚úÖ BARRE DE PROGRESSION -->
    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 overflow-hidden shadow-sm">
      <div id="progressBar" class="h-4 bg-[#00AEEF] transition-all duration-500 ease-out w-0"></div>
    </div>

    <!-- ‚úÖ PR√âVISUALISATION SALAIRE -->
    <div id="salaryPreview" class="bg-white dark:bg-gray-800 text-center py-4 rounded-xl shadow fade-in">
      <p class="text-lg font-semibold text-[#003366] dark:text-[#00AEEF]">
        üí∞ Salaire estim√© : <span id="salaryLive" class="text-2xl font-bold pulse">-- ‚Ç¨</span>
      </p>
    </div>

    <!-- ‚úÖ FORMULAIRE -->
    <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow transition-colors duration-300">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìù Profil</h2>

      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block mb-1">üè∑Ô∏è Secteur</label>
          <select id="sector" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"></select>
        </div>

        <div>
          <label class="block mb-1">üìö √âcole</label>
          <select id="school" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"></select>
        </div>

        <div>
          <label class="block mb-1">üíº Fonction / M√©tier</label>
          <select id="fonction" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"></select>
        </div>

        <div>
          <label class="block mb-1">üìÖ Exp√©rience : <span id="expVal">3</span> ans</label>
          <input type="range" id="experience" min="0" max="40" value="3" class="w-full accent-[#00AEEF]">
        </div>

        <div>
          <label class="block mb-1">üî¨ Sous-domaine (ing√©nierie uniquement)</label>
          <select id="subdomain" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"></select>
        </div>

        <div>
          <label class="block mb-1">üëî R√¥le / Statut</label>
          <select id="classification" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100">
            <option value="">-- Optionnel --</option>
            <option value="I1">I1 - Ing√©nieur D√©butant</option>
            <option value="I2">I2 - Ing√©nieur Confirm√©</option>
            <option value="I3">I3 - Ing√©nieur Senior</option>
            <option value="I4">I4 - Ing√©nieur Expert</option>
            <option value="M1">M1 - Manager Niveau 1</option>
            <option value="M2">M2 - Manager Niveau 2</option>
            <option value="M3">M3 - Leader D√©partement</option>
            <option value="RLot">Responsable de Lot</option>
            <option value="DirecteurTechnique">Directeur Technique</option>
          </select>
        </div>

        <div>
          <label class="block mb-1">üåç R√©gion</label>
          <select id="region" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100">
            <option value="IDF">√éle-de-France</option>
            <option value="hors">Hors √éle-de-France</option>
          </select>
        </div>

        <div>
          <label class="block mb-1">üè¢ Taille entreprise</label>
          <select id="companySize" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100">
            <option value="startup">Startup</option>
            <option value="PME">PME</option>
            <option value="ETI">ETI</option>
            <option value="grand-groupe">Grand Groupe</option>
          </select>
        </div>

        <div>
          <label class="block mb-1">üìä Source des donn√©es</label>
          <select id="source" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100">
            <option value="marche">üåç March√©</option>
            <option value="fw">üè¢ Flying Whales (interne)</option>
            <option value="croisee">‚öñÔ∏è Donn√©es crois√©es</option>
          </select>
        </div>
      </div>

      <!-- ‚úÖ Bouton Calculer -->
      <div class="text-center mt-6">
        <button onclick="calculateSalary()" class="bg-[#00AEEF] hover:bg-[#008FCC] text-white px-6 py-2 rounded-lg transition-all duration-300">
          üöÄ Calculer le salaire
        </button>
      </div>
    </section>
    <!-- ‚úÖ R√âSULTATS -->
    <section id="result" class="hidden bg-white dark:bg-gray-800 p-6 rounded-xl shadow fade-in transition-all duration-500">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìä R√©sultats</h2>

      <div class="space-y-2 text-sm">
        <p><b>R√©f√©rence √©cole :</b> <span id="schoolRange">--</span></p>
        <p><b>M√©dian √©cole :</b> <span id="schoolMedian">--</span></p>
      </div>

      <hr class="my-4 border-gray-300 dark:border-gray-600">

      <div class="space-y-2">
        <p class="text-base font-semibold">üí° Estimation personnalis√©e :</p>
        <p>M√©dian : <span id="median" class="font-bold text-lg text-[#003366] dark:text-[#00AEEF]">-- ‚Ç¨</span></p>
        <p>Fourchette : <span id="range" class="font-semibold">-- ‚Ç¨ ‚Äì -- ‚Ç¨</span></p>
      </div>

      <!-- ‚úÖ Graphique -->
      <canvas id="salaryChart" class="mt-6"></canvas>

      <!-- ‚úÖ Pr√©visualisation PDF -->
      <iframe id="pdfPreview" style="width:100%; height:400px; border:1px solid #ccc; margin-top:20px;" class="rounded-lg shadow-sm"></iframe>

      <!-- ‚úÖ Bouton Export PDF -->
      <div class="text-center mt-6">
        <button onclick="exportPDF()" 
          class="mt-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold shadow highlight transition-all duration-300">
          üìë Exporter en PDF
        </button>
      </div>
    </section>
  </main>
  <!-- ========================================================= -->
  <!-- üß© Bloc 4.1 ‚Äî Donn√©es : √âcoles (toutes fili√®res)           -->
  <!-- ========================================================= -->

  <script>
  // ===============================
  // Bloc 3 : √âcoles d‚Äôing√©nieurs (71 + Hors liste)
  // ===============================
  const schoolsIngenieur = [
    { Ecole:"Polytechnique", p25:54000, p50:57000, p75:60000 },
    { Ecole:"Mines Paris", p25:44000, p50:45750, p75:47500 },
    { Ecole:"CentraleSup√©lec", p25:45000, p50:47000, p75:49000 },
    { Ecole:"ISAE-Supa√©ro", p25:42000, p50:43500, p75:45000 },
    { Ecole:"T√©l√©com Paris", p25:45000, p50:46300, p75:48000 },
    { Ecole:"ESTP", p25:44000, p50:46000, p75:48000 },
    { Ecole:"ESTACA", p25:42000, p50:44600, p75:47000 },
    { Ecole:"Efrei", p25:47000, p50:48700, p75:50500 },
    { Ecole:"IMT Atlantique", p25:44000, p50:44900, p75:46000 },
    { Ecole:"Centrale Nantes", p25:39500, p50:41165, p75:43000 },
    { Ecole:"Centrale Lyon", p25:43000, p50:44500, p75:46000 },
    { Ecole:"Centrale Marseille", p25:42000, p50:44000, p75:46000 },
    { Ecole:"Centrale Lille", p25:42000, p50:44000, p75:46000 },
    { Ecole:"Centrale Paris", p25:45000, p50:47000, p75:49000 },
    { Ecole:"ENSAM Arts et M√©tiers", p25:39000, p50:41000, p75:43000 },
    { Ecole:"Mines Nancy", p25:40000, p50:42000, p75:44000 },
    { Ecole:"Mines Saint-√âtienne", p25:40000, p50:42000, p75:44000 },
    { Ecole:"Mines Al√®s", p25:38000, p50:40000, p75:42000 },
    { Ecole:"Mines Douai", p25:38000, p50:40000, p75:42000 },
    { Ecole:"ENSTA Paris", p25:43000, p50:45000, p75:47000 },
    { Ecole:"ENSTA Bretagne", p25:38000, p50:40000, p75:42000 },
    { Ecole:"T√©l√©com SudParis", p25:39000, p50:41000, p75:43000 },
    { Ecole:"T√©l√©com Nancy", p25:38000, p50:40000, p75:42000 },
    { Ecole:"INSA Lyon", p25:38000, p50:40000, p75:42000 },
    { Ecole:"INSA Toulouse", p25:37000, p50:39000, p75:41000 },
    { Ecole:"INSA Rennes", p25:37000, p50:39000, p75:41000 },
    { Ecole:"INSA Strasbourg", p25:37000, p50:39000, p75:41000 },
    { Ecole:"INSA Rouen", p25:36000, p50:38000, p75:40000 },
    { Ecole:"UTC Compi√®gne", p25:37000, p50:39000, p75:41000 },
    { Ecole:"UTT Troyes", p25:36000, p50:38000, p75:40000 },
    { Ecole:"UTBM Belfort", p25:36000, p50:38000, p75:40000 },
    { Ecole:"Polytech Grenoble", p25:35000, p50:37000, p75:39000 },
    { Ecole:"Polytech Nantes", p25:35000, p50:37000, p75:39000 },
    { Ecole:"Polytech Orl√©ans", p25:35000, p50:37000, p75:39000 },
    { Ecole:"Polytech Sorbonne", p25:35000, p50:37000, p75:39000 },
    { Ecole:"Polytech Nice", p25:35000, p50:37000, p75:39000 },
    { Ecole:"Polytech Lyon", p25:35000, p50:37000, p75:39000 },
    { Ecole:"Polytech Lille", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ESILV", p25:45000, p50:46800, p75:48500 },
    { Ecole:"ESME Sudria", p25:37000, p50:39000, p75:41000 },
    { Ecole:"EPF", p25:36000, p50:38000, p75:40000 },
    { Ecole:"ECE Paris", p25:36000, p50:38000, p75:40000 },
    { Ecole:"ESIEA", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ESIEE Paris", p25:36000, p50:38000, p75:40000 },
    { Ecole:"ISEN", p25:36000, p50:38000, p75:40000 },
    { Ecole:"HEI Lille", p25:36000, p50:38000, p75:40000 },
    { Ecole:"EIGSI La Rochelle", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ENSTA", p25:42000, p50:44000, p75:46000 },
    { Ecole:"ENSICAEN", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ENSC Rennes", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ENSAM Metz", p25:37000, p50:39000, p75:41000 },
    { Ecole:"ENSAIA", p25:34000, p50:36000, p75:38000 },
    { Ecole:"AgroParisTech", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ISA Lille", p25:34000, p50:36000, p75:38000 },
    { Ecole:"EI Purpan", p25:34000, p50:36000, p75:38000 },
    { Ecole:"ESA Angers", p25:34000, p50:36000, p75:38000 },
    { Ecole:"ESIGELEC", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ENSEA", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ESEO Angers", p25:35000, p50:37000, p75:39000 },
    { Ecole:"ENSMA Poitiers", p25:36000, p50:38000, p75:40000 },
    { Ecole:"ENISE Saint-√âtienne", p25:34000, p50:36000, p75:38000 },
    { Ecole:"SUPAERO Toulouse", p25:42000, p50:43500, p75:45000 },
    { Ecole:"ENAC Toulouse", p25:40000, p50:42000, p75:44000 },
    { Ecole:"ENSGTI Pau", p25:34000, p50:36000, p75:38000 },
    { Ecole:"ESPCI Paris", p25:43000, p50:45000, p75:47000 },
    { Ecole:"ENS Cachan", p25:42000, p50:44000, p75:46000 },
    { Ecole:"ENS Lyon", p25:42000, p50:44000, p75:46000 },
    { Ecole:"ENS Paris-Saclay", p25:42000, p50:44000, p75:46000 },
    { Ecole:"ENS Ulm", p25:43000, p50:45000, p75:47000 },
    { Ecole:"Hors liste", p25:33000, p50:35000, p75:37000 }
  ];

  // ===============================
  // Bloc 4 : Grandes √©coles de commerce (30)
  // ===============================
  const schoolsCommerce = [
    {Ecole:"HEC Paris", p25:48000, p50:55000, p75:65000},
    {Ecole:"ESSEC Business School", p25:45000, p50:52000, p75:62000},
    {Ecole:"ESCP Business School", p25:44000, p50:51000, p75:60000},
    {Ecole:"EDHEC Business School", p25:42000, p50:49000, p75:58000},
    {Ecole:"emlyon Business School", p25:43000, p50:50000, p75:59000},
    {Ecole:"Audencia Business School", p25:40000, p50:47000, p75:56000},
    {Ecole:"Skema Business School", p25:38000, p50:45000, p75:53000},
    {Ecole:"NEOMA Business School", p25:37000, p50:44000, p75:52000},
    {Ecole:"Kedge Business School", p25:35000, p50:42000, p75:50000},
    {Ecole:"TBS Education", p25:36000, p50:43000, p75:51000},
    {Ecole:"Grenoble EM", p25:37000, p50:44000, p75:52000},
    {Ecole:"Montpellier BS", p25:35000, p50:42000, p75:50000},
    {Ecole:"Rennes SB", p25:34000, p50:41000, p75:49000},
    {Ecole:"ICN Business School", p25:34000, p50:40000, p75:48000},
    {Ecole:"EM Strasbourg", p25:34000, p50:40000, p75:48000},
    {Ecole:"Excelia Business School", p25:33000, p50:39000, p75:47000},
    {Ecole:"ISC Paris", p25:33000, p50:39000, p75:46000},
    {Ecole:"INSEEC Grande √âcole", p25:32000, p50:38000, p75:45000},
    {Ecole:"PSB (Paris School of Business)", p25:32000, p50:38000, p75:45000},
    {Ecole:"EMLV", p25:31000, p50:37000, p75:44000},
    {Ecole:"ISG", p25:31000, p50:37000, p75:43000},
    {Ecole:"ESC Clermont BS", p25:31000, p50:36000, p75:42000},
    {Ecole:"Burgundy SB", p25:31000, p50:36000, p75:42000},
    {Ecole:"IMT-BS", p25:30000, p50:36000, p75:42000},
    {Ecole:"ESC Pau BS", p25:30000, p50:35000, p75:41000},
    {Ecole:"SCBS", p25:30000, p50:35000, p75:40000},
    {Ecole:"Brest BS", p25:29000, p50:34000, p75:39000},
    {Ecole:"ISCID-CO", p25:28000, p50:33000, p75:38000},
    {Ecole:"ICD", p25:28000, p50:33000, p75:38000},
    {Ecole:"ESLSCA", p25:28000, p50:33000, p75:38000}
  ];

  // ===============================
  // Bloc 5 : Sciences Po (10 IEP)
  // ===============================
  const schoolsScPo = [
    {Ecole:"Sciences Po Paris",p25:36000,p50:40000,p75:45000},
    {Ecole:"Sciences Po Bordeaux",p25:34000,p50:37000,p75:42000},
    {Ecole:"Sciences Po Grenoble",p25:33500,p50:36500,p75:41000},
    {Ecole:"Sciences Po Lille",p25:34000,p50:37000,p75:42000},
    {Ecole:"Sciences Po Lyon",p25:34500,p50:37500,p75:42500},
    {Ecole:"Sciences Po Rennes",p25:33000,p50:36000,p75:41000},
    {Ecole:"Sciences Po Strasbourg",p25:33500,p50:36500,p75:41500},
    {Ecole:"Sciences Po Toulouse",p25:33500,p50:36500,p75:41500},
    {Ecole:"Sciences Po Saint-Germain-en-Laye",p25:32000,p50:35000,p75:40000},
    {Ecole:"Sciences Po Aix",p25:33000,p50:36000,p75:41000}
  ];

  // ===============================
  // Bloc 6 : Universit√©s (Top 20)
  // ===============================
  const schoolsUniversite = [
    {Ecole:"Sorbonne Universit√©",p25:35000,p50:39000,p75:43000},
    {Ecole:"Universit√© Paris-Saclay",p25:35000,p50:39000,p75:43000},
    {Ecole:"Universit√© PSL",p25:35000,p50:39500,p75:43500},
    {Ecole:"Universit√© Paris Cit√©",p25:34000,p50:38000,p75:42000},
    {Ecole:"Universit√© de Montpellier",p25:33500,p50:37500,p75:41500},
    {Ecole:"Universit√© de Strasbourg",p25:33500,p50:37500,p75:41500},
    {Ecole:"Universit√© Grenoble Alpes",p25:33500,p50:37500,p75:41500},
    {Ecole:"Aix-Marseille Universit√©",p25:33000,p50:37000,p75:41000},
    {Ecole:"Universit√© de Bordeaux",p25:33000,p50:37000,p75:41000},
    {Ecole:"Universit√© de Lyon",p25:33000,p50:37000,p75:41000},
    {Ecole:"Universit√© de Lille",p25:32500,p50:36500,p75:40500},
    {Ecole:"Universit√© Toulouse III Paul Sabatier",p25:32500,p50:36500,p75:40500},
    {Ecole:"Universit√© de Nantes",p25:32000,p50:36000,p75:40000},
    {Ecole:"Universit√© de Rennes 1",p25:32000,p50:36000,p75:40000},
    {Ecole:"Universit√© de Lorraine",p25:32000,p50:36000,p75:40000},
    {Ecole:"Universit√© C√¥te d‚ÄôAzur (Nice)",p25:31500,p50:35500,p75:39500},
    {Ecole:"Universit√© de Tours",p25:31000,p50:35000,p75:39000},
    {Ecole:"Universit√© d‚ÄôAngers",p25:31000,p50:35000,p75:39000},
    {Ecole:"Universit√© de Clermont Auvergne",p25:31000,p50:35000,p75:39000},
    {Ecole:"Universit√© de Reims",p25:30500,p50:34500,p75:38500}
  ];

  // ===============================
  // Bloc 7 : √âcoles IT
  // ===============================
  const schoolsIT = [
    {Ecole:"√âcole 42",p25:30000,p50:35000,p75:42000},
    {Ecole:"EPITA",p25:32000,p50:37000,p75:43000},
    {Ecole:"Epitech",p25:31000,p50:36000,p75:42000},
    {Ecole:"ENSIMAG",p25:30000,p50:35000,p75:41000},
    {Ecole:"T√©l√©com Paris",p25:33000,p50:38000,p75:44000},
    {Ecole:"T√©l√©com SudParis",p25:31000,p50:36000,p75:42000},
    {Ecole:"ENSIIE",p25:28000,p50:33000,p75:38000},
    {Ecole:"Polytech Grenoble",p25:27000,p50:32000,p75:37000},
    {Ecole:"Universit√© Paris Cit√©",p25:25000,p50:30000,p75:35000},
    {Ecole:"Universit√© de Strasbourg",p25:24000,p50:29000,p75:34000},
    {Ecole:"Universit√© de Bordeaux",p25:24000,p50:29000,p75:34000},
    {Ecole:"Universit√© de Lille",p25:23000,p50:28000,p75:33000},
    {Ecole:"Sup√©lec / Centrale",p25:32000,p50:37000,p75:43000},
    {Ecole:"Hors liste IT",p25:22000,p50:27000,p75:32000}
  ];

  // ===============================
  // Bloc 8 : √âcoles Design
  // ===============================
  const schoolsDesign = [
    {Ecole:"Strate √âcole de Design",p25:28000,p50:33000,p75:40000},
    {Ecole:"ENSAD (Arts D√©cos)",p25:26000,p50:31000,p75:38000},
    {Ecole:"√âcole Estienne",p25:25000,p50:30000,p75:35000},
    {Ecole:"√âcole de Design Nantes Atlantique",p25:26000,p50:31000,p75:36000},
    {Ecole:"Gobelins",p25:27000,p50:32000,p75:38000},
    {Ecole:"ENSCI-Les Ateliers",p25:25000,p50:30000,p75:35000},
    {Ecole:"LISAA",p25:23000,p50:28000,p75:33000},
    {Ecole:"Universit√© (arts appliqu√©s)",p25:22000,p50:27000,p75:32000},
    {Ecole:"Hors liste Design",p25:20000,p50:25000,p75:30000}
  ];
  // =========================================================
  // üß© Bloc 4.2 ‚Äî Donn√©es : Fonctions m√©tier
  // =========================================================

  // üß≠ Achats
  const functionsAchats = {
    "Acheteur Junior": { p25:38000, p50:42000, p75:47000 },
    "Acheteur Confirm√©": { p25:45000, p50:50000, p75:55000 },
    "Responsable Achats": { p25:55000, p50:65000, p75:80000 },
    "Directeur Achats": { p25:80000, p50:95000, p75:120000 }
  };

  // üè¢ Immobilier
  const functionsImmo = {
    "Charg√© de Gestion Immobili√®re": { p25:32000, p50:38000, p75:45000 },
    "Property Manager": { p25:40000, p50:52000, p75:65000 },
    "Responsable Immobilier": { p25:55000, p50:72000, p75:90000 },
    "Directeur Immobilier": { p25:80000, p50:100000, p75:125000 }
  };

  // üë• Ressources Humaines
  const functionsRH = {
    "Charg√© RH": { p25:34000, p50:39000, p75:45000 },
    "Charg√© de Recrutement": { 
      p25:37000, 
      p50:42000, 
      p75:47000,
      fwBase: { exp: 5, salaire: 46987 } // Donn√©e FW interne
    },
    "Responsable Recrutement": { p25:45000, p50:53000, p75:60000 },
    "Responsable RH / HRBP": { p25:47000, p50:55250, p75:66000 },
    "Directeur des Ressources Humaines": { p25:70000, p50:95000, p75:120000 }
  };

  // üí∞ Finance
  const functionsFinance = {
    "Comptable": { p25:32000, p50:37000, p75:42000 },
    "Contr√¥leur de Gestion": { p25:42000, p50:49400, p75:60000 },
    "Auditeur Interne": { p25:40000, p50:47000, p75:55000 },
    "Tr√©sorier": { p25:45000, p50:52000, p75:60000 },
    "Responsable Financier": { p25:55000, p50:65000, p75:80000 },
    "Directeur Administratif et Financier (DAF)": { p25:80000, p50:110000, p75:140000 }
  };

  // üíº Commerciaux
  const functionsCommerciaux = {
    "Business Developer Junior": { p25:30000, p50:35000, p75:40000 },
    "Business Developer Confirm√©": { p25:38000, p50:42000, p75:48000 },
    "Ing√©nieur d‚ÄôAffaires": { p25:45000, p50:50000, p75:60000 },
    "Responsable Commercial": { p25:55000, p50:60000, p75:75000 },
    "Directeur Commercial": { p25:75000, p50:85000, p75:110000 }
  };

  // üíª M√©tiers IT
  const functionsIT = {
    "D√©veloppeur Front-End": { p25:30000, p50:38000, p75:48000 },
    "D√©veloppeur Back-End": { p25:32000, p50:40000, p75:50000 },
    "D√©veloppeur Full-Stack": { p25:33000, p50:42000, p75:52000 },
    "Data Engineer": { p25:35000, p50:45000, p75:58000 },
    "Data Scientist": { p25:37000, p50:48000, p75:62000 },
    "DevOps / SRE": { p25:36000, p50:47000, p75:60000 },
    "Infra / R√©seau": { p25:32000, p50:42000, p75:54000 },
    "Cloud Architect": { p25:45000, p50:60000, p75:80000 },
    "Cybersecurity": { p25:38000, p50:50000, p75:65000 },
    "Admin Syst√®mes": { p25:31000, p50:40000, p75:52000 }
  };

  // üé® M√©tiers Design
  const functionsDesign = {
    "UX Designer": { p25:30000, p50:38000, p75:48000 },
    "UI Designer": { p25:32000, p50:40000, p75:50000 },
    "Product Designer": { p25:33000, p50:42000, p75:55000 },
    "Motion Designer": { p25:28000, p50:35000, p75:45000 },
    "Graphiste / Branding": { p25:26000, p50:33000, p75:42000 },
    "Interaction Designer": { p25:30000, p50:38000, p75:47000 }
  };
  // =========================================================
  // üß© Bloc 4.3 ‚Äî Coefficients, sous-domaines et r√¥les
  // =========================================================

  // ‚öôÔ∏è Sous-domaines ing√©nierie avec coefficients multiplicateurs
  const subdomainCoef = {
    "Calculs & Simulation": 1.10,
    "Conception": 1.05,
    "√âlectronique": 1.08,
    "Avionique": 1.08,
    "Mat√©riaux": 1.05,
    "Propulsion": 1.08,
    "M√©thodes": 1.02,         
    "Production": 1.02,
    "Maintenance": 1.05,      
    "Qualit√©": 1.06,          
    "Supply Chain": 1.06,     
    "Gestion de Projet": 1.05,
    "Ing√©nierie Syst√®mes": 1.08,
    "Gestion de Programme": 1.08,
    "Support Client": 1.02,   
    "Thermique": 1.09,
    "Dynamique de Vol": 1.11,
    "√âlectrique": 1.11,
    "Test": 1.05
  };

  // üéØ R√¥les internes FW (affectent la pond√©ration)
  const roles = [
    "Ing√©nieur Standard",
    "Expert Technique",
    "Architecte Syst√®me",
    "Chef de Projet",
    "Manager d‚Äô√âquipe",
    "Directeur de Programme"
  ];

  // üßÆ Coefficients internes FW selon classification
  const classificationCoefficients = {
    "I1": { p25: [38000, 44000], p50: [38000, 48000], p75: [40000, 50000], exp: [1, 3] },
    "I2": { p25: [48000, 53000], p50: [48000, 59000], p75: [50000, 61000], exp: [3, 5] },
    "I3": { p25: [59000, 68000], p50: [59000, 73330], p75: [61000, 76000], exp: [6, 8] },
    "I4": { base: 73330, factor: 1.02 },
    "M1": 1.10,
    "M2": 1.15,
    "M3": 1.20,
    "RLot": 1.07,
    "DirecteurTechnique": 1.25
  };

  // üåç Coefficients r√©gionaux et taille d‚Äôentreprise
  const regionCoef = {
    "IDF": 1.14,
    "hors": 0.86
  };

  const sizeCoef = {
    "startup": 0.9,
    "PME": 1.0,
    "ETI": 1.05,
    "grand-groupe": 1.15
  };

  // üìà Facteur d‚Äô√©volution annuelle moyenne du salaire (croissance)
  const growthFactor = 1.023;
  // =========================================================
  // üß© Bloc 4.4 ‚Äî Logique principale : calculs + affichage
  // =========================================================

  let chart;

  // üìè Interpolation des planchers FW selon l'exp√©rience
  function interpolateFW(exp, minExp, maxExp, minVal, maxVal) {
    if (exp <= minExp) return minVal;
    if (exp >= maxExp) return maxVal;
    const ratio = (exp - minExp) / (maxExp - minExp);
    return minVal + ratio * (maxVal - minVal);
  }

 // üß≠ Remplit les menus dynamiquement selon le secteur
function populateMenus() {
  const sectorSel = document.getElementById("sector");
  const schoolSel = document.getElementById("school");
  const fonctionSel = document.getElementById("fonction");
  const subSel = document.getElementById("subdomain");
  const roleSel = document.getElementById("role");

  // üè∑Ô∏è Remplit le menu des secteurs
  sectorSel.innerHTML = "";
  [
    { value: "ingenieur", label: "√âcoles d‚Äôing√©nieurs" },
    { value: "commerce", label: "√âcoles de commerce" },
    { value: "scpo", label: "Sciences Po / IEP" },
    { value: "universite", label: "Universit√©s" },
    { value: "it", label: "Informatique / Num√©rique" },
    { value: "design", label: "Design / Cr√©ation" }
  ].forEach(opt => {
    sectorSel.add(new Option(opt.label, opt.value));
  });

  // üéì Liste d‚Äô√©coles selon le secteur
  function updateSchoolList() {
    schoolSel.innerHTML = "";
    const map = {
      ingenieur: schoolsIngenieur,
      commerce: schoolsCommerce,
      scpo: schoolsScPo,
      universite: schoolsUniversite,
      it: schoolsIT,
      design: schoolsDesign
    };
    const list = map[sectorSel.value] || [];
    list.forEach((s, i) => schoolSel.add(new Option(s.Ecole, i)));
  }
  sectorSel.addEventListener("change", () => { updateSchoolList(); calculateSalary(); });
  updateSchoolList();

  // üíº Fonctions disponibles
  fonctionSel.innerHTML = "";
  fonctionSel.add(new Option("-- Pas de fonction transverse --", ""));
  const allFunctions = {
    ...functionsAchats,
    ...functionsImmo,
    ...functionsRH,
    ...functionsFinance,
    ...functionsCommerciaux,
    ...functionsIT,
    ...functionsDesign
  };
  Object.keys(allFunctions).forEach(k => fonctionSel.add(new Option(k, k)));

  // üî¨ Sous-domaines
  subSel.innerHTML = "";
  subSel.add(new Option("-- Pas de sous-domaine --", ""));
  Object.keys(subdomainCoef).forEach(k => subSel.add(new Option(k, k)));

  // üéØ R√¥les
  roles.forEach(r => roleSel.add(new Option(r, r)));

  // üß© Listeners
  document.querySelectorAll("#school, #fonction, #subdomain, #role, #classification, #region, #companySize, #source")
    .forEach(el => el.addEventListener("change", calculateSalary));

  document.getElementById("experience").addEventListener("input", e => {
    document.getElementById("expVal").innerText = e.target.value;
    calculateSalary();
  });

  // üöÄ Calcul initial
  calculateSalary();
}


  // üí∞ Fonction principale de calcul de salaire
  function calculateSalary() {
    const sector = document.getElementById("sector").value;
    const exp = parseInt(document.getElementById("experience").value);
    let p25 = 0, p50 = 0, p75 = 0;
    let refP25 = 0, refP50 = 0, refP75 = 0;

    // üéì Donn√©es √©cole
    const sch = document.getElementById("school").value;
    if (sch) {
      const maps = {
        ingenieur: schoolsIngenieur,
        commerce: schoolsCommerce,
        scpo: schoolsScPo,
        universite: schoolsUniversite,
        it: schoolsIT,
        design: schoolsDesign
      };
      const data = maps[sector]?.[sch];
      if (data) {
        p25 = data.p25; p50 = data.p50; p75 = data.p75;
        refP25 = data.p25; refP50 = data.p50; refP75 = data.p75;
      }
    }

    // üíº Fonction transverse
    const fn = document.getElementById("fonction").value;
    if (fn) {
      const allFunctions = {
        ...functionsAchats, ...functionsImmo, ...functionsRH,
        ...functionsFinance, ...functionsCommerciaux,
        ...functionsIT, ...functionsDesign
      };
      const f = allFunctions[fn];
      if (f) {
        if (p25 > 0) {
          // Combinaison √©cole + fonction
          p25 = 0.6 * p25 + 0.4 * f.p25;
          p50 = 0.6 * p50 + 0.4 * f.p50;
          p75 = 0.6 * p75 + 0.4 * f.p75;
        } else {
          // Fonction seule
          p25 = f.p25; p50 = f.p50; p75 = f.p75;
          if (f.fwBase) {
            const baseExp = f.fwBase.exp;
            const baseSalary = f.fwBase.salaire;
            const factor = Math.pow(growthFactor, exp - baseExp);
            p25 = baseSalary * 0.9 * factor;
            p50 = baseSalary * factor;
            p75 = baseSalary * 1.1 * factor;
          }
        }
      }
    }

    // üìö Affichage r√©f√©rence √©cole brute
    if (refP50 > 0) {
      document.getElementById("schoolRange").innerText = `${Math.round(refP25)}‚Ç¨ ‚Äì ${Math.round(refP75)}‚Ç¨`;
      document.getElementById("schoolMedian").innerText = `${Math.round(refP50)}‚Ç¨`;
    } else {
      document.getElementById("schoolRange").innerText = "N/A";
      document.getElementById("schoolMedian").innerText = "N/A";
    }

    // ‚è≥ Exp√©rience (+2,3%/an)
    let factor = Math.pow(growthFactor, exp);
    p25 *= factor; p50 *= factor; p75 *= factor;

    // ‚öôÔ∏è Coefficients cumul√©s
    const sd = subdomainCoef[document.getElementById("subdomain").value] || 1;
    const reg = regionCoef[document.getElementById("region").value] || 1;
    const size = sizeCoef[document.getElementById("companySize").value] || 1;
    let coef = sd * reg * size;

    // üéØ R√¥le / classification
    const classification = document.getElementById("classification").value;
    let roleCoef = 1;
    if (["M1", "M2", "M3", "RLot", "DirecteurTechnique"].includes(classification)) {
      roleCoef = classificationCoefficients[classification];
    }

    // ‚öñÔ∏è Source
    const source = document.getElementById("source").value;
    let median, low, high;
    if (source === "marche") {
      median = p50; low = p25; high = p75;
    } else if (source === "fw") {
      median = p50 * 0.95; low = p25 * 0.95; high = p75 * 0.95;
    } else {
      median = (p50 * 0.4 + p50 * 0.95 * 0.6);
      low = (p25 * 0.4 + p25 * 0.95 * 0.6);
      high = (p75 * 0.4 + p75 * 0.95 * 0.6);
    }

    // üìà Application coefficients r√©gion, taille, r√¥le
    median *= coef * roleCoef;
    low *= coef * roleCoef;
    high *= coef * roleCoef;

    // üöÄ Application planchers FW (I1‚ÄìI4)
    if (["I1","I2","I3"].includes(classification)) {
      const c = classificationCoefficients[classification];
      const fwP25 = interpolateFW(exp, c.exp[0], c.exp[1], c.p25[0], c.p25[1]);
      const fwP50 = interpolateFW(exp, c.exp[0], c.exp[1], c.p50[0], c.p50[1]);
      const fwP75 = interpolateFW(exp, c.exp[0], c.exp[1], c.p75[0], c.p75[1]);
      low = Math.max(low, fwP25);
      median = Math.max(median, fwP50);
      high = Math.max(high, fwP75);
    } else if (classification === "I4") {
      const base = classificationCoefficients["I4"].base;
      const fact = Math.pow(classificationCoefficients["I4"].factor, Math.max(0, exp - 10));
      const fwP50 = base * fact;
      median = Math.max(median, fwP50);
    }

    // üßÆ Affichage des r√©sultats
document.getElementById("median").innerText = `${Math.round(median).toLocaleString()} ‚Ç¨`;
document.getElementById("range").innerText = `${Math.round(low).toLocaleString()} ‚Ç¨ ‚Äì ${Math.round(high).toLocaleString()} ‚Ç¨`;
document.getElementById("salaryLive").innerText = `${Math.round(median).toLocaleString()} ‚Ç¨`;
document.getElementById("result").classList.remove("hidden");


    // üé¢ Graphique projection sur 40 ans
    const ctx = document.getElementById("salaryChart").getContext("2d");
    if (chart) chart.destroy();
    const years = [...Array(41).keys()];
    const projection = years.map(y => median * Math.pow(growthFactor, y));

    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: years,
        datasets: [{
          label: "Salaire m√©dian projet√© (‚Ç¨)",
          data: projection,
          borderColor: "#00AEEF",
          backgroundColor: "rgba(0,174,239,0.1)",
          fill: true,
          tension: 0.3,
          pointRadius: 0
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.formattedValue} ‚Ç¨`
            }
          }
        },
        scales: {
          y: {
            ticks: { color: "#00AEEF", callback: v => v.toLocaleString("fr-FR") + " ‚Ç¨" },
            grid: { color: "rgba(0,0,0,0.1)" }
          },
          x: { ticks: { color: "#6b7280" } }
        }
      }
    });
  }

  // üöÄ Initialisation
  window.onload = populateMenus;
  </script>
  <!-- ========================================================= -->
  <!-- üß© Bloc 5 ‚Äî Export PDF + Dark Mode + Modal + Fin de page -->
  <!-- ========================================================= -->

  <script>
  // ===============================
  // üìë Export PDF complet (propre & structur√©)
  // ===============================
  async function exportPDF() {
    console.log("üëâ Export PDF lanc√©");
    try {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "mm", "a4");

      // üé® HEADER
      doc.setFillColor(0, 51, 102);
      doc.rect(0, 0, 210, 30, "F");
      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.setTextColor(255, 255, 255);
      doc.text("Rapport Salaire ‚Äì Flying Whales", 15, 18);

      // Donn√©es principales
      const schoolSelect = document.getElementById("school");
      const school = schoolSelect.options[schoolSelect.selectedIndex]?.text || "N/A";
      const jobSelect = document.getElementById("fonction");
      const job = jobSelect.options[jobSelect.selectedIndex]?.text || "N/A";
      const classificationSelect = document.getElementById("classification");
      const classification = classificationSelect.options[classificationSelect.selectedIndex]?.text || "Classique";
      const experience = document.getElementById("experience").value + " ans";
      const subdomainSelect = document.getElementById("subdomain");
      const subdomain = subdomainSelect.options[subdomainSelect.selectedIndex]?.text || "";
      const sourceVal = document.getElementById("source").value;

      let sourceClean = "March√©";
      if (sourceVal === "fw") sourceClean = "Flying Whales (interne)";
      if (sourceVal === "croisee") sourceClean = "Donn√©es crois√©es";

      const median = document.getElementById("median").innerText || "N/A";
      const range = document.getElementById("range").innerText || "N/A";

      // =============================
      // üìä TABLEAU R√©f√©rence √âcole
      // =============================
      let y = 45;
      doc.setFont("helvetica", "bold");
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(13);
      doc.text("R√©f√©rence √©cole :", 15, y);

      y += 8;
      doc.setFillColor(230, 236, 245);
      doc.rect(15, y, 180, 10, "F");
      doc.setFontSize(11);
      doc.text("√âcole", 20, y + 7);
      doc.text("P25 (‚Ç¨)", 95, y + 7);
      doc.text("M√©dian (‚Ç¨)", 130, y + 7);
      doc.text("P75 (‚Ç¨)", 165, y + 7);

      // Extraction rapide
      let p25 = "N/A", p50 = "N/A", p75 = "N/A";
      const dataset = [
        ...schoolsIngenieur, ...schoolsCommerce, ...schoolsScPo,
        ...schoolsUniversite, ...schoolsIT, ...schoolsDesign
      ];
      const data = dataset.find(e => e.Ecole === school);
      if (data) {
        p25 = (data.p25 || 0).toLocaleString() + " ‚Ç¨";
        p50 = (data.p50 || 0).toLocaleString() + " ‚Ç¨";
        p75 = (data.p75 || 0).toLocaleString() + " ‚Ç¨";
      }

      y += 12;
      doc.setFillColor(255, 255, 255);
      doc.rect(15, y, 180, 10, "F");
      doc.setFont("helvetica", "normal");
      doc.text(school, 20, y + 7);
      doc.text(p25, 105, y + 7, { align: "right" });
      doc.text(p50, 145, y + 7, { align: "right" });
      doc.text(p75, 185, y + 7, { align: "right" });

      // =============================
      // üìà KPI Cards
      // =============================
      y += 25;
      doc.setFillColor(46, 204, 113);
      doc.roundedRect(15, y, 60, 25, 3, 3, "F");
      doc.setTextColor(255, 255, 255);
      doc.text("M√©dian", 20, y + 10);
      doc.setFontSize(13);
      doc.text(median, 20, y + 20);

      doc.setFillColor(52, 152, 219);
      doc.roundedRect(85, y, 70, 25, 3, 3, "F");
      doc.text("Fourchette", 90, y + 10);
      doc.text(range, 90, y + 20);

      doc.setFillColor(255, 165, 100);
      doc.roundedRect(165, y, 30, 25, 3, 3, "F");
      doc.setFontSize(11);
      doc.text("Source", 168, y + 10);
      doc.text(doc.splitTextToSize(sourceClean, 28), 168, y + 20);

      // =============================
      // üìâ Graphique
      // =============================
      y += 45;
      const chartCanvas = document.getElementById("salaryChart");
      if (chartCanvas) {
        const imgData = chartCanvas.toDataURL("image/png", 1.0);
        doc.addImage(imgData, "PNG", 15, y + 5, 180, 80);
        y += 95;
      }

      // =============================
      // üßæ R√©capitulatif
      // =============================
      doc.setFontSize(11);
      doc.setFont("helvetica", "italic");
      doc.setTextColor(80, 80, 80);

      const recap = `Profil ${job}, dipl√¥m√© de ${school}${subdomain ? " (" + subdomain + ")" : ""}, `
        + `${classification}, ${experience}. Salaire m√©dian estim√© ${median}, `
        + `projection croissante sur 40 ans.`;

      doc.text(doc.splitTextToSize(recap, 180), 15, y + 10);

      // =============================
      // üìÖ Footer
      // =============================
      doc.setFontSize(9);
      doc.setFont("helvetica", "italic");
      doc.setTextColor(120);
      const today = new Date().toLocaleDateString("fr-FR");
      doc.text(`Estimation indicative bas√©e sur les donn√©es ${sourceClean}.`, 15, 280);
      doc.text("Export√© le " + today, 170, 280);

      // üíæ Sauvegarde
      doc.save("simulateur_salaire.pdf");
      console.log("‚úÖ PDF g√©n√©r√© avec succ√®s");
    } catch (err) {
      console.error("‚ùå Erreur export PDF :", err);
      alert("Erreur lors de l'export PDF !");
    }
  }

  // ===============================
  // üåô/‚òÄÔ∏è Dark Mode toggle + persistance
  // ===============================
  function toggleDarkMode() {
    const html = document.documentElement;
    const isDark = html.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");

    // üí° Fix typographie : bascule couleur texte selon le mode
    const body = document.body;
    if (isDark) {
      body.classList.add("text-white");
      body.classList.remove("text-gray-900");
    } else {
      body.classList.remove("text-white");
      body.classList.add("text-gray-900");
    }
  }

  // üßæ Modal d‚Äôaide
  function openModal() { document.getElementById("helpModal").style.display = "flex"; }
  function closeModal() { document.getElementById("helpModal").style.display = "none"; }

  </script>

</body>
</html>

