<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simulateur Salaire - Flying Whales</title>

<!-- ‚úÖ Tailwind avec dark mode activ√© -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    darkMode: 'class'
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("‚úÖ Service Worker enregistr√©"))
        .catch(err => console.error("Erreur SW:", err));
    }
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }
  </script>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:50; }
    .modal-content { background:white; padding:2rem; border-radius:1rem; max-width:700px; }
    .dark .modal-content { background:#1f2937; color:white; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
  <header class="w-full py-6 bg-[#00AEEF] text-white dark:bg-[#003366] flex justify-between px-8 items-center transition-colors duration-300">
    <h1 class="text-2xl font-bold">‚úàÔ∏è Simulateur Salaire - Flying Whales</h1>
    <div class="flex gap-2">
      <button onclick="toggleDarkMode()" class="px-3 py-1 bg-white text-[#003366] rounded-lg">üåô/‚òÄÔ∏è</button>
      <button onclick="openModal()" class="px-3 py-1 bg-white text-[#003366] rounded-lg">‚ùì Aide</button>
    </div>
  </header>

  <!-- Modal d'aide -->
  <div id="helpModal" class="modal flex">
    <div class="modal-content">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4 transition-colors duration-300">
‚ÑπÔ∏è Aide & FAQ</h2>
      <p><b>üåç March√© :</b> donn√©es nationales (√©coles, universit√©s, fonctions, +2,3%/an, coefficients).</p>
      <p><b>üè¢ Flying Whales :</b> packages internes FW.</p>
      <p><b>‚öñÔ∏è Crois√©e :</b> combinaison 60% FW, 40% march√©.</p>
      <p><b>Graphique :</b> √©volution projet√©e sur 40 ans.</p>
      <button onclick="closeModal()" class="mt-4 px-4 py-2 bg-[#00AEEF] text-white rounded">Fermer</button>
    </div>
  </div>

  <!-- Formulaire -->
  <main class="max-w-5xl mx-auto p-6">
    <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow mb-6 transition-colors duration-300">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìù Renseigne ton profil</h2>
      
      <label>üìö Origine acad√©mique</label>
      <select id="origin" class="w-full mb-4 p-2 border rounded">
        <option value="ingenieur">√âcole d‚Äôing√©nieur</option>
        <option value="commerce">Grande √©cole de commerce</option>
        <option value="scpo">Sciences Po</option>
        <option value="universite">Universit√©</option>
      </select>

      <label>üè´ √âcole</label>
      <select id="school" class="w-full mb-4 p-2 border rounded"></select>

      <label>üíº Fonction transverse</label>
      <select id="fonction" class="w-full mb-4 p-2 border rounded"></select>

      <label>üìÖ Exp√©rience: <span id="expVal">3</span> ans</label>
      <input type="range" id="experience" min="0" max="40" value="3" class="w-full mb-4">

      <label>üî¨ Sous-domaine (ing√©nierie uniquement)</label>
      <select id="subdomain" class="w-full mb-4 p-2 border rounded"></select>

      <label>üëî R√¥le / Statut</label>
      <select id="role" class="w-full mb-4 p-2 border rounded"></select>

      <label>üè∑Ô∏è Classification interne</label>
      <select id="classification" class="w-full mb-4 p-2 border rounded">
        <option value="">-- Optionnelle --</option>
        <option value="I1">I1 - Ing√©nieur D√©butant</option>
        <option value="I2">I2 - Ing√©nieur Confirm√©</option>
        <option value="I3">I3 - Ing√©nieur Senior</option>
        <option value="I4">I4 - Ing√©nieur Expert</option>
        <option value="M1">M1 - Manager Niveau 1</option>
        <option value="M2">M2 - Manager Niveau 2</option>
        <option value="M3">M3 - Leader D√©partement</option>
        <option value="RLot">Responsable de Lot</option>
        <option value="RDept">Responsable de D√©partement</option>
      </select>

      <label>üåç R√©gion</label>
      <select id="region" class="w-full mb-4 p-2 border rounded">
        <option value="IDF">√éle-de-France</option>
        <option value="hors">Hors √éle-de-France</option>
      </select>

      <label>üè¢ Taille entreprise</label>
      <select id="companySize" class="w-full mb-4 p-2 border rounded">
        <option value="startup">Startup</option>
        <option value="PME">PME</option>
        <option value="ETI">ETI</option>
        <option value="grand-groupe">Grand Groupe</option>
      </select>

      <label>üìä Source des donn√©es</label>
      <select id="source" class="w-full mb-4 p-2 border rounded">
        <option value="marche">üåç March√©</option>
        <option value="fw">üè¢ Flying Whales (interne)</option>
        <option value="croisee">‚öñÔ∏è Donn√©es crois√©es</option>
      </select>
    </section>

    <section id="result" class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hidden">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìä R√©sultats</h2>
      <p><b>R√©f√©rence √©cole :</b> <span id="schoolRange"></span></p>
      <p><b>M√©dian √©cole :</b> <span id="schoolMedian"></span></p>
      <hr class="my-4">
      <p><b>Estimation personnalis√©e :</b></p>
      <p>M√©dian: <span id="median"></span></p>
      <p>Fourchette: <span id="range"></span></p>
      <canvas id="salaryChart" class="mt-6"></canvas>
    </section>
  </main>

  <script>
    // ===============================
    // Bloc 2 : √âcoles d‚Äôing√©nieurs (69)
    // ===============================
    const schoolsIngenieur = [
      {Ecole:"Hors liste", p25:34000, p50:38000, p75:42000},
      {Ecole:"ISA JUNIA", p25:44563, p50:47045, p75:49098},
      {Ecole:"EI PURPAN", p25:44975, p50:47918, p75:50153},
      {Ecole:"ESA", p25:45643, p50:48698, p75:50285},
      {Ecole:"ENSI POITIERS", p25:47449, p50:50129, p75:52065},
      {Ecole:"ENI BREST", p25:47783, p50:50500, p75:52804},
      {Ecole:"ENSC RENNES", p25:47816, p50:50979, p75:53549},
      {Ecole:"ENSMA", p25:48316, p50:51276, p75:53115},
      {Ecole:"ENSAIA", p25:48916, p50:51310, p75:53737},
      {Ecole:"ENISE", p25:48321, p50:51324, p75:53457},
      {Ecole:"AgroParisTech", p25:48979, p50:51545, p75:53439},
      {Ecole:"POLYTECH ORLEANS", p25:48986, p50:51671, p75:53871},
      {Ecole:"ECAM", p25:49425, p50:51887, p75:54074},
      {Ecole:"ENSE3 GRENOBLE INP", p25:49279, p50:52031, p75:54466},
      {Ecole:"IMT NORD EUROPE", p25:49554, p50:52143, p75:54446},
      {Ecole:"POLYTECH GRENOBLE", p25:49434, p50:52223, p75:54578},
      {Ecole:"POLYTECH SORBONNE", p25:49673, p50:52345, p75:54784},
      {Ecole:"ENSAI", p25:49793, p50:52586, p75:55060},
      {Ecole:"ENSEIRB MATMECA", p25:49864, p50:52673, p75:55122},
      {Ecole:"POLYTECH LYON", p25:50155, p50:52921, p75:55541},
      {Ecole:"POLYTECH LILLE", p25:50419, p50:53201, p75:55722},
      {Ecole:"INSA TOULOUSE", p25:50536, p50:53423, p75:55892},
      {Ecole:"POLYTECH NANTES", p25:50619, p50:53587, p75:56097},
      {Ecole:"POLYTECH NICE", p25:50841, p50:53821, p75:56377},
      {Ecole:"INSA LYON", p25:50987, p50:54002, p75:56514},
      {Ecole:"ESIREM", p25:51154, p50:54232, p75:56780},
      {Ecole:"ENSGSI", p25:51266, p50:54397, p75:57001},
      {Ecole:"ENSGTI", p25:51445, p50:54644, p75:57282},
      {Ecole:"ESIGELEC", p25:51562, p50:54813, p75:57405},
      {Ecole:"ENSEA", p25:51788, p50:55067, p75:57628},
      {Ecole:"ESEO", p25:51890, p50:55234, p75:57800},
      {Ecole:"INSA RENNES", p25:52076, p50:55401, p75:57955},
      {Ecole:"INSA STRASBOURG", p25:52201, p50:55629, p75:58192},
      {Ecole:"UTC COMPIEGNE", p25:52388, p50:55811, p75:58435},
      {Ecole:"UTT TROYES", p25:52516, p50:56024, p75:58674},
      {Ecole:"UTBM BELFORT", p25:52699, p50:56167, p75:58850},
      {Ecole:"SUPELEC", p25:52934, p50:56345, p75:59031},
      {Ecole:"ENSEEIHT", p25:53112, p50:56529, p75:59244},
      {Ecole:"ENSEA PARIS", p25:53284, p50:56711, p75:59461},
      {Ecole:"TELECOM PARIS", p25:53496, p50:56877, p75:59648},
      {Ecole:"TELECOM SUDPARIS", p25:53673, p50:57098, p75:59870},
      {Ecole:"ENSEEIHT TOULOUSE", p25:53845, p50:57212, p75:60065},
      {Ecole:"ENSEIRB", p25:53988, p50:57367, p75:60219},
      {Ecole:"ENSEA CERGY", p25:54111, p50:57499, p75:60352},
      {Ecole:"ENSEM NANCY", p25:54283, p50:57691, p75:60541},
      {Ecole:"ENSAM ARTS ET METIERS", p25:54420, p50:57845, p75:60698},
      {Ecole:"MINES SAINT-ETIENNE", p25:54631, p50:58012, p75:60844},
      {Ecole:"MINES NANCY", p25:54772, p50:58167, p75:61012},
      {Ecole:"MINES DOUAI", p25:54911, p50:58321, p75:61145},
      {Ecole:"CENTRALE LILLE", p25:55128, p50:58545, p75:61372},
      {Ecole:"CENTRALE NANTES", p25:55295, p50:58714, p75:61530},
      {Ecole:"CENTRALE MARSEILLE", p25:55438, p50:58873, p75:61690},
      {Ecole:"CENTRALE LYON", p25:55612, p50:59054, p75:61871},
      {Ecole:"CENTRALE PARIS", p25:55782, p50:59233, p75:62035},
      {Ecole:"CENTRALE SUP√âLEC", p25:55944, p50:59419, p75:62223},
      {Ecole:"MINES PARIS", p25:56122, p50:59598, p75:62419},
      {Ecole:"POLYTECHNIQUE", p25:56291, p50:59771, p75:62608},
      {Ecole:"ISAE-SUPAERO", p25:56462, p50:59955, p75:62891},
      {Ecole:"ENAC", p25:56634, p50:60134, p75:63080},
      {Ecole:"ESPCI", p25:56798, p50:60318, p75:63260},
      {Ecole:"ENS CACHAN", p25:56972, p50:60501, p75:63440},
      {Ecole:"ENS LYON", p25:57133, p50:60682, p75:63625},
      {Ecole:"ENS PARIS-SACLAY", p25:57301, p50:60863, p75:63804},
      {Ecole:"ENS ULM", p25:57472, p50:61048, p75:63986},
      {Ecole:"COLL√àGE DE FRANCE (ex ENS)", p25:57645, p50:61231, p75:64173}
    ];
    // ===============================
    // Bloc 3 : Grandes √©coles de commerce (30)
    // ===============================
    const schoolsCommerce = [
      {Ecole:"HEC Paris", p25:48000, p50:55000, p75:65000},
      {Ecole:"ESSEC Business School", p25:45000, p50:52000, p75:62000},
      {Ecole:"ESCP Business School", p25:44000, p50:51000, p75:60000},
      {Ecole:"EDHEC Business School", p25:42000, p50:49000, p75:58000},
      {Ecole:"emlyon Business School", p25:43000, p50:50000, p75:59000},
      {Ecole:"Audencia Business School", p25:40000, p50:47000, p75:56000},
      {Ecole:"Skema Business School", p25:38000, p50:45000, p75:53000},
      {Ecole:"NEOMA Business School", p25:37000, p50:44000, p75:52000},
      {Ecole:"Kedge Business School", p25:35000, p50:42000, p75:50000},
      {Ecole:"TBS Education", p25:36000, p50:43000, p75:51000},
      {Ecole:"Grenoble EM", p25:37000, p50:44000, p75:52000},
      {Ecole:"Montpellier BS", p25:35000, p50:42000, p75:50000},
      {Ecole:"Rennes SB", p25:34000, p50:41000, p75:49000},
      {Ecole:"ICN Business School", p25:34000, p50:40000, p75:48000},
      {Ecole:"EM Strasbourg", p25:34000, p50:40000, p75:48000},
      {Ecole:"Excelia Business School", p25:33000, p50:39000, p75:47000},
      {Ecole:"ISC Paris", p25:33000, p50:39000, p75:46000},
      {Ecole:"INSEEC Grande √âcole", p25:32000, p50:38000, p75:45000},
      {Ecole:"PSB (Paris School of Business)", p25:32000, p50:38000, p75:45000},
      {Ecole:"EMLV (√âcole de Management L√©onard de Vinci)", p25:31000, p50:37000, p75:44000},
      {Ecole:"ISG (Institut Sup√©rieur de Gestion)", p25:31000, p50:37000, p75:43000},
      {Ecole:"ESC Clermont BS", p25:31000, p50:36000, p75:42000},
      {Ecole:"Burgundy School of Business (BSB Dijon)", p25:31000, p50:36000, p75:42000},
      {Ecole:"IMT-BS (Institut Mines-T√©l√©com Business School)", p25:30000, p50:36000, p75:42000},
      {Ecole:"ESC Pau Business School", p25:30000, p50:35000, p75:41000},
      {Ecole:"SCBS (South Champagne Business School)", p25:30000, p50:35000, p75:40000},
      {Ecole:"Brest Business School", p25:29000, p50:34000, p75:39000},
      {Ecole:"ISCID-CO (Boulogne/Calais)", p25:28000, p50:33000, p75:38000},
      {Ecole:"ICD Business School", p25:28000, p50:33000, p75:38000},
      {Ecole:"ESLSCA Business School Paris", p25:28000, p50:33000, p75:38000}
    ];
    // ===============================
    // Bloc 4 : Sciences Po (10 IEP)
    // ===============================
    const schoolsScPo = [
      {Ecole:"Sciences Po Paris", p25:36000, p50:40000, p75:45000},
      {Ecole:"Sciences Po Bordeaux", p25:34000, p50:37000, p75:42000},
      {Ecole:"Sciences Po Grenoble", p25:33500, p50:36500, p75:41000},
      {Ecole:"Sciences Po Lille", p25:34000, p50:37000, p75:42000},
      {Ecole:"Sciences Po Lyon", p25:34500, p50:37500, p75:42500},
      {Ecole:"Sciences Po Rennes", p25:33000, p50:36000, p75:41000},
      {Ecole:"Sciences Po Strasbourg", p25:33500, p50:36500, p75:41500},
      {Ecole:"Sciences Po Toulouse", p25:33500, p50:36500, p75:41500},
      {Ecole:"Sciences Po Saint-Germain-en-Laye", p25:32000, p50:35000, p75:40000},
      {Ecole:"Sciences Po Aix", p25:33000, p50:36000, p75:41000}
    ];
    // ===============================
    // Bloc 5 : Universit√©s (Top 20)
    // ===============================
    const schoolsUniversite = [
      {Ecole:"Sorbonne Universit√©", p25:35000, p50:39000, p75:43000},
      {Ecole:"Universit√© Paris-Saclay", p25:35000, p50:39000, p75:43000},
      {Ecole:"Universit√© PSL (Paris Sciences & Lettres)", p25:35000, p50:39500, p75:43500},
      {Ecole:"Universit√© Paris Cit√©", p25:34000, p50:38000, p75:42000},
      {Ecole:"Universit√© de Montpellier", p25:33500, p50:37500, p75:41500},
      {Ecole:"Universit√© de Strasbourg", p25:33500, p50:37500, p75:41500},
      {Ecole:"Universit√© Grenoble Alpes", p25:33500, p50:37500, p75:41500},
      {Ecole:"Aix-Marseille Universit√©", p25:33000, p50:37000, p75:41000},
      {Ecole:"Universit√© de Bordeaux", p25:33000, p50:37000, p75:41000},
      {Ecole:"Universit√© de Lyon", p25:33000, p50:37000, p75:41000},
      {Ecole:"Universit√© de Lille", p25:32500, p50:36500, p75:40500},
      {Ecole:"Universit√© Toulouse III - Paul Sabatier", p25:32500, p50:36500, p75:40500},
      {Ecole:"Universit√© de Nantes", p25:32000, p50:36000, p75:40000},
      {Ecole:"Universit√© de Rennes 1", p25:32000, p50:36000, p75:40000},
      {Ecole:"Universit√© de Lorraine", p25:32000, p50:36000, p75:40000},
      {Ecole:"Universit√© C√¥te d‚ÄôAzur (Nice)", p25:31500, p50:35500, p75:39500},
      {Ecole:"Universit√© de Tours", p25:31000, p50:35000, p75:39000},
      {Ecole:"Universit√© d‚ÄôAngers", p25:31000, p50:35000, p75:39000},
      {Ecole:"Universit√© de Clermont Auvergne", p25:31000, p50:35000, p75:39000},
      {Ecole:"Universit√© de Reims Champagne-Ardenne", p25:30500, p50:34500, p75:38500}
    ];
    // ===============================
    // Bloc 6 : Fonctions transverses
    // ===============================

    // Achats
    const functionsAchats = {
      "Acheteur Junior": { p25:38000, p50:42000, p75:47000 },
      "Acheteur Confirm√©": { p25:45000, p50:50000, p75:55000 },
      "Responsable Achats": { p25:55000, p50:65000, p75:80000 },
      "Directeur Achats": { p25:80000, p50:95000, p75:120000 }
    };

    // Immobilier
    const functionsImmo = {
      "Charg√© de Gestion Immobili√®re": { p25:32000, p50:38000, p75:45000 },
      "Property Manager": { p25:40000, p50:52000, p75:65000 },
      "Responsable Immobilier": { p25:55000, p50:72000, p75:90000 },
      "Directeur Immobilier": { p25:80000, p50:100000, p75:125000 }
    };

    // Ressources Humaines
    const functionsRH = {
      "Charg√© RH": { p25:34000, p50:39000, p75:45000 },
      "Charg√© de Recrutement": { 
        p25:37000, 
        p50:42000, 
        p75:47000,
        fwBase: { exp: 5, salaire: 46987 } // Donn√©e FW int√©gr√©e
      },
      "Responsable Recrutement": { p25:45000, p50:53000, p75:60000 },
      "Responsable RH / HRBP": { p25:47000, p50:55250, p75:66000 },
      "Directeur des Ressources Humaines": { p25:70000, p50:95000, p75:120000 }
    };

    // Finance
    const functionsFinance = {
      "Comptable": { p25:32000, p50:37000, p75:42000 },
      "Contr√¥leur de Gestion": { p25:42000, p50:49400, p75:60000 },
      "Auditeur Interne": { p25:40000, p50:47000, p75:55000 },
      "Tr√©sorier": { p25:45000, p50:52000, p75:60000 },
      "Responsable Financier": { p25:55000, p50:65000, p75:80000 },
      "Directeur Administratif et Financier (DAF)": { p25:80000, p50:110000, p75:140000 }
    };

    // Commerciaux
    const functionsCommerciaux = {
      "Business Developer Junior": { p25:30000, p50:35000, p75:40000 },
      "Business Developer Confirm√©": { p25:38000, p50:42000, p75:48000 },
      "Ing√©nieur d‚ÄôAffaires": { p25:45000, p50:50000, p75:60000 },
      "Responsable Commercial": { p25:55000, p50:60000, p75:75000 },
      "Directeur Commercial": { p25:75000, p50:85000, p75:110000 }
    };
    <!-- =============================== -->
    <!-- Bloc 7 : Logique principale corrig√©e avec alertes debug -->
    <!-- =============================== -->

    const subdomainCoef = {
      "Calculs & Simulation":1.10,"Conception":1.05,"√âlectronique":1.08,"Avionique":1.07,
      "Mat√©riaux":1.06,"Propulsion":1.12,"M√©thodes":0.95,"Production":1.0,
      "Maintenance":0.92,"Qualit√©":0.93,"Supply Chain":0.94,"Gestion de Projet":1.05,
      "Ing√©nierie Syst√®mes":1.08,"Gestion de Programme":1.12,"Support Client":0.96,
      "Thermique":1.09,"Dynamique de Vol":1.11,
      "√âlectrique":1.10,"Test":0.97,"Structure":1.05
    };

    const roles = [
      "Ing√©nieur Standard","Expert Technique","Architecte Syst√®me","Chef de Projet",
      "Manager d‚Äô√âquipe","Directeur de Programme"
    ];

    function populateMenus() {
      const originSel=document.getElementById("origin");
      const schoolSel=document.getElementById("school");
      const fonctionSel=document.getElementById("fonction");
      const subSel=document.getElementById("subdomain");
      const roleSel=document.getElementById("role");

      // Liste √©coles selon origine
      function updateSchoolList() {
        schoolSel.innerHTML="";
        if(originSel.value==="ingenieur") schoolsIngenieur.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if(originSel.value==="commerce") schoolsCommerce.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if(originSel.value==="scpo") schoolsScPo.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if(originSel.value==="universite") schoolsUniversite.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
      }
      originSel.addEventListener("change", ()=>{updateSchoolList(); calculateSalary();});
      updateSchoolList();

      // Liste fonctions transverses
      fonctionSel.innerHTML="";
      fonctionSel.add(new Option("-- Pas de fonction transverse --","")); // ‚úÖ neutre
      const allFunctions = {
        ...functionsAchats, ...functionsImmo, ...functionsRH, ...functionsFinance, ...functionsCommerciaux
      };
      Object.keys(allFunctions).forEach(k=>fonctionSel.add(new Option(k,k)));

      // Liste sous-domaines ing√©nierie
      subSel.innerHTML="";
      subSel.add(new Option("-- Pas de sous-domaine --","")); // ‚úÖ neutre
      Object.keys(subdomainCoef).forEach(k=>subSel.add(new Option(k,k)));

      roles.forEach(r=>roleSel.add(new Option(r,r)));

      document.querySelectorAll("#school, #fonction, #subdomain, #role, #classification, #region, #companySize, #source")
        .forEach(el => el.addEventListener("change", calculateSalary));
      document.getElementById("experience").addEventListener("input", e=>{
        document.getElementById("expVal").innerText=e.target.value; 
        calculateSalary();
      });

      calculateSalary();
    }

    let chart;
    function calculateSalary() {
      const origin=document.getElementById("origin").value;
      const exp=parseInt(document.getElementById("experience").value);
      let p25=0,p50=0,p75=0;

      // === Cas 1 : √âcole seule ===
      if(origin!=="fonction"){
        const sch=document.getElementById("school").value;
        if(sch){
          if(origin==="ingenieur"){ const school=schoolsIngenieur[sch]; p25=school.p25; p50=school.p50; p75=school.p75; }
          if(origin==="commerce"){ const school=schoolsCommerce[sch]; p25=school.p25; p50=school.p50; p75=school.p75; }
          if(origin==="scpo"){ const school=schoolsScPo[sch]; p25=school.p25; p50=school.p50; p75=school.p75; }
          if(origin==="universite"){ const school=schoolsUniversite[sch]; p25=school.p25; p50=school.p50; p75=school.p75; }
        }
      }

      // === Cas 2 : Fonction transverse seule ===
      if(origin==="fonction"){
        const fn=document.getElementById("fonction").value;
        if(fn){
          const allFunctions={...functionsAchats,...functionsImmo,...functionsRH,...functionsFinance,...functionsCommerciaux};
          const f=allFunctions[fn];
          if(f){
            p25=f.p25; p50=f.p50; p75=f.p75;

            // Cas sp√©cial FW calibration
            if(f.fwBase){
              const baseExp=f.fwBase.exp;
              const baseSalary=f.fwBase.salaire;
              const factor=Math.pow(1.023,exp-baseExp);
              p25=baseSalary*0.9*factor;
              p50=baseSalary*factor;
              p75=baseSalary*1.1*factor;
            }
          }
        }
      }

      // === Cas 3 : Hybride (√©cole + fonction transverse s√©lectionn√©s) ===
      if(origin!=="fonction"){
        const fn=document.getElementById("fonction").value;
        if(fn){ 
          const allFunctions={...functionsAchats,...functionsImmo,...functionsRH,...functionsFinance,...functionsCommerciaux};
          const f=allFunctions[fn];
          if(f){
            p25 = 0.6*p25 + 0.4*f.p25;
            p50 = 0.6*p50 + 0.4*f.p50;
            p75 = 0.6*p75 + 0.4*f.p75;
          }
        }
      }

      // Affichage √©cole de r√©f√©rence
      document.getElementById("schoolRange").innerText=Math.round(p25)+"‚Ç¨ ‚Äì "+Math.round(p75)+"‚Ç¨";
      document.getElementById("schoolMedian").innerText=Math.round(p50)+"‚Ç¨";

      // Exp√©rience (+2,3%/an)
      let factor=Math.pow(1.023,exp);
      p25*=factor; p50*=factor; p75*=factor;

      // Coeffs
      const sd=subdomainCoef[document.getElementById("subdomain").value]||1;
      const regionCoef=document.getElementById("region").value==="hors"?0.86:1.14; 
      const sizeCoef={startup:0.9,PME:1.0,ETI:1.05,"grand-groupe":1.15}[document.getElementById("companySize").value]||1;
      let coef=sd*regionCoef*sizeCoef;

      // R√¥le / classification
      const classification=document.getElementById("classification").value;
      let roleCoef=1;
      if (classification==="M1") roleCoef=1.10;
      if (classification==="M2") roleCoef=1.15;
      if (classification==="M3") roleCoef=1.20;
      if (classification==="RDept") roleCoef=1.25;
      if (classification==="RLot") roleCoef=1.07;

      // Source (appliquer region + taille dans tous les cas)
      const source=document.getElementById("source").value;
      let median,low,high;
      if(source==="marche"){
        median=p50; low=p25; high=p75;
      }else if(source==="fw"){
        median=p50*0.95; low=p25*0.95; high=p75*0.95;
      }else{
        median=(p50*0.4 + p50*0.95*0.6);
        low=(p25*0.4 + p25*0.95*0.6);
        high=(p75*0.4 + p75*0.95*0.6);
      }

      // appliquer region + taille entreprise + r√¥le
      median*=coef*roleCoef;
      low*=coef*roleCoef;
      high*=coef*roleCoef;

      // Affichage
      document.getElementById("median").innerText=Math.round(median)+"‚Ç¨";
      document.getElementById("range").innerText=Math.round(low)+"‚Ç¨ ‚Äì "+Math.round(high)+"‚Ç¨";
      document.getElementById("result").classList.remove("hidden");

      // Graphique
      const ctx=document.getElementById("salaryChart").getContext("2d");
      if(chart) chart.destroy();
      const years=[...Array(41).keys()];
      const projection=years.map(y=>p50*Math.pow(1.023,y));
      chart=new Chart(ctx,{
        type:"line",
        data:{labels:years,datasets:[{label:"Projection Salaire",data:projection,borderColor:"#003366",fill:false}]},
        options:{responsive:true,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:false}}}
      });
    }

    // üåô/‚òÄÔ∏è Dark/Light toggle avec alertes debug
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }
    function toggleDarkMode() {
      const html = document.documentElement;
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.setItem('theme','light');
        alert("‚òÄÔ∏è Mode clair activ√©");
      } else {
        html.classList.add('dark');
        localStorage.setItem('theme','dark');
        alert("üåô Mode sombre activ√©");
      }
    }

    function openModal(){document.getElementById("helpModal").style.display="flex";}
    function closeModal(){document.getElementById("helpModal").style.display="none";}

    window.onload=populateMenus;
  </script>
</body>
</html>
