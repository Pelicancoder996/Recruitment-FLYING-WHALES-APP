<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Salary Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    body { 
  font-family: 'Poppins', sans-serif;
  overflow-x: hidden;
}

/* Onglets - Mode clair */
.tab-active {
  background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
  color: white;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.tab-inactive {
  background: #f3f4f6;
  color: #374151;
}

.tab-inactive:hover {
  background: #e5e7eb;
  color: #1f2937;
}

/* Onglets - Mode sombre */
.dark .tab-active {
  background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
  color: #111827;
  box-shadow: 0 4px 6px -1px rgba(255, 255, 255, 0.1);
}

.dark .tab-inactive {
  background: #374151;
  color: #d1d5db;
}

.dark .tab-inactive:hover {
  background: #4b5563;
  color: #f9fafb;
}

.label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #374151;
}

.dark .label {
  color: #e5e7eb;
}

.result-card {
  padding: 2.5rem 2rem;
  border-radius: 1.25rem;
  background: rgba(255, 255, 255, 0.95);
  border: 2px solid rgba(0, 0, 0, 0.05);
  box-shadow: 
    0 2px 8px rgba(0, 0, 0, 0.04),
    0 20px 40px rgba(0, 0, 0, 0.08);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.result-card::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: currentColor;
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.4s ease;
}

.result-card:hover::after {
  transform: scaleX(1);
}

.result-card:hover {
  transform: translateY(-8px);
  box-shadow: 
    0 4px 12px rgba(0, 0, 0, 0.06),
    0 30px 60px rgba(0, 0, 0, 0.12);
}

/* Couleurs sp√©cifiques */
.result-card.bg-gradient-to-br.from-blue-500 {
  background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
  color: #0369a1;
}

.result-card.bg-gradient-to-br.from-green-500 {
  background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
  color: #15803d;
}

.result-card.bg-gradient-to-br.from-purple-500 {
  background: linear-gradient(135deg, #ffffff 0%, #faf5ff 100%);
  color: #7e22ce;
}

/* Chiffres √©l√©gants */
.result-card .font-bold {
  color: inherit !important;
  font-weight: 800;
  font-size: 2.5rem;
  line-height: 1;
}

/* Mode sombre */
.dark .result-card {
  background: rgba(30, 41, 59, 0.95);
  border: 2px solid rgba(255, 255, 255, 0.08);
  box-shadow: 
    0 2px 8px rgba(0, 0, 0, 0.2),
    0 20px 40px rgba(0, 0, 0, 0.3);
}

.dark .result-card.bg-gradient-to-br.from-blue-500 {
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  color: #60a5fa;
}

.dark .result-card.bg-gradient-to-br.from-green-500 {
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  color: #4ade80;
}

.dark .result-card.bg-gradient-to-br.from-purple-500 {
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  color: #c084fc;
}


/* ====================================
   üí∞ TOGGLE BRUT/NET
   ==================================== */

.toggle-switch {
  position: relative;
  width: 200px;
  height: 50px;
  background: #e5e7eb;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s;
}

.dark .toggle-switch {
  background: #374151;
}

.toggle-slider {
  position: absolute;
  top: 4px;
  left: 4px;
  width: 96px;
  height: 42px;
  background: linear-gradient(135deg, #00AEEF 0%, #003366 100%);
  border-radius: 21px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.toggle-switch.net-mode .toggle-slider {
  left: 100px;
}

.toggle-label {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  font-weight: 600;
  transition: all 0.3s;
  z-index: 1;
  pointer-events: none;
}

.toggle-label-left {
  left: 32px;
  color: white;
}

.toggle-label-right {
  right: 37px;
  color: #6b7280;
}

.toggle-switch.net-mode .toggle-label-left {
  color: #6b7280;
}

.toggle-switch.net-mode .toggle-label-right {
  color: white;
}

/* ====================================
   üìä COTISATIONS
   ==================================== */

.cotisation-row {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid #e5e7eb;
}

.dark .cotisation-row {
  border-bottom-color: #374151;
}

.dark .cotisation-row span {
  color: #e5e7eb !important;
}

.dark .cotisation-row .font-bold {
  color: #ffffff !important;
}

.cotisation-category {
  font-weight: 600;
  color: #003366;
  margin-top: 15px;
  margin-bottom: 5px;
  font-size: 14px;
}

.dark .cotisation-category {
  color: #00AEEF;
}

/* ====================================
   üåô MODE DARK - Lisibilit√© compl√®te
   ==================================== */

/* Cotisations */
.dark .cotisation-row span {
  color: #e5e7eb !important;
}

.dark .cotisation-row .font-bold,
.dark #total-salarial,
.dark #total-patronal {
  color: #ffffff !important;
}

/* D√©tail imp√¥t */
.dark .bg-orange-50 .text-gray-700,
.dark .bg-orange-900\/20 .text-gray-700 {
  color: #e5e7eb !important;
}

.dark #revenu-imposable,
.dark #impot-total {
  color: #ffffff !important;
}

/* ====================================
   üì± RESPONSIVE TOGGLE MOBILE
   ==================================== */

@media (max-width: 640px) {
  .toggle-switch {
    width: 180px;
    height: 44px;
  }

  .toggle-slider {
    width: 86px;
    height: 36px;
  }

  .toggle-switch.net-mode .toggle-slider {
    left: 90px;
  }

  .toggle-label {
    font-size: 12px;
  }

  .toggle-label-left {
    left: 28px;
  }

  .toggle-label-right {
    right: 33px;
  }
}



.comparison-bar {
  transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}

.dark input, .dark select {
  background-color: #374151 !important;
  color: #f9fafb !important;
  border-color: #4b5563 !important;
}

.school-info-box {
  transition: all 0.3s ease;
  opacity: 0;
  max-height: 0;
  overflow: hidden;
}

.school-info-box.show {
  opacity: 1;
  max-height: 200px;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.02); }
}

.pulse-btn {
  animation: pulse 2s infinite;
}

/* ====================================
   üì± RESPONSIVE MOBILE
   ==================================== */

/* Tablette et mobile */
@media (max-width: 1024px) {
  header h1 {
    font-size: 1.5rem !important;
  }

  .max-w-7xl, .max-w-5xl {
    padding-left: 1rem;
    padding-right: 1rem;
  }

  /* Tabs responsive */
  .tab-active, .tab-inactive {
    padding: 0.5rem 1rem !important;
    font-size: 0.875rem;
  }

  /* Grilles responsive */
  .grid {
    grid-template-columns: 1fr !important;
  }

  /* Profils comparateur c√¥te √† c√¥te sur tablette */
  @media (min-width: 768px) {
    .grid.lg\\:grid-cols-2 {
      grid-template-columns: repeat(2, 1fr) !important;
    }
  }
}

/* Mobile strict */
@media (max-width: 640px) {
  body {
    font-size: 14px;
  }

  header {
    padding: 1rem 0 !important;
  }

  header h1 {
    font-size: 1.25rem !important;
  }

  header button {
    padding: 0.5rem 0.75rem !important;
    font-size: 0.875rem;
  }

  /* Tabs mobile */
  .flex.gap-4 {
    gap: 0.5rem !important;
  }

  .tab-active, .tab-inactive {
    padding: 0.5rem 0.75rem !important;
    font-size: 0.75rem;
    flex: 1;
    text-align: center;
  }

  /* Cartes */
  .rounded-2xl {
    border-radius: 1rem !important;
  }

  .p-8 {
    padding: 1rem !important;
  }

  .p-6 {
    padding: 0.875rem !important;
  }

  /* Inputs et selects plus grands (touch-friendly) */
  select, input[type="range"] {
    padding: 0.75rem !important;
    font-size: 1rem !important;
    min-height: 44px; /* Taille minimum Apple */
  }

  /* Boutons plus grands */
  button {
    padding: 0.75rem 1.25rem !important;
    font-size: 1rem !important;
    min-height: 44px;
  }

  /* Titres */
  h2 {
    font-size: 1.25rem !important;
  }

  h1 {
    font-size: 1.5rem !important;
  }

  /* R√©sultats m√©dians */
  .text-3xl {
    font-size: 1.75rem !important;
  }

  .text-4xl {
    font-size: 2rem !important;
  }

  /* Labels plus petits */
  label {
    font-size: 0.8rem !important;
  }

  /* Espacement r√©duit */
  .space-y-4 > * + * {
    margin-top: 0.75rem !important;
  }

  .space-y-3 > * + * {
    margin-top: 0.5rem !important;
  }

  .gap-6 {
    gap: 1rem !important;
  }

  .gap-4 {
    gap: 0.75rem !important;
  }

  /* Scroll optimis√© pour profils comparateur */
  .max-h-\\[650px\\] {
    max-height: 400px !important;
  }

  /* School info box */
  .school-info-box {
    padding: 0.5rem !important;
    font-size: 0.75rem !important;
  }

  /* Barre de comparaison */
  .h-12 {
    height: 3rem !important;
  }

  .comparison-bar span {
    font-size: 0.75rem !important;
    padding: 0 0.5rem !important;
  }

  /* Graphique Chart.js */
  canvas {
    max-height: 200px !important;
  }

  /* Insights */
  #comparison-insight p,
  #insight-main,
  #insight-academic,
  #insight-professional {
    font-size: 0.875rem !important;
    line-height: 1.4 !important;
  }

  /* Grid colonnes forc√©es */
  .grid.md\\:grid-cols-2,
  .grid.md\\:grid-cols-3 {
    grid-template-columns: 1fr !important;
  }

  /* Cartes r√©sultats empil√©es */
  .bg-gradient-to-br {
    padding: 1rem !important;
  }

  /* Padding g√©n√©ral r√©duit */
  .px-8 {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }

  .pb-12 {
    padding-bottom: 2rem !important;
  }

  /* Range slider plus visible */
  input[type="range"] {
    height: 8px;
  }

  input[type="range"]::-webkit-slider-thumb {
    width: 24px;
    height: 24px;
  }

  input[type="range"]::-moz-range-thumb {
    width: 24px;
    height: 24px;
  }
}

/* Tr√®s petit mobile (iPhone SE, etc.) */
@media (max-width: 375px) {
  header h1 {
    font-size: 1rem !important;
  }

  .tab-active, .tab-inactive {
    font-size: 0.7rem;
    padding: 0.4rem 0.5rem !important;
  }

  .text-4xl {
    font-size: 1.5rem !important;
  }

  .text-3xl {
    font-size: 1.25rem !important;
  }

  .text-2xl {
    font-size: 1.125rem !important;
  }
}

/* Mode paysage mobile */
@media (max-width: 896px) and (orientation: landscape) {
  header {
    padding: 0.5rem 0 !important;
  }

  .max-h-\\[650px\\],
  .max-h-\\[600px\\] {
    max-height: 300px !important;
  }
}

/* ====================================
   üåç BOUTON EXPATRIATION PREMIUM GRADIENT
   ==================================== */

button#tab-expat {
  position: relative !important;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%) !important;
  color: white !important;
  border: 2px solid transparent !important;
  background-clip: padding-box !important;
  overflow: hidden !important;
}

button#tab-expat::before {
  content: '' !important;
  position: absolute !important;
  top: 0 !important;
  left: -100% !important;
  width: 100% !important;
  height: 100% !important;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent) !important;
  transition: left 0.5s !important;
  z-index: 0 !important;
  pointer-events: none !important;
}

button#tab-expat:hover::before {
  left: 100% !important;
}

button#tab-expat span {
  position: relative !important;
  z-index: 1 !important;
}

button#tab-expat.tab-active {
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4), 0 0 30px rgba(118, 75, 162, 0.3) !important;
  transform: translateY(-2px) !important;
  border-color: rgba(255, 255, 255, 0.3) !important;
}

button#tab-expat.tab-inactive {
  opacity: 0.7 !important;
}

button#tab-expat.tab-inactive:hover {
  opacity: 0.85 !important;
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
}

.dark button#tab-expat.tab-active {
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5), 0 0 35px rgba(118, 75, 162, 0.4) !important;
}

/* ====================================
   üì± OPTIMISATION 4 BOUTONS SUR UNE LIGNE (ULTRA-COMPACT)
   ==================================== */

/* R√©duction MAXIMALE pour tous les boutons */
.max-w-7xl > .px-4 > .flex button {
  padding: 0.45rem 0.7rem !important;
  font-size: 0.75rem !important;
  white-space: nowrap;
  letter-spacing: -0.02em; /* L√©g√®re compression texte */
}

/* Desktop large : un peu plus d'espace */
@media (min-width: 1400px) {
  .max-w-7xl > .px-4 > .flex button {
    padding: 0.6rem 1rem !important;
    font-size: 0.85rem !important;
    letter-spacing: normal;
  }
}

/* Desktop standard */
@media (min-width: 1024px) and (max-width: 1399px) {
  .max-w-7xl > .px-4 > .flex button {
    padding: 0.5rem 0.8rem !important;
    font-size: 0.78rem !important;
  }
}

/* Tablette : cache emojis */
@media (min-width: 768px) and (max-width: 1023px) {
  .max-w-7xl > .px-4 > .flex button {
    padding: 0.5rem 0.7rem !important;
    font-size: 0.72rem !important;
  }
  
  .max-w-7xl > .px-4 > .flex button span.hidden {
    display: none !important;
  }
}

/* Mobile : 2 par ligne */
@media (max-width: 767px) {
  .max-w-7xl > .px-4 > .flex {
    justify-content: space-between;
  }
  
  .max-w-7xl > .px-4 > .flex button {
    flex: 1 1 48% !important;
    padding: 0.6rem 0.5rem !important;
    font-size: 0.75rem !important;
    margin-bottom: 0.5rem;
  }
  
  .max-w-7xl > .px-4 > .flex button span {
    display: none !important;
  }
}

/* ====================================
   üåé BOUTONS PAYS EXPATRIATION
   ==================================== */

.country-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem;
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 0.75rem;
  cursor: pointer;
  transition: all 0.3s;
}

.dark .country-btn {
  background: #1f2937;
  border-color: #374151;
}

.dark .country-btn .text-xs {
  color: #e5e7eb !important;
}

.country-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border-color: #667eea;
}

.dark .country-btn:hover {
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.country-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
}

.country-btn.active span {
  color: white;
}

.country-btn.active .text-xs {
  color: rgba(255, 255, 255, 0.9);
}

/* ====================================
   üîÑ BOUTONS MODE EXPATRIATION
   ==================================== */

.expat-mode-btn {
  background: transparent;
  color: #6b7280;
  border: 1px solid transparent;
  cursor: pointer;
  padding: 0.35rem 0.75rem !important;
  font-size: 0.7rem !important;
  white-space: nowrap;
}

.expat-mode-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
}

.dark .expat-mode-btn {
  color: #9ca3af;
}

.dark .expat-mode-btn.active {
  color: white;
}
  </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
  
  <!-- Header -->
  <header class="w-full py-6 bg-gradient-to-r from-[#00AEEF] to-[#003366] text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-8 flex justify-between items-center">
      <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold">Salary Pro </h1>
      <button onclick="toggleDarkMode()" class="px-3 py-2 sm:px-4 bg-white/20 hover:bg-white/30 rounded-lg transition text-sm sm:text-base">
        üåô/‚òÄÔ∏è
      </button>
    </div>
  </header>

<div class="max-w-7xl mx-auto px-4 sm:px-8 mt-6">
  <div class="flex gap-2 sm:gap-4 mb-6 flex-wrap">
    <button 
  id="tab-simulator" 
  onclick="switchTab('simulator')" 
  class="tab-active flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
  <span class="hidden sm:inline">üìä </span>Simulateur
</button>

<button 
  id="tab-comparator" 
  onclick="switchTab('comparator')" 
  class="tab-inactive flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
  <span class="hidden sm:inline">üë• </span>Comparateur
</button>

<button 
  id="tab-brutnet" 
  onclick="switchTab('brutnet')" 
  class="tab-inactive flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
  <span class="hidden sm:inline">üí∞ </span>Brut/Net
</button>

<button 
  id="tab-expat" 
  onclick="switchTab('expat')" 
  class="tab-inactive flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
  <span class="hidden sm:inline">üåç </span><span id="expat-text">Expatriation</span>
</button>

<button 
  id="tab-juridique" 
  onclick="switchTab('juridique')" 
  class="tab-inactive flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
  <span class="hidden sm:inline">‚öñÔ∏è </span>
  <span id="juridique-text">
    <span class="sm:hidden">Juridique</span>
    <span class="hidden sm:inline">Juridique & Fiscal</span>
  </span>
</button>

  </div>
</div>
  
  
<!-- ============================================= -->
  <!-- CONTENU : SIMULATEUR -->
  <!-- ============================================= -->
  <div id="content-simulator" class="max-w-5xl mx-auto px-4 sm:px-8 pb-8 sm:pb-12">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8 mb-6">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìù Renseigne ton profil</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
        
        <!-- Secteur -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè∑Ô∏è Secteur</label>
          <select id="sector" class="w-full p-2 border rounded-lg">
            <option value="ingenieur">Ing√©nierie</option>
            <option value="commerce">Grande √©cole de commerce</option>
            <option value="scpo">Sciences Po</option>
            <option value="universite">Universit√©</option>
            <option value="it">Informatique / IT</option>
            <option value="design">Design / UX / UI</option>
            <option value="fonction">Fonctions transverses</option>
          </select>
        </div>

        <!-- √âcole -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìö √âcole</label>
          <select id="school" class="w-full p-2 border rounded-lg"></select>
        </div>
      </div>

<!-- Fourchette sortie d'√©cole -->
      <div id="schoolInfo" class="school-info-box mt-3 p-2 sm:p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500">
        <p class="text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Salaire sortie d'√©cole</p>
        <div class="grid grid-cols-3 gap-2 text-xs">
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">P25:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP25">‚Äî</span>
          </div>
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">M√©d:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP50">‚Äî</span>
          </div>
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">P75:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP75">‚Äî</span>
          </div>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-4 mt-4">
        <!-- Niveau d'anglais -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üåé Niveau d'anglais</label>
          <select id="englishLevel" class="w-full p-2 border rounded-lg">
            <option value="basic">Basique (A2‚ÄìB1)</option>
            <option value="intermediate">Interm√©diaire (B2)</option>
            <option value="advanced">Avanc√© (C1)</option>
            <option value="bilingual">Bilingue / International (C2)</option>
          </select>
        </div>

        
<!-- Niveau d'√©tudes -->
<div>
  <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üéì Niveau d'√©tudes</label>
  <select id="educationLevel" class="w-full p-2 border rounded-lg">
    <option value="bac2_technicien">Bac+2 (Technicien - BTS/DUT)</option>
    <option value="bac2_technicien_sup">Bac+2/3 (Technicien sup√©rieur / Licence pro)</option>
    <option value="bac3">Bac+3 (Licence)</option>
    <option value="bac5_master">Bac+5 (Master universitaire)</option>
    <option value="bac5_master_ingenierie">Bac+5 (Master sp√©cialis√© ing√©nierie)</option>
    <option value="bac5_ingenieur" selected>Bac+5 (Dipl√¥me d'ing√©nieur)</option>
    <option value="bac8">Bac+8 (Doctorat)</option>
  </select>
</div>
        
<!-- Type de contrat -->
<div>
  <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìú Type de contrat</label>
  <select id="contractType" class="w-full p-2 border rounded-lg">
    <option value="cdi">CDI</option>
    <option value="cdd">CDD</option>
    <option value="alternance">Alternance</option>
  </select>
</div>

        <!-- Secteur industriel -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè≠ Secteur industriel</label>
          <select id="industry" class="w-full p-2 border rounded-lg">
            <option value="aero">A√©ronautique / Spatial</option>
            <option value="auto">Automobile / Mobilit√©</option>
            <option value="energie">√ânergie / Nucl√©aire</option>
            <option value="num√©rique">Num√©rique / IT</option>
            <option value="sante">Sant√© / Biotech</option>
            <option value="luxe">Luxe / Design</option>
            <option value="public">Secteur public</option>
          </select>
        </div>

        <!-- Taille d'√©quipe -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üë• Taille d'√©quipe encadr√©e (Manager)</label>
          <select id="teamSize" class="w-full p-2 border rounded-lg">
            <option value="none">Aucune</option>
            <option value="small">1 √† 5 personnes</option>
            <option value="medium">6 √† 15 personnes</option>
            <option value="large">16 √† 50 personnes</option>
            <option value="xl">Plus de 50 personnes</option>
          </select>
        </div>

        <!-- Package global -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üéÅ Package global</label>
          <select id="packageLevel" class="w-full p-2 border rounded-lg">
            <option value="standard">Salaire fixe</option>
            <option value="bonus">Fixe + bonus (5‚Äì10%)</option>
            <option value="bonusplus">Fixe + bonus (15‚Äì25%)</option>
            <option value="actions">(Fixe + bonus)Package + actions / BSPCE</option>
          </select>
        </div>

        <!-- Exp√©rience -->
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">
            üìÖ Exp√©rience: <span id="expVal">3</span> ans
          </label>
          <input type="range" id="experience" min="0" max="40" value="3" class="w-full accent-blue-600">
        </div>

        <!-- R√©gion -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üåç R√©gion</label>
          <select id="region" class="w-full p-2 border rounded-lg">
            <option value="IDF">√éle-de-France</option>
            <option value="hors">Hors √éle-de-France</option>
          </select>
        </div>

        <!-- Taille entreprise -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè¢ Taille entreprise</label>
          <select id="companySize" class="w-full p-2 border rounded-lg">
            <option value="startup">Startup</option>
            <option value="PME">PME</option>
            <option value="ETI">ETI</option>
            <option value="grand-groupe">Grand Groupe</option>
          </select>
        </div>

        <!-- Management -->
<div>
  <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üëî Management</label>
  <select id="classification" class="w-full p-2 border rounded-lg">
    <option value="">Pas de management</option>
    <option value="M1">M1 - Manager d'√©quipe</option>
    <option value="M2">M2 - Senior Manager</option>
    <option value="M3">M3 - Leader</option>
    <option value="directeur_technique">Directeur Technique</option>
  </select>
</div>

        <!-- Source des donn√©es -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìä Source des donn√©es</label>
          <select id="source" class="w-full p-2 border rounded-lg">
            <option value="marche">üåç March√©</option>
            <option value="fw">üè¢ Flying Whales (interne)</option>
            <option value="croisee">‚öñÔ∏è Donn√©es crois√©es</option>
          </select>
        </div>
        <!-- Sous-domaine technique -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üî¨ Sous-domaine technique</label>
          <select id="subdomain" class="w-full p-2 border rounded-lg">
            <option value="">-- Aucun --</option>
            <option value="Fonction sp√©cifique">Fonction sp√©cifique (pilote, astronaute...)</option>
            <option value="Calculs & Simulation">Calculs & Simulation </option>
            <option value="Conception">Conception </option>
            <option value="√âlectronique">√âlectronique </option>
            <option value="Avionique">Avionique </option>
            <option value="Mat√©riaux">Mat√©riaux </option>
            <option value="Propulsion">Propulsion </option>
            <option value="M√©thodes">M√©thodes </option>
            <option value="Production">Production </option>
            <option value="Maintenance">Maintenance </option>
            <option value="Qualit√©">Qualit√© </option>
            <option value="Supply Chain">Supply Chain </option>
            <option value="Gestion de Projet">Gestion de Projet </option>
            <option value="Ing√©nierie Syst√®mes">Ing√©nierie Syst√®mes </option>
            <option value="Gestion de Programme">Gestion de Programme </option>
            <option value="Support Client">Support Client </option>
            <option value="Thermique">Thermique </option>
            <option value="Dynamique de Vol">Dynamique de Vol </option>
            <option value="√âlectrique">√âlectrique</option>
            <option value="Test">Test </option>
          </select>
        </div>
        
        <!-- M√©tier / Fonction -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üíº M√©tier / Fonction</label>
          <select id="jobFunction" class="w-full p-2 border rounded-lg">
            <option value="">-- Aucun --</option>
            <optgroup label="üíª IT / Tech">
              <option value="D√©veloppeur Front-End">D√©veloppeur Front-End</option>
              <option value="D√©veloppeur Back-End">D√©veloppeur Back-End</option>
              <option value="D√©veloppeur Full-Stack">D√©veloppeur Full-Stack</option>
              <option value="Data Engineer">Data Engineer</option>
              <option value="Data Scientist">Data Scientist</option>
              <option value="DevOps / SRE">DevOps / SRE</option>
              <option value="Infra / R√©seau">Infra / R√©seau</option>
              <option value="Cloud Architect">Cloud Architect</option>
              <option value="Cybersecurity Engineer">Cybersecurity Engineer</option>
              <option value="Admin Syst√®mes">Admin Syst√®mes</option>
              <option value="Product Owner">Product Owner</option>
              <option value="Product Manager">Product Manager</option>
            </optgroup>
            <optgroup label="üé® Design / UX">
              <option value="UX Designer">UX Designer</option>
              <option value="UI Designer">UI Designer</option>
              <option value="UX/UI Designer">UX/UI Designer</option>
              <option value="Product Designer">Product Designer</option>
              <option value="Motion Designer">Motion Designer</option>
              <option value="Graphiste / Branding">Graphiste / Branding</option>
              <option value="Interaction Designer">Interaction Designer</option>
            </optgroup>
            <optgroup label="üõí Achats">
              <option value="Acheteur Junior">Acheteur Junior</option>
              <option value="Acheteur Confirm√©">Acheteur Confirm√©</option>
              <option value="Responsable Achats">Responsable Achats</option>
              <option value="Directeur Achats">Directeur Achats</option>
            </optgroup>
            <optgroup label="üè¢ Immobilier">
              <option value="Charg√© de Gestion Immobili√®re">Charg√© de Gestion Immobili√®re</option>
              <option value="Property Manager">Property Manager</option>
              <option value="Responsable Immobilier">Responsable Immobilier</option>
              <option value="Directeur Immobilier">Directeur Immobilier</option>
            </optgroup>
            <optgroup label="üë• Ressources Humaines">
              <option value="Charg√© RH">Charg√© RH</option>
              <option value="Talent Acquisition">Talent Acquisition</option>
              <option value="Senior Talent Acquisition">Senior Talent Acquisition</option>
              <option value="Talent Acquisition Manager">Talent Acquisition Manager</option>
              <option value="Responsable RH / HRBP">Responsable RH / HRBP</option>
              <option value="Directeur des Ressources Humaines">Directeur des Ressources Humaines</option>
            </optgroup>
            <optgroup label="üí∞ Finance / Gestion">
              <option value="Comptable">Comptable</option>
              <option value="Contr√¥leur de Gestion">Contr√¥leur de Gestion</option>
              <option value="Auditeur Interne">Auditeur Interne</option>
              <option value="Tr√©sorier">Tr√©sorier</option>
              <option value="Responsable Financier">Responsable Financier</option>
              <option value="Directeur Administratif et Financier (DAF)">Directeur Administratif et Financier (DAF)</option>
            </optgroup>
            <optgroup label="üìà Commercial / Business">
              <option value="Business Developer Junior">Business Developer Junior</option>
              <option value="Business Developer Confirm√©">Business Developer Confirm√©</option>
              <option value="Responsable Commercial">Responsable Commercial</option>
              <option value="Directeur Commercial">Directeur Commercial</option>
            </optgroup>
            <optgroup label="üì¢ Communication">
              <option value="Charg√© de communication">Charg√© de communication</option>
              <option value="Responsable de communication">Responsable de communication</option>
              <option value="Directeur de la communication">Directeur de la communication</option>
            </optgroup>
            <optgroup label="‚úàÔ∏è Ing√©nieurs Ops">
              <option value="Ing√©nieur Op√©ration">Ing√©nieur Op√©ration</option>
              <option value="Ing√©nieur Op√©ration Senior">Ing√©nieur Op√©ration Senior</option>
              <option value="Ing√©nieur Mission">Ing√©nieur Mission</option>
              <option value="Ing√©nieur Mission Senior">Ing√©nieur Mission Senior</option>
            </optgroup>
          </select>
          
          
        </div>
        
<!-- Certifications professionnelles (checkboxes) -->
<div>
  <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">
    üèÖ Certifications professionnelles 
    <span class="text-xs font-normal text-gray-500">(cochez toutes celles que vous poss√©dez)</span>
  </label>
  
  <div class="max-h-64 overflow-y-auto border rounded-lg p-3 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-200">
<!-- Executive Education -->
<div class="mb-3">
  <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üéì Executive Education / Grandes √âcoles</p>
  <div class="space-y-1 ml-2">
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="escp_ai_business" class="mr-2">
      <span>ESCP - Executive program</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="hec_digital" class="mr-2">
      <span>HEC - Digital Leadership</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="hec_ai" class="mr-2">
      <span>HEC - Executive MBA</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="insead_digital" class="mr-2">
      <span>INSEAD - Digital Transformation</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="insead_ai" class="mr-2">
      <span>INSEAD - General Management Programme</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="polytechnique_ai" class="mr-2">
      <span>Polytechnique - Executive Program</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="mit_ai" class="mr-2">
      <span>MIT - Executive Education</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="stanford_ai" class="mr-2">
      <span>Stanford - Strategic Leadership</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="essec_management" class="mr-2">
      <span>ESSEC - Advanced Management</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="emlyon_innovation" class="mr-2">
      <span>emlyon - Innovation & Entrepreneurship</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="edhec_finance" class="mr-2">
      <span>EDHEC - Executive Finance</span>
    </label>
    <label class="flex items-center text-sm">
      <input type="checkbox" name="certifications" value="sciences_po_leadership" class="mr-2">
      <span>Sciences Po - Executive Leadership</span>
    </label>
  </div>
</div>
    
    <!-- IA / ML -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">ü§ñ Intelligence Artificielle / ML</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="gen_ai" class="mr-2">
          <span>Generative AI (GPT/LLM)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="mlops" class="mr-2">
          <span>MLOps Engineer</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="deep_learning" class="mr-2">
          <span>Deep Learning Specialization</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="tensorflow_dev" class="mr-2">
          <span>TensorFlow Developer</span>
        </label>
      </div>
    </div>
    
    <!-- Cloud -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">‚òÅÔ∏è Cloud / Infrastructure</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="aws_architect" class="mr-2">
          <span>AWS Solutions Architect</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="azure_architect" class="mr-2">
          <span>Azure Solutions Architect</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="gcp_architect" class="mr-2">
          <span>Google Cloud Architect</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="kubernetes" class="mr-2">
          <span>Kubernetes (CKA/CKAD)</span>
        </label>
      </div>
    </div>
    
    <!-- Cybers√©curit√© -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üîí Cybers√©curit√©</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="cissp" class="mr-2">
          <span>CISSP</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="oscp" class="mr-2">
          <span>OSCP</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="ceh" class="mr-2">
          <span>CEH (Ethical Hacker)</span>
        </label>
      </div>
    </div>
    
    <!-- Data & Analytics -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üìä Data & Analytics</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="databricks" class="mr-2">
          <span>Databricks Certified</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="snowflake" class="mr-2">
          <span>Snowflake Certified</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="power_bi" class="mr-2">
          <span>Microsoft Power BI Expert</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="tableau" class="mr-2">
          <span>Tableau Desktop Specialist</span>
        </label>
      </div>
    </div>
    
    <!-- Gestion de projet -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üéØ Gestion de projet / Product</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="pmp" class="mr-2">
          <span>PMP (Project Management)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="scrum_master" class="mr-2">
          <span>Scrum Master (PSM/CSM)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="product_owner" class="mr-2">
          <span>Product Owner (PSPO/CSPO)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="safe" class="mr-2">
          <span>SAFe Certified</span>
        </label>
      </div>
    </div>
    
    <!-- Finance -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üí∞ Finance / Comptabilit√©</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="cfa" class="mr-2">
          <span>CFA (Chartered Financial Analyst)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="cpa" class="mr-2">
          <span>CPA</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="acca" class="mr-2">
          <span>ACCA</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="frm" class="mr-2">
          <span>FRM (Risk Management)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="dec" class="mr-2">
          <span>DEC (Expert-comptable)</span>
        </label>
      </div>
    </div>
    
    <!-- Paie -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üíº Paie / Social</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="paie_gestionnaire" class="mr-2">
          <span>Gestionnaire de Paie Certifi√©</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="paie_silae" class="mr-2">
          <span>SILAE Expert</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="paie_sage" class="mr-2">
          <span>Sage Paie Expert</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="droit_social" class="mr-2">
          <span>Droit Social Approfondi</span>
        </label>
      </div>
    </div>
    
    <!-- RH -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üë• RH / Recrutement</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="shrm" class="mr-2">
          <span>SHRM-CP / SHRM-SCP</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="ats_expert" class="mr-2">
          <span>ATS Expert (Workday/Greenhouse)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="sourcing_advanced" class="mr-2">
          <span>Boolean Search / Sourcing Avanc√©</span>
        </label>
        <label class="flex items-center text-sm">
  <input type="checkbox" name="certifications" value="linkedin_recruiter" class="mr-2">
  <span>Recrutement <span class="text-gray-500 text-xs">(EDR, LinkedIn...)</span>

      </div>
    </div>
    
    <!-- Office -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üìà Suite Microsoft Office</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="excel_expert" class="mr-2">
          <span>Excel Expert (VBA, Power Query)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="excel_advanced" class="mr-2">
          <span>Excel Avanc√© (TCD, formules)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="power_automate" class="mr-2">
          <span>Power Automate Expert</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="ms365_admin" class="mr-2">
          <span>Microsoft 365 Administrator</span>
        </label>
      </div>
    </div>
    
    <!-- ERP -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üè¢ ERP / Syst√®mes</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="sap_fico" class="mr-2">
          <span>SAP FI/CO</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="sap_mm" class="mr-2">
          <span>SAP MM (Achats/Stock)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="sap_hr" class="mr-2">
          <span>SAP HR</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="oracle_ebs" class="mr-2">
          <span>Oracle E-Business Suite</span>
        </label>
      </div>
    </div>
    
    <!-- CRM / Marketing -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üõí CRM / Sales / Marketing</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="salesforce_admin" class="mr-2">
          <span>Salesforce Administrator</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="salesforce_dev" class="mr-2">
          <span>Salesforce Developer</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="google_ads" class="mr-2">
          <span>Google Ads Certified</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="seo_advanced" class="mr-2">
          <span>SEO Advanced</span>
        </label>
      </div>
    </div>
    
    <!-- Qualit√© / Lean -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üè≠ Qualit√© / Lean</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="six_sigma_black" class="mr-2">
          <span>Six Sigma Black Belt</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="six_sigma_green" class="mr-2">
          <span>Six Sigma Green Belt</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="lean_expert" class="mr-2">
          <span>Lean Management Expert</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="itil" class="mr-2">
          <span>ITIL Foundation</span>
        </label>
      </div>
    </div>
    
    <!-- Design -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üé® Design / UX</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="ux_certified" class="mr-2">
          <span>UX Certification (Nielsen Norman)</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="adobe_certified" class="mr-2">
          <span>Adobe Certified Expert</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="figma_advanced" class="mr-2">
          <span>Figma Advanced</span>
        </label>
      </div>
    </div>
    
    <!-- Ing√©nierie -->
    <div class="mb-3">
      <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">üèóÔ∏è Ing√©nierie / CAO</p>
      <div class="space-y-1 ml-2">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="catia" class="mr-2">
          <span>CATIA Expert</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="solidworks" class="mr-2">
          <span>SolidWorks Certified</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="bim_manager" class="mr-2">
          <span>BIM Manager Certified</span>
        </label>
        <label class="flex items-center text-sm">
          <input type="checkbox" name="certifications" value="autocad_certified" class="mr-2">
          <span>AutoCAD Certified Professional</span>
        </label>
      </div>
    </div>
    
    
  </div>
  
  <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
    üí° Les certifications s√©lectionn√©es augmenteront votre salaire et score de raret√© (cumul d√©gressif)
  </p>
</div>
        
      </div>
    </div>

<!-- R√©sultats Simulateur -->
    <div id="result" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8 hidden">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìä R√©sultats</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-4 sm:mb-6">
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Salaire M√©dian</p>
          <p class="text-2xl sm:text-3xl font-bold text-blue-600" id="median">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Fourchette Basse</p>
          <p class="text-2xl sm:text-3xl font-bold text-green-600" id="low">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Fourchette Haute</p>
          <p class="text-2xl sm:text-3xl font-bold text-purple-600" id="high">‚Äî</p>
        </div>
      </div>
      
      <!-- Synth√®se d'analyse d√©taill√©e -->
      <div id="detailedAnalysis" class="mb-6 space-y-4">
        
        <!-- Positionnement march√© -->
        <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl border-l-4 border-blue-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">üìä Positionnement sur le march√©</h3>
          <p id="analysis-market" class="text-sm text-gray-700 dark:text-gray-300">‚Äî</p>
        </div>

        <!-- Facteurs valorisants -->
        <div class="p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl border-l-4 border-green-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">‚úÖ Facteurs valorisants</h3>
          <ul id="analysis-positive" class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-disc list-inside">
            <li>En cours d'analyse...</li>
          </ul>
        </div>

        <!-- Points d'attention -->
        <div class="p-4 bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-xl border-l-4 border-orange-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">‚ö†Ô∏è Points d'attention</h3>
          <ul id="analysis-attention" class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-disc list-inside">
            <li>En cours d'analyse...</li>
          </ul>
        </div>

        <!-- Projection carri√®re -->
        <div class="p-4 bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 rounded-xl border-l-4 border-purple-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">üöÄ Projection de carri√®re</h3>
          <div id="analysis-projection" class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
            <p>‚Äî</p>
          </div>
        </div>

        <!-- Recommandations -->
        <div class="p-4 bg-gradient-to-r from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 rounded-xl border-l-4 border-yellow-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">üí° Recommandations</h3>
          <ul id="analysis-recommendations" class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-disc list-inside">
            <li>En cours d'analyse...</li>
          </ul>
        </div>
        
        <!-- ========== SCORE DE RARET√â ========== -->
<div id="rarity-score" class="mb-6 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl shadow-lg p-6 hidden">
  <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
    <span class="text-3xl">üåü</span> Score de Raret√© du Profil
  </h3>
  
  <!-- Score principal -->
  <div class="text-center mb-6">
    <div class="inline-block relative">
      <svg class="w-32 h-32">
        <circle cx="64" cy="64" r="56" fill="none" stroke="#e5e7eb" stroke-width="8"/>
        <circle id="rarity-circle" cx="64" cy="64" r="56" fill="none" stroke="url(#gradient)" stroke-width="8" 
                stroke-dasharray="352" stroke-dashoffset="352" transform="rotate(-90 64 64)" 
                style="transition: stroke-dashoffset 1s ease"/>
        <defs>
          <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
          </linearGradient>
        </defs>
      </svg>
      <div class="absolute inset-0 flex items-center justify-center">
        <div>
          <p id="rarity-score-value" class="text-4xl font-bold text-purple-600 dark:text-purple-400">‚Äî</p>
          <p class="text-xs text-gray-600 dark:text-gray-400">/ 100</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- D√©tails du score -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <!-- Facteurs de raret√© -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
      <h4 class="font-bold text-sm text-gray-700 dark:text-gray-300 mb-3">üîç Facteurs de raret√©</h4>
      <div id="rarity-factors" class="space-y-2 text-xs">
        <!-- Rempli dynamiquement -->
      </div>
    </div>
    
    <!-- Statistiques march√© -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
      <h4 class="font-bold text-sm text-gray-700 dark:text-gray-300 mb-3">üìä Statistiques march√©</h4>
      <div class="space-y-3 text-xs">
        <div>
          <p class="text-gray-600 dark:text-gray-400">Profils similaires en France</p>
          <p id="similar-profiles" class="text-lg font-bold text-purple-600">‚Äî</p>
        </div>
        <div>
          <p class="text-gray-600 dark:text-gray-400">Postes ouverts estim√©s/an</p>
          <p id="open-positions" class="text-lg font-bold text-blue-600">‚Äî</p>
        </div>
        <div>
          <p class="text-gray-600 dark:text-gray-400">Ratio Offre/Demande</p>
          <p id="supply-demand" class="text-lg font-bold text-green-600">‚Äî</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Conclusion -->
  <div id="rarity-conclusion" class="bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-purple-500">
    <p class="text-sm text-gray-700 dark:text-gray-300">
      <strong class="text-purple-600">üí° Conclusion :</strong> 
      <span id="rarity-message">Analyse en cours...</span>
    </p>
  </div>
</div>

      </div>
      <canvas id="salaryChart" class="mt-4 sm:mt-6"></canvas>

      <!-- Bouton Export PDF -->
      <button onclick="exportSimulatorPDF()" class="mt-4 sm:mt-6 w-full sm:w-auto px-4 sm:px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition pulse-btn text-sm sm:text-base">
        üìÑ Exporter en PDF
      </button>
    </div>
  </div>
  
<!-- ============================================= -->
  <!-- CONTENU : COMPARATEUR -->
  <!-- ============================================= -->
  <div id="content-comparator" class="max-w-7xl mx-auto px-4 sm:px-8 pb-8 sm:pb-12 hidden">
    
    <!-- Grille de comparaison -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
      
      <!-- ========== PROFIL A ========== -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 sm:p-6 text-white">
          <h2 class="text-xl sm:text-2xl font-bold mb-2">Profil A</h2>
          <p class="text-2xl sm:text-4xl font-bold" id="resultA-median">‚Äî</p>
        </div>
        <div class="p-4 sm:p-6 space-y-2 sm:space-y-3 max-h-[400px] sm:max-h-[650px] overflow-y-auto">
          
          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur</label>
            <select id="sectorA" class="w-full p-2 text-sm border rounded-lg">
              <option value="ingenieur">Ing√©nierie</option>
              <option value="commerce">Commerce</option>
              <option value="scpo">Sciences Po</option>
              <option value="universite">Universit√©</option>
              <option value="it">IT</option>
              <option value="design">Design</option>
              <option value="fonction">Fonctions transverses</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">√âcole</label>
            <select id="schoolA" class="w-full p-2 text-sm border rounded-lg"></select>
          </div>

          <!-- Fourchette √âcole A -->
          <div id="schoolInfoA" class="school-info-box p-2 bg-blue-50 dark:bg-blue-900/20 rounded border-l-4 border-blue-500">
            <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Sortie d'√©cole</p>
            <div class="flex justify-between text-xs">
              <div><span class="text-gray-600 dark:text-gray-400">P25:</span> <span class="font-bold text-blue-600" id="schoolP25A">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">M√©d:</span> <span class="font-bold text-blue-600" id="schoolP50A">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">P75:</span> <span class="font-bold text-blue-600" id="schoolP75A">‚Äî</span></div>
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'anglais</label>
            <select id="englishLevelA" class="w-full p-2 text-sm border rounded-lg">
              <option value="basic">Basique (A2‚ÄìB1)</option>
              <option value="intermediate">Interm√©diaire (B2)</option>
              <option value="advanced">Avanc√© (C1)</option>
              <option value="bilingual">Bilingue (C2)</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'√©tudes</label>
            <select id="educationLevelA" class="w-full p-2 text-sm border rounded-lg">
               <option value="bac2_technicien">Bac+2 (Technicien - BTS/DUT)</option>
    <option value="bac2_technicien_sup">Bac+2/3 (Technicien sup√©rieur / Licence pro)</option>
    <option value="bac3">Bac+3 (Licence)</option>
    <option value="bac5_master">Bac+5 (Master universitaire)</option>
    <option value="bac5_master_ingenierie">Bac+5 (Master sp√©cialis√© ing√©nierie)</option>
    <option value="bac5_ingenieur" selected>Bac+5 (Dipl√¥me d'ing√©nieur)</option>
    <option value="bac8">Bac+8 (Doctorat)</option>
            </select>
          </div>

          <div>
  <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Type de contrat</label>
  <select id="contractTypeA" class="w-full p-2 text-sm border rounded-lg">
    <option value="cdi">CDI</option>
    <option value="cdd">CDD</option>
    <option value="alternance">Alternance</option>
  </select>
</div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur industriel</label>
            <select id="industryA" class="w-full p-2 text-sm border rounded-lg">
              <option value="aero">A√©ronautique</option>
              <option value="auto">Automobile</option>
              <option value="energie">√ânergie</option>
              <option value="num√©rique">Num√©rique</option>
              <option value="sante">Sant√©</option>
              <option value="luxe">Luxe</option>
              <option value="public">Public</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille √©quipe</label>
            <select id="teamSizeA" class="w-full p-2 text-sm border rounded-lg">
              <option value="none">Aucune</option>
              <option value="small">1-5</option>
              <option value="medium">6-15</option>
              <option value="large">16-50</option>
              <option value="xl">50+</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Package</label>
            <select id="packageLevelA" class="w-full p-2 text-sm border rounded-lg">
              <option value="standard">Standard</option>
              <option value="bonus">Bonus 5-10%</option>
              <option value="bonusplus">Variable 15-25%</option>
              <option value="actions">Actions/BSPCE</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">
              Exp√©rience: <span id="expValA">3</span> ans
            </label>
            <input type="range" id="experienceA" min="0" max="40" value="3" class="w-full accent-blue-600">
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">R√©gion</label>
            <select id="regionA" class="w-full p-2 text-sm border rounded-lg">
              <option value="IDF">√éle-de-France</option>
              <option value="hors">Hors IDF</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille entreprise</label>
            <select id="companySizeA" class="w-full p-2 text-sm border rounded-lg">
              <option value="startup">Startup</option>
              <option value="PME">PME</option>
              <option value="ETI">ETI</option>
              <option value="grand-groupe" selected>Grand Groupe</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Classification</label>
            <select id="classificationA" class="w-full p-2 text-sm border rounded-lg">
              <option value="">Pas de management</option>
    <option value="M1">M1 - Manager d'√©quipe</option>
    <option value="M2">M2 - Senior Manager</option>
    <option value="M3">M3 - Leader</option>
    <option value="directeur_technique">Directeur Technique</option>
            </select>
          </div>
          
          <div>
  <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">üî¨ Sous-domaine technique</label>
  <select id="subdomainA" class="w-full p-2 text-sm border rounded-lg">
    <option value="">-- Aucun --</option>
    <option value="Fonction sp√©cifique">Fonction sp√©cifique (pilote, astronaute...)</option>
    <option value="Calculs & Simulation">Calculs & Simulation</option>
    <option value="Conception">Conception</option>
    <option value="√âlectronique">√âlectronique</option>
    <option value="Avionique">Avionique</option>
    <option value="Mat√©riaux">Mat√©riaux</option>
    <option value="Propulsion">Propulsion</option>
    <option value="M√©thodes">M√©thodes </option>
    <option value="Production">Production</option>
    <option value="Maintenance">Maintenance </option>
    <option value="Qualit√©">Qualit√©</option>
    <option value="Supply Chain">Supply Chain </option>
    <option value="Gestion de Projet">Gestion de Projet </option>
    <option value="Ing√©nierie Syst√®mes">Ing√©nierie Syst√®mes </option>
    <option value="Gestion de Programme">Gestion de Programme </option>
    <option value="Support Client">Support Client </option>
    <option value="Thermique">Thermique</option>
    <option value="Dynamique de Vol">Dynamique de Vol</option>
    <option value="√âlectrique">√âlectrique </option>
    <option value="Test">Test</option>
  </select>
</div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Source</label>
            <select id="sourceA" class="w-full p-2 text-sm border rounded-lg">
              <option value="marche">March√©</option>
              <option value="fw">FW</option>
              <option value="croisee">Crois√©e</option>
            </select>
          </div>
          
          <div>
  <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">üíº M√©tier</label>
  <select id="jobFunctionA" class="w-full p-2 text-sm border rounded-lg">
    <option value="">-- Aucun --</option>
    <optgroup label="üíª IT / Tech">
      <option value="D√©veloppeur Front-End">D√©veloppeur Front-End</option>
      <option value="D√©veloppeur Back-End">D√©veloppeur Back-End</option>
      <option value="D√©veloppeur Full-Stack">D√©veloppeur Full-Stack</option>
      <option value="Data Engineer">Data Engineer</option>
      <option value="Data Scientist">Data Scientist</option>
      <option value="DevOps / SRE">DevOps / SRE</option>
      <option value="Infra / R√©seau">Infra / R√©seau</option>
      <option value="Cloud Architect">Cloud Architect</option>
      <option value="Cybersecurity Engineer">Cybersecurity Engineer</option>
      <option value="Admin Syst√®mes">Admin Syst√®mes</option>
      <option value="Product Owner">Product Owner</option>
      <option value="Product Manager">Product Manager</option>
    </optgroup>
    <optgroup label="üé® Design / UX">
      <option value="UX Designer">UX Designer</option>
      <option value="UI Designer">UI Designer</option>
      <option value="UX/UI Designer">UX/UI Designer</option>
      <option value="Product Designer">Product Designer</option>
      <option value="Motion Designer">Motion Designer</option>
      <option value="Graphiste / Branding">Graphiste / Branding</option>
      <option value="Interaction Designer">Interaction Designer</option>
    </optgroup>
    <optgroup label="üõí Achats">
      <option value="Acheteur Junior">Acheteur Junior</option>
      <option value="Acheteur Confirm√©">Acheteur Confirm√©</option>
      <option value="Responsable Achats">Responsable Achats</option>
      <option value="Directeur Achats">Directeur Achats</option>
    </optgroup>
    <optgroup label="üè¢ Immobilier">
      <option value="Charg√© de Gestion Immobili√®re">Charg√© de Gestion Immobili√®re</option>
      <option value="Property Manager">Property Manager</option>
      <option value="Responsable Immobilier">Responsable Immobilier</option>
      <option value="Directeur Immobilier">Directeur Immobilier</option>
    </optgroup>
    <optgroup label="üë• Ressources Humaines">
      <option value="Charg√© RH">Charg√© RH</option>
      <option value="Talent Acquisition">Talent Acquisition</option>
      <option value="Senior Talent Acquisition">Senior Talent Acquisition</option>
      <option value="Talent Acquisition Manager">Talent Acquisition Manager</option>
      <option value="Responsable RH / HRBP">Responsable RH / HRBP</option>
      <option value="Directeur des Ressources Humaines">Directeur des Ressources Humaines</option>
    </optgroup>
    <optgroup label="üí∞ Finance / Gestion">
      <option value="Comptable">Comptable</option>
      <option value="Contr√¥leur de Gestion">Contr√¥leur de Gestion</option>
      <option value="Auditeur Interne">Auditeur Interne</option>
      <option value="Tr√©sorier">Tr√©sorier</option>
      <option value="Responsable Financier">Responsable Financier</option>
      <option value="Directeur Administratif et Financier (DAF)">Directeur Administratif et Financier (DAF)</option>
    </optgroup>
    <optgroup label="üìà Commercial / Business">
      <option value="Business Developer Junior">Business Developer Junior</option>
      <option value="Business Developer Confirm√©">Business Developer Confirm√©</option>
      <option value="Responsable Commercial">Responsable Commercial</option>
      <option value="Directeur Commercial">Directeur Commercial</option>
    </optgroup>
    <optgroup label="üì¢ Communication">
      <option value="Charg√© de communication">Charg√© de communication</option>
      <option value="Responsable de communication">Responsable de communication</option>
      <option value="Directeur de la communication">Directeur de la communication</option>
    </optgroup>
    <optgroup label="‚úàÔ∏è Ing√©nieurs Ops">
      <option value="Ing√©nieur Op√©ration">Ing√©nieur Op√©ration</option>
      <option value="Ing√©nieur Op√©ration Senior">Ing√©nieur Op√©ration Senior</option>
      <option value="Ing√©nieur Mission">Ing√©nieur Mission</option>
      <option value="Ing√©nieur Mission Senior">Ing√©nieur Mission Senior</option>
    </optgroup>
  </select>
</div>

          <div class="pt-3 border-t">
            <p class="text-xs text-gray-600 dark:text-gray-400">
              Fourchette: <span class="font-semibold text-gray-800 dark:text-white" id="resultA-range">‚Äî</span>
            </p>
          </div>
        </div>
      </div>

      <!-- ========== PROFIL B ========== -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 sm:p-6 text-white">
          <h2 class="text-xl sm:text-2xl font-bold mb-2">Profil B</h2>
          <p class="text-2xl sm:text-4xl font-bold" id="resultB-median">‚Äî</p>
        </div>
        <div class="p-4 sm:p-6 space-y-2 sm:space-y-3 max-h-[400px] sm:max-h-[650px] overflow-y-auto">
          
          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur</label>
            <select id="sectorB" class="w-full p-2 text-sm border rounded-lg">
              <option value="ingenieur">Ing√©nierie</option>
              <option value="commerce">Commerce</option>
              <option value="scpo">Sciences Po</option>
              <option value="universite">Universit√©</option>
              <option value="it">IT</option>
              <option value="design">Design</option>
              <option value="fonction">Fonctions transverses</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">√âcole</label>
            <select id="schoolB" class="w-full p-2 text-sm border rounded-lg"></select>
          </div>

          <!-- Fourchette √âcole B -->
          <div id="schoolInfoB" class="school-info-box p-2 bg-green-50 dark:bg-green-900/20 rounded border-l-4 border-green-500">
            <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Sortie d'√©cole</p>
            <div class="flex justify-between text-xs">
              <div><span class="text-gray-600 dark:text-gray-400">P25:</span> <span class="font-bold text-green-600" id="schoolP25B">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">M√©d:</span> <span class="font-bold text-green-600" id="schoolP50B">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">P75:</span> <span class="font-bold text-green-600" id="schoolP75B">‚Äî</span></div>
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'anglais</label>
            <select id="englishLevelB" class="w-full p-2 text-sm border rounded-lg">
              <option value="basic">Basique (A2‚ÄìB1)</option>
              <option value="intermediate">Interm√©diaire (B2)</option>
              <option value="advanced">Avanc√© (C1)</option>
              <option value="bilingual">Bilingue (C2)</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'√©tudes</label>
            <select id="educationLevelB" class="w-full p-2 text-sm border rounded-lg">
               <option value="bac2_technicien">Bac+2 (Technicien - BTS/DUT)</option>
    <option value="bac2_technicien_sup">Bac+2/3 (Technicien sup√©rieur / Licence pro)</option>
    <option value="bac3">Bac+3 (Licence)</option>
    <option value="bac5_master">Bac+5 (Master universitaire)</option>
    <option value="bac5_master_ingenierie">Bac+5 (Master sp√©cialis√© ing√©nierie)</option>
    <option value="bac5_ingenieur" selected>Bac+5 (Dipl√¥me d'ing√©nieur)</option>
    <option value="bac8">Bac+8 (Doctorat)</option>
            </select>
          </div>

          <div>
  <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Type de contrat</label>
  <select id="contractTypeB" class="w-full p-2 text-sm border rounded-lg">
    <option value="cdi">CDI</option>
    <option value="cdd">CDD</option>
    <option value="alternance">Alternance</option>
  </select>
</div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur industriel</label>
            <select id="industryB" class="w-full p-2 text-sm border rounded-lg">
              <option value="aero">A√©ronautique</option>
              <option value="auto">Automobile</option>
              <option value="energie">√ânergie</option>
              <option value="num√©rique">Num√©rique</option>
              <option value="sante">Sant√©</option>
              <option value="luxe">Luxe</option>
              <option value="public">Public</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille √©quipe</label>
            <select id="teamSizeB" class="w-full p-2 text-sm border rounded-lg">
              <option value="none">Aucune</option>
              <option value="small">1-5</option>
              <option value="medium">6-15</option>
              <option value="large">16-50</option>
              <option value="xl">50+</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Package</label>
            <select id="packageLevelB" class="w-full p-2 text-sm border rounded-lg">
              <option value="standard">Standard</option>
              <option value="bonus">Bonus 5-10%</option>
              <option value="bonusplus">Variable 15-25%</option>
              <option value="actions">Actions/BSPCE</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">
              Exp√©rience: <span id="expValB">5</span> ans
            </label>
            <input type="range" id="experienceB" min="0" max="40" value="5" class="w-full accent-green-600">
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">R√©gion</label>
            <select id="regionB" class="w-full p-2 text-sm border rounded-lg">
              <option value="IDF">√éle-de-France</option>
              <option value="hors" selected>Hors IDF</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille entreprise</label>
            <select id="companySizeB" class="w-full p-2 text-sm border rounded-lg">
              <option value="startup">Startup</option>
              <option value="PME" selected>PME</option>
              <option value="ETI">ETI</option>
              <option value="grand-groupe">Grand Groupe</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Classification</label>
            <select id="classificationB" class="w-full p-2 text-sm border rounded-lg">
              <option value="">Pas de management</option>
    <option value="M1">M1 - Manager d'√©quipe</option>
    <option value="M2">M2 - Senior Manager</option>
    <option value="M3">M3 - Leader</option>
    <option value="directeur_technique">Directeur Technique</option>
            </select>
          </div>
          
          <div>
  <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">üî¨ Sous-domaine technique</label>
  <select id="subdomainB" class="w-full p-2 text-sm border rounded-lg">
    <option value="">-- Aucun --</option>
    <option value="Fonction sp√©cifique">Fonction sp√©cifique (pilote, astronaute...)</option>
    <option value="Calculs & Simulation">Calculs & Simulation</option>
    <option value="Conception">Conception</option>
    <option value="√âlectronique">√âlectronique</option>
    <option value="Avionique">Avionique</option>
    <option value="Mat√©riaux">Mat√©riaux</option>
    <option value="Propulsion">Propulsion</option>
    <option value="M√©thodes">M√©thodes</option>
    <option value="Production">Production</option>
    <option value="Maintenance">Maintenance</option>
    <option value="Qualit√©">Qualit√©</option>
    <option value="Supply Chain">Supply Chain</option>
    <option value="Gestion de Projet">Gestion de Projet</option>
    <option value="Ing√©nierie Syst√®mes">Ing√©nierie Syst√®mes</option>
    <option value="Gestion de Programme">Gestion de Programme</option>
    <option value="Support Client">Support Client</option>
    <option value="Thermique">Thermique</option>
    <option value="Dynamique de Vol">Dynamique de Vol</option>
    <option value="√âlectrique">√âlectrique</option>
    <option value="Test">Test</option>
  </select>
</div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Source</label>
            <select id="sourceB" class="w-full p-2 text-sm border rounded-lg">
              <option value="marche">March√©</option>
              <option value="fw">FW</option>
              <option value="croisee">Crois√©e</option>
            </select>
          </div>
          
          <div>
  <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">üíº M√©tier</label>
  <select id="jobFunctionB" class="w-full p-2 text-sm border rounded-lg">
    <option value="">-- Aucun --</option>
    <optgroup label="üíª IT / Tech">
      <option value="D√©veloppeur Front-End">D√©veloppeur Front-End</option>
      <option value="D√©veloppeur Back-End">D√©veloppeur Back-End</option>
      <option value="D√©veloppeur Full-Stack">D√©veloppeur Full-Stack</option>
      <option value="Data Engineer">Data Engineer</option>
      <option value="Data Scientist">Data Scientist</option>
      <option value="DevOps / SRE">DevOps / SRE</option>
      <option value="Infra / R√©seau">Infra / R√©seau</option>
      <option value="Cloud Architect">Cloud Architect</option>
      <option value="Cybersecurity Engineer">Cybersecurity Engineer</option>
      <option value="Admin Syst√®mes">Admin Syst√®mes</option>
      <option value="Product Owner">Product Owner</option>
      <option value="Product Manager">Product Manager</option>
    </optgroup>
    <optgroup label="üé® Design / UX">
      <option value="UX Designer">UX Designer</option>
      <option value="UI Designer">UI Designer</option>
      <option value="UX/UI Designer">UX/UI Designer</option>
      <option value="Product Designer">Product Designer</option>
      <option value="Motion Designer">Motion Designer</option>
      <option value="Graphiste / Branding">Graphiste / Branding</option>
      <option value="Interaction Designer">Interaction Designer</option>
    </optgroup>
    <optgroup label="üõí Achats">
      <option value="Acheteur Junior">Acheteur Junior</option>
      <option value="Acheteur Confirm√©">Acheteur Confirm√©</option>
      <option value="Responsable Achats">Responsable Achats</option>
      <option value="Directeur Achats">Directeur Achats</option>
    </optgroup>
    <optgroup label="üè¢ Immobilier">
      <option value="Charg√© de Gestion Immobili√®re">Charg√© de Gestion Immobili√®re</option>
      <option value="Property Manager">Property Manager</option>
      <option value="Responsable Immobilier">Responsable Immobilier</option>
      <option value="Directeur Immobilier">Directeur Immobilier</option>
    </optgroup>
    <optgroup label="üë• Ressources Humaines">
      <option value="Charg√© RH">Charg√© RH</option>
      <option value="Talent Acquisition">Talent Acquisition</option>
      <option value="Senior Talent Acquisition">Senior Talent Acquisition</option>
      <option value="Talent Acquisition Manager">Talent Acquisition Manager</option>
      <option value="Responsable RH / HRBP">Responsable RH / HRBP</option>
      <option value="Directeur des Ressources Humaines">Directeur des Ressources Humaines</option>
    </optgroup>
    <optgroup label="üí∞ Finance / Gestion">
      <option value="Comptable">Comptable</option>
      <option value="Contr√¥leur de Gestion">Contr√¥leur de Gestion</option>
      <option value="Auditeur Interne">Auditeur Interne</option>
      <option value="Tr√©sorier">Tr√©sorier</option>
      <option value="Responsable Financier">Responsable Financier</option>
      <option value="Directeur Administratif et Financier (DAF)">Directeur Administratif et Financier (DAF)</option>
    </optgroup>
    <optgroup label="üìà Commercial / Business">
      <option value="Business Developer Junior">Business Developer Junior</option>
      <option value="Business Developer Confirm√©">Business Developer Confirm√©</option>
      <option value="Responsable Commercial">Responsable Commercial</option>
      <option value="Directeur Commercial">Directeur Commercial</option>
    </optgroup>
    <optgroup label="üì¢ Communication">
      <option value="Charg√© de communication">Charg√© de communication</option>
      <option value="Responsable de communication">Responsable de communication</option>
      <option value="Directeur de la communication">Directeur de la communication</option>
    </optgroup>
    <optgroup label="‚úàÔ∏è Ing√©nieurs Ops">
      <option value="Ing√©nieur Op√©ration">Ing√©nieur Op√©ration</option>
      <option value="Ing√©nieur Op√©ration Senior">Ing√©nieur Op√©ration Senior</option>
      <option value="Ing√©nieur Mission">Ing√©nieur Mission</option>
      <option value="Ing√©nieur Mission Senior">Ing√©nieur Mission Senior</option>
    </optgroup>
  </select>
</div>

          <div class="pt-3 border-t">
            <p class="text-xs text-gray-600 dark:text-gray-400">
              Fourchette: <span class="font-semibold text-gray-800 dark:text-white" id="resultB-range">‚Äî</span>
            </p>
          </div>
          
        </div>
      </div>
    </div>

<!-- ========== ANALYSE COMPARATIVE PEAUFIN√âE ========== -->
    <div id="comparison-results" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìä Analyse Comparative</h2>
      
      <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
  <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
    </svg>
    √âvolution salariale comparative
  </h3>
  
  <div class="bg-gray-50 rounded-lg p-4">
    <canvas id="comparisonSalaryChart"></canvas>
  </div>
  
  <p class="text-xs text-gray-500 mt-3 text-center italic">
    Projection bas√©e sur une augmentation annuelle moyenne de 2,3% (hors promotions et changements de poste)
  </p>
</div>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Diff√©rence (A - B)</p>
          <p id="diff-absolute" class="text-2xl sm:text-3xl font-bold">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">√âcart relatif</p>
          <p id="diff-percent" class="text-2xl sm:text-3xl font-bold">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Ratio A/B</p>
          <p id="diff-ratio" class="text-2xl sm:text-3xl font-bold text-blue-600">‚Äî</p>
        </div>
      </div>

      <!-- Visualisation barre -->
      <div class="mb-4 sm:mb-6">
        <div class="flex items-center justify-between mb-2 sm:mb-3">
          <span class="text-xs sm:text-sm font-semibold text-blue-600">Profil A</span>
          <span class="text-xs sm:text-sm font-semibold text-green-600">Profil B</span>
        </div>
        <div class="relative h-10 sm:h-12 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
          <div id="bar-A" class="comparison-bar absolute top-0 left-0 h-full bg-blue-500 flex items-center justify-end pr-2 sm:pr-3" style="width: 50%">
            <span class="text-white text-xs sm:text-sm font-bold" id="bar-A-text">‚Äî</span>
          </div>
          <div id="bar-B" class="comparison-bar absolute top-0 right-0 h-full bg-green-500 flex items-center justify-start pl-2 sm:pl-3" style="width: 50%">
            <span class="text-white text-xs sm:text-sm font-bold" id="bar-B-text">‚Äî</span>
          </div>
        </div>
      </div>

      <!-- Analyse d√©taill√©e multi-facteurs -->
      <div id="comparison-insight" class="space-y-3 sm:space-y-4">
        <!-- Insight principal -->
        <div class="p-3 sm:p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
          <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">
            üí° <strong>Synth√®se :</strong> <span id="insight-main">Configure les deux profils pour voir l'analyse.</span>
          </p>
        </div>

        <!-- D√©tails comparatifs -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
          <div class="p-3 sm:p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
            <p class="text-xs font-semibold text-blue-700 dark:text-blue-300 mb-2">üéì Facteurs acad√©miques</p>
            <p id="insight-academic" class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">‚Äî</p>
          </div>
          <div class="p-3 sm:p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
            <p class="text-xs font-semibold text-green-700 dark:text-green-300 mb-2">üíº Facteurs professionnels</p>
            <p id="insight-professional" class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">‚Äî</p>
          </div>
        </div>
      </div>

      <!-- Bouton Export PDF Comparaison -->
      <button onclick="exportComparisonPDF()" class="mt-4 sm:mt-6 w-full sm:w-auto px-4 sm:px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition pulse-btn text-sm sm:text-base">
        üìÑ Exporter la comparaison en PDF
      </button>
    </div>
  </div>
  
  <!-- ============================================= -->
  <!-- CONTENU : BRUT/NET (NOUVEAU) -->
  <!-- ============================================= -->
  <div id="content-brutnet" class="max-w-5xl mx-auto px-4 sm:px-8 pb-8 sm:pb-12 hidden">
    
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">üí∞ Calculateur Brut/Net 2024</h2>
      
      <!-- Toggle Brut/Net -->
      <div class="flex justify-center mb-8">
        <div id="toggle-mode" class="toggle-switch" onclick="toggleCalculationMode()">
          <span class="toggle-label toggle-label-left">BRUT</span>
          <span class="toggle-label toggle-label-right">NET</span>
          <div class="toggle-slider"></div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <!-- Colonne Gauche : Inputs -->
        <div class="space-y-4">
          
          <!-- Input Montant -->
          <div>
            <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300" id="input-label">
              üí∂ Salaire Brut Annuel
            </label>
            <input 
              type="number" 
              id="salary-input-brutnet" 
              placeholder="Ex: 42000" 
              class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-lg font-semibold focus:border-blue-500 dark:bg-gray-700 dark:text-white"
              oninput="calculateBrutNet()">
          </div>

          <!-- Statut -->
          <div>
            <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">
              üëî Statut
            </label>
            <select id="statut-brutnet" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:text-white" onchange="calculateBrutNet()">
              <option value="cadre">Cadre</option>
              <option value="non-cadre">Non-cadre</option>
            </select>
          </div>

          <!-- Parts fiscales -->
          <div>
            <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">
              üë®‚Äçüë©‚Äçüëß Parts fiscales
            </label>
            <select id="parts-fiscales" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:text-white" onchange="calculateBrutNet()">
              <option value="1">1 part (c√©libataire)</option>
              <option value="1.5">1,5 parts (c√©libataire + 1 enfant)</option>
              <option value="2">2 parts (couple)</option>
              <option value="2.5">2,5 parts (couple + 1 enfant)</option>
              <option value="3">3 parts (couple + 2 enfants)</option>
              <option value="3.5">3,5 parts (couple + 3 enfants)</option>
              <option value="4">4 parts (couple + 4 enfants)</option>
            </select>
          </div>

          <!-- Avantages en nature -->
          <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
            <h3 class="font-semibold mb-3 text-gray-800 dark:text-white">üéÅ Avantages en nature (optionnel)</h3>
            
            <div class="space-y-3">
              <div>
                <label class="flex items-center gap-2 text-sm">
                  <input type="checkbox" id="avantage-voiture" onchange="toggleAvantage('voiture')">
                  <span class="text-gray-700 dark:text-gray-300">Voiture de fonction</span>
                </label>
                <input 
                  type="number" 
                  id="voiture-value" 
                  placeholder="Valeur annuelle (‚Ç¨)" 
                  class="w-full mt-1 p-2 border rounded text-sm dark:bg-gray-700 dark:text-white"
                  oninput="calculateBrutNet()"
                  disabled>
              </div>

              <div>
                <label class="flex items-center gap-2 text-sm">
                  <input type="checkbox" id="avantage-tickets" onchange="toggleAvantage('tickets')">
                  <span class="text-gray-700 dark:text-gray-300">Tickets restaurant</span>
                </label>
                <input 
                  type="number" 
                  id="tickets-value" 
                  placeholder="Valeur annuelle (‚Ç¨)" 
                  class="w-full mt-1 p-2 border rounded text-sm dark:bg-gray-700 dark:text-white"
                  oninput="calculateBrutNet()"
                  disabled>
              </div>

              <div>
                <label class="flex items-center gap-2 text-sm">
                  <input type="checkbox" id="avantage-logement" onchange="toggleAvantage('logement')">
                  <span class="text-gray-700 dark:text-gray-300">Logement de fonction</span>
                </label>
                <input 
                  type="number" 
                  id="logement-value" 
                  placeholder="Valeur annuelle (‚Ç¨)" 
                  class="w-full mt-1 p-2 border rounded text-sm dark:bg-gray-700 dark:text-white"
                  oninput="calculateBrutNet()"
                  disabled>
              </div>
            </div>
          </div>

        </div>

        <!-- Colonne Droite : R√©sultats -->
        <div class="space-y-4">
          
          <!-- R√©sultat Principal -->
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white">
            <p class="text-sm opacity-80 mb-2" id="result-label">Salaire Net Annuel (avant imp√¥ts)</p>
            <p class="text-4xl font-bold" id="result-value">‚Äî</p>
            <p class="text-xs opacity-70 mt-2">Pr√©l√®vement √† la source non d√©duit</p>
          </div>

          <!-- Net apr√®s imp√¥ts -->
          <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white">
            <p class="text-sm opacity-80 mb-1">üí∏ Net apr√®s imp√¥ts</p>
            <p class="text-2xl font-bold" id="net-apres-impots">‚Äî</p>
            <p class="text-xs opacity-70 mt-1">Bar√®me progressif 2024</p>
          </div>

          <!-- D√©tail imp√¥t -->
          <div class="bg-orange-50 dark:bg-orange-900/20 rounded-xl p-4">
            <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">üìä D√©tail calcul imp√¥t</p>
            <div class="text-sm space-y-1">
              <div class="flex justify-between">
                <span class="text-gray-700 dark:text-gray-300">Revenu imposable :</span>
                <span class="font-bold" id="revenu-imposable">‚Äî</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-700 dark:text-gray-300">Imp√¥t annuel :</span>
                <span class="font-bold text-orange-600" id="impot-total">‚Äî</span>
              </div>
            </div>
          </div>

          <!-- Mensuel -->
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-gray-100 dark:bg-gray-700 rounded-xl p-4">
              <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Brut mensuel</p>
              <p class="text-lg font-bold text-gray-900 dark:text-white" id="brut-mensuel">‚Äî</p>
            </div>
            <div class="bg-gray-100 dark:bg-gray-700 rounded-xl p-4">
              <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Net mensuel</p>
              <p class="text-lg font-bold text-gray-900 dark:text-white" id="net-mensuel">‚Äî</p>
            </div>
          </div>

          <!-- Co√ªt Employeur -->
          <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white">
            <p class="text-sm opacity-80 mb-1">üíº Co√ªt Total Employeur</p>
            <p class="text-2xl font-bold" id="cout-employeur">‚Äî</p>
            <p class="text-xs opacity-70 mt-1">Charges patronales incluses</p>
          </div>

        </div>

      </div>
    </div>

    <!-- D√©tail des Cotisations -->
    <div id="cotisations-detail" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 hidden">
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">üìã D√©tail des Cotisations 2024</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <!-- Cotisations Salariales -->
        <div>
          <h4 class="cotisation-category">üßë Cotisations Salariales</h4>
          <div id="cotisations-salariales"></div>
          <div class="cotisation-row font-bold text-lg mt-4">
            <span>Total salarial</span>
            <span id="total-salarial">‚Äî</span>
          </div>
        </div>

        <!-- Cotisations Patronales -->
        <div>
          <h4 class="cotisation-category">üè¢ Cotisations Patronales</h4>
          <div id="cotisations-patronales"></div>
          <div class="cotisation-row font-bold text-lg mt-4">
            <span>Total patronal</span>
            <span id="total-patronal">‚Äî</span>
          </div>
        </div>

      </div>

      <!-- Graphique R√©partition -->
      <div class="mt-6">
        <h4 class="font-bold text-gray-800 dark:text-white mb-4">üìä R√©partition</h4>
        <canvas id="repartitionChart" class="max-h-64"></canvas>
      </div>
    </div>

  </div>
  
  <!-- ============================================= -->
  <!-- CONTENU : EXPATRIATION -->
  <!-- ============================================= -->
  <div id="content-expat" class="max-w-7xl mx-auto px-4 sm:px-8 pb-8 sm:pb-12 hidden">
    
    <div class="flex justify-between items-center mb-6">

        
        <button 
          onclick="fetchExchangeRates()" 
          class="px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded-lg transition flex items-center gap-2"
          title="Mettre √† jour les taux de change">
          <span>üîÑ</span>
          <span class="hidden sm:inline">Actualiser taux</span>
        </button>
      </div>
      
      <!-- R√©f√©rence France -->
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 mb-6">
        <h3 class="font-semibold text-gray-800 dark:text-white mb-3">üá´üá∑ Votre situation actuelle en France</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Salaire Brut Annuel</label>
            <input 
              type="number" 
              id="expat-salary-france" 
              placeholder="Ex: 42000" 
              class="w-full p-2 border rounded-lg text-sm dark:bg-gray-700 dark:text-white"
              oninput="calculateExpatriation()">
          </div>
          <div>
            <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Statut</label>
            <select id="expat-statut-france" class="w-full p-2 border rounded-lg text-sm dark:bg-gray-700 dark:text-white" onchange="calculateExpatriation()">
              <option value="cadre">Cadre</option>
              <option value="non-cadre">Non-cadre</option>
            </select>
          </div>
          <div>
            <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Parts fiscales</label>
            <select id="expat-parts-france" class="w-full p-2 border rounded-lg text-sm dark:bg-gray-700 dark:text-white" onchange="calculateExpatriation()">
              <option value="1">1 part</option>
              <option value="1.5">1,5 parts</option>
              <option value="2">2 parts</option>
              <option value="2.5">2,5 parts</option>
              <option value="3">3 parts</option>
            </select>
          </div>
        </div>
        <div class="mt-3 p-3 bg-white dark:bg-gray-800 rounded-lg">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-700 dark:text-gray-300">üí∞ Net apr√®s imp√¥ts France :</span>
            <span class="text-lg font-bold text-blue-600" id="expat-net-france">‚Äî</span>
          </div>
        </div>
      </div>

      <!-- S√©lection Pays -->
      <div class="mb-6">
        <label class="block text-sm font-semibold mb-3 text-gray-700 dark:text-gray-300">üåé Pays de destination</label>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
          <button onclick="selectCountry('usa')" class="country-btn" data-country="usa">
            <span class="text-2xl">üá∫üá∏</span>
            <span class="text-xs font-semibold">USA</span>
          </button>
          <button onclick="selectCountry('uk')" class="country-btn" data-country="uk">
            <span class="text-2xl">üá¨üáß</span>
            <span class="text-xs font-semibold">Royaume-Uni</span>
          </button>
          <button onclick="selectCountry('germany')" class="country-btn" data-country="germany">
            <span class="text-2xl">üá©üá™</span>
            <span class="text-xs font-semibold">Allemagne</span>
          </button>
          <button onclick="selectCountry('switzerland')" class="country-btn" data-country="switzerland">
            <span class="text-2xl">üá®üá≠</span>
            <span class="text-xs font-semibold">Suisse</span>
          </button>
          <button onclick="selectCountry('luxembourg')" class="country-btn" data-country="luxembourg">
            <span class="text-2xl">üá±üá∫</span>
            <span class="text-xs font-semibold">Luxembourg</span>
          </button>
          <button onclick="selectCountry('dubai')" class="country-btn" data-country="dubai">
            <span class="text-2xl">üá¶üá™</span>
            <span class="text-xs font-semibold">Duba√Ø</span>
          </button>
          <button onclick="selectCountry('singapore')" class="country-btn" data-country="singapore">
            <span class="text-2xl">üá∏üá¨</span>
            <span class="text-xs font-semibold">Singapour</span>
          </button>
          <button onclick="selectCountry('canada')" class="country-btn" data-country="canada">
            <span class="text-2xl">üá®üá¶</span>
            <span class="text-xs font-semibold">Canada</span>
          </button>
          <button onclick="selectCountry('australia')" class="country-btn" data-country="australia">
            <span class="text-2xl">üá¶üá∫</span>
            <span class="text-xs font-semibold">Australie</span>
          </button>
          <button onclick="selectCountry('japan')" class="country-btn" data-country="japan">
            <span class="text-2xl">üáØüáµ</span>
            <span class="text-xs font-semibold">Japon</span>
          </button>
          <button onclick="selectCountry('china')" class="country-btn" data-country="china">
            <span class="text-2xl">üá®üá≥</span>
            <span class="text-xs font-semibold">Chine</span>
          </button>
          <button onclick="selectCountry('brazil')" class="country-btn" data-country="brazil">
            <span class="text-2xl">üáßüá∑</span>
            <span class="text-xs font-semibold">Br√©sil</span>
          </button>
          <button onclick="selectCountry('southkorea')" class="country-btn" data-country="southkorea">
            <span class="text-2xl">üá∞üá∑</span>
            <span class="text-xs font-semibold">Cor√©e du Sud</span>
          </button>
        </div>
      </div>

      <!-- Input Salaire Propos√© -->
      <div id="expat-input-section" class="hidden">
        <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl p-4 mb-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-semibold text-gray-800 dark:text-white">
              <span id="expat-country-flag">üåç</span> <span id="expat-country-name">Pays</span>
            </h3>
            
            <!-- Toggle Mode Comparaison/√âquivalence -->
            <div class="flex items-center gap-3 bg-white dark:bg-gray-800 px-3 py-2 rounded-lg">
              <span class="text-xs text-gray-600 dark:text-gray-400">Mode :</span>
              <button 
                id="mode-comparison" 
                onclick="switchExpatMode('comparison')" 
                class="expat-mode-btn active px-3 py-1 rounded text-xs font-semibold transition">
                Comparaison
              </button>
              <button 
                id="mode-equivalence" 
                onclick="switchExpatMode('equivalence')" 
                class="expat-mode-btn px-3 py-1 rounded text-xs font-semibold transition">
                √âquivalence
              </button>
            </div>
          </div>

<!-- Mode Comparaison -->
          <div id="expat-mode-comparison-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Salaire propos√© (annuel brut)</label>
                <div class="flex gap-2">
                  <input 
                    type="number" 
                    id="expat-salary-foreign" 
                    placeholder="Ex: 65000" 
                    class="flex-1 p-2 border rounded-lg text-sm dark:bg-gray-700 dark:text-white"
                    oninput="calculateExpatriation()">
                  <span id="expat-currency" class="flex items-center px-3 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm font-semibold">$</span>
                </div>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  Taux actuel : 1 ‚Ç¨ = <span id="current-rate-display">‚Äî</span>
                </p>
              </div>
              <div>
                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">√âquivalent en EUR</label>
                <div class="p-2 bg-white dark:bg-gray-800 rounded-lg text-sm font-semibold text-gray-900 dark:text-white">
                  <span id="expat-salary-eur">‚Äî</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Mode √âquivalence -->
          <div id="expat-mode-equivalence-content" class="hidden">
            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-3">
              <p class="text-xs text-blue-800 dark:text-blue-300 mb-2">
                üí° Le syst√®me calcule automatiquement le salaire n√©cessaire pour avoir le m√™me pouvoir d'achat qu'en France.
              </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Salaire √©quivalent n√©cessaire</label>
                <div class="p-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg">
                  <p class="text-lg font-bold" id="expat-equivalent-salary">‚Äî</p>
                  <p class="text-xs opacity-80">Pour le m√™me pouvoir d'achat</p>
                </div>
              </div>
              <div>
                <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">√âquivalent en EUR</label>
                <div class="p-2 bg-white dark:bg-gray-800 rounded-lg text-sm font-semibold text-gray-900 dark:text-white">
                  <span id="expat-equivalent-eur">‚Äî</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Comparaison France vs √âtranger -->
    <div id="expat-comparison-section" class="hidden">
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        
        <!-- Colonne France -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
          <div class="flex items-center gap-2 mb-4">
            <span class="text-3xl">üá´üá∑</span>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">France</h3>
          </div>
          
          <div class="space-y-3">
            <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <p class="text-xs text-gray-600 dark:text-gray-400">Salaire brut</p>
              <p class="text-lg font-bold text-gray-900 dark:text-white" id="comp-france-brut">‚Äî</p>
            </div>
            <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
              <p class="text-xs text-gray-600 dark:text-gray-400">Net apr√®s imp√¥ts</p>
              <p class="text-lg font-bold text-green-600" id="comp-france-net">‚Äî</p>
            </div>
            <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
              <p class="text-xs text-gray-600 dark:text-gray-400">Co√ªt de la vie (base 100)</p>
              <p class="text-lg font-bold text-purple-600">100</p>
            </div>
            <div class="p-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg">
              <p class="text-xs opacity-80">üí° Pouvoir d'achat r√©el</p>
              <p class="text-xl font-bold" id="comp-france-pouvoir">‚Äî</p>
            </div>
          </div>
        </div>

        <!-- Colonne √âtranger -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
          <div class="flex items-center gap-2 mb-4">
            <span class="text-3xl" id="comp-foreign-flag">üåç</span>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="comp-foreign-name">Pays</h3>
          </div>
          
          <div class="space-y-3">
            <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <p class="text-xs text-gray-600 dark:text-gray-400">Salaire brut</p>
              <p class="text-lg font-bold text-gray-900 dark:text-white" id="comp-foreign-brut">‚Äî</p>
            </div>
            <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
              <p class="text-xs text-gray-600 dark:text-gray-400">Net apr√®s imp√¥ts locaux</p>
              <p class="text-lg font-bold text-green-600" id="comp-foreign-net">‚Äî</p>
            </div>
            <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
              <p class="text-xs text-gray-600 dark:text-gray-400">Co√ªt de la vie (indice)</p>
              <p class="text-lg font-bold text-purple-600" id="comp-foreign-cost">‚Äî</p>
            </div>
            <div class="p-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg">
              <p class="text-xs opacity-80">üí° Pouvoir d'achat r√©el</p>
              <p class="text-xl font-bold" id="comp-foreign-pouvoir">‚Äî</p>
            </div>
          </div>
        </div>

      </div>

      <!-- Analyse & Insights -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">üìä Analyse comparative</h3>
        
        <div id="expat-analysis" class="space-y-3">
          <!-- Contenu g√©n√©r√© dynamiquement -->
        </div>

        <!-- Graphique comparatif -->
        <div class="mt-6">
          <canvas id="expatComparisonChart" class="max-h-64"></canvas>
        </div>
      </div>

    </div>
    
    

  </div>
  
  <!-- ============================================= -->
<!-- CONTENU : JURIDIQUE & FISCAL -->
<!-- ============================================= -->
<div id="content-juridique" class="max-w-7xl mx-auto px-4 sm:px-8 pb-24 mt-6 hidden">
  
  <!-- Module juridique & fiscal -->
  <div id="module-juridique-fiscal" class="space-y-6">
    
    <div class="card animate-slide-up">
      <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4">
        ‚öñÔ∏è Configuration M√©tier Juridique & Fiscal
      </h3>
      
      <!-- Domaine juridique -->
      <div class="mb-4">
        <label class="label">
          <span>üéØ</span>
          <span>Domaine</span>
        </label>
        <select id="juridique-domaine" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
          <option value="">-- S√©lectionnez --</option>
          <option value="barreau">Barreau (Avocats)</option>
          <option value="entreprise">Juridique en entreprise</option>
          <option value="notariat">Notariat</option>
          <option value="public">Fonction publique</option>
          <option value="enseignement">Enseignement sup√©rieur</option>
        </select>
      </div>

      <!-- M√©tier -->
      <div class="mb-4">
        <label class="label">
          <span>üíº</span>
          <span>M√©tier / Sp√©cialisation</span>
        </label>
        <select id="juridique-metier" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
          <option value="">-- Choisissez d'abord un domaine --</option>
        </select>
      </div>

      <!-- Statut -->
      <div class="mb-4">
        <label class="label">
          <span>üìã</span>
          <span>Statut professionnel</span>
        </label>
        <select id="juridique-statut" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
          <option value="salarie">Salari√© (CDI/CDD)</option>
          <option value="liberal">Lib√©ral</option>
          <option value="public">Fonction publique</option>
          <option value="micro">Micro-entreprise</option>
        </select>
      </div>

      <!-- Exp√©rience -->
      <div class="mb-4">
        <label class="label">
          <span>üìÖ</span>
          <span>Exp√©rience : <strong id="juridique-exp-val" class="text-blue-600 dark:text-blue-400">5</strong> ans</span>
        </label>
        <input type="range" id="juridique-experience" min="0" max="40" value="5" class="w-full">
      </div>

      <!-- Localisation -->
      <div class="mb-4">
        <label class="label">
          <span>üìç</span>
          <span>Localisation</span>
        </label>
        <select id="juridique-localisation" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
          <option value="province">Province</option>
          <option value="grande_ville">Grande ville</option>
          <option value="paris">Paris / IDF</option>
        </select>
      </div>
    </div>

    <!-- ========================================== -->
    <!-- BLOC AVOCAT -->
    <!-- ========================================== -->
    <!-- ========================================== -->
<!-- BLOC AVOCAT -->
<!-- ========================================== -->
<div id="juridique-bloc-avocat" class="card hidden animate-slide-up">
  <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4">
    üëî Configuration Avocat
  </h3>
  
  <!-- STRUCTURE : Visible pour LIB√âRAL et SALARI√â -->
  <div id="juridique-avocat-structure-container" class="mb-4">
    <label class="label">
      <span>üè¢</span>
      <span>Type de structure</span>
    </label>
    <select id="juridique-avocat-structure" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
      <option value="big_law">Big Law / Cabinet international</option>
      <option value="mid_size">Cabinet mid-size</option>
      <option value="boutique">Cabinet boutique / sp√©cialis√©</option>
      <option value="solo">Solo / Ind√©pendant</option>
    </select>
  </div>

  <!-- TARIF & HEURES : Visible pour LIB√âRAL et MICRO uniquement -->
  <div id="juridique-avocat-tarif-heures" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
    <div>
      <label class="label">
        <span>üí∞</span>
        <span>Tarif horaire (‚Ç¨/h)</span>
      </label>
      <input type="number" id="juridique-avocat-tarif" min="50" max="800" value="200" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
    </div>

    <div>
      <label class="label">
        <span>‚è∞</span>
        <span>Heures facturables/an</span>
      </label>
      <input type="number" id="juridique-avocat-heures" min="500" max="2000" value="1200" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
    </div>
  </div>

  <!-- CHAMPS LIB√âRAL UNIQUEMENT -->
  <div id="juridique-avocat-champs-liberal" class="hidden">
    <div class="mb-4">
      <label class="label">
        <span>üìä</span>
        <span>Taux de r√©alisation : <strong id="juridique-realisation-val" class="text-blue-600 dark:text-blue-400">70</strong>%</span>
      </label>
      <input type="range" id="juridique-avocat-realisation" min="40" max="95" value="70" class="w-full">
    </div>

    <div class="mb-4">
      <label class="label">
        <span>üí∏</span>
        <span>R√©trocession : <strong id="juridique-retro-val" class="text-blue-600 dark:text-blue-400">75</strong>%</span>
      </label>
      <input type="range" id="juridique-avocat-retro" min="50" max="90" value="75" class="w-full">
    </div>

    <div class="info-box bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-xl border-l-4 border-purple-500">
      <p class="text-sm text-gray-700 dark:text-gray-300">
        üí° <strong>Collaborateur lib√©ral :</strong> Revenu = (Tarif √ó Heures √ó R√©alisation) √ó R√©trocession
      </p>
    </div>
  </div>

  <!-- INFO SALARI√â -->
  <div id="juridique-avocat-info-salarie" class="info-box bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-xl border-l-4 border-blue-500 hidden">
    <p class="text-sm text-gray-700 dark:text-gray-300">
      üí° <strong>Mode salari√© :</strong> Le salaire est calcul√© √† partir de la grille salariale selon votre sp√©cialit√© et votre type de cabinet.
    </p>
  </div>

  <!-- INFO MICRO -->
  <div id="juridique-avocat-info-micro" class="info-box bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-xl border-l-4 border-green-500 hidden">
    <p class="text-sm text-gray-700 dark:text-gray-300">
      üí° <strong>Micro-entreprise :</strong> Revenu = CA (Tarif √ó Heures) - Cotisations (21.1%)
    </p>
  </div>

  <!-- INFO PUBLIC -->
  <div id="juridique-avocat-info-public" class="info-box bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 p-4 rounded-xl border-l-4 border-yellow-500 hidden">
    <p class="text-sm text-gray-700 dark:text-gray-300">
      üí° <strong>Fonction publique :</strong> Salaire bas√© sur la grille fonction publique (-15% vs priv√©).
    </p>
  </div>
</div>
      <!-- CHAMPS LIB√âRAL UNIQUEMENT -->
      <div id="juridique-avocat-champs-liberal" class="hidden">
        <div class="mb-4">
          <label class="label">
            <span>üìä</span>
            <span>Taux de r√©alisation : <strong id="juridique-realisation-val" class="text-blue-600 dark:text-blue-400">70</strong>%</span>
          </label>
          <input type="range" id="juridique-avocat-realisation" min="40" max="95" value="70" class="w-full">
        </div>

        <div class="mb-4">
          <label class="label">
            <span>üí∏</span>
            <span>R√©trocession : <strong id="juridique-retro-val" class="text-blue-600 dark:text-blue-400">75</strong>%</span>
          </label>
          <input type="range" id="juridique-avocat-retro" min="50" max="90" value="75" class="w-full">
        </div>

        <div class="info-box bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-xl border-l-4 border-purple-500">
          <p class="text-sm text-gray-700 dark:text-gray-300">
            üí° <strong>Collaborateur lib√©ral :</strong> Revenu = (Tarif √ó Heures √ó R√©alisation) √ó R√©trocession
          </p>
        </div>
      </div>

      <!-- INFO SALARI√â -->
      <div id="juridique-avocat-info-salarie" class="info-box bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-xl border-l-4 border-blue-500 hidden">
        <p class="text-sm text-gray-700 dark:text-gray-300">
          üí° <strong>Mode salari√© :</strong> Le salaire est calcul√© √† partir du volume d'heures et du tarif moyen du cabinet (coefficient ~30%).
        </p>
      </div>
    </div>

    <!-- ========================================== -->
    <!-- BLOC ASSOCI√â -->
    <!-- ========================================== -->
    <div id="juridique-bloc-associe" class="card hidden animate-slide-up">
      <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4">
        ü§ù Configuration Associ√©
      </h3>
      
      <div class="mb-4">
        <label class="label">
          <span>üíº</span>
          <span>CA annuel cabinet/√©tude (‚Ç¨)</span>
        </label>
        <input type="number" id="juridique-associe-ca" min="100000" max="50000000" value="1500000" step="50000" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
      </div>

      <div class="mb-4">
        <label class="label">
          <span>üìä</span>
          <span>Part associ√©e : <strong id="juridique-part-val" class="text-blue-600 dark:text-blue-400">20</strong>%</span>
        </label>
        <input type="range" id="juridique-associe-part" min="5" max="50" value="20" class="w-full">
      </div>

      <div class="mb-4">
        <label class="label">
          <span>üí∏</span>
          <span>Frais structure annuels (‚Ç¨)</span>
        </label>
        <input type="number" id="juridique-associe-frais" min="20000" max="500000" value="80000" step="10000" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
      </div>
    </div>

    <!-- ========================================== -->
    <!-- BLOC JURISTE ENTREPRISE -->
    <!-- ========================================== -->
    <div id="juridique-bloc-juriste" class="card hidden animate-slide-up">
      <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4">
        üè¢ Configuration Juriste Entreprise
      </h3>
      
      <div class="mb-4">
        <label class="label">
          <span>üìä</span>
          <span>S√©niorit√©</span>
        </label>
        <select id="juridique-seniorite" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
          <option value="junior">Junior (0-3 ans)</option>
          <option value="confirme">Confirm√© (3-7 ans)</option>
          <option value="senior">Senior (7-12 ans)</option>
          <option value="responsable">Responsable juridique</option>
          <option value="directeur">Directeur juridique</option>
        </select>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
        <div>
          <label class="label">
            <span>üè≠</span>
            <span>Secteur activit√©</span>
          </label>
          <select id="juridique-secteur-activite" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
            <option value="tech">Tech / Num√©rique</option>
            <option value="banque">Banque / Finance</option>
            <option value="pharma">Pharmacie / Sant√©</option>
            <option value="luxe">Luxe / Mode</option>
            <option value="industrie">Industrie / BTP</option>
          </select>
        </div>

        <div>
          <label class="label">
            <span>üè¢</span>
            <span>Taille entreprise</span>
          </label>
          <select id="juridique-taille" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
            <option value="startup">Startup (&lt;50)</option>
            <option value="pme">PME (50-250)</option>
            <option value="eti">ETI (250-5000)</option>
            <option value="cac40">CAC40 / Multi</option>
          </select>
        </div>
      </div>

      <div class="mb-4">
        <label class="label">
          <span>üí∞</span>
          <span>Bonus annuel : <strong id="juridique-bonus-val" class="text-blue-600 dark:text-blue-400">10</strong>%</span>
        </label>
        <input type="range" id="juridique-bonus" min="0" max="30" value="10" class="w-full">
      </div>

      <div class="mb-4">
        <label class="label">
          <span>üìà</span>
          <span>Stock-options/actions (‚Ç¨/an)</span>
        </label>
        <input type="number" id="juridique-stock" min="0" max="100000" value="0" step="1000" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
      </div>
    </div>

    <!-- ========================================== -->
    <!-- BLOC ENSEIGNEMENT -->
    <!-- ========================================== -->
    <div id="juridique-bloc-enseignement" class="card hidden animate-slide-up">
      <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4">
        üìö Configuration Enseignement
      </h3>
      
      <div class="mb-4">
        <label class="label">
          <span>üéì</span>
          <span>Grade universitaire</span>
        </label>
        <select id="juridique-grade" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
          <option value="vacataire">Vacataire / Charg√© de TD</option>
          <option value="ater">ATER</option>
          <option value="prag">PRAG / PRCE</option>
          <option value="mcf">Ma√Ætre de Conf√©rences</option>
          <option value="pr">Professeur des Universit√©s</option>
        </select>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
        <div>
          <label class="label">
            <span>‚è∞</span>
            <span>Heures TD / an</span>
          </label>
          <input type="number" id="juridique-heures-td" min="0" max="400" value="0" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
        </div>

        <div>
          <label class="label">
            <span>‚è∞</span>
            <span>Heures CM / an</span>
          </label>
          <input type="number" id="juridique-heures-cm" min="0" max="200" value="0" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
        </div>
      </div>

      <div class="mb-4">
        <label class="label">
          <span>üèÜ</span>
          <span>Prime de recherche (‚Ç¨/an)</span>
        </label>
        <input type="number" id="juridique-prime-recherche" min="0" max="15000" value="0" step="500" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
      </div>

      <div class="mb-4">
        <label class="label">
          <span>üìñ</span>
          <span>HDR obtenue ?</span>
        </label>
        <select id="juridique-hdr" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
          <option value="non">Non</option>
          <option value="oui">Oui</option>
        </select>
      </div>
    </div>

    <!-- Temps partiel -->
    <div class="card animate-slide-up">
      <div class="mb-4">
        <label class="label">
          <span>‚è±Ô∏è</span>
          <span>Temps de travail</span>
        </label>
        <select id="juridique-temps-partiel" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
          <option value="100">Temps plein (100%)</option>
          <option value="90">90%</option>
          <option value="80">80%</option>
          <option value="50">50%</option>
        </select>
      </div>
    </div>

    <!-- Bouton calcul -->
    <div class="text-center">
      <button onclick="calculateJuridique()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-8 py-3 text-lg font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
        üßÆ Calculer le salaire
      </button>
    </div>

  </div>

  <!-- Zone de r√©sultats -->
  <div id="result-juridique" class="hidden space-y-6 mt-6">
    
    <!-- Cartes de r√©sultats -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="result-card bg-gradient-to-br from-blue-500 to-blue-600">
        <div class="flex items-center gap-3 mb-2">
          <span class="text-3xl">üí∞</span>
          <p class="text-sm text-white/80 font-medium">M√©dian</p>
        </div>
        <p class="text-3xl sm:text-4xl font-bold text-white" id="median-juridique">‚Äî</p>
      </div>
      
      <div class="result-card bg-gradient-to-br from-green-500 to-green-600">
        <div class="flex items-center gap-3 mb-2">
          <span class="text-3xl">üìâ</span>
          <p class="text-sm text-white/80 font-medium">Minimum</p>
        </div>
        <p class="text-3xl sm:text-4xl font-bold text-white" id="low-juridique">‚Äî</p>
      </div>
      
      <div class="result-card bg-gradient-to-br from-purple-500 to-purple-600">
        <div class="flex items-center gap-3 mb-2">
          <span class="text-3xl">üìà</span>
          <p class="text-sm text-white/80 font-medium">Maximum</p>
        </div>
        <p class="text-3xl sm:text-4xl font-bold text-white" id="high-juridique">‚Äî</p>
      </div>
    </div>
    
  </div>

</div>
  <!-- ============================================= -->
  <!-- SCRIPT COMPLET : DONN√âES + LOGIQUE -->
  <!-- ============================================= -->
  <script>
    
    // ============================================
// ‚öñÔ∏è DONN√âES M√âTIERS JURIDIQUES & FISCAUX
// ============================================

const metiersJuridiques = {
  barreau: {
    "avocat-penal": "Avocat p√©naliste",
    "avocat-corporate": "Avocat corporate / M&A",
    "avocat-fiscal": "Avocat fiscaliste",
    "avocat-social": "Avocat droit social",
    "avocat-ip": "Avocat propri√©t√© intellectuelle",
    "avocat-immobilier": "Avocat immobilier",
    "avocat-arbitrage": "Avocat arbitrage international",
    "avocat-associe": "Avocat associ√©"
  },
  entreprise: {
    "juriste-contrats": "Juriste contrats",
    "juriste-corporate": "Juriste corporate",
    "juriste-compliance": "Juriste compliance",
    "juriste-rgpd": "Juriste RGPD",
    "juriste-ip": "Juriste PI",
    "juriste-immobilier": "Juriste immobilier",
    "responsable-juridique": "Responsable juridique",
    "directeur-juridique": "Directeur juridique"
  },
  notariat: {
    "clerc": "Clerc de notaire",
    "notaire-assistant": "Notaire assistant",
    "notaire-salarie": "Notaire salari√©",
    "notaire-associe": "Notaire associ√©"
  },
  public: {
    "magistrat": "Magistrat",
    "greffier": "Greffier",
    "juriste-territorial": "Juriste territorial"
  },
  enseignement: {
    "prof-droit": "Professeur de droit"
  }
};

const salairesJuridiques = {
  "avocat-penal": { p25: 38000, p50: 52000, p75: 75000 },
  "avocat-corporate": { p25: 45000, p50: 70000, p75: 110000 },
  "avocat-fiscal": { p25: 50000, p50: 80000, p75: 130000 },
  "avocat-social": { p25: 42000, p50: 60000, p75: 90000 },
  "avocat-ip": { p25: 45000, p50: 70000, p75: 120000 },
  "avocat-immobilier": { p25: 40000, p50: 58000, p75: 85000 },
  "avocat-arbitrage": { p25: 60000, p50: 100000, p75: 180000 },
  "juriste-contrats": { p25: 38000, p50: 48000, p75: 65000 },
  "juriste-corporate": { p25: 40000, p50: 52000, p75: 75000 },
  "juriste-compliance": { p25: 45000, p50: 60000, p75: 90000 },
  "juriste-rgpd": { p25: 42000, p50: 58000, p75: 85000 },
  "juriste-ip": { p25: 42000, p50: 60000, p75: 95000 },
  "juriste-immobilier": { p25: 38000, p50: 50000, p75: 75000 },
  "responsable-juridique": { p25: 75000, p50: 90000, p75: 110000 },
  "directeur-juridique": { p25: 120000, p50: 150000, p75: 200000 },
  "clerc": { p25: 28000, p50: 32000, p75: 38000 },
  "notaire-assistant": { p25: 35000, p50: 42000, p75: 52000 },
  "notaire-salarie": { p25: 38000, p50: 55000, p75: 80000 },
  "magistrat": { p25: 42000, p50: 55000, p75: 75000 },
  "greffier": { p25: 26000, p50: 30000, p75: 34000 },
  "juriste-territorial": { p25: 30000, p50: 35000, p75: 42000 }
};

const grillesEnseignement = {
  vacataire: { base: 0, tauxTD: 41.68, tauxCM: 62.52 },
  ater: { base: 24000 },
  prag: { base: 35000 },
  mcf: { base: 42000 },
  pr: { base: 65000 }
};


function get(id) {
  const el = document.getElementById(id);
  return el ? el.value : "";
}

function formatEur(montant) {
  return Math.round(montant).toLocaleString('fr-FR') + '‚Ç¨';
}

// ============================================
// üîå SYST√àME MULTI-SOURCES AVEC FALLBACK
// ============================================

// Configuration des sources de donn√©es
const dataSources = {
  version: "2026-01",
  lastUpdate: "15/01/2026",
  
  // Sources API
  apis: {
    insee: "https://api.insee.fr/series/BDM/001515333",
    dataGouv: "https://data.gouv.fr/api/",
    // Ajoute tes endpoints ici
  },
  
  // Donn√©es locales (fallback)
  local: {
    tauxCharges: {
      salarie: 0.78,      // 22% charges
      liberal: 0.53,      // 47% charges
      public: 0.84,       // 16% charges
      micro: 0.79         // 21% charges
    },
    
    indicePrix: 1.0,      // Base 2026
    
    smic: {
      horaire: 11.88,
      mensuel: 1801,
      annuel: 21612
    }
  }
};

// ============================================
// SYST√àME DE CACHE (localStorage)
// ============================================

const CacheManager = {
  TTL: 24 * 60 * 60 * 1000, // 24 heures
  
  set(key, data) {
    const item = {
      data: data,
      timestamp: Date.now(),
      version: dataSources.version
    };
    localStorage.setItem(key, JSON.stringify(item));
  },
  
  get(key) {
    try {
      const item = JSON.parse(localStorage.getItem(key));
      if (!item) return null;
      
      const now = Date.now();
      const age = now - item.timestamp;
      
      // V√©rifier si cache valide (pas expir√© + bonne version)
      if (age < this.TTL && item.version === dataSources.version) {
        console.log(`‚úÖ Cache hit: ${key}`);
        return item.data;
      }
      
      console.log(`‚è∞ Cache expir√©: ${key}`);
      return null;
    } catch (e) {
      return null;
    }
  },
  
  clear() {
    localStorage.clear();
    console.log('üóëÔ∏è Cache nettoy√©');
  }
};

// ============================================
// FETCH AVEC TIMEOUT
// ============================================

async function fetchWithTimeout(url, timeout = 5000) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);
  
  try {
    const response = await fetch(url, { signal: controller.signal });
    clearTimeout(timeoutId);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    clearTimeout(timeoutId);
    throw error;
  }
}

// ============================================
// R√âCUP√âRATION TAUX DE CHARGES
// ============================================

async function getTauxChargesAPI() {
  const cacheKey = 'taux_charges';
  
  // 1. V√©rifier cache
  const cached = CacheManager.get(cacheKey);
  if (cached) return cached;
  
  console.log('üåê Fetching taux de charges...');
  
  try {
    // Exemple : API custom ou scraping
    // Pour l'instant, on simule avec les donn√©es locales enrichies
    
    // Tu peux remplacer par une vraie API :
    // const response = await fetchWithTimeout('https://ton-api.com/taux-charges');
    
    // Simulation d'un enrichissement avec date de MAJ
    const data = {
      ...dataSources.local.tauxCharges,
      source: "URSSAF 2026",
      lastUpdate: "01/01/2026",
      details: {
        salarie: {
          taux: 0.78,
          charges: {
            secu: 0.15,
            retraite: 0.04,
            chomage: 0.024,
            autres: 0.006
          }
        },
        liberal: {
          taux: 0.53,
          charges: {
            urssaf: 0.22,
            cipav: 0.25
          }
        },
        public: {
          taux: 0.84,
          charges: {
            retraite: 0.11,
            autres: 0.05
          }
        },
        micro: {
          taux: 0.79,
          cotisations: 0.211
        }
      }
    };
    
    // Mettre en cache
    CacheManager.set(cacheKey, data);
    console.log('‚úÖ Taux de charges r√©cup√©r√©s');
    
    return data;
    
  } catch (error) {
    console.warn('‚ö†Ô∏è Erreur API, utilisation donn√©es locales', error);
    return dataSources.local.tauxCharges;
  }
}

// ============================================
// R√âCUP√âRATION INDICES INSEE
// ============================================

async function getIndicesINSEE() {
  const cacheKey = 'indices_insee';
  
  // V√©rifier cache
  const cached = CacheManager.get(cacheKey);
  if (cached) return cached;
  
  console.log('üåê Fetching indices INSEE...');
  
  try {
    // Exemple avec une vraie API INSEE (n√©cessite token)
    // const response = await fetchWithTimeout(
    //   'https://api.insee.fr/series/BDM/001515333?token=TON_TOKEN'
    // );
    
    // Pour l'instant, simulation avec donn√©es locales enrichies
    const data = {
      prixConsommation: 1.023, // +2.3% depuis base
      salaireMoyen: 1.018,     // +1.8%
      source: "INSEE",
      periode: "2026-01",
      baseYear: 2025
    };
    
    CacheManager.set(cacheKey, data);
    console.log('‚úÖ Indices INSEE r√©cup√©r√©s');
    
    return data;
    
  } catch (error) {
    console.warn('‚ö†Ô∏è Erreur INSEE, utilisation donn√©es locales', error);
    return { prixConsommation: 1.0, salaireMoyen: 1.0 };
  }
}

// ============================================
// R√âCUP√âRATION SMIC √Ä JOUR
// ============================================

async function getSMIC() {
  const cacheKey = 'smic';
  
  const cached = CacheManager.get(cacheKey);
  if (cached) return cached;
  
  console.log('üåê Fetching SMIC...');
  
  try {
    // Exemple avec data.gouv.fr ou API Service Public
    // const response = await fetchWithTimeout(
    //   'https://data.gouv.fr/api/datasets/...'
    // );
    
    // Simulation
    const data = {
      horaire: 11.88,
      mensuel: 1801,
      annuel: 21612,
      source: "Service-Public.fr",
      dateApplication: "01/01/2026"
    };
    
    CacheManager.set(cacheKey, data);
    console.log('‚úÖ SMIC r√©cup√©r√©');
    
    return data;
    
  } catch (error) {
    console.warn('‚ö†Ô∏è Erreur SMIC, utilisation donn√©es locales', error);
    return dataSources.local.smic;
  }
}

// ============================================
// INITIALISATION AU CHARGEMENT
// ============================================

async function initDataSources() {
  console.log('üöÄ Initialisation des sources de donn√©es...');
  
  // Afficher version
  console.log(`üìä Version donn√©es: ${dataSources.version}`);
  console.log(`üìÖ Derni√®re MAJ: ${dataSources.lastUpdate}`);
  
  // Pr√©-charger les donn√©es en parall√®le (sans bloquer)
  Promise.all([
    getTauxChargesAPI(),
    getIndicesINSEE(),
    getSMIC()
  ]).then(() => {
    console.log('‚úÖ Toutes les donn√©es sont pr√™tes');
    
    // Afficher dans l'UI
    displayDataVersion();
  }).catch(error => {
    console.warn('‚ö†Ô∏è Certaines donn√©es n\'ont pas pu √™tre charg√©es', error);
  });
}

// ============================================
// AFFICHER VERSION DANS L'UI
// ============================================

function displayDataVersion() {
  // Cr√©er un badge dans l'interface
  const badge = document.createElement('div');
  badge.id = 'data-version-badge';
  badge.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(0, 174, 239, 0.9);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    transition: all 0.3s ease;
  `;
  badge.innerHTML = `üìä Donn√©es ${dataSources.version}`;
  
  // Tooltip au survol
  badge.title = `Derni√®re mise √† jour: ${dataSources.lastUpdate}\nClic pour plus d'infos`;
  
  // Clic pour afficher d√©tails
  badge.addEventListener('click', showDataSourcesInfo);
  
  // Hover effect
  badge.addEventListener('mouseenter', () => {
    badge.style.transform = 'scale(1.05)';
  });
  badge.addEventListener('mouseleave', () => {
    badge.style.transform = 'scale(1)';
  });
  
  document.body.appendChild(badge);
}

function showDataSourcesInfo() {
  const info = `
üìä SOURCES DE DONN√âES

Version: ${dataSources.version}
Derni√®re MAJ: ${dataSources.lastUpdate}

üìà Sources actives:
‚úì Taux de charges (URSSAF)
‚úì Indices √©conomiques (INSEE)
‚úì SMIC (Service-Public.fr)

üíæ Cache: ${localStorage.length} entr√©es
‚è∞ Validit√©: 24 heures

üîÑ Les donn√©es sont mises √† jour automatiquement.
  `.trim();
  
  alert(info);
}

// ============================================
// FONCTION getTauxCharges AM√âLIOR√âE
// ============================================

// Remplace ta fonction getTauxCharges existante par celle-ci:
async function getTauxCharges(statut) {
  try {
    const data = await getTauxChargesAPI();
    return data[statut] || data.salarie || 0.78;
  } catch (error) {
    console.warn('Fallback sur donn√©es locales pour getTauxCharges');
    return dataSources.local.tauxCharges[statut] || 0.78;
  }
}

// ============================================
// AJUSTEMENT AUTOMATIQUE AVEC INDICES
// ============================================

async function adjustSalaireWithIndices(salaireBase) {
  try {
    const indices = await getIndicesINSEE();
    return salaireBase * indices.salaireMoyen;
  } catch (error) {
    return salaireBase; // Pas d'ajustement si erreur
  }
}

// ============================================
// EXPORT POUR DEBUG
// ============================================

window.DataSourcesDebug = {
  clearCache: () => CacheManager.clear(),
  showCache: () => console.table(localStorage),
  forceRefresh: () => {
    CacheManager.clear();
    initDataSources();
  },
  version: dataSources.version
};

// ============================================
// AUTO-INITIALISATION
// ============================================

// Lancer au chargement de la page
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initDataSources);
} else {
  initDataSources();
}

console.log('üí° Debug: Tape "DataSourcesDebug" dans la console pour les commandes');

    // ===== TOUTES LES √âCOLES (DONN√âES COMPL√àTES) =====
    
    // 71 √âcoles d'ing√©nieurs
    const schoolsIngenieur = [
      { Ecole:"AgroParisTech", p25:41135, p50:43290, p75:44881 },
      { Ecole:"CENTRALE LILLE", p25:44886, p50:47528, p75:49058 },
      { Ecole:"Centrale Lyon", p25:46209, p50:48572, p75:50405 },
      { Ecole:"CENTRALE MARSEILLE", p25:44069, p50:46526, p75:48343 },
      { Ecole:"CENTRALE NANTES", p25:44069, p50:46526, p75:48343 },
      { Ecole:"CNAM", p25:42399, p50:44470, p75:46186 },
      { Ecole:"CPE LYON", p25:44354, p50:47226, p75:48952 },
      { Ecole:"ECAM LASALLE", p25:42327, p50:44639, p75:46354 },
      { Ecole:"EFREI PARIS", p25:46376, p50:48826, p75:50707 },
      { Ecole:"EI PURPAN", p25:37773, p50:40245, p75:42122 },
      { Ecole:"ENAC", p25:46878, p50:49601, p75:51537 },
      { Ecole:"ENGEES", p25:41546, p50:43956, p75:46258 },
      { Ecole:"ENI BREST", p25:40131, p50:42413, p75:44348 },
      { Ecole:"ENIM", p25:40788, p50:43661, p75:44789 },
      { Ecole:"ENISE", p25:40583, p50:43105, p75:44897 },
      { Ecole:"ENPC", p25:51562, p50:54355, p75:56797 },
      { Ecole:"ENSAIA", p25:41083, p50:43093, p75:45132 },
      { Ecole:"ENSAM", p25:44787, p50:46788, p75:48322 },
      { Ecole:"ENSC LILLE", p25:42070, p50:44533, p75:46408 },
      { Ecole:"ENSC MONTPELLIER", p25:42008, p50:44482, p75:46379 },
      { Ecole:"ENSC MULHOUSE", p25:41534, p50:44526, p75:46946 },
      { Ecole:"ENSC RENNES", p25:40159, p50:42815, p75:44974 },
      { Ecole:"ENSEA", p25:41829, p50:44221, p75:45882 },
      { Ecole:"ENSEIRB MATMECA", p25:44556, p50:47002, p75:48898 },
      { Ecole:"ENSEM", p25:42859, p50:45524, p75:47467 },
      { Ecole:"ENSGTI PAU", p25:44512, p50:46900, p75:48768 },
      { Ecole:"ENSI POITIERS", p25:39851, p50:42102, p75:43728 },
      { Ecole:"ENSIC", p25:44084, p50:46515, p75:48535 },
      { Ecole:"ENSICAEN", p25:41455, p50:44169, p75:45726 },
      { Ecole:"ENSIIE", p25:47536, p50:50298, p75:52473 },
      { Ecole:"ENSIL ENSCI", p25:40977, p50:43344, p75:44941 },
      { Ecole:"ENSMA", p25:40579, p50:43065, p75:44609 },
      { Ecole:"ENSMM", p25:41995, p50:44264, p75:46176 },
      { Ecole:"ENSTA", p25:46261, p50:48833, p75:50734 },
      { Ecole:"ENSTA BRETAGNE", p25:41949, p50:44081, p75:46198 },
      { Ecole:"ENTPE", p25:46289, p50:49067, p75:50863 },
      { Ecole:"ESA", p25:38334, p50:40900, p75:42233 },
      { Ecole:"ESCOM", p25:42003, p50:44499, p75:46560 },
      { Ecole:"ESEO", p25:42635, p50:45151, p75:46890 },
      { Ecole:"ESIEA", p25:43286, p50:45885, p75:47485 },
      { Ecole:"ESME SUDRIA", p25:42420, p50:44687, p75:46350 },
      { Ecole:"ESTP PARIS", p25:45163, p50:47416, p75:49305 },
      { Ecole:"Grenoble INP ense3", p25:42963, p50:45276, p75:46845 },
      { Ecole:"Grenoble INP ENSIMAG", p25:47093, p50:49721, p75:52230 },
      { Ecole:"Grenoble INP Pagora", p25:44597, p50:47520, p75:49835 },
      { Ecole:"Grenoble INP Phelma", p25:44178, p50:46881, p75:48593 },
      { Ecole:"HEI Junia", p25:41979, p50:44569, p75:46193 },
      { Ecole:"ICAM", p25:42159, p50:44262, p75:45939 },
      { Ecole:"INSA Lyon", p25:43733, p50:46209, p75:47758 },
      { Ecole:"INSA Rennes", p25:41703, p50:43841, p75:45798 },
      { Ecole:"INSA Rouen", p25:41747, p50:43887, p75:45750 },
      { Ecole:"INSA Strasbourg", p25:41718, p50:44200, p75:45847 },
      { Ecole:"INSA Val de Loire", p25:41330, p50:43640, p75:45632 },
      { Ecole:"IOTA", p25:44010, p50:46591, p75:48917 },
      { Ecole:"ISA JUNIA", p25:37427, p50:39511, p75:41236 },
      { Ecole:"ISAE SUPAERO", p25:47058, p50:49747, p75:51463 },
      { Ecole:"ISEN Lille", p25:43171, p50:45961, p75:48194 },
      { Ecole:"ISEP", p25:44546, p50:47223, p75:49110 },
      { Ecole:"ISMEP-SUPMECA", p25:41055, p50:43450, p75:45175 },
      { Ecole:"ITECH", p25:43641, p50:46534, p75:48523 },
      { Ecole:"Mines St Etienne", p25:48369, p50:50744, p75:52868 },
      { Ecole:"Polytech Grenoble", p25:43344, p50:46061, p75:48346 },
      { Ecole:"POLYTECHNIQUE", p25:57013, p50:59835, p75:62105 },
      { Ecole:"SIGMA", p25:43111, p50:45484, p75:47341 },
      { Ecole:"SUPELEC", p25:49405, p50:52285, p75:54153 },
      { Ecole:"Toulouse INP ENSEEIHT", p25:42714, p50:44978, p75:46697 },
      { Ecole:"Toulouse INP ENSIACET", p25:42714, p50:44978, p75:46697 },
      { Ecole:"UTC", p25:43177, p50:45658, p75:47442 },
      { Ecole:"Hors liste", p25:41840, p50:43726, p75:45414 }
    ];

    // 30 √âcoles de commerce
    const schoolsCommerce = [
      {Ecole:"HEC Paris", p25:45600, p50:52250, p75:61750},
      {Ecole:"ESSEC Business School", p25:42750, p50:49400, p75:58900},
      {Ecole:"ESCP Business School", p25:41800, p50:48450, p75:57000},
      {Ecole:"EDHEC Business School", p25:39900, p50:46600, p75:55100},
      {Ecole:"emlyon Business School", p25:40850, p50:47500, p75:56050},
      {Ecole:"Audencia Business School", p25:38000, p50:44650, p75:53200},
      {Ecole:"Skema Business School", p25:36100, p50:42750, p75:50350},
      {Ecole:"NEOMA Business School", p25:35150, p50:41800, p75:49400},
      {Ecole:"Kedge Business School", p25:33250, p50:39900, p75:47500},
      {Ecole:"TBS Education", p25:34200, p50:40850, p75:48450},
      {Ecole:"Grenoble EM", p25:35150, p50:41800, p75:49400},
      {Ecole:"Montpellier BS", p25:33250, p50:39900, p75:47500},
      {Ecole:"Rennes SB", p25:32300, p50:38950, p75:46550},
      {Ecole:"ICN Business School", p25:32300, p50:38000, p75:45600},
      {Ecole:"EM Strasbourg", p25:32300, p50:38000, p75:45600},
      {Ecole:"Excelia Business School", p25:31350, p50:37050, p75:44650},
      {Ecole:"ISC Paris", p25:31350, p50:37050, p75:43700},
      {Ecole:"INSEEC Grande √âcole", p25:30400, p50:36100, p75:42750},
      {Ecole:"PSB (Paris School of Business)", p25:30400, p50:36100, p75:42750},
      {Ecole:"EMLV", p25:30000, p50:36500, p75:43000},
      {Ecole:"ISG", p25:29450, p50:35150, p75:40850},
      {Ecole:"ESC Clermont BS", p25:29450, p50:34200, p75:39900},
      {Ecole:"Burgundy School of Business", p25:29450, p50:34200, p75:39900},
      {Ecole:"IMT-BS", p25:28500, p50:34200, p75:39900},
      {Ecole:"ESC Pau Business School", p25:28500, p50:33300, p75:38950},
      {Ecole:"SCBS", p25:28500, p50:33300, p75:38000},
      {Ecole:"Brest Business School", p25:27550, p50:32300, p75:37050},
      {Ecole:"ISCID-CO", p25:26600, p50:31350, p75:36100},
      {Ecole:"ICD Business School", p25:26600, p50:31350, p75:36100},
      {Ecole:"ESLSCA Business School Paris", p25:26600, p50:31350, p75:36100}
    ];

    // 10 Sciences Po
    const schoolsScPo = [
      {Ecole:"Sciences Po Paris", p25:35000, p50:39000, p75:44000},
      {Ecole:"Sciences Po Bordeaux", p25:32500, p50:35500, p75:40500},
      {Ecole:"Sciences Po Grenoble", p25:33000, p50:35500, p75:40500},
      {Ecole:"Sciences Po Lille", p25:32500, p50:35500, p75:40500},
      {Ecole:"Sciences Po Lyon", p25:33000, p50:36000, p75:41000},
      {Ecole:"Sciences Po Rennes", p25:31500, p50:34500, p75:39500},
      {Ecole:"Sciences Po Strasbourg", p25:32000, p50:35000, p75:40000},
      {Ecole:"Sciences Po Toulouse", p25:32000, p50:35000, p75:40000},
      {Ecole:"Sciences Po Saint-Germain-en-Laye", p25:30500, p50:33500, p75:38500},
      {Ecole:"Sciences Po Aix", p25:31500, p50:34500, p75:39500}
    ];

    // 20 Universit√©s
    const schoolsUniversite = [
      {Ecole:"Sorbonne Universit√©", p25:33250, p50:37000, p75:40850},
      {Ecole:"Universit√© Paris-Saclay", p25:33250, p50:37000, p75:40850},
      {Ecole:"Universit√© PSL", p25:33250, p50:37500, p75:41350},
      {Ecole:"Universit√© Paris Cit√©", p25:32300, p50:36100, p75:39900},
      {Ecole:"Universit√© de Montpellier", p25:31800, p50:35600, p75:39400},
      {Ecole:"Universit√© de Strasbourg", p25:31800, p50:35600, p75:39400},
      {Ecole:"Universit√© Grenoble Alpes", p25:31800, p50:35600, p75:39400},
      {Ecole:"Aix-Marseille Universit√©", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Bordeaux", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Lyon", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Lille", p25:30800, p50:34600, p75:38400},
      {Ecole:"Universit√© Toulouse III", p25:30800, p50:34600, p75:38400},
      {Ecole:"Universit√© de Nantes", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© de Rennes 1", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© de Lorraine", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© C√¥te d'Azur", p25:30500, p50:34500, p75:38500},
      {Ecole:"Universit√© de Tours", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© d'Angers", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© de Clermont Auvergne", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© de Reims", p25:29000, p50:32800, p75:36600}
    ];

    // 33 √âcoles IT
    const schoolsIT = [
      { Ecole:"√âcole 42", p25:30000, p50:35000, p75:42000 },
      { Ecole:"EPITA", p25:34000, p50:39000, p75:46000 },
      { Ecole:"Epitech", p25:33000, p50:38000, p75:45000 },
      { Ecole:"ENSIMAG / Grenoble INP", p25:35000, p50:40000, p75:47000 },
      { Ecole:"T√©l√©com Paris", p25:36000, p50:42000, p75:50000 },
      { Ecole:"T√©l√©com SudParis", p25:32000, p50:37000, p75:44000 },
      { Ecole:"T√©l√©com Nancy", p25:30000, p50:35000, p75:40000 },
      { Ecole:"INSA Lyon (informatique)", p25:32000, p50:37000, p75:43000 },
      { Ecole:"INSA Toulouse (informatique)", p25:31000, p50:36000, p75:42000 },
      { Ecole:"INSA Rennes (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"INSA Strasbourg (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"INSA Rouen (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"EFREI Paris", p25:30000, p50:35000, p75:42000 },
      { Ecole:"ISEP Paris", p25:30000, p50:35000, p75:42000 },
      { Ecole:"ESGI", p25:28000, p50:33000, p75:39000 },
      { Ecole:"EfreiTech", p25:27000, p50:32000, p75:37000 },
      { Ecole:"Polytech Grenoble (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Polytech Lyon (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Universit√© Paris Cit√© (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Strasbourg (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Bordeaux (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Lille (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Sup√©lec / Centrale (info)", p25:35000, p50:41000, p75:48000 },
      { Ecole:"IUT Informatique", p25:26000, p50:30000, p75:35000 },
      { Ecole:"Licence Info (Sorbonne/Saclay)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"IESA / EIGSI Info", p25:27000, p50:32000, p75:38000 },
      { Ecole:"ESEO Angers (info)", p25:28000, p50:33000, p75:39000 },
      { Ecole:"ENIB Brest (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Data ScienceTech Institute", p25:30000, p50:35000, p75:42000 },
      { Ecole:"IA School Paris", p25:28000, p50:33000, p75:40000 },
      { Ecole:"Supinfo", p25:26000, p50:30000, p75:36000 },
      { Ecole:"YNOV Informatique", p25:27000, p50:32000, p75:38000 },
      { Ecole:"YNOV Cyber-s√©curit√©", p25:28000, p50:33000, p75:40000 }
    ];

    // 9 √âcoles Design
    const schoolsDesign = [
      { Ecole:"Strate √âcole de Design", p25:32000, p50:36000, p75:40000 },
      { Ecole:"ENSAD (Arts D√©cos)", p25:32000, p50:36000, p75:40000 },
      { Ecole:"√âcole Estienne", p25:32000, p50:36000, p75:40000 },
      { Ecole:"√âcole de Design Nantes Atlantique", p25:32000, p50:36000, p75:40000 },
      { Ecole:"Gobelins", p25:32000, p50:36000, p75:40000 },
      { Ecole:"ENSCI-Les Ateliers", p25:25000, p50:30000, p75:35000 },
      { Ecole:"LISAA", p25:32000, p50:36000, p75:40000 },
      { Ecole:"Universit√© (arts appliqu√©s)", p25:27000, p50:31000, p75:35000 },
      { Ecole:"Hors liste Design", p25:28000, p50:32000, p75:36000 }
    ];

    // 11 √âcoles Communication
    const schoolsCom = [
      { Ecole:"CELSA", p25:33250, p50:37000, p75:40850 },
      { Ecole:"ISCOM", p25:30000, p50:33000, p75:37000 },
      { Ecole:"Sup de Pub (INSEEC)", p25:28000, p50:31000, p75:35000 },
      { Ecole:"EFAP", p25:28000, p50:31000, p75:34000 },
      { Ecole:"ESP", p25:27000, p50:30000, p75:33000 },
      { Ecole:"ISEG", p25:27000, p50:30000, p75:33000 },
      { Ecole:"ECS", p25:26000, p50:29000, p75:32000 },
      { Ecole:"Sup de Com", p25:27000, p50:30000, p75:34000 },
      { Ecole:"Audencia SciencesCom", p25:31000, p50:34000, p75:38000 },
      { Ecole:"ISCPA", p25:26000, p50:29000, p75:32000 },
      { Ecole:"Hors liste Communication", p25:25000, p50:28000, p75:31000 }
    ];

    // 17 √âcoles RH
    const schoolsRH = [
      { Ecole:"IGS RH", p25:31350, p50:35150, p75:40850 },
      { Ecole:"ESGRH", p25:30400, p50:34200, p75:39900 },
      { Ecole:"Sup des RH", p25:28500, p50:32300, p75:38000 },
      { Ecole:"ISFOGEP", p25:29450, p50:33250, p75:38000 },
      { Ecole:"ICD Business School (RH)", p25:29450, p50:33250, p75:38950 },
      { Ecole:"ESSCA RH & Management", p25:30400, p50:34200, p75:39900 },
      { Ecole:"ISCG Paris (RH & Paie)", p25:28500, p50:32300, p75:37050 },
      { Ecole:"IAE Paris-Sorbonne (Master RH)", p25:32300, p50:36100, p75:42750 },
      { Ecole:"IAE Lyon (Master GRH)", p25:31350, p50:35150, p75:40850 },
      { Ecole:"IAE Aix-Marseille (Master RH)", p25:31350, p50:36100, p75:41800 },
      { Ecole:"IAE Grenoble (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"IAE Lille (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"IAE Nantes (Master GRH)", p25:29450, p50:33250, p75:38950 },
      { Ecole:"IAE Nice (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"Toulouse School of Management", p25:30400, p50:34200, p75:38950 },
      { Ecole:"Hors liste RH", p25:26600, p50:30400, p75:35150 }
    ];

    // Regroupement
    const allSchools = {
      ingenieur: schoolsIngenieur,
      commerce: schoolsCommerce,
      scpo: schoolsScPo,
      universite: schoolsUniversite,
      it: schoolsIT,
      design: schoolsDesign,
      fonction: [...schoolsCom, ...schoolsRH]
    };
    
    // Coefficients sous-domaines techniques
    const subdomainCoef = {
      "Fonction sp√©cifique": 1.12,
      "Calculs & Simulation": 1.04,
      "Conception": 1.02,
      "√âlectronique": 1.04,
      "Avionique": 1.04,
      "Mat√©riaux": 1.02,
      "Propulsion": 1.04,
      "M√©thodes": 1.00,
      "Production": 1.00,
      "Maintenance": 1.00,
      "Qualit√©": 1.02,
      "Supply Chain": 1.02,
      "Gestion de Projet": 1.03,
      "Ing√©nierie Syst√®mes": 1.04,
      "Gestion de Programme": 1.04,
      "Support Client": 0.98,
      "Thermique": 1.04,
      "Dynamique de Vol": 1.06,
      "√âlectrique": 1.06,
      "Test": 1.01
    };
    
  // Coefficients certifications professionnelles (r√©duits)
const certificationCoef = {
  // Executive Education (top 1.5-2%)
  // Executive Education (top 1.5-2%)
"escp_ai_business": 1.02,
"hec_digital": 1.02,
"hec_ai": 1.02,                    // (renomm√© en Executive MBA)
"insead_digital": 1.02,
"insead_ai": 1.02,                 // (renomm√© en General Management)
"polytechnique_ai": 1.02,          // (renomm√© en Executive Program)
"mit_ai": 1.02,                    // (renomm√© en Executive Education)
"stanford_ai": 1.02,               // (renomm√© en Strategic Leadership)
"essec_management": 1.015,         // NOUVEAU
"emlyon_innovation": 1.015,        // NOUVEAU
"edhec_finance": 1.015,            // NOUVEAU
"sciences_po_leadership": 1.015,   // NOUVEAU          // √©tait 1.03 ‚Üí -1%
  
  // IA / ML (1-1.5%)
  "gen_ai": 1.015,                // √©tait 1.025 ‚Üí -1%
  "mlops": 1.01,                  // √©tait 1.02 ‚Üí -1%
  "deep_learning": 1.01,          // √©tait 1.02 ‚Üí -1%
  "tensorflow_dev": 1.01,         // √©tait 1.015 ‚Üí -0.5%
  
  // Cloud (1-1.5%)
  "aws_architect": 1.01,          // √©tait 1.02 ‚Üí -1%
  "azure_architect": 1.01,        // √©tait 1.02 ‚Üí -1%
  "gcp_architect": 1.01,          // √©tait 1.02 ‚Üí -1%
  "kubernetes": 1.01,             // √©tait 1.015 ‚Üí -0.5%
  
  // Cybers√©curit√© (1.5-2%)
  "cissp": 1.02,                  // √©tait 1.03 ‚Üí -1%
  "oscp": 1.015,                  // √©tait 1.025 ‚Üí -1%
  "ceh": 1.01,                    // √©tait 1.02 ‚Üí -1%
  
  // Data & Analytics (0.5-1%)
  "databricks": 1.01,             // √©tait 1.015 ‚Üí -0.5%
  "snowflake": 1.01,              // √©tait 1.015 ‚Üí -0.5%
  "power_bi": 1.01,               // √©tait 1.015 ‚Üí -0.5%
  "tableau": 1.005,               // √©tait 1.01 ‚Üí -0.5%
  
  // Gestion de projet (1-1.5%)
  "pmp": 1.01,                    // √©tait 1.02 ‚Üí -1%
  "scrum_master": 1.01,           // √©tait 1.015 ‚Üí -0.5%
  "product_owner": 1.01,          // √©tait 1.015 ‚Üí -0.5%
  "safe": 1.01,                   // √©tait 1.015 ‚Üí -0.5%
  
  // Finance (1.5-2%)
  "cfa": 1.02,                    // √©tait 1.03 ‚Üí -1%
  "cpa": 1.02,                    // √©tait 1.03 ‚Üí -1%
  "acca": 1.015,                  // √©tait 1.025 ‚Üí -1%
  "frm": 1.01,                    // √©tait 1.02 ‚Üí -1%
  "dec": 1.02,                    // √©tait 1.03 ‚Üí -1%
  
  // Paie / Social (0.5-1%)
  "paie_gestionnaire": 1.01,      // √©tait 1.015 ‚Üí -0.5%
  "paie_silae": 1.005,            // √©tait 1.01 ‚Üí -0.5%
  "paie_sage": 1.005,             // √©tait 1.01 ‚Üí -0.5%
  "droit_social": 1.01,           // √©tait 1.015 ‚Üí -0.5%
  
  // RH / Recrutement (0.5-1%)
  "shrm": 1.01,                   // √©tait 1.015 ‚Üí -0.5%
  "ats_expert": 1.01,             // √©tait 1.015 ‚Üí -0.5%
  "sourcing_advanced": 1.01,      // √©tait 1.015 ‚Üí -0.5%
  "linkedin_recruiter": 1.005,    // √©tait 1.01 ‚Üí -0.5%
  
  // Suite Office (0.5-1.5%)
  "excel_expert": 1.01,           // √©tait 1.02 ‚Üí -1%
  "excel_advanced": 1.005,        // √©tait 1.01 ‚Üí -0.5%
  "power_automate": 1.01,         // √©tait 1.015 ‚Üí -0.5%
  "ms365_admin": 1.01,            // √©tait 1.015 ‚Üí -0.5%
  
  // ERP (1-1.5%)
  "sap_fico": 1.015,              // √©tait 1.025 ‚Üí -1%
  "sap_mm": 1.01,                 // √©tait 1.02 ‚Üí -1%
  "sap_hr": 1.01,                 // √©tait 1.02 ‚Üí -1%
  "oracle_ebs": 1.01,             // √©tait 1.02 ‚Üí -1%
  
  // CRM / Marketing (0.5-1.5%)
  "salesforce_admin": 1.01,       // √©tait 1.015 ‚Üí -0.5%
  "salesforce_dev": 1.01,         // √©tait 1.02 ‚Üí -1%
  "google_ads": 1.005,            // √©tait 1.01 ‚Üí -0.5%
  "seo_advanced": 1.01,           // √©tait 1.015 ‚Üí -0.5%
  
  // Qualit√© / Lean (0.5-1.5%)
  "six_sigma_black": 1.015,       // √©tait 1.025 ‚Üí -1%
  "six_sigma_green": 1.01,        // √©tait 1.015 ‚Üí -0.5%
  "lean_expert": 1.01,            // √©tait 1.015 ‚Üí -0.5%
  "itil": 1.005,                  // √©tait 1.01 ‚Üí -0.5%
  
  // Design (0.5-1%)
  "ux_certified": 1.01,           // √©tait 1.015 ‚Üí -0.5%
  "adobe_certified": 1.01,        // √©tait 1.015 ‚Üí -0.5%
  "figma_advanced": 1.005,        // √©tait 1.01 ‚Üí -0.5%
  
  // Ing√©nierie / CAO (0.5-1.5%)
  "catia": 1.01,                  // √©tait 1.015 ‚Üí -0.5%
  "solidworks": 1.01,             // √©tait 1.015 ‚Üí -0.5%
  "bim_manager": 1.01,            // √©tait 1.02 ‚Üí -1%
  "autocad_certified": 1.005      // √©tait 1.01 ‚Üí -0.5%
};
    
    // ===============================
    // M√âTIERS PAR SECTEUR
    // ===============================

    // M√©tiers IT
    const functionsIT = {
      "D√©veloppeur Front-End": { p25: 30000, p50: 38000, p75: 46000 },
      "D√©veloppeur Back-End": { p25: 32000, p50: 40000, p75: 48000 },
      "D√©veloppeur Full-Stack": { p25: 33000, p50: 42000, p75: 52000 },
      "Data Engineer": { p25: 35000, p50: 45000, p75: 58000 },
      "Data Scientist": { p25: 37000, p50: 48000, p75: 62000 },
      "DevOps / SRE": { p25: 36000, p50: 47000, p75: 60000 },
      "Infra / R√©seau": { p25: 32000, p50: 42000, p75: 54000 },
      "Cloud Architect": { p25: 45000, p50: 60000, p75: 80000 },
      "Cybersecurity Engineer": { p25: 38000, p50: 42000, p75: 46000 },
      "Admin Syst√®mes": { p25: 31000, p50: 40000, p75: 52000 },
      "Product Owner": { p25: 42000, p50: 49000, p75: 58000 },
      "Product Manager": { p25: 50000, p50: 60000, p75: 75000 }
    };

    // M√©tiers Design
    const functionsDesign = {
      "UX Designer": { p25: 30000, p50: 38000, p75: 48000 },
      "UI Designer": { p25: 32000, p50: 40000, p75: 50000 },
      "UX/UI Designer": { p25: 35000, p50: 42000, p75: 50000 },
      "Product Designer": { p25: 33000, p50: 42000, p75: 55000 },
      "Motion Designer": { p25: 28000, p50: 35000, p75: 45000 },
      "Graphiste / Branding": { p25: 26000, p50: 33000, p75: 42000 },
      "Interaction Designer": { p25: 30000, p50: 38000, p75: 47000 }
    };

    // Achats
    const functionsAchats = {
      "Acheteur Junior": { p25: 38000, p50: 42000, p75: 47000 },
      "Acheteur Confirm√©": { p25: 45000, p50: 50000, p75: 55000 },
      "Responsable Achats": { p25: 55000, p50: 65000, p75: 80000 },
      "Directeur Achats": { p25: 80000, p50: 95000, p75: 120000 }
    };

    // Immobilier
    const functionsImmo = {
      "Charg√© de Gestion Immobili√®re": { p25: 32000, p50: 38000, p75: 45000 },
      "Property Manager": { p25: 40000, p50: 52000, p75: 65000 },
      "Responsable Immobilier": { p25: 55000, p50: 72000, p75: 90000 },
      "Directeur Immobilier": { p25: 80000, p50: 100000, p75: 125000 }
    };

    // Ressources Humaines
    const functionsRH = {
      "Charg√© RH": { p25: 34000, p50: 39000, p75: 45000 },
      "Talent Acquisition": { p25: 33000, p50: 37000, p75: 42000 },
      "Senior Talent Acquisition": { p25: 42000, p50: 48000, p75: 54000 },
      "Talent Acquisition Manager": { p25: 50000, p50: 58000, p75: 66000 },
      "Responsable RH / HRBP": { p25: 47000, p50: 55250, p75: 66000 },
      "Directeur des Ressources Humaines": { p25: 70000, p50: 95000, p75: 120000 }
    };

    // Finance
    const functionsFinance = {
      "Comptable": { p25: 32000, p50: 37000, p75: 42000 },
      "Contr√¥leur de Gestion": { p25: 42000, p50: 49400, p75: 60000 },
      "Auditeur Interne": { p25: 40000, p50: 47000, p75: 55000 },
      "Tr√©sorier": { p25: 45000, p50: 52000, p75: 60000 },
      "Responsable Financier": { p25: 55000, p50: 65000, p75: 80000 },
      "Directeur Administratif et Financier (DAF)": { p25: 80000, p50: 110000, p75: 140000 }
    };

    // Commerciaux
    const functionsCommerciaux = {
      "Business Developer Junior": { p25: 30000, p50: 35000, p75: 40000 },
      "Business Developer Confirm√©": { p25: 38000, p50: 42000, p75: 48000 },
      "Responsable Commercial": { p25: 55000, p50: 60000, p75: 75000 },
      "Directeur Commercial": { p25: 75000, p50: 85000, p75: 110000 }
    };

    // Communication
    const functionsCommunication = {
      "Charg√© de communication": { p25: 28000, p50: 32000, p75: 37000 },
      "Responsable de communication": { p25: 40000, p50: 46000, p75: 52000 },
      "Directeur de la communication": { p25: 65000, p50: 75000, p75: 90000 }
    };

    // Ing√©nieurs Ops
    const functionsOps = {
      "Ing√©nieur Op√©ration": { p25: 35500, p50: 38500, p75: 44000 },
      "Ing√©nieur Op√©ration Senior": { p25: 62000, p50: 68900, p75: 78000 },
      "Ing√©nieur Mission": { p25: 38500, p50: 42000, p75: 47000 },
      "Ing√©nieur Mission Senior": { p25: 68000, p50: 73950, p75: 83000 }
    };

    // Regroupement de toutes les fonctions
    const allFunctions = {
      ...functionsIT,
      ...functionsDesign,
      ...functionsAchats,
      ...functionsImmo,
      ...functionsRH,
      ...functionsFinance,
      ...functionsCommerciaux,
      ...functionsCommunication,
      ...functionsOps
    };

    // ===== GESTION DES TABS =====
    let currentTab = 'simulator';
    
    // ===== VARIABLES GLOBALES BRUT/NET =====
    let calculationMode = 'brut'; // 'brut' ou 'net'
    let repartitionChart = null;
    
    // ===== BASE DE DONN√âES EXPATRIATION (11 PAYS) =====
    let selectedCountry = null;
    let expatComparisonChart = null;
    let expatMode = 'comparison'; // 'comparison' ou 'equivalence'
    let exchangeRatesLastUpdate = null;
    let exchangeRatesFetchError = false;

    const countriesData = {
      usa: {
        name: "√âtats-Unis",
        flag: "üá∫üá∏",
        currency: "USD",
        exchangeRate: 1.17, // 1 EUR = 1.17 USD
        taxBrackets: [
          { min: 0, max: 11600, rate: 0.10 },
          { min: 11600, max: 47150, rate: 0.12 },
          { min: 47150, max: 100525, rate: 0.22 },
          { min: 100525, max: 191950, rate: 0.24 },
          { min: 191950, max: 243725, rate: 0.32 },
          { min: 243725, max: 609350, rate: 0.35 },
          { min: 609350, max: Infinity, rate: 0.37 }
        ],
        socialCharges: 0.0765, // FICA 7.65% (Social Security 6.2% + Medicare 1.45%)
        costOfLiving: 115, // Base 100 = France
        taxNote: "Bar√®me f√©d√©ral. S'ajoutent imp√¥ts d'√âtat (0-13%). Syst√®me citizenship-based."
      },
      uk: {
        name: "Royaume-Uni",
        flag: "üá¨üáß",
        currency: "GBP",
        exchangeRate: 0.87, // 1 EUR = 0.87 GBP
        taxBrackets: [
          { min: 0, max: 12570, rate: 0 }, // Personal allowance
          { min: 12570, max: 50270, rate: 0.20 },
          { min: 50270, max: 125140, rate: 0.40 },
          { min: 125140, max: Infinity, rate: 0.45 }
        ],
        socialCharges: 0.12, // National Insurance 12% + 2% sur hauts revenus
        costOfLiving: 120,
        taxNote: "National Insurance 12% sur revenus jusqu'√† ¬£50k, puis 2% au-del√†."
      },
      germany: {
        name: "Allemagne",
        flag: "üá©üá™",
        currency: "EUR",
        exchangeRate: 1.0,
        taxBrackets: [
          { min: 0, max: 11604, rate: 0 },
          { min: 11604, max: 17005, rate: 0.14 },
          { min: 17005, max: 66760, rate: 0.2397 },
          { min: 66760, max: 277825, rate: 0.42 },
          { min: 277825, max: Infinity, rate: 0.45 }
        ],
        socialCharges: 0.20, // Sant√© + retraite + ch√¥mage ~20% partag√©
        costOfLiving: 95,
        taxNote: "Cotisations sociales ~20%+ partag√©es employ√©/employeur."
      },
      switzerland: {
        name: "Suisse",
        flag: "üá®üá≠",
        currency: "CHF",
        exchangeRate: 0.93, // 1 EUR = 0.93 CHF
        taxBrackets: [
          { min: 0, max: 18200, rate: 0 },
          { min: 18200, max: 31600, rate: 0.01 },
          { min: 31600, max: 41400, rate: 0.02 },
          { min: 41400, max: 55200, rate: 0.03 },
          { min: 55200, max: 72500, rate: 0.04 },
          { min: 72500, max: 78100, rate: 0.05 },
          { min: 78100, max: 103600, rate: 0.06 },
          { min: 103600, max: 134600, rate: 0.07 },
          { min: 134600, max: 176000, rate: 0.08 },
          { min: 176000, max: 755200, rate: 0.09 },
          { min: 755200, max: Infinity, rate: 0.115 }
        ],
        socialCharges: 0.11, // AVS/AI/APG + AC ~10-12%
        costOfLiving: 140,
        taxNote: "Imp√¥t f√©d√©ral (bar√®me ci-dessus) + cantonal (variable). Moyenne totale ~34%."
      },
      luxembourg: {
        name: "Luxembourg",
        flag: "üá±üá∫",
        currency: "EUR",
        exchangeRate: 1.0,
        taxBrackets: [
          { min: 0, max: 12438, rate: 0 },
          { min: 12438, max: 23967, rate: 0.08 },
          { min: 23967, max: 33269, rate: 0.10 },
          { min: 33269, max: 42475, rate: 0.12 },
          { min: 42475, max: 51672, rate: 0.14 },
          { min: 51672, max: 60868, rate: 0.16 },
          { min: 60868, max: 70064, rate: 0.18 },
          { min: 70064, max: 79260, rate: 0.20 },
          { min: 79260, max: 88457, rate: 0.22 },
          { min: 88457, max: 97653, rate: 0.24 },
          { min: 97653, max: 106849, rate: 0.26 },
          { min: 106849, max: 116045, rate: 0.28 },
          { min: 116045, max: 125241, rate: 0.30 },
          { min: 125241, max: 134438, rate: 0.32 },
          { min: 134438, max: 143634, rate: 0.34 },
          { min: 143634, max: 152830, rate: 0.36 },
          { min: 152830, max: 162026, rate: 0.38 },
          { min: 162026, max: 171223, rate: 0.39 },
          { min: 171223, max: 180419, rate: 0.40 },
          { min: 180419, max: 189615, rate: 0.41 },
          { min: 189615, max: 200004, rate: 0.42 },
          { min: 200004, max: Infinity, rate: 0.45 }
        ],
        socialCharges: 0.125, // ~12.5% (part salari√© sur ~25% total combin√©)
        costOfLiving: 125,
        taxNote: "Progressif jusqu'√† 45-46%. Cotisations ~25% combin√©es employ√©+employeur."
      },
      dubai: {
        name: "Duba√Ø (EAU)",
        flag: "üá¶üá™",
        currency: "AED",
        exchangeRate: 4.30, // 1 EUR = 4.30 AED
        taxBrackets: [
          { min: 0, max: Infinity, rate: 0 } // Pas d'imp√¥t sur le revenu des personnes physiques
        ],
        socialCharges: 0.0, // Pas de cotisations pour expatri√©s
        costOfLiving: 110,
        taxNote: "0% imp√¥t revenu personnes physiques. 0% cotisations sociales pour expatri√©s. TVA 5%."
      },
      singapore: {
        name: "Singapour",
        flag: "üá∏üá¨",
        currency: "SGD",
        exchangeRate: 1.60, // 1 EUR = 1.60 SGD
        taxBrackets: [
          { min: 0, max: 20000, rate: 0 },
          { min: 20000, max: 30000, rate: 0.02 },
          { min: 30000, max: 40000, rate: 0.035 },
          { min: 40000, max: 80000, rate: 0.07 },
          { min: 80000, max: 120000, rate: 0.115 },
          { min: 120000, max: 160000, rate: 0.15 },
          { min: 160000, max: 200000, rate: 0.18 },
          { min: 200000, max: 240000, rate: 0.19 },
          { min: 240000, max: 280000, rate: 0.195 },
          { min: 280000, max: 320000, rate: 0.20 },
          { min: 320000, max: 500000, rate: 0.22 },
          { min: 500000, max: 1000000, rate: 0.23 },
          { min: 1000000, max: Infinity, rate: 0.24 }
        ],
        socialCharges: 0.0, // CPF obligatoire pour r√©sidents uniquement, pas pour expatri√©s non-r√©sidents
        costOfLiving: 125,
        taxNote: "Progressif jusqu'√† 22-24%. CPF (20%) obligatoire pour r√©sidents, pas pour expats."
      },
      canada: {
        name: "Canada",
        flag: "üá®üá¶",
        currency: "CAD",
        exchangeRate: 1.61, // 1 EUR = 1.61 CAD
        taxBrackets: [
          { min: 0, max: 55867, rate: 0.15 },
          { min: 55867, max: 111733, rate: 0.205 },
          { min: 111733, max: 173205, rate: 0.26 },
          { min: 173205, max: 246752, rate: 0.29 },
          { min: 246752, max: Infinity, rate: 0.33 }
        ],
        socialCharges: 0.11, // CPP + EI ~10-12% partag√©
        costOfLiving: 105,
        taxNote: "Bar√®me f√©d√©ral (max 33%). S'ajoute imp√¥t provincial (total combin√© ~50% max)."
      },
      australia: {
        name: "Australie",
        flag: "üá¶üá∫",
        currency: "AUD",
        exchangeRate: 1.60, // 1 EUR = 1.60 AUD
        taxBrackets: [
          { min: 0, max: 18200, rate: 0 },
          { min: 18200, max: 45000, rate: 0.19 },
          { min: 45000, max: 120000, rate: 0.325 },
          { min: 120000, max: 180000, rate: 0.37 },
          { min: 180000, max: Infinity, rate: 0.45 }
        ],
        socialCharges: 0.10, // Superannuation ~10-11% (pay√© par employeur, pas pr√©l√®vement direct salari√©)
        costOfLiving: 118,
        taxNote: "Progressif jusqu'√† 45%. Superannuation ~10-11% pay√© par employeur."
      },
      japan: {
        name: "Japon",
        flag: "üáØüáµ",
        currency: "JPY",
        exchangeRate: 180, // 1 EUR = 180 JPY
        taxBrackets: [
          { min: 0, max: 1950000, rate: 0.05 },
          { min: 1950000, max: 3300000, rate: 0.10 },
          { min: 3300000, max: 6950000, rate: 0.20 },
          { min: 6950000, max: 9000000, rate: 0.23 },
          { min: 9000000, max: 18000000, rate: 0.33 },
          { min: 18000000, max: 40000000, rate: 0.40 },
          { min: 40000000, max: Infinity, rate: 0.45 }
        ],
        socialCharges: 0.15, // Sant√© + retraite + ch√¥mage ~15%+ partag√©
        costOfLiving: 100,
        taxNote: "Progressif jusqu'√† 45%. Cotisations sociales ~15%+ partag√©es."
      },
      china: {
        name: "Chine",
        flag: "üá®üá≥",
        currency: "CNY",
        exchangeRate: 7.9, // 1 EUR = 7.9 CNY
        taxBrackets: [
          { min: 0, max: 36000, rate: 0.03 },
          { min: 36000, max: 144000, rate: 0.10 },
          { min: 144000, max: 300000, rate: 0.20 },
          { min: 300000, max: 420000, rate: 0.25 },
          { min: 420000, max: 660000, rate: 0.30 },
          { min: 660000, max: 960000, rate: 0.35 },
          { min: 960000, max: Infinity, rate: 0.45 }
        ],
        socialCharges: 0.22, // Sant√© + retraite + ch√¥mage + logement ~20-30% selon ville
        costOfLiving: 75,
        taxNote: "Progressif jusqu'√† 45%. Cotisations ~20-30% selon ville (P√©kin, Shanghai)."
      }
      ,
      brazil: {
        name: "Br√©sil",
        flag: "üáßüá∑",
        currency: "BRL",
        exchangeRate: 6.5, // 1 EUR = 6.5 BRL
        taxBrackets: [
          { min: 0, max: 24511, rate: 0 }, // Exon√©ration (‚âà 2042 BRL/mois √ó 12)
          { min: 24511, max: 33919, rate: 0.075 }, // 7.5%
          { min: 33919, max: 45012, rate: 0.15 }, // 15%
          { min: 45012, max: 55976, rate: 0.225 }, // 22.5%
          { min: 55976, max: Infinity, rate: 0.275 } // 27.5% (taux marginal max)
        ],
        socialCharges: 0.14, // Cotisations salariales ~14% (retraite, sant√©, ch√¥mage)
        costOfLiving: 65, // Base 100 = France (Br√©sil significativement moins cher)
        taxNote: "IRPF progressif jusqu'√† 27.5%. Cotisations ~14% salari√© + 20-22% employeur. R√©forme fiscale TVA en cours 2026."
      },
      southkorea: {
        name: "Cor√©e du Sud",
        flag: "üá∞üá∑",
        currency: "KRW",
        exchangeRate: 1690, // 1 EUR = 1690 KRW (Won sud-cor√©en) - ECB 2025
        taxBrackets: [
          { min: 0, max: 12000000, rate: 0.06 }, // 6% jusqu'√† 12M KRW
          { min: 12000000, max: 46000000, rate: 0.15 }, // 15%
          { min: 46000000, max: 88000000, rate: 0.24 }, // 24%
          { min: 88000000, max: 150000000, rate: 0.35 }, // 35%
          { min: 150000000, max: 300000000, rate: 0.38 }, // 38%
          { min: 300000000, max: 500000000, rate: 0.40 }, // 40%
          { min: 500000000, max: 1000000000, rate: 0.42 }, // 42%
          { min: 1000000000, max: Infinity, rate: 0.45 } // 45%
        ],
        socialCharges: 0.095, // Cotisations salariales ~9.5% (Sant√© 4% + Retraite 4.5% + Emploi 0.9% + LTC 0.46%)
        costOfLiving: 105, // Base 100 = France
        taxNote: "Imp√¥t progressif jusqu'√† 45% + surtaxe locale 10% (incluse dans le calcul). Cotisations ~9.5% salari√©. Option taux plat 19% pour gros salaires expatri√©s premi√®res ann√©es.",
        localTaxSurcharge: 0.10 // Surtaxe locale = 10% de l'imp√¥t national
      }
    };
    
    // ===== FONCTION : R√âCUP√âRATION TAUX DE CHANGE EN TEMPS R√âEL =====
    async function fetchExchangeRates() {
      try {
        // API gratuite : https://www.exchangerate-api.com (1500 requ√™tes/mois)
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/EUR');
        
        if (!response.ok) {
          throw new Error('API non disponible');
        }
        
        const data = await response.json();
        const rates = data.rates;
        
        // Mise √† jour des taux dans countriesData
        countriesData.usa.exchangeRate = rates.USD || 1.17;
        countriesData.uk.exchangeRate = rates.GBP || 0.87;
        countriesData.switzerland.exchangeRate = rates.CHF || 0.93;
        countriesData.dubai.exchangeRate = rates.AED || 4.30;
        countriesData.singapore.exchangeRate = rates.SGD || 1.60;
        countriesData.canada.exchangeRate = rates.CAD || 1.61;
        countriesData.australia.exchangeRate = rates.AUD || 1.60;
        countriesData.japan.exchangeRate = rates.JPY || 180;
        countriesData.china.exchangeRate = rates.CNY || 7.9;
        countriesData.brazil.exchangeRate = rates.BRL || 6.5;
        countriesData.southkorea.exchangeRate = rates.KRW || 1690;
        
        // Date de mise √† jour
        exchangeRatesLastUpdate = new Date(data.date || Date.now());
        exchangeRatesFetchError = false;
        
        console.log('‚úÖ Taux de change mis √† jour:', exchangeRatesLastUpdate.toLocaleDateString('fr-FR'));
        
        // Afficher un indicateur de mise √† jour r√©ussie
        showExchangeRateStatus('success', exchangeRatesLastUpdate);
        
      } catch (error) {
        console.warn('‚ö†Ô∏è Impossible de r√©cup√©rer les taux de change en temps r√©el. Utilisation des taux par d√©faut.');
        console.error(error);
        exchangeRatesFetchError = true;
        
        // Afficher un message d'avertissement
        showExchangeRateStatus('error');
      }
    }

    // ===== FONCTION : AFFICHER STATUT TAUX DE CHANGE =====
    function showExchangeRateStatus(status, date = null) {
      const existingStatus = document.getElementById('exchange-rate-status');
      if (existingStatus) existingStatus.remove();
      
      const statusDiv = document.createElement('div');
      statusDiv.id = 'exchange-rate-status';
      statusDiv.className = 'fixed bottom-4 right-4 z-50 p-3 rounded-lg shadow-lg transition-all duration-500';
      
      if (status === 'success') {
        statusDiv.className += ' bg-green-500 text-white';
        statusDiv.innerHTML = `
          <div class="flex items-center gap-2 text-sm">
            <span>‚úÖ</span>
            <div>
              <p class="font-semibold">Taux de change √† jour</p>
              <p class="text-xs opacity-80">${date.toLocaleDateString('fr-FR')} ${date.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</p>
            </div>
          </div>
        `;
      } else {
        statusDiv.className += ' bg-orange-500 text-white';
        statusDiv.innerHTML = `
          <div class="flex items-center gap-2 text-sm">
            <span>‚ö†Ô∏è</span>
            <div>
              <p class="font-semibold">Taux de change statiques</p>
              <p class="text-xs opacity-80">API non disponible</p>
            </div>
          </div>
        `;
      }
      
      document.body.appendChild(statusDiv);
      
      // Auto-masquer apr√®s 5 secondes
      setTimeout(() => {
        statusDiv.style.opacity = '0';
        setTimeout(() => statusDiv.remove(), 500);
      }, 5000);
    }

    // ===== APPELER L'API AU CHARGEMENT DE LA PAGE =====
    window.addEventListener('load', () => {
      fetchExchangeRates();
    });
    
    // ===== FONCTION : S√âLECTION PAYS =====
    function selectCountry(country) {
      selectedCountry = country;
      const countryData = countriesData[country];
      
      // Retirer la classe active de tous les boutons
      document.querySelectorAll('.country-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Ajouter la classe active au bouton s√©lectionn√©
      document.querySelector(`[data-country="${country}"]`).classList.add('active');
      
      // Afficher la section input salaire
      document.getElementById('expat-input-section').classList.remove('hidden');
      document.getElementById('expat-country-flag').textContent = countryData.flag;
      document.getElementById('expat-country-name').textContent = countryData.name;
      document.getElementById('expat-currency').textContent = countryData.currency;
      document.getElementById('current-rate-display').textContent = 
  countryData.exchangeRate.toFixed(2) + ' ' + countryData.currency;
  
    
    
      // Calculer si les champs sont remplis
      calculateExpatriation();
    }
    
    // ===== FONCTION : SWITCH MODE EXPATRIATION =====
    function switchExpatMode(mode) {
      expatMode = mode;
      
      // G√©rer les boutons
      document.getElementById('mode-comparison').classList.toggle('active', mode === 'comparison');
      document.getElementById('mode-equivalence').classList.toggle('active', mode === 'equivalence');
      
      // G√©rer l'affichage des contenus
      document.getElementById('expat-mode-comparison-content').classList.toggle('hidden', mode !== 'comparison');
      document.getElementById('expat-mode-equivalence-content').classList.toggle('hidden', mode !== 'equivalence');
      
      // Recalculer
      calculateExpatriation();
    }

 // ===== FONCTION : CALCUL SALAIRE √âQUIVALENT (SANS LIMITES) =====
    function calculateEquivalentSalary(targetPouvoirAchat, countryData) {
      // Plafond tr√®s √©lev√© pour couvrir toutes les devises (1 milliard)
      let minSalary = 1000;
      let maxSalary = 1000000000; // 1 milliard dans n'importe quelle devise
      let iterations = 0;
      const maxIterations = 100; // Plus d'it√©rations pour garantir convergence
      const tolerancePercent = 0.001; // Tol√©rance de 0.1% du salaire
      
      while (iterations < maxIterations) {
        const testSalary = (minSalary + maxSalary) / 2;
        
        // Calcul avec ce salaire test
        const socialCharges = testSalary * countryData.socialCharges;
        const netBeforeTax = testSalary - socialCharges;
        let tax = calculateProgressiveTax(netBeforeTax, countryData.taxBrackets);

// Ajouter la surtaxe locale si le pays en a une
if (countryData.localTaxSurcharge) {
  tax = tax * (1 + countryData.localTaxSurcharge);
}
        const netAfterTax = netBeforeTax - tax;
        const netAfterTaxEUR = netAfterTax / countryData.exchangeRate;
        const pouvoirAchat = (netAfterTaxEUR / countryData.costOfLiving) * 100;
        
        // V√©rifier si on a converg√© (√©cart < 0.1%)
        const diff = Math.abs(pouvoirAchat - targetPouvoirAchat);
        if (diff < targetPouvoirAchat * tolerancePercent) {
          return testSalary;
        }
        
        if (pouvoirAchat < targetPouvoirAchat) {
          minSalary = testSalary;
        } else {
          maxSalary = testSalary;
        }
        
        iterations++;
        
        // Si on atteint la limite haute sans converger, doubler le plafond
        if (iterations === maxIterations - 1 && maxSalary >= 999000000) {
          maxSalary = maxSalary * 2;
          maxIterations += 50; // Plus d'it√©rations
        }
      }
      
      return (minSalary + maxSalary) / 2;
    }
    // ===== FONCTION : CALCUL IMP√îT PROGRESSIF =====
    function calculateProgressiveTax(income, brackets) {
      let tax = 0;
      let previousMax = 0;
      
      for (const bracket of brackets) {
        if (income > bracket.min) {
          const taxableInBracket = Math.min(income, bracket.max) - bracket.min;
          tax += taxableInBracket * bracket.rate;
        }
        if (income <= bracket.max) break;
      }
      
      return tax;
    }

    // ===== FONCTION : CALCUL NET FRANCE (r√©utilise logique Brut/Net) =====
    function calculateNetFrance(brut, statut, partsFiscales) {
      const plafondSS = 46368;
      const tranche1 = Math.min(brut, plafondSS);
      const tranche2 = Math.max(0, brut - plafondSS);
      const assietteCsgCrds = brut * 0.9825;
      
      let cotisationsSalariales = {};
      
      if (statut === 'cadre') {
        cotisationsSalariales = {
          csg: assietteCsgCrds * 0.068,
          csgNonDed: assietteCsgCrds * 0.024,
          crds: assietteCsgCrds * 0.005,
          retraiteBase: tranche1 * 0.069,
          retraiteDeplaf: brut * 0.004,
          retraiteCompT1: tranche1 * 0.0315,
          retraiteCompT2: tranche2 * 0.0864,
          cegT1: tranche1 * 0.0086,
          cegT2: tranche2 * 0.0108,
          apec: Math.min(brut, plafondSS * 4) * 0.00024
        };
      } else {
        cotisationsSalariales = {
          csg: assietteCsgCrds * 0.068,
          csgNonDed: assietteCsgCrds * 0.024,
          crds: assietteCsgCrds * 0.005,
          retraiteBase: tranche1 * 0.069,
          retraiteDeplaf: brut * 0.004,
          retraiteCompT1: tranche1 * 0.0315,
          retraiteCompT2: tranche2 * 0.0864,
          cegT1: tranche1 * 0.0086,
          cegT2: tranche2 * 0.0108
        };
      }
      
      const totalCotisations = Object.values(cotisationsSalariales).reduce((a, b) => a + b, 0);
      const netAvantImpots = brut - totalCotisations;
      
      // Calcul imp√¥t avec bar√®me 2024
      const abattement = Math.min(Math.max(netAvantImpots * 0.10, 472), 13522);
      const revenuImposable = netAvantImpots - abattement;
      const quotientFamilial = revenuImposable / partsFiscales;
      
      let impotParPart = 0;
      if (quotientFamilial <= 11497) {
        impotParPart = 0;
      } else if (quotientFamilial <= 29315) {
        impotParPart = (quotientFamilial - 11497) * 0.11;
      } else if (quotientFamilial <= 83823) {
        impotParPart = (29315 - 11497) * 0.11 + (quotientFamilial - 29315) * 0.30;
      } else if (quotientFamilial <= 180294) {
        impotParPart = (29315 - 11497) * 0.11 + (83823 - 29315) * 0.30 + (quotientFamilial - 83823) * 0.41;
      } else {
        impotParPart = (29315 - 11497) * 0.11 + (83823 - 29315) * 0.30 + (180294 - 83823) * 0.41 + (quotientFamilial - 180294) * 0.45;
      }
      
      const impotTotal = impotParPart * partsFiscales;
      const netApresImpots = netAvantImpots - impotTotal;
      
      return {
        brut: brut,
        netAvantImpots: netAvantImpots,
        impot: impotTotal,
        netApresImpots: netApresImpots
      };
    }

// ===== FONCTION PRINCIPALE : CALCUL EXPATRIATION (MODIFI√âE) =====
    function calculateExpatriation() {
      const salaryFrance = parseFloat(document.getElementById('expat-salary-france').value) || 0;
      const statutFrance = document.getElementById('expat-statut-france').value;
      const partsFiscales = parseFloat(document.getElementById('expat-parts-france').value);
      
      if (salaryFrance === 0) {
        document.getElementById('expat-net-france').textContent = '‚Äî';
        return;
      }
      
      // Calcul France
      const resultFrance = calculateNetFrance(salaryFrance, statutFrance, partsFiscales);
      document.getElementById('expat-net-france').textContent = 
        Math.round(resultFrance.netApresImpots).toLocaleString() + ' ‚Ç¨';
      
      // Si pas de pays s√©lectionn√©, on s'arr√™te l√†
      if (!selectedCountry) return;
      
      const countryData = countriesData[selectedCountry];
      let salaryForeign, salaryForeignEUR, netAfterTaxForeign, netAfterTaxForeignEUR;
      
      // ===== MODE COMPARAISON =====
      if (expatMode === 'comparison') {
        salaryForeign = parseFloat(document.getElementById('expat-salary-foreign').value) || 0;
        
        if (salaryForeign === 0) {
          document.getElementById('expat-comparison-section').classList.add('hidden');
          return;
        }
        
        // Conversion en EUR
        salaryForeignEUR = salaryForeign / countryData.exchangeRate;
        document.getElementById('expat-salary-eur').textContent = 
          Math.round(salaryForeignEUR).toLocaleString() + ' ‚Ç¨';
        
        // Calcul cotisations sociales pays √©tranger
        const socialChargesForeign = salaryForeign * countryData.socialCharges;
        const netBeforeTaxForeign = salaryForeign - socialChargesForeign;
        
        // Calcul imp√¥t pays √©tranger
        let taxForeign = calculateProgressiveTax(netBeforeTaxForeign, countryData.taxBrackets);

// Ajouter la surtaxe locale si le pays en a une (ex: Cor√©e du Sud 10%)
if (countryData.localTaxSurcharge) {
  taxForeign = taxForeign * (1 + countryData.localTaxSurcharge);
}
        netAfterTaxForeign = netBeforeTaxForeign - taxForeign;
        netAfterTaxForeignEUR = netAfterTaxForeign / countryData.exchangeRate;
      }
      // ===== MODE √âQUIVALENCE =====
      else {
        const pouvoirAchatFrance = resultFrance.netApresImpots;
        
        // Calcul du salaire √©quivalent n√©cessaire
        salaryForeign = calculateEquivalentSalary(pouvoirAchatFrance, countryData);
        salaryForeignEUR = salaryForeign / countryData.exchangeRate;
        
        // Affichage
        document.getElementById('expat-equivalent-salary').textContent = 
          Math.round(salaryForeign).toLocaleString() + ' ' + countryData.currency;
        document.getElementById('expat-equivalent-eur').textContent = 
          Math.round(salaryForeignEUR).toLocaleString() + ' ‚Ç¨';
        
        // Calcul avec ce salaire
        const socialChargesForeign = salaryForeign * countryData.socialCharges;
        const netBeforeTaxForeign = salaryForeign - socialChargesForeign;
        let taxForeign = calculateProgressiveTax(netBeforeTaxForeign, countryData.taxBrackets);

// Ajouter la surtaxe locale si le pays en a une (ex: Cor√©e du Sud 10%)
if (countryData.localTaxSurcharge) {
  taxForeign = taxForeign * (1 + countryData.localTaxSurcharge);
}
        netAfterTaxForeign = netBeforeTaxForeign - taxForeign;
        netAfterTaxForeignEUR = netAfterTaxForeign / countryData.exchangeRate;
      }
      
      // Calcul pouvoir d'achat r√©el
      const pouvoirAchatFrance = resultFrance.netApresImpots;
      const pouvoirAchatForeign = (netAfterTaxForeignEUR / countryData.costOfLiving) * 100;
      
      // Affichage comparaison
      document.getElementById('expat-comparison-section').classList.remove('hidden');
      
      // Colonne France
      document.getElementById('comp-france-brut').textContent = 
        Math.round(resultFrance.brut).toLocaleString() + ' ‚Ç¨';
      document.getElementById('comp-france-net').textContent = 
        Math.round(resultFrance.netApresImpots).toLocaleString() + ' ‚Ç¨/an';
      document.getElementById('comp-france-pouvoir').textContent = 
        Math.round(pouvoirAchatFrance).toLocaleString() + ' ‚Ç¨';
      
      // Colonne √âtranger
      document.getElementById('comp-foreign-flag').textContent = countryData.flag;
      document.getElementById('comp-foreign-name').textContent = countryData.name;
      document.getElementById('comp-foreign-brut').textContent = 
        Math.round(salaryForeign).toLocaleString() + ' ' + countryData.currency +
        ' (' + Math.round(salaryForeignEUR).toLocaleString() + ' ‚Ç¨)';
      document.getElementById('comp-foreign-net').textContent = 
        Math.round(netAfterTaxForeign).toLocaleString() + ' ' + countryData.currency +
        ' (' + Math.round(netAfterTaxForeignEUR).toLocaleString() + ' ‚Ç¨/an)';
      document.getElementById('comp-foreign-cost').textContent = countryData.costOfLiving;
      document.getElementById('comp-foreign-pouvoir').textContent = 
        Math.round(pouvoirAchatForeign).toLocaleString() + ' ‚Ç¨';
      
      // G√©n√©ration analyse
      generateExpatAnalysis(resultFrance, netAfterTaxForeignEUR, pouvoirAchatFrance, pouvoirAchatForeign, countryData, expatMode);
      
      // G√©n√©ration graphique
      generateExpatChart(resultFrance, netAfterTaxForeignEUR, pouvoirAchatFrance, pouvoirAchatForeign, countryData);
    }

    // ===== FONCTION : G√âN√âRATION ANALYSE =====
    function generateExpatAnalysis(france, netForeign, pouvoirFrance, pouvoirForeign, countryData, mode) {
      const diffNet = netForeign - france.netApresImpots;
      const diffPouvoir = pouvoirForeign - pouvoirFrance;
      const percNet = ((diffNet / france.netApresImpots) * 100).toFixed(1);
      const percPouvoir = ((diffPouvoir / pouvoirFrance) * 100).toFixed(1);
      
      let analysis = '';
      
      // Message sp√©cifique au mode √âquivalence
  if (mode === 'equivalence') {
    analysis += `
      <div class="p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg border-l-4 border-indigo-500">
        <p class="text-sm font-semibold text-indigo-800 dark:text-indigo-300">
          üéØ Mode √âquivalence activ√©
        </p>
        <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
          Le salaire affich√© correspond √† ce qu'il faudrait demander pour avoir le m√™me pouvoir d'achat qu'en France.
        </p>
      </div>
    `;
  }
      
      // Analyse net absolu
      if (diffNet > 0) {
        analysis += `
          <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
            <p class="text-sm font-semibold text-green-800 dark:text-green-300">
              ‚úÖ Gain net : +${Math.round(Math.abs(diffNet)).toLocaleString()} ‚Ç¨/an (+${percNet}%)
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
              Vous gagnez ${Math.round(Math.abs(diffNet) / 12).toLocaleString()} ‚Ç¨/mois de plus en net apr√®s imp√¥ts.
            </p>
          </div>
        `;
      } else if (diffNet < 0) {
        analysis += `
          <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border-l-4 border-red-500">
            <p class="text-sm font-semibold text-red-800 dark:text-red-300">
              ‚ö†Ô∏è Perte nette : -${Math.round(Math.abs(diffNet)).toLocaleString()} ‚Ç¨/an (${percNet}%)
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
              Vous perdez ${Math.round(Math.abs(diffNet) / 12).toLocaleString()} ‚Ç¨/mois en net apr√®s imp√¥ts.
            </p>
          </div>
        `;
      }
      
      // Analyse pouvoir d'achat
      if (diffPouvoir > 0) {
        analysis += `
          <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500">
            <p class="text-sm font-semibold text-blue-800 dark:text-blue-300">
              üí° Pouvoir d'achat : +${Math.round(Math.abs(diffPouvoir)).toLocaleString()} ‚Ç¨ √©quivalent (+${percPouvoir}%)
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
              Apr√®s ajustement co√ªt de vie (indice ${countryData.costOfLiving}), votre pouvoir d'achat r√©el augmente.
            </p>
          </div>
        `;
      } else if (diffPouvoir < 0) {
        analysis += `
          <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-l-4 border-orange-500">
            <p class="text-sm font-semibold text-orange-800 dark:text-orange-300">
              üí∞ Pouvoir d'achat : -${Math.round(Math.abs(diffPouvoir)).toLocaleString()} ‚Ç¨ √©quivalent (${percPouvoir}%)
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
              Malgr√© un √©ventuel gain net, le co√ªt de vie plus √©lev√© (indice ${countryData.costOfLiving}) r√©duit votre pouvoir d'achat.
            </p>
          </div>
        `;
      }
      
      // Note fiscale sp√©cifique au pays
      if (countryData.taxNote) {
        analysis += `
          <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
            <p class="text-xs font-semibold text-purple-800 dark:text-purple-300 mb-1">üìã Note fiscale ${countryData.name}</p>
            <p class="text-xs text-gray-600 dark:text-gray-400">${countryData.taxNote}</p>
          </div>
        `;
      }
      
      document.getElementById('expat-analysis').innerHTML = analysis;
    }

    // ===== FONCTION : G√âN√âRATION GRAPHIQUE =====
    function generateExpatChart(france, netForeign, pouvoirFrance, pouvoirForeign, countryData) {
      const canvas = document.getElementById('expatComparisonChart');
      const ctx = canvas.getContext('2d');
      
      if (expatComparisonChart) {
        expatComparisonChart.destroy();
      }
      
      expatComparisonChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Net apr√®s imp√¥ts', 'Pouvoir d\'achat r√©el'],
          datasets: [
            {
              label: 'üá´üá∑ France',
              data: [france.netApresImpots, pouvoirFrance],
              backgroundColor: '#3b82f6',
              borderColor: '#2563eb',
              borderWidth: 2
            },
            {
              label: countryData.flag + ' ' + countryData.name,
              data: [netForeign, pouvoirForeign],
              backgroundColor: '#8b5cf6',
              borderColor: '#7c3aed',
              borderWidth: 2
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              position: 'top'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + Math.round(context.parsed.y).toLocaleString() + ' ‚Ç¨';
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return value.toLocaleString() + ' ‚Ç¨';
                }
              }
            }
          }
        }
      });
    }


    
    // ===== FONCTION TOGGLE BRUT/NET =====
    function toggleCalculationMode() {
      const toggle = document.getElementById('toggle-mode');
      const inputLabel = document.getElementById('input-label');
      const resultLabel = document.getElementById('result-label');
      
      if (calculationMode === 'brut') {
        calculationMode = 'net';
        toggle.classList.add('net-mode');
        inputLabel.textContent = 'üí∂ Salaire Net Annuel (avant imp√¥ts)';
        resultLabel.textContent = 'Salaire Brut Annuel';
      } else {
        calculationMode = 'brut';
        toggle.classList.remove('net-mode');
        inputLabel.textContent = 'üí∂ Salaire Brut Annuel';
        resultLabel.textContent = 'Salaire Net Annuel (avant imp√¥ts)';
      }
      
      calculateBrutNet();
    }

    // ===== FONCTION TOGGLE AVANTAGES =====
    function toggleAvantage(type) {
      const checkbox = document.getElementById('avantage-' + type);
      const input = document.getElementById(type + '-value');
      input.disabled = !checkbox.checked;
      if (!checkbox.checked) input.value = '';
      calculateBrutNet();
    }

    // ===== FONCTION PRINCIPALE DE CALCUL BRUT/NET =====
    function calculateBrutNet() {
      const input = parseFloat(document.getElementById('salary-input-brutnet').value) || 0;
      if (input === 0) {
        document.getElementById('result-value').textContent = '‚Äî';
        document.getElementById('brut-mensuel').textContent = '‚Äî';
        document.getElementById('net-mensuel').textContent = '‚Äî';
        document.getElementById('net-apres-impots').textContent = '‚Äî';
        document.getElementById('cout-employeur').textContent = '‚Äî';
        document.getElementById('revenu-imposable').textContent = '‚Äî';
        document.getElementById('impot-total').textContent = '‚Äî';
        document.getElementById('cotisations-detail').classList.add('hidden');
        return;
      }

      const statut = document.getElementById('statut-brutnet').value;
      const partsFiscales = parseFloat(document.getElementById('parts-fiscales').value);
      
      // Avantages en nature
      let avantagesTotal = 0;
      if (document.getElementById('avantage-voiture').checked) {
        avantagesTotal += parseFloat(document.getElementById('voiture-value').value) || 0;
      }
      if (document.getElementById('avantage-tickets').checked) {
        avantagesTotal += parseFloat(document.getElementById('tickets-value').value) || 0;
      }
      if (document.getElementById('avantage-logement').checked) {
        avantagesTotal += parseFloat(document.getElementById('logement-value').value) || 0;
      }

      let brut, net, coutEmployeur;
      let cotisationsSalariales = {};
      let cotisationsPatronales = {};

      if (calculationMode === 'brut') {
        // BRUT ‚Üí NET
        brut = input;
        
        const plafondSS = 46368;
        const tranche1 = Math.min(brut, plafondSS);
        const tranche2 = Math.max(0, brut - plafondSS);
        const assietteCsgCrds = brut * 0.9825;
        
        if (statut === 'cadre') {
          cotisationsSalariales = {
            "CSG d√©ductible (6,8%)": assietteCsgCrds * 0.068,
            "CSG non d√©ductible (2,4%)": assietteCsgCrds * 0.024,
            "CRDS (0,5%)": assietteCsgCrds * 0.005,
            "Retraite de base plafonn√©e (6,9%)": tranche1 * 0.069,
            "Retraite de base d√©plafonn√©e (0,4%)": brut * 0.004,
            "Retraite compl√©mentaire T1 (3,15%)": tranche1 * 0.0315,
            "Retraite compl√©mentaire T2 (8,64%)": tranche2 * 0.0864,
            "CEG T1 (0,86%)": tranche1 * 0.0086,
            "CEG T2 (1,08%)": tranche2 * 0.0108,
            "APEC (0,024%)": Math.min(brut, plafondSS * 4) * 0.00024
          };
          cotisationsPatronales = {
            "Assurance maladie (13%)": brut * 0.13,
            "Allocations familiales (3,45%)": brut * 0.0345,
            "Accident du travail (1,5%)": brut * 0.015,
            "Retraite de base (8,6%)": tranche1 * 0.086,
            "Vieillesse d√©plafonn√©e (1,9%)": brut * 0.019,
            "Retraite compl√©mentaire T1 (4,72%)": tranche1 * 0.0472,
            "Retraite compl√©mentaire T2 (12,96%)": tranche2 * 0.1296,
            "CEG T1 (1,29%)": tranche1 * 0.0129,
            "CEG T2 (1,62%)": tranche2 * 0.0162,
            "APEC (0,036%)": Math.min(brut, plafondSS * 4) * 0.00036,
            "Ch√¥mage (4,05%)": brut * 0.0405,
            "AGS (0,15%)": brut * 0.0015,
            "Taxe apprentissage (0,68%)": brut * 0.0068,
            "Formation pro (1%)": brut * 0.01
          };
        } else {
          cotisationsSalariales = {
            "CSG d√©ductible (6,8%)": assietteCsgCrds * 0.068,
            "CSG non d√©ductible (2,4%)": assietteCsgCrds * 0.024,
            "CRDS (0,5%)": assietteCsgCrds * 0.005,
            "Retraite de base plafonn√©e (6,9%)": tranche1 * 0.069,
            "Retraite de base d√©plafonn√©e (0,4%)": brut * 0.004,
            "Retraite compl√©mentaire T1 (3,15%)": tranche1 * 0.0315,
            "Retraite compl√©mentaire T2 (8,64%)": tranche2 * 0.0864,
            "CEG T1 (0,86%)": tranche1 * 0.0086,
            "CEG T2 (1,08%)": tranche2 * 0.0108
          };
          cotisationsPatronales = {
            "Assurance maladie (13%)": brut * 0.13,
            "Allocations familiales (3,45%)": brut * 0.0345,
            "Accident du travail (1,5%)": brut * 0.015,
            "Retraite de base (8,6%)": tranche1 * 0.086,
            "Vieillesse d√©plafonn√©e (1,9%)": brut * 0.019,
            "Retraite compl√©mentaire T1 (4,72%)": tranche1 * 0.0472,
            "Retraite compl√©mentaire T2 (12,96%)": tranche2 * 0.1296,
            "CEG T1 (1,29%)": tranche1 * 0.0129,
            "CEG T2 (1,62%)": tranche2 * 0.0162,
            "Ch√¥mage (4,05%)": brut * 0.0405,
            "AGS (0,15%)": brut * 0.0015,
            "Taxe apprentissage (0,68%)": brut * 0.0068,
            "Formation pro (1%)": brut * 0.01
          };
        }

        const totalSalarial = Object.values(cotisationsSalariales).reduce((a, b) => a + b, 0);
        net = brut - totalSalarial;
        const totalPatronal = Object.values(cotisationsPatronales).reduce((a, b) => a + b, 0);
        coutEmployeur = brut + totalPatronal + avantagesTotal;

      } else {
        // NET ‚Üí BRUT
        net = input;
        const coefBrut = statut === 'cadre' ? 1.264 : 1.262;
        brut = net * coefBrut;

        const plafondSS = 46368;
        const tranche1 = Math.min(brut, plafondSS);
        const tranche2 = Math.max(0, brut - plafondSS);
        const assietteCsgCrds = brut * 0.9825;

        if (statut === 'cadre') {
          cotisationsSalariales = {
            "CSG d√©ductible (6,8%)": assietteCsgCrds * 0.068,
            "CSG non d√©ductible (2,4%)": assietteCsgCrds * 0.024,
            "CRDS (0,5%)": assietteCsgCrds * 0.005,
            "Retraite de base plafonn√©e (6,9%)": tranche1 * 0.069,
            "Retraite de base d√©plafonn√©e (0,4%)": brut * 0.004,
            "Retraite compl√©mentaire T1 (3,15%)": tranche1 * 0.0315,
            "Retraite compl√©mentaire T2 (8,64%)": tranche2 * 0.0864,
            "CEG T1 (0,86%)": tranche1 * 0.0086,
            "CEG T2 (1,08%)": tranche2 * 0.0108,
            "APEC (0,024%)": Math.min(brut, plafondSS * 4) * 0.00024
          };
          cotisationsPatronales = {
            "Assurance maladie (13%)": brut * 0.13,
            "Allocations familiales (3,45%)": brut * 0.0345,
            "Accident du travail (1,5%)": brut * 0.015,
            "Retraite de base (8,6%)": tranche1 * 0.086,
            "Vieillesse d√©plafonn√©e (1,9%)": brut * 0.019,
            "Retraite compl√©mentaire T1 (4,72%)": tranche1 * 0.0472,
            "Retraite compl√©mentaire T2 (12,96%)": tranche2 * 0.1296,
            "CEG T1 (1,29%)": tranche1 * 0.0129,
            "CEG T2 (1,62%)": tranche2 * 0.0162,
            "APEC (0,036%)": Math.min(brut, plafondSS * 4) * 0.00036,
            "Ch√¥mage (4,05%)": brut * 0.0405,
            "AGS (0,15%)": brut * 0.0015,
            "Taxe apprentissage (0,68%)": brut * 0.0068,
            "Formation pro (1%)": brut * 0.01
          };
        } else {
          cotisationsSalariales = {
            "CSG d√©ductible (6,8%)": assietteCsgCrds * 0.068,
            "CSG non d√©ductible (2,4%)": assietteCsgCrds * 0.024,
            "CRDS (0,5%)": assietteCsgCrds * 0.005,
            "Retraite de base plafonn√©e (6,9%)": tranche1 * 0.069,
            "Retraite de base d√©plafonn√©e (0,4%)": brut * 0.004,
            "Retraite compl√©mentaire T1 (3,15%)": tranche1 * 0.0315,
            "Retraite compl√©mentaire T2 (8,64%)": tranche2 * 0.0864,
            "CEG T1 (0,86%)": tranche1 * 0.0086,
            "CEG T2 (1,08%)": tranche2 * 0.0108
          };
          cotisationsPatronales = {
            "Assurance maladie (13%)": brut * 0.13,
            "Allocations familiales (3,45%)": brut * 0.0345,
            "Accident du travail (1,5%)": brut * 0.015,
            "Retraite de base (8,6%)": tranche1 * 0.086,
            "Vieillesse d√©plafonn√©e (1,9%)": brut * 0.019,
            "Retraite compl√©mentaire T1 (4,72%)": tranche1 * 0.0472,
            "Retraite compl√©mentaire T2 (12,96%)": tranche2 * 0.1296,
            "CEG T1 (1,29%)": tranche1 * 0.0129,
            "CEG T2 (1,62%)": tranche2 * 0.0162,
            "Ch√¥mage (4,05%)": brut * 0.0405,
            "AGS (0,15%)": brut * 0.0015,
            "Taxe apprentissage (0,68%)": brut * 0.0068,
            "Formation pro (1%)": brut * 0.01
          };
        }

        const totalPatronal = Object.values(cotisationsPatronales).reduce((a, b) => a + b, 0);
        coutEmployeur = brut + totalPatronal + avantagesTotal;
      }

      // Affichage r√©sultats
      if (calculationMode === 'brut') {
        document.getElementById('result-value').textContent = Math.round(net).toLocaleString() + ' ‚Ç¨';
      } else {
        document.getElementById('result-value').textContent = Math.round(brut).toLocaleString() + ' ‚Ç¨';
      }

      document.getElementById('brut-mensuel').textContent = Math.round(brut / 12).toLocaleString() + ' ‚Ç¨';
      document.getElementById('net-mensuel').textContent = Math.round(net / 12).toLocaleString() + ' ‚Ç¨';
      document.getElementById('cout-employeur').textContent = Math.round(coutEmployeur).toLocaleString() + ' ‚Ç¨';

      // ===== CALCUL IMP√îT AVEC BAR√àME PROGRESSIF 2024 =====
      const abattement = Math.min(Math.max(net * 0.10, 472), 13522);
      const revenuImposable = net - abattement;
      const quotientFamilial = revenuImposable / partsFiscales;
      
      let impotParPart = 0;
      if (quotientFamilial <= 11497) {
        impotParPart = 0;
      } else if (quotientFamilial <= 29315) {
        impotParPart = (quotientFamilial - 11497) * 0.11;
      } else if (quotientFamilial <= 83823) {
        impotParPart = (29315 - 11497) * 0.11 + (quotientFamilial - 29315) * 0.30;
      } else if (quotientFamilial <= 180294) {
        impotParPart = (29315 - 11497) * 0.11 + (83823 - 29315) * 0.30 + (quotientFamilial - 83823) * 0.41;
      } else {
        impotParPart = (29315 - 11497) * 0.11 + (83823 - 29315) * 0.30 + (180294 - 83823) * 0.41 + (quotientFamilial - 180294) * 0.45;
      }
      
      const impotTotal = impotParPart * partsFiscales;
      const netApresImpots = net - impotTotal;
      const netApresImpotsMensuel = Math.round(netApresImpots / 12);
      
      document.getElementById('revenu-imposable').textContent = Math.round(revenuImposable).toLocaleString() + ' ‚Ç¨';
      document.getElementById('impot-total').textContent = Math.round(impotTotal).toLocaleString() + ' ‚Ç¨';
      document.getElementById('net-apres-impots').textContent = 
        Math.round(netApresImpots).toLocaleString() + ' ‚Ç¨ / an (' + netApresImpotsMensuel.toLocaleString() + ' ‚Ç¨/mois)';

      // Affichage d√©tail cotisations
      document.getElementById('cotisations-detail').classList.remove('hidden');
      
      let htmlSalarial = '';
      for (const [label, montant] of Object.entries(cotisationsSalariales)) {
        htmlSalarial += `
          <div class="cotisation-row">
            <span class="text-sm text-gray-700 dark:text-gray-300">${label}</span>
            <span class="font-semibold text-gray-900 dark:text-white">${Math.round(montant).toLocaleString()} ‚Ç¨</span>
          </div>
        `;
      }
      document.getElementById('cotisations-salariales').innerHTML = htmlSalarial;
      
      const totalSalarial = Object.values(cotisationsSalariales).reduce((a, b) => a + b, 0);
      document.getElementById('total-salarial').textContent = Math.round(totalSalarial).toLocaleString() + ' ‚Ç¨';

      let htmlPatronal = '';
      for (const [label, montant] of Object.entries(cotisationsPatronales)) {
        htmlPatronal += `
          <div class="cotisation-row">
            <span class="text-sm text-gray-700 dark:text-gray-300">${label}</span>
            <span class="font-semibold text-gray-900 dark:text-white">${Math.round(montant).toLocaleString()} ‚Ç¨</span>
          </div>
        `;
      }
      document.getElementById('cotisations-patronales').innerHTML = htmlPatronal;
      
      const totalPatronal = Object.values(cotisationsPatronales).reduce((a, b) => a + b, 0);
      document.getElementById('total-patronal').textContent = Math.round(totalPatronal).toLocaleString() + ' ‚Ç¨';

      // Graphique r√©partition
      generateRepartitionChart(netApresImpots, totalSalarial, totalPatronal, impotTotal);
    }

    // ===== FONCTION GRAPHIQUE R√âPARTITION =====
    function generateRepartitionChart(netApresImpots, cotisationsSalariales, cotisationsPatronales, impot) {
      const canvas = document.getElementById('repartitionChart');
      const ctx = canvas.getContext('2d');

      if (repartitionChart) {
        repartitionChart.destroy();
      }

      repartitionChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Net apr√®s imp√¥ts', 'Imp√¥ts', 'Charges salariales', 'Charges patronales'],
          datasets: [{
            data: [
              Math.round(netApresImpots),
              Math.round(impot),
              Math.round(cotisationsSalariales),
              Math.round(cotisationsPatronales)
            ],
            backgroundColor: [
              '#10b981',
              '#f97316',
              '#f59e0b',
              '#ef4444'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              position: 'bottom'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return label + ': ' + value.toLocaleString() + ' ‚Ç¨ (' + percentage + '%)';
                }
              }
            }
          }
        }
      });
    }

function switchTab(tab) {
  currentTab = tab;
  
  // Gestion des 4 boutons
  document.getElementById('tab-simulator').className = tab === 'simulator' ? 
    'tab-active flex-1 sm:flex-none px-3 sm:px-5 py-1 sm:py-2 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base' : 
    'tab-inactive flex-1 sm:flex-none px-3 sm:px-5 py-1 sm:py-2 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base';
  
  document.getElementById('tab-comparator').className = tab === 'comparator' ? 
    'tab-active flex-1 sm:flex-none px-3 sm:px-5 py-1 sm:py-2 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base' : 
    'tab-inactive flex-1 sm:flex-none px-3 sm:px-5 py-1 sm:py-2 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base';
  
  document.getElementById('tab-brutnet').className = tab === 'brutnet' ? 
    'tab-active flex-1 sm:flex-none px-3 sm:px-5 py-1 sm:py-2 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base' : 
    'tab-inactive flex-1 sm:flex-none px-3 sm:px-5 py-1 sm:py-2 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base';
  
  document.getElementById('tab-expat').className = tab === 'expat' ? 
  'tab-active flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base' : 
  'tab-inactive flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base';

document.getElementById('tab-juridique').className = tab === 'juridique' ? 
  'tab-active flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base' : 
  'tab-inactive flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base';
  
  // Gestion de l'affichage des 4 contenus
  document.getElementById('content-simulator').classList.toggle('hidden', tab !== 'simulator');
  document.getElementById('content-comparator').classList.toggle('hidden', tab !== 'comparator');
  document.getElementById('content-brutnet').classList.toggle('hidden', tab !== 'brutnet');
  document.getElementById('content-expat').classList.toggle('hidden', tab !== 'expat');
  document.getElementById('content-juridique').classList.toggle('hidden', tab !== 'juridique');


  if (tab === 'comparator') {
    populateSchoolsComparator();
    calculateComparison();
  }
}

    // ===== DARK MODE =====
    function toggleDarkMode() {
      document.documentElement.classList.toggle('dark');
    }

    // ===== D√âTECTION MOBILE & OPTIMISATIONS =====
    function isMobile() {
      return window.innerWidth <= 768;
    }

    function isSmallMobile() {
      return window.innerWidth <= 640;
    }

    // Ajuster la hauteur du graphique selon device
    function adjustChartHeight() {
      const canvas = document.getElementById('salaryChart');
      if (canvas && isMobile()) {
        canvas.style.maxHeight = '250px';
      }
    }

    // Scroll smooth vers r√©sultat sur mobile
    function scrollToResult(elementId) {
      if (isMobile()) {
        const element = document.getElementById(elementId);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    }

    // Optimiser les events touch pour les sliders
    function optimizeSliders() {
      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        // Touch events pour mobile
        slider.addEventListener('touchstart', function() {
          this.classList.add('active-slider');
        }, { passive: true });

        slider.addEventListener('touchend', function() {
          this.classList.remove('active-slider');
        }, { passive: true });
      });
    }

    // Pr√©venir le zoom accidentel sur double-tap
    function preventDoubleTabZoom() {
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);
    }

    // Feedback visuel pour les touches
    function addTouchFeedback() {
      const touchElements = document.querySelectorAll('button, select, input[type="range"]');
      touchElements.forEach(elem => {
        elem.addEventListener('touchstart', function() {
          this.style.opacity = '0.7';
        }, { passive: true });

        elem.addEventListener('touchend', function() {
          setTimeout(() => {
            this.style.opacity = '1';
          }, 100);
        }, { passive: true });
      });
    }
    
    // ========== GRAPHIQUE COMPARATIF ==========
let comparisonChart = null;

function generateComparisonChart(medianA, medianB) {
  const canvas = document.getElementById('comparisonSalaryChart');
  if (!canvas) {
    console.error('Canvas comparisonSalaryChart non trouv√©');
    return;
  }
  
  const ctx = canvas.getContext('2d');
  
  // D√©truire l'ancien graphique s'il existe
  if (comparisonChart) {
    comparisonChart.destroy();
  }
  
  // Calculer les projections sur 40 ans
  const years = [];
  const salariesA = [];
  const salariesB = [];
  const growthRate = 0.023; // 2.3% par an
  
  for (let year = 0; year <= 40; year++) {
    years.push(year);
    salariesA.push(Math.round(medianA * Math.pow(1 + growthRate, year)));
    salariesB.push(Math.round(medianB * Math.pow(1 + growthRate, year)));
  }
  
  // Cr√©er le graphique
  comparisonChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: years,
      datasets: [
        {
          label: 'Profil A',
          data: salariesA,
          borderColor: '#007bff',
          backgroundColor: 'rgba(0, 123, 255, 0.1)',
          borderWidth: 3,
          pointRadius: 2,
          pointHoverRadius: 5,
          fill: true,
          tension: 0.4
        },
        {
          label: 'Profil B',
          data: salariesB,
          borderColor: '#ff8c00',
          backgroundColor: 'rgba(255, 140, 0, 0.1)',
          borderWidth: 3,
          pointRadius: 2,
          pointHoverRadius: 5,
          fill: true,
          tension: 0.4
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      aspectRatio: 2,
      plugins: {
        title: {
          display: true,
          text: '√âvolution salariale projet√©e sur 40 ans',
          font: { size: 16, weight: 'bold' },
          padding: { top: 10, bottom: 20 }
        },
        legend: {
          display: true,
          position: 'top',
          labels: {
            usePointStyle: true,
            padding: 15,
            font: { size: 12 }
          }
        },
        tooltip: {
          mode: 'index',
          intersect: false,
          callbacks: {
            label: function(context) {
              let label = context.dataset.label || '';
              if (label) label += ': ';
              label += context.parsed.y.toLocaleString('fr-FR') + ' ‚Ç¨';
              return label;
            },
            title: function(context) {
              return 'Ann√©e ' + context[0].label;
            }
          }
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Ann√©es de carri√®re',
            font: { size: 12, weight: 'bold' }
          },
          grid: { display: false }
        },
        y: {
          title: {
            display: true,
            text: 'Salaire projet√© (‚Ç¨)',
            font: { size: 12, weight: 'bold' }
          },
          beginAtZero: false,
          ticks: {
            callback: function(value) {
              return value.toLocaleString('fr-FR') + ' ‚Ç¨';
            }
          },
          grid: { color: 'rgba(0, 0, 0, 0.05)' }
        }
      },
      interaction: {
        mode: 'nearest',
        axis: 'x',
        intersect: false
      }
    }
  });
}


// ========== BASE M√âTIER G√âN√âRIQUE ==========
function calculateBaseMetierSecteur(sector) {
  const schools = allSchools[sector] || [];
  
  if (schools.length === 0) {
    return 48000;
  }
  
  const p50Values = schools.map(school => school.p50).filter(val => val > 0);
  
  if (p50Values.length === 0) {
    return 48000;
  }
  
  // MOYENNE
  const sum = p50Values.reduce((a, b) => a + b, 0);
  const baseMetier = sum / p50Values.length;
  
  return baseMetier;
}

// ========== SECTEURS AVEC MOD√àLE Œ± ==========
const sectorsWithAlphaModel = [
  'ingenieur',
  'commerce',
  'scpo',
  'universite',
  'it',
  'design',
  'fonction'
];

// ===== CALCUL SALAIRE (logique compl√®te) =====
function calculateSalaryForProfile(profile) {
  const schools = allSchools[profile.sector] || [];
  const school = schools[profile.school];
  
  if (!school) return null;
  let { p25, p50, p75 } = school;

  const experience = profile.experience;
  
  // ========== V√âRIFICATION : Ce secteur utilise-t-il le mod√®le Œ± ? ==========
  const usesAlphaModel = sectorsWithAlphaModel.includes(profile.sector);
  
if (usesAlphaModel) {
  // === MOD√àLE Œ± (d√©gressivit√© √©cole ‚Üí m√©tier) ===
  
  let baseMetier;
  
  // SI un m√©tier est renseign√©, POND√âRER √©cole + m√©tier (comme ancien mod√®le)
  if (profile.jobFunction && allFunctions[profile.jobFunction]) {
    const jobData = allFunctions[profile.jobFunction];
    
    // Pond√©ration 50% √©cole + 50% m√©tier (IMPORTANT !)
    p25 = (p25 * 0.5) + (jobData.p25 * 0.5);
    p50 = (p50 * 0.5) + (jobData.p50 * 0.5);
    p75 = (p75 * 0.5) + (jobData.p75 * 0.5);
    
    baseMetier = jobData.p50;
  } else {
    // SINON, utiliser la moyenne du secteur
    baseMetier = calculateBaseMetierSecteur(profile.sector);
  }
  
  // D√©tecter si c'est une "grande √©cole" (comparer AVANT pond√©ration)
  const originalP50 = school.p50;
  const isTopSchool = originalP50 > baseMetier;
  
  let alpha;
  if (experience <= 5) {
    alpha = 1.0;  // 100% √©cole pour tous au d√©but
  } else if (experience <= 15) {
    if (isTopSchool) {
      // Grandes √©coles : descente douce de 1.0 √† 0.65
      alpha = 1 - 0.035 * (experience - 5);
    } else {
      // √âcoles standard : descente rapide de 1.0 √† 0.1
      alpha = 1 - 0.09 * (experience - 5);
    }
  } else {
    // Apr√®s 15 ans : stabilisation
    alpha = isTopSchool ? 0.65 : 0.1;  // 65/35 pour grandes √©coles
  }
    const baseMix = Math.pow(p50, alpha) * Math.pow(baseMetier, 1 - alpha);
    const expFactor = Math.pow(1.023, experience);
    p50 = baseMix * expFactor;
    
    const ratio25 = school.p25 / school.p50;
    const ratio75 = school.p75 / school.p50;
    p25 = p50 * ratio25;
    p75 = p50 * ratio75;
    
  } else {
    // === MOD√àLE CLASSIQUE POUR LES AUTRES SECTEURS ===
    
    // ===== INT√âGRATION M√âTIER (si s√©lectionn√©) =====
    if (profile.jobFunction && allFunctions[profile.jobFunction]) {
      const jobData = allFunctions[profile.jobFunction];
      // Pond√©ration : 50% √©cole + 50% m√©tier
      p25 = (p25 * 0.5) + (jobData.p25 * 0.5);
      p50 = (p50 * 0.5) + (jobData.p50 * 0.5);
      p75 = (p75 * 0.5) + (jobData.p75 * 0.5);
    }
    
    // Exp√©rience (+2.3%/an)
    const expFactor = Math.pow(1.023, experience);
    p25 *= expFactor;
    p50 *= expFactor;
    p75 *= expFactor;
  }

  // ========== COEFFICIENTS (COMMUNS √Ä TOUS LES SECTEURS) ==========
  
const educationCoef = {
  "bac2_technicien": 0.78,
  "bac2_technicien_sup": 0.85,
  "bac3": 0.85,
  "bac5_master": 1.00,
  "bac5_master_ingenierie": 0.98,
  "bac5_ingenieur": 1.02,
  "bac8": 1.05
}[profile.educationLevel] || 1;

  const englishCoef = {
    basic: 1.00, intermediate: 1.03, advanced: 1.06, bilingual: 1.10
  }[profile.englishLevel] || 1;

  const contractCoef = {
    cdi: 1.00, cdd: 0.96, alternance: 0.70, freelance: 1.20, expatriation: 1.15
  }[profile.contractType] || 1;

  const industryCoef = {
    aero: 1.04, auto: 1.00, energie: 1.02, numerique: 1.05, sante: 1.04, luxe: 1.05, public: 0.88
  }[profile.industry] || 1;

  const teamCoef = {
    none: 1.00, small: 1.05, medium: 1.10, large: 1.18, xl: 1.25
  }[profile.teamSize] || 1;

  const packageCoef = {
    standard: 1.00, bonus: 1.07, bonusplus: 1.18, actions: 1.30
  }[profile.packageLevel] || 1;

  const regionCoef = profile.region === 'IDF' ? 1.14 : 1.00;
  
  const sizeCoef = {
    'startup': 0.95, 'PME': 0.96, 'ETI': 1.00, 'grand-groupe': 1.06
  }[profile.companySize] || 1;
  
  // Sous-domaine technique
  const subdomainCoefValue = subdomainCoef[profile.subdomain] || 1;
  
  // Certifications multiples avec cumul d√©gressif
let certificationCoefValue = 1.0;
const selectedCerts = Array.from(document.querySelectorAll('input[name="certifications"]:checked')).map(cb => cb.value);

if (selectedCerts.length > 0) {
  // Trier par valeur d√©croissante pour prendre les meilleures d'abord
  const certValues = selectedCerts.map(cert => certificationCoef[cert] || 1.0).sort((a, b) => b - a);
  
  // Appliquer avec rendement d√©croissant
  certValues.forEach((value, index) => {
    if (index === 0) {
      // Premi√®re certification : 100% de l'effet
      certificationCoefValue *= value;
    } else if (index === 1) {
      // Deuxi√®me certification : 70% de l'effet
      certificationCoefValue *= (1 + (value - 1) * 0.7);
    } else if (index === 2) {
      // Troisi√®me certification : 50% de l'effet
      certificationCoefValue *= (1 + (value - 1) * 0.5);
    } else {
      // 4√®me+ certifications : 30% de l'effet
      certificationCoefValue *= (1 + (value - 1) * 0.3);
    }
  });
  
  // Cap maximum √† +8%
  certificationCoefValue = Math.min(certificationCoefValue, 1.08);
}

  // Classification
  let classCoef = 1;
  if (profile.classification === 'M1') classCoef = 1.12;
  if (profile.classification === 'M2') classCoef = 1.15;
  if (profile.classification === 'M3') classCoef = 1.20;
  if (profile.classification === 'directeur_technique') classCoef = 1.30;
  if (profile.classification === 'I1') classCoef = 0.95;
  if (profile.classification === 'I2') classCoef = 1.00;
  if (profile.classification === 'I3') classCoef = 1.10;
  if (profile.classification === 'I4') classCoef = 1.15;

  // Moyenne g√©om√©trique des raffinements
  const refinements = [educationCoef, englishCoef, contractCoef, industryCoef, teamCoef];
  const geoMean = Math.pow(refinements.reduce((a, b) => a * b, 1), 1 / refinements.length);
  const refinementCoef = Math.min(Math.max(geoMean, 0.85), 1.25);

  // Source
  let sourceCoef = 1;
  if (profile.source === 'fw') sourceCoef = 0.95;
  if (profile.source === 'croisee') sourceCoef = 0.97;

const median = p50 * regionCoef * sizeCoef * classCoef * educationCoef * refinementCoef * packageCoef * sourceCoef * subdomainCoefValue * certificationCoefValue;
const low = p25 * regionCoef * sizeCoef * classCoef * educationCoef * refinementCoef * packageCoef * sourceCoef * subdomainCoefValue * certificationCoefValue;
const high = p75 * regionCoef * sizeCoef * classCoef * educationCoef * refinementCoef * packageCoef * sourceCoef * subdomainCoefValue * certificationCoefValue;
  return { median, low, high };
}

    // ===== POPULATE SCHOOLS + AFFICHER FOURCHETTES =====
    function populateSchools() {
      const sector = document.getElementById('sector').value;
      const schoolSel = document.getElementById('school');
      schoolSel.innerHTML = '';
      
      const schools = allSchools[sector] || [];
      schools.forEach((s, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = s.Ecole;
        schoolSel.appendChild(opt);
      });
      
      updateSchoolInfo();
      calculateSimulator();
    }

    function updateSchoolInfo() {
      const sector = document.getElementById('sector').value;
      const schoolIndex = parseInt(document.getElementById('school').value);
      const schools = allSchools[sector] || [];
      const school = schools[schoolIndex];

      if (school) {
        document.getElementById('schoolP25').textContent = Math.round(school.p25).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP50').textContent = Math.round(school.p50).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP75').textContent = Math.round(school.p75).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolInfo').classList.add('show');
      }
    }

    function populateSchoolsComparator() {
      ['A', 'B'].forEach(profile => {
        const sector = document.getElementById('sector' + profile).value;
        const schoolSel = document.getElementById('school' + profile);
        schoolSel.innerHTML = '';
        
        const schools = allSchools[sector] || [];
        schools.forEach((s, i) => {
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = s.Ecole;
          schoolSel.appendChild(opt);
        });

        updateSchoolInfoComparator(profile);
      });
    }

    function updateSchoolInfoComparator(profile) {
      const sector = document.getElementById('sector' + profile).value;
      const schoolIndex = parseInt(document.getElementById('school' + profile).value);
      const schools = allSchools[sector] || [];
      const school = schools[schoolIndex];

      if (school) {
        document.getElementById('schoolP25' + profile).textContent = Math.round(school.p25).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP50' + profile).textContent = Math.round(school.p50).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP75' + profile).textContent = Math.round(school.p75).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolInfo' + profile).classList.add('show');
      }
    }
    
    // ========== CALCUL SCORE DE RARET√â ==========
function calculateRarityScore(profile, result) {
  let score = 0;
  let factors = [];
  
  const schools = allSchools[profile.sector] || [];
  const school = schools[profile.school];
  
  // ===== 1. PRESTIGE √âCOLE (0-25 points) =====
  let schoolScore = 0;
  let schoolStars = 0;
  
  if (school) {
    if (school.p50 > 55000) {
      schoolScore = 25;
      schoolStars = 5;
      factors.push({ label: '√âcole', value: school.Ecole, stars: 5, rarity: 'Top 0.5%' });
    } else if (school.p50 > 50000) {
      schoolScore = 20;
      schoolStars = 4;
      factors.push({ label: '√âcole', value: school.Ecole, stars: 4, rarity: 'Top 2%' });
    } else if (school.p50 > 45000) {
      schoolScore = 15;
      schoolStars = 4;
      factors.push({ label: '√âcole', value: school.Ecole, stars: 4, rarity: 'Top 10%' });
    } else if (school.p50 > 40000) {
      schoolScore = 10;
      schoolStars = 3;
      factors.push({ label: '√âcole', value: school.Ecole, stars: 3, rarity: 'Top 25%' });
    } else {
      schoolScore = 5;
      schoolStars = 2;
      factors.push({ label: '√âcole', value: school.Ecole, stars: 2, rarity: 'Standard' });
    }
  }
  score += schoolScore;
  
  // ===== 2. EXP√âRIENCE (0-15 points) =====
  let expScore = 0;
  let expStars = 0;
  
  if (profile.experience >= 15) {
    expScore = 15;
    expStars = 5;
    factors.push({ label: 'Exp√©rience', value: profile.experience + ' ans', stars: 5, rarity: 'Top 15%' });
  } else if (profile.experience >= 10) {
    expScore = 12;
    expStars = 4;
    factors.push({ label: 'Exp√©rience', value: profile.experience + ' ans', stars: 4, rarity: 'Top 25%' });
  } else if (profile.experience >= 7) {
    expScore = 9;
    expStars = 3;
    factors.push({ label: 'Exp√©rience', value: profile.experience + ' ans', stars: 3, rarity: 'Confirm√©' });
  } else if (profile.experience >= 3) {
    expScore = 5;
    expStars = 2;
    factors.push({ label: 'Exp√©rience', value: profile.experience + ' ans', stars: 2, rarity: 'Junior' });
  } else {
    expScore = 2;
    expStars = 1;
    factors.push({ label: 'Exp√©rience', value: profile.experience + ' ans', stars: 1, rarity: 'D√©butant' });
  }
  score += expScore;
  
  // ===== 3. NIVEAU ANGLAIS (0-15 points) =====
  let englishScore = 0;
  let englishStars = 0;
  
  if (profile.englishLevel === 'bilingual') {
    englishScore = 15;
    englishStars = 5;
    factors.push({ label: 'Anglais', value: 'Bilingue', stars: 5, rarity: 'Top 5%' });
  } else if (profile.englishLevel === 'advanced') {
    englishScore = 10;
    englishStars = 4;
    factors.push({ label: 'Anglais', value: 'Avanc√©', stars: 4, rarity: 'Top 15%' });
  } else if (profile.englishLevel === 'intermediate') {
    englishScore = 5;
    englishStars = 3;
    factors.push({ label: 'Anglais', value: 'Interm√©diaire', stars: 3, rarity: 'Standard' });
  } else {
    englishScore = 2;
    englishStars = 1;
    factors.push({ label: 'Anglais', value: 'Basique', stars: 1, rarity: '√Ä am√©liorer' });
  }
  score += englishScore;
  
  // ===== 4. SP√âCIALISATION TECHNIQUE (0-20 points) =====
  let subdomainScore = 0;
  let subdomainStars = 0;
  
  const rareSubdomains = ['Dynamique de Vol', 'Thermique', '√âlectrique', 'Avionique', 'Propulsion'];
  const trendySubdomains = ['Ing√©nierie Syst√®mes', 'Gestion de Programme'];
  
  if (profile.subdomain && rareSubdomains.includes(profile.subdomain)) {
    subdomainScore = 20;
    subdomainStars = 5;
    factors.push({ label: 'Sp√©cialisation', value: profile.subdomain, stars: 5, rarity: 'Top 2%' });
  } else if (profile.subdomain && trendySubdomains.includes(profile.subdomain)) {
    subdomainScore = 15;
    subdomainStars = 4;
    factors.push({ label: 'Sp√©cialisation', value: profile.subdomain, stars: 4, rarity: 'Top 8%' });
  } else if (profile.subdomain && profile.subdomain !== '') {
    subdomainScore = 8;
    subdomainStars = 3;
    factors.push({ label: 'Sp√©cialisation', value: profile.subdomain, stars: 3, rarity: 'Courant' });
  } else {
    subdomainScore = 0;
    subdomainStars = 1;
    factors.push({ label: 'Sp√©cialisation', value: 'G√©n√©raliste', stars: 1, rarity: 'Standard' });
  }
  score += subdomainScore;
  
  // ===== 5. M√âTIER SP√âCIALIS√â (0-10 points) =====
  let jobScore = 0;
  let jobStars = 0;
  
  const rareJobs = ['Cloud Architect', 'Data Scientist', 'Product Manager', 'Directeur Commercial', 'Directeur Immobilier'];
  
  if (profile.jobFunction && rareJobs.includes(profile.jobFunction)) {
    jobScore = 10;
    jobStars = 5;
    factors.push({ label: 'M√©tier', value: profile.jobFunction, stars: 5, rarity: 'Top 3%' });
  } else if (profile.jobFunction && profile.jobFunction !== '') {
    jobScore = 5;
    jobStars = 3;
    factors.push({ label: 'M√©tier', value: profile.jobFunction, stars: 3, rarity: 'D√©fini' });
  }
  score += jobScore;
  
  // ===== 6. NIVEAU HI√âRARCHIQUE (0-10 points) =====
  let classScore = 0;
  let classStars = 0;
  
  if (profile.classification === 'directeur_technique' || profile.classification === 'leader_departement') {
    classScore = 10;
    classStars = 5;
    factors.push({ label: 'Position', value: 'Direction', stars: 5, rarity: 'Top 5%' });
  } else if (profile.classification === 'M3') {
    classScore = 8;
    classStars = 4;
    factors.push({ label: 'Position', value: 'M3', stars: 4, rarity: 'Top 10%' });
  } else if (profile.classification === 'M2' || profile.classification === 'M1') {
    classScore = 5;
    classStars = 3;
    factors.push({ label: 'Position', value: profile.classification, stars: 3, rarity: 'Manager' });
  } else if (profile.classification === 'I4') {
    classScore = 6;
    classStars = 4;
    factors.push({ label: 'Position', value: 'Expert I4', stars: 4, rarity: 'Top 12%' });
  } else if (profile.classification === 'I3') {
    classScore = 4;
    classStars = 3;
    factors.push({ label: 'Position', value: 'Senior I3', stars: 3, rarity: 'Confirm√©' });
  }
  score += classScore;
  
  // ===== 7. PACKAGE R√âMUN√âRATION (0-5 points) =====
  let packageScore = 0;
  
  if (profile.packageLevel === 'actions') {
    packageScore = 5;
    factors.push({ label: 'Package', value: 'Actions/BSPCE', stars: 5, rarity: 'Top 8%' });
  } else if (profile.packageLevel === 'bonusplus') {
    packageScore = 3;
    factors.push({ label: 'Package', value: 'Variable √©lev√©', stars: 4, rarity: 'Top 20%' });
  }
  score += packageScore;
  
  // ===== 8. CERTIFICATIONS PROFESSIONNELLES (0-15 points) =====
let certScore = 0;
let certStars = 0;

const selectedCerts = profile.certifications || [];
const certCount = selectedCerts.length;

if (certCount > 0) {
  // Cat√©gorisation des certifications par valeur
  const exceptionalCerts = ['cfa', 'cissp', 'cpa', 'oscp', 'six_sigma_black', 'dec', 'hec_digital', 'mit_ai', 'stanford_ai', 'polytechnique_ai'];
  const highValueCerts = ['escp_ai_business', 'insead_digital', 'insead_ai', 'hec_ai', 'gen_ai', 'mlops', 'aws_architect', 'azure_architect', 'acca', 'pmp', 'sap_fico', 'bim_manager', 'gcp_architect'];
  const valuableCerts = ['deep_learning', 'kubernetes', 'ceh', 'databricks', 'snowflake', 'power_bi', 'scrum_master', 'product_owner', 'excel_expert', 'frm', 'salesforce_dev', 'oracle_ebs', 'six_sigma_green', 'lean_expert'];
  
  const hasExceptional = selectedCerts.some(c => exceptionalCerts.includes(c));
  const hasHighValue = selectedCerts.some(c => highValueCerts.includes(c));
  const hasValuable = selectedCerts.some(c => valuableCerts.includes(c));
  
  // Score de base selon la meilleure certification
  if (hasExceptional) {
    certScore = 10;
    certStars = 5;
  } else if (hasHighValue) {
    certScore = 7;
    certStars = 4;
  } else if (hasValuable) {
    certScore = 5;
    certStars = 3;
  } else {
    certScore = 3;
    certStars = 2;
  }
  
  // Bonus pour certifications multiples (polyvalence)
  if (certCount >= 4) {
    certScore += 5;
    certStars = 5;
    factors.push({ 
      label: 'Certifications', 
      value: certCount + ' certifications', 
      stars: 5, 
      rarity: 'Polyvalent expert (top 0.5%)' 
    });
  } else if (certCount >= 3) {
    certScore += 3;
    certStars = Math.max(certStars, 4);
    factors.push({ 
      label: 'Certifications', 
      value: certCount + ' certifications', 
      stars: certStars, 
      rarity: 'Multi-certifi√© (top 3%)' 
    });
  } else if (certCount >= 2) {
    certScore += 2;
    factors.push({ 
      label: 'Certifications', 
      value: certCount + ' certifications', 
      stars: certStars, 
      rarity: 'Double expertise (top 8%)' 
    });
  } else {
    // Une seule certification
    if (hasExceptional) {
      factors.push({ 
        label: 'Certification', 
        value: '1 certification', 
        stars: certStars, 
        rarity: 'Tr√®s valoris√©e (top 2%)' 
      });
    } else if (hasHighValue) {
      factors.push({ 
        label: 'Certification', 
        value: '1 certification', 
        stars: certStars, 
        rarity: 'Valoris√©e (top 5%)' 
      });
    } else {
      factors.push({ 
        label: 'Certification', 
        value: '1 certification', 
        stars: certStars, 
        rarity: 'Reconnue (top 15%)' 
      });
    }
  }
  
  score += certScore;
}
  
  // ===== CALCUL FINAL =====
  score = Math.min(Math.round(score), 100);
  
  // ===== ESTIMATION PROFILS SIMILAIRES =====
  let estimatedProfiles = 0;
  
  if (score >= 90) {
    estimatedProfiles = Math.floor(Math.random() * 200) + 100; // 100-300
  } else if (score >= 80) {
    estimatedProfiles = Math.floor(Math.random() * 500) + 300; // 300-800
  } else if (score >= 70) {
    estimatedProfiles = Math.floor(Math.random() * 1000) + 800; // 800-1800
  } else if (score >= 60) {
    estimatedProfiles = Math.floor(Math.random() * 3000) + 2000; // 2000-5000
  } else if (score >= 50) {
    estimatedProfiles = Math.floor(Math.random() * 8000) + 5000; // 5000-13000
  } else {
    estimatedProfiles = Math.floor(Math.random() * 20000) + 15000; // 15000-35000
  }
  
// ===== ESTIMATION POSTES OUVERTS (bas√© sur score + √©cole + M√âTIER) =====
let tensionMultiplier = 1.0;

// D√©tection grande √©cole prestigieuse
const isTopSchool = school && school.p50 > 52000;

// ========== AJUSTEMENT PAR M√âTIER (PRIORITAIRE) ==========
// M√©tiers en FORTE sur-offre (beaucoup de candidats, peu de postes)
const lowDemandJobs = [
  'Charg√© RH',
  'Talent Acquisition',
  'Senior Talent Acquisition',
  'Talent Acquisition Manager',
  'Charg√© de communication',
  'Responsable de communication',
  'Charg√© de Gestion Immobili√®re',
  'Comptable',
  'Auditeur Interne'
];

// M√©tiers en l√©g√®re sur-offre
const moderateDemandJobs = [
  'Responsable RH / HRBP',
  'Contr√¥leur de Gestion',
  'Tr√©sorier',
  'Responsable Financier',
  'Property Manager',
  'Acheteur Junior',
  'Acheteur Confirm√©'
];

// M√©tiers √âQUILIBR√âS
const balancedJobs = [
  'Directeur des Ressources Humaines',
  'Directeur Administratif et Financier (DAF)',
  'Responsable Achats',
  'Responsable Immobilier',
  'Directeur de la communication'
];

// M√©tiers en FORTE DEMANDE (p√©nurie)
const highDemandJobs = [
  'Cloud Architect',
  'Data Scientist',
  'Cybersecurity Engineer',
  'DevOps / SRE',
  'Machine Learning Engineer',
  'Data Engineer',
  'Product Manager',
  'Directeur Commercial',
  'Directeur Immobilier',
  'Directeur Achats'
];

// Calcul du ratio de base selon M√âTIER (prioritaire sur le score)
if (profile.jobFunction && lowDemandJobs.includes(profile.jobFunction)) {
  // M√©tiers en forte sur-offre : 0.4-0.6
  tensionMultiplier = 0.45 + (score / 500); // ~0.45-0.65 selon score
  
} else if (profile.jobFunction && moderateDemandJobs.includes(profile.jobFunction)) {
  // M√©tiers en l√©g√®re sur-offre : 0.6-0.9
  tensionMultiplier = 0.60 + (score / 400); // ~0.60-0.85 selon score
  
} else if (profile.jobFunction && balancedJobs.includes(profile.jobFunction)) {
  // M√©tiers √©quilibr√©s : 0.8-1.1
  tensionMultiplier = 0.80 + (score / 333); // ~0.80-1.10 selon score
  
} else if (profile.jobFunction && highDemandJobs.includes(profile.jobFunction)) {
  // M√©tiers en forte demande : 1.3-2.5
  tensionMultiplier = 1.30 + (score / 100); // ~1.30-2.30 selon score
  
} else {
  // PAS DE M√âTIER SP√âCIFI√â : calcul selon score g√©n√©ral
  if (score >= 85) {
    tensionMultiplier = 2.5;
  } else if (score >= 75) {
    tensionMultiplier = 1.8;
  } else if (score >= 65) {
    tensionMultiplier = 1.4;
  } else if (score >= 55) {
    tensionMultiplier = 1.1;
  } else if (score >= 45) {
    tensionMultiplier = 0.95;
  } else {
    tensionMultiplier = 0.8;
  }
}

// BOOST GRANDE √âCOLE (mais mod√©r√© si m√©tier en sur-offre)
if (isTopSchool) {
  if (profile.jobFunction && lowDemandJobs.includes(profile.jobFunction)) {
    // Grande √©cole + m√©tier sur-offre : boost l√©ger
    tensionMultiplier = Math.min(tensionMultiplier * 1.2, 0.85); // Max 0.85
  } else if (score < 55) {
    // Grande √©cole + m√©tier normal : boost normal
    tensionMultiplier = Math.max(tensionMultiplier, 1.3);
  } else if (score < 70) {
    tensionMultiplier = Math.max(tensionMultiplier, 1.5);
  }
}

const openPositions = Math.round(estimatedProfiles * tensionMultiplier);


// ===== RATIO OFFRE/DEMANDE =====
const ratio = tensionMultiplier.toFixed(1);
  
  // ===== MESSAGE =====
  let message = '';
  
  if (score >= 90) {
    message = 'Profil EXCEPTIONNEL ! Tu fais partie des profils les plus rares et recherch√©s du march√©. Ton expertise est unique et hautement valoris√©e. Les opportunit√©s premium te sont grandes ouvertes.';
  } else if (score >= 80) {
    message = 'Profil TR√àS RARE ! Tu te situes dans le top 5% du march√©. Ton profil est hautement recherch√© et tu as un excellent pouvoir de n√©gociation. Continue √† cultiver ton expertise unique.';
  } else if (score >= 70) {
    message = 'Profil RARE ! Tu fais partie des profils recherch√©s du march√© (top 15%). Tu as de solides atouts pour n√©gocier et √©voluer rapidement. Quelques am√©liorations te propulseraient dans l\'√©lite.';
  } else if (score >= 60) {
    message = 'Profil DIFF√âRENCIANT. Tu te d√©marques de la moyenne avec des atouts sp√©cifiques. Continue √† d√©velopper tes points forts pour augmenter ta raret√© et ton attractivit√© sur le march√©.';
  } else if (score >= 50) {
    message = 'Profil STANDARD+. Tu as un profil solide avec quelques √©l√©ments diff√©renciants. Investis dans une sp√©cialisation ou une comp√©tence rare pour booster ta valeur march√©.';
  } else {
    message = 'Profil STANDARD. Tu as un bon profil de base, mais il reste g√©n√©raliste. Identifie une niche ou une comp√©tence rare √† d√©velopper pour te d√©marquer davantage sur le march√©.';
  }
  
  return {
    score,
    factors,
    estimatedProfiles,
    openPositions,
    ratio,
    message
  };
}
    
    // ========== AFFICHAGE SCORE DE RARET√â ==========
function generateRarityScore(profile, result) {
  const rarity = calculateRarityScore(profile, result);
  
  // Afficher la section
  document.getElementById('rarity-score').classList.remove('hidden');
  
  // Score principal avec animation
  document.getElementById('rarity-score-value').textContent = rarity.score;
  
  // Animation du cercle
  const circle = document.getElementById('rarity-circle');
  const circumference = 2 * Math.PI * 56;
  const offset = circumference - (rarity.score / 100) * circumference;
  setTimeout(() => {
    circle.style.strokeDashoffset = offset;
  }, 100);
  
const factorsHTML = rarity.factors.map(f => {
  const stars = '‚≠ê'.repeat(f.stars);
  return `
    <div class="flex justify-between items-center">
      <div>
        <span class="font-semibold text-gray-900 dark:text-gray-100">${f.label}:</span> 
        <span class="text-gray-800 dark:text-gray-200">${f.value}</span>
      </div>
      <div class="text-right">
        <div class="text-yellow-500 dark:text-yellow-400">${stars}</div>
        <div class="text-xs text-gray-500 dark:text-gray-400">${f.rarity}</div>
      </div>
    </div>
  `;
}).join('');
  document.getElementById('rarity-factors').innerHTML = factorsHTML;
  
  // Statistiques
  document.getElementById('similar-profiles').textContent = '~' + rarity.estimatedProfiles.toLocaleString();
  document.getElementById('open-positions').textContent = '~' + rarity.openPositions.toLocaleString();
  document.getElementById('supply-demand').textContent = rarity.ratio + 'x';
  
  // Message
  document.getElementById('rarity-message').textContent = rarity.message;
}

// ===== CALCUL SIMULATEUR =====
    let chart;
    function calculateSimulator() {
      const profile = {
        sector: document.getElementById('sector').value,
        school: parseInt(document.getElementById('school').value),
        experience: parseInt(document.getElementById('experience').value),
        region: document.getElementById('region').value,
        companySize: document.getElementById('companySize').value,
        classification: document.getElementById('classification').value,
        educationLevel: document.getElementById('educationLevel').value,
        englishLevel: document.getElementById('englishLevel').value,
        contractType: document.getElementById('contractType').value,
        industry: document.getElementById('industry').value,
        teamSize: document.getElementById('teamSize').value,
        packageLevel: document.getElementById('packageLevel').value,
        subdomain: document.getElementById('subdomain').value,
        jobFunction: document.getElementById('jobFunction').value,
        certifications: Array.from(document.querySelectorAll('input[name="certifications"]:checked')).map(cb => cb.value),
        source: document.getElementById('source').value
      
        
      };

      const result = calculateSalaryForProfile(profile);
      
      if (!result) return;

      document.getElementById('median').textContent = Math.round(result.median).toLocaleString() + ' ‚Ç¨';
      document.getElementById('low').textContent = Math.round(result.low).toLocaleString() + ' ‚Ç¨';
      document.getElementById('high').textContent = Math.round(result.high).toLocaleString() + ' ‚Ç¨';
      
      document.getElementById('result').classList.remove('hidden');


      // Graphique
      const ctx = document.getElementById('salaryChart').getContext('2d');
      if (chart) chart.destroy();
      
      const years = [...Array(41).keys()];
      const projection = years.map(y => result.median * Math.pow(1.023, y));
      
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: [{
            label: 'Salaire projet√© (‚Ç¨)',
            data: projection,
            borderColor: '#00AEEF',
            backgroundColor: 'rgba(0, 174, 239, 0.1)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: !isMobile(), // D√©sactiver ratio fixe sur mobile
          plugins: { 
            legend: { 
              display: true,
              labels: {
                font: {
                  size: isMobile() ? 10 : 12
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value) {
                  return value.toLocaleString() + ' ‚Ç¨';
                },
                font: {
                  size: isMobile() ? 9 : 11
                }
              }
            },
            x: {
              ticks: {
                font: {
                  size: isMobile() ? 9 : 11
                }
              }
            }
          }
        }
      });

      adjustChartHeight();
      
     // ===== G√âN√âRER L'ANALYSE D√âTAILL√âE =====
      generateDetailedAnalysis(profile, result);
      
      // ===== G√âN√âRER SCORE DE RARET√â =====
generateRarityScore(profile, result);
    }
    
    // ============================================
// ‚öñÔ∏è FONCTIONS JURIDIQUES
// ============================================

function updateMetiersJuridiques() {
  const domaine = document.getElementById('juridique-domaine').value;
  const selectMetier = document.getElementById('juridique-metier');
  
  selectMetier.innerHTML = '<option value="">-- S√©lectionnez un m√©tier --</option>';
  
  if (domaine && metiersJuridiques[domaine]) {
    for (const [key, label] of Object.entries(metiersJuridiques[domaine])) {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = label;
      selectMetier.appendChild(opt);
    }
  }
  
  toggleBlocsJuridiques();
}

function toggleBlocsJuridiques() {
  const metier = get('juridique-metier');
  const statut = get('juridique-statut');
  const domaine = get('juridique-domaine');
  
  // Masquer tous les blocs par d√©faut
  document.getElementById('juridique-bloc-avocat').classList.add('hidden');
  document.getElementById('juridique-bloc-associe').classList.add('hidden');
  document.getElementById('juridique-bloc-juriste').classList.add('hidden');
  document.getElementById('juridique-bloc-enseignement').classList.add('hidden');
  
  // ============================================
  // GESTION DU SELECT STATUT SELON LE DOMAINE
  // ============================================
  
  const selectStatut = document.getElementById('juridique-statut');
  const containerStatut = selectStatut.closest('.mb-4');
  
  // FONCTION PUBLIQUE : Forcer statut "public" et masquer le select
  if (domaine === 'public') {
    selectStatut.value = 'public';
    containerStatut.style.display = 'none';
  }
  
  // ENSEIGNEMENT : Forcer statut "public" et masquer le select
  else if (domaine === 'enseignement') {
    selectStatut.value = 'public';
    containerStatut.style.display = 'none';
  }
  
  // NOTARIAT : Adapter selon le m√©tier
  else if (domaine === 'notariat') {
    if (metier === 'notaire-associe') {
      selectStatut.value = 'liberal';
      containerStatut.style.display = 'none';
    } else if (metier === 'notaire-salarie') {
      selectStatut.value = 'salarie';
      containerStatut.style.display = 'none';
    } else {
      // Clerc ou notaire assistant : CDI uniquement
      selectStatut.value = 'salarie';
      containerStatut.style.display = 'none';
    }
  }
  
  // BARREAU : Tous les statuts possibles (afficher le select)
  else if (domaine === 'barreau') {
    containerStatut.style.display = 'block';
  }
  
  // ENTREPRISE : Salari√© uniquement (masquer le select)
  else if (domaine === 'entreprise') {
    selectStatut.value = 'salarie';
    containerStatut.style.display = 'none';
  }
  
  // Autres cas : Afficher le select
  else {
    containerStatut.style.display = 'block';
  }
  
  // ============================================
  // AFFICHAGE DES BLOCS SELON LE M√âTIER
  // ============================================
  
  // Bloc avocat (sauf associ√©)
if (domaine === 'barreau' && metier !== 'avocat-associe' && metier) {
  document.getElementById('juridique-bloc-avocat').classList.remove('hidden');
  
  // R√©cup√©rer les √©l√©ments
  const structureContainer = document.getElementById('juridique-avocat-structure-container');
  const tarifHeures = document.getElementById('juridique-avocat-tarif-heures');
  const champsLiberal = document.getElementById('juridique-avocat-champs-liberal');
  const infoSalarie = document.getElementById('juridique-avocat-info-salarie');
  const infoMicro = document.getElementById('juridique-avocat-info-micro');
  const infoPublic = document.getElementById('juridique-avocat-info-public');
  
  // Masquer tout par d√©faut
  structureContainer.classList.add('hidden');
  tarifHeures.classList.add('hidden');
  champsLiberal.classList.add('hidden');
  infoSalarie.classList.add('hidden');
  infoMicro.classList.add('hidden');
  infoPublic.classList.add('hidden');
  
  // Afficher selon le statut
  if (statut === 'liberal') {
    structureContainer.classList.remove('hidden');
    tarifHeures.classList.remove('hidden');
    champsLiberal.classList.remove('hidden');
  } 
  else if (statut === 'salarie') {
    structureContainer.classList.remove('hidden');
    infoSalarie.classList.remove('hidden');
  } 
  else if (statut === 'micro') {
    tarifHeures.classList.remove('hidden');
    infoMicro.classList.remove('hidden');
  } 
  else if (statut === 'public') {
    infoPublic.classList.remove('hidden');
  }
}
  
  // Bloc associ√©
  if (metier === 'avocat-associe' || metier === 'notaire-associe') {
    document.getElementById('juridique-bloc-associe').classList.remove('hidden');
  }
  
  // Bloc juriste entreprise
  if (domaine === 'entreprise' && metier) {
    document.getElementById('juridique-bloc-juriste').classList.remove('hidden');
  }
  
  // Bloc enseignement
  if (domaine === 'enseignement' && metier) {
    document.getElementById('juridique-bloc-enseignement').classList.remove('hidden');
  }
}

async function calculateJuridique() {
  const metier = get("juridique-metier");
  const statut = get("juridique-statut");
  const domaine = get("juridique-domaine");
  const experience = parseInt(get("juridique-experience")) || 0;
  const localisation = get("juridique-localisation");
  const tempsPartiel = parseInt(get("juridique-temps-partiel")) / 100;
  
  if (!metier || !domaine) {
    alert('Veuillez s√©lectionner un domaine et un m√©tier');
    return;
  }
  
  const getTauxNet = (statut) => {
    const taux = {
      'salarie': 0.78,
      'public': 0.84,
      'liberal': 0.53,
      'micro': 0.79
    };
    return taux[statut] || 0.78;
  };
  
  let resultat = { brut: 0, net: 0, details: [] };
  
// A) AVOCAT
if (domaine === 'barreau' && metier !== 'avocat-associe') {
  const tarif = parseFloat(get("juridique-avocat-tarif")) || 200;
  const heures = parseInt(get("juridique-avocat-heures")) || 1200;
  
  // ============================================
  // LIB√âRAL
  // ============================================
  if (statut === 'liberal') {
    const realisation = parseFloat(get("juridique-avocat-realisation")) / 100;
    const retrocession = parseFloat(get("juridique-avocat-retro")) / 100;
    
    const ca = tarif * heures;
    const caReel = ca * realisation;
    const revenu = caReel * retrocession;
    
    const coefExp = 1 + (experience * 0.025);
    const revenuAvecExp = revenu * coefExp;
    
    const tauxNet = getTauxNet(statut);
    resultat.brut = revenuAvecExp;
    resultat.net = revenuAvecExp * tauxNet;
    
    resultat.details = [
      `CA th√©orique : ${tarif}‚Ç¨/h √ó ${heures}h = ${formatEur(ca)}`,
      `R√©alisation ${Math.round(realisation*100)}% : ${formatEur(caReel)}`,
      `R√©trocession ${Math.round(retrocession*100)}% : ${formatEur(revenu)}`,
      `Coefficient exp√©rience (${experience} ans) : √ó${coefExp.toFixed(2)}`,
      `Revenu brut : ${formatEur(revenuAvecExp)}`,
      `Charges lib√©rales (47%) : -${formatEur(revenuAvecExp * 0.47)}`,
      `Net apr√®s charges : ${formatEur(resultat.net)}`
    ];
  }
  
  // ============================================
  // SALARI√â (CDI/CDD)
  // ============================================
  else if (statut === 'salarie') {  // ‚Üê CORRECTION ICI
    const salaireBase = salairesJuridiques[metier];
    
    if (!salaireBase) {
      alert('Erreur: salaire non trouv√© pour ' + metier);
      return;
    }
    
    let salaireBrut = salaireBase.p50;
    
    const structure = get("juridique-avocat-structure");
    const coefStructure = {
      'big_law': 1.4,
      'mid_size': 1.15,
      'boutique': 1.0,
      'solo': 0.85
    };
    salaireBrut *= coefStructure[structure] || 1.0;
    
    const coefExp = 1 + (experience * 0.025);
    salaireBrut *= coefExp;
    
    const tauxNet = getTauxNet('salarie');
    resultat.brut = salaireBrut;
    resultat.net = salaireBrut * tauxNet;
    
    resultat.details = [
      `Salaire de base ${metier} : ${formatEur(salaireBase.p50)}`,
      `Type cabinet (${structure}) : √ó${(coefStructure[structure] || 1.0).toFixed(2)}`,
      `Coefficient exp√©rience (${experience} ans) : √ó${coefExp.toFixed(2)}`,
      `Salaire brut annuel : ${formatEur(salaireBrut)}`,
      `Charges salariales (22%) : -${formatEur(salaireBrut * 0.22)}`,
      `Net annuel : ${formatEur(resultat.net)}`
    ];
  }
  
  // ============================================
  // MICRO-ENTREPRISE
  // ============================================
  else if (statut === 'micro') {
    const ca = tarif * heures;
    const coefExp = 1 + (experience * 0.025);
    const caAvecExp = ca * coefExp;
    
    const tauxCotisations = 0.211;
    const cotisations = caAvecExp * tauxCotisations;
    
    resultat.brut = caAvecExp;
    resultat.net = caAvecExp - cotisations;
    
    resultat.details = [
      `CA annuel : ${tarif}‚Ç¨/h √ó ${heures}h = ${formatEur(ca)}`,
      `Coefficient exp√©rience (${experience} ans) : √ó${coefExp.toFixed(2)}`,
      `CA avec exp√©rience : ${formatEur(caAvecExp)}`,
      `Cotisations micro-entrepreneur (21.1%) : -${formatEur(cotisations)}`,
      `Revenu net : ${formatEur(resultat.net)}`
    ];
  }
  
  // ============================================
  // FONCTION PUBLIQUE
  // ============================================
  else if (statut === 'public') {
    const salaireBase = salairesJuridiques[metier];
    
    if (!salaireBase) {
      alert('Erreur: salaire non trouv√© pour ' + metier);
      return;
    }
    
    let salaireBrut = salaireBase.p50 * 0.85;
    
    const coefExp = 1 + (experience * 0.025);
    salaireBrut *= coefExp;
    
    const tauxNet = 0.84;
    resultat.brut = salaireBrut;
    resultat.net = salaireBrut * tauxNet;
    
    resultat.details = [
      `Salaire de base fonction publique : ${formatEur(salaireBase.p50 * 0.85)}`,
      `Coefficient exp√©rience (${experience} ans) : √ó${coefExp.toFixed(2)}`,
      `Salaire brut annuel : ${formatEur(salaireBrut)}`,
      `Charges fonction publique (16%) : -${formatEur(salaireBrut * 0.16)}`,
      `Net annuel : ${formatEur(resultat.net)}`
    ];
  }
  
  // ============================================
  // STATUT NON G√âR√â
  // ============================================
  else {
    alert(`Statut "${statut}" non g√©r√© pour les avocats`);
    return;
  }
}  // ‚Üê FERMETURE DU BLOC AVOCAT ICI

// B) ASSOCI√â
else if (metier === 'avocat-associe' || metier === 'notaire-associe') {
  const ca = parseInt(get("juridique-associe-ca")) || 1500000;
  const part = parseInt(get("juridique-associe-part")) / 100;
  const frais = parseInt(get("juridique-associe-frais")) || 80000;
  
  resultat.brut = (ca * part) - frais;
  const tauxNet = getTauxNet(statut);
  resultat.net = resultat.brut * tauxNet;
  
  resultat.details = [
    `CA cabinet : ${formatEur(ca)}`,
    `Part associ√©e ${Math.round(part*100)}% : ${formatEur(ca*part)}`,
    `Frais structure : -${formatEur(frais)}`,
    `Revenu brut : ${formatEur(resultat.brut)}`,
    `Charges lib√©rales (47%) : -${formatEur(resultat.brut*0.47)}`,
    `Net apr√®s charges : ${formatEur(resultat.net)}`
  ];
}
  
  // C) JURISTE ENTREPRISE
  else if (domaine === 'entreprise') {
    const seniorite = get("juridique-seniorite");
    const secteurAct = get("juridique-secteur-activite");
    const taille = get("juridique-taille");
    const bonusPct = parseInt(get("juridique-bonus")) / 100;
    const stock = parseInt(get("juridique-stock")) || 0;
    
    const bases = { junior: 40000, confirme: 55000, senior: 70000, responsable: 90000, directeur: 140000 };
    let base = bases[seniorite] || 45000;
    
    const coefSecteur = { tech: 1.15, banque: 1.12, pharma: 1.10, luxe: 1.08, industrie: 1.0 };
    base *= coefSecteur[secteurAct] || 1.0;
    
    const coefTaille = { startup: 0.9, pme: 1.0, eti: 1.1, cac40: 1.25 };
    base *= coefTaille[taille] || 1.0;
    
    const coefExp = 1 + (experience * 0.025);
    base *= coefExp;
    
    const bonus = base * bonusPct;
    resultat.brut = base + bonus + stock;
    const tauxNet = getTauxNet(statut);
    resultat.net = resultat.brut * tauxNet;
    
    resultat.details = [
      `Salaire de base : ${formatEur(base)}`,
      bonus > 0 ? `Bonus ${Math.round(bonusPct*100)}% : ${formatEur(bonus)}` : null,
      stock > 0 ? `Stock-options : ${formatEur(stock)}` : null,
      `Brut total : ${formatEur(resultat.brut)}`,
     `Charges salariales (${Math.round((1-tauxNet)*100)}%) : -${formatEur(resultat.brut*(1-tauxNet))}`,
      `Net : ${formatEur(resultat.net)}`
    ].filter(Boolean);
  }
  
  // D) ENSEIGNEMENT
  else if (domaine === 'enseignement') {
    const grade = get("juridique-grade");
    const heuresTD = parseInt(get("juridique-heures-td")) || 0;
    const heuresCM = parseInt(get("juridique-heures-cm")) || 0;
    const prime = parseInt(get("juridique-prime-recherche")) || 0;
    const hdr = get("juridique-hdr") === 'oui';
    
    const grille = grillesEnseignement[grade];
    let base = grille.base || 0;
    
    if (grade === 'vacataire') {
      base = (heuresTD * grille.tauxTD) + (heuresCM * grille.tauxCM);
    } else {
      base += (heuresTD * 41.68) + (heuresCM * 62.52) + prime;
      if (hdr && (grade === 'mcf' || grade === 'pr')) {
        base *= 1.08;
      }
    }
    
    resultat.brut = base;
    const tauxNet = 0.84;
    resultat.net = resultat.brut * tauxNet;
    
    resultat.details = [
      `Traitement de base : ${grille.base ? formatEur(grille.base) : '0‚Ç¨'}`,
      heuresTD > 0 ? `Heures TD : ${heuresTD}h √ó 41.68‚Ç¨ = ${formatEur(heuresTD*41.68)}` : null,
      heuresCM > 0 ? `Heures CM : ${heuresCM}h √ó 62.52‚Ç¨ = ${formatEur(heuresCM*62.52)}` : null,
      prime > 0 ? `Prime recherche : ${formatEur(prime)}` : null,
      hdr ? 'Bonus HDR : +8%' : null,
      `Brut : ${formatEur(resultat.brut)}`,
      `Charges fonction publique (16%) : -${formatEur(resultat.brut*0.16)}`,
      `Net : ${formatEur(resultat.net)}`
    ].filter(Boolean);
  }
  
  // E) STANDARD
  else if (salairesJuridiques[metier]) {
    const base = salairesJuridiques[metier];
    const coefExp = 1 + (experience * 0.025);
    resultat.brut = base.p50 * coefExp;
    const tauxNet = getTauxNet(statut);
    resultat.net = resultat.brut * tauxNet;
    
    resultat.details = [
      `Salaire de base : ${formatEur(base.p50)}`,
      `Coefficient exp√©rience : ${coefExp.toFixed(2)}`,
      `Brut : ${formatEur(resultat.brut)}`,
      `Charges ${statut} (~${Math.round((1-tauxNet)*100)}%) : -${formatEur(resultat.brut*(1-tauxNet))}`,
      `Net : ${formatEur(resultat.net)}`
    ];
  }
  
  // Ajustements finaux
  const coefLoc = localisation === 'paris' ? 1.2 : localisation === 'grande_ville' ? 1.05 : 1.0;
  resultat.brut *= coefLoc * tempsPartiel;
  resultat.net *= coefLoc * tempsPartiel;
  
  if (localisation === 'paris') {
    resultat.details.push('Coefficient Paris : +20%');
  } else if (localisation === 'grande_ville') {
    resultat.details.push('Coefficient grande ville : +5%');
  }
  
  if (tempsPartiel < 1) {
    resultat.details.push(`Temps partiel : ${Math.round(tempsPartiel * 100)}%`);
  }
  
  // Affichage
  const median = Math.round(resultat.net);
  const low = Math.round(resultat.net * 0.85);
  const high = Math.round(resultat.net * 1.15);
  
  document.getElementById('median-juridique').textContent = median.toLocaleString() + " ‚Ç¨";
  document.getElementById('low-juridique').textContent = low.toLocaleString() + " ‚Ç¨";
  document.getElementById('high-juridique').textContent = high.toLocaleString() + " ‚Ç¨";
  
  const resultDiv = document.getElementById('result-juridique');
  if (resultDiv) {
    resultDiv.classList.remove('hidden');
    
    let detailsSection = document.getElementById('juridique-details');
    if (!detailsSection) {
      detailsSection = document.createElement('div');
      detailsSection.id = 'juridique-details';
      detailsSection.className = 'mt-6 p-6 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700';
      resultDiv.appendChild(detailsSection);
    }
    
    detailsSection.innerHTML = `
      <h4 class="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2">
        <span>üìä</span>
        <span>D√©tails du calcul</span>
      </h4>
      <ul class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
        ${resultat.details.map(d => `<li class="flex items-start gap-2"><span class="text-blue-600 dark:text-blue-400">‚Ä¢</span><span>${d}</span></li>`).join('')}
      </ul>
    `;
    
  
  }
}
    
    

// ===== ANALYSE D√âTAILL√âE DU PROFIL =====
    function generateDetailedAnalysis(profile, result) {
      const schools = allSchools[profile.sector] || [];
      const school = schools[profile.school];

      // 1. POSITIONNEMENT MARCH√â
      let marketAnalysis = '';
      if (result.median < 35000) {
        marketAnalysis = `Avec un salaire m√©dian de ${Math.round(result.median).toLocaleString()} ‚Ç¨, ton profil se situe dans la tranche basse du march√©. Cela correspond g√©n√©ralement √† un d√©but de carri√®re ou √† un secteur moins r√©mun√©rateur.`;
      } else if (result.median < 45000) {
        marketAnalysis = `Ton salaire m√©dian de ${Math.round(result.median).toLocaleString()} ‚Ç¨ correspond √† un profil junior √† interm√©diaire. Tu es dans la moyenne du march√© fran√ßais pour ton niveau.`;
      } else if (result.median < 60000) {
        marketAnalysis = `Avec ${Math.round(result.median).toLocaleString()} ‚Ç¨ de salaire m√©dian, tu te situes au-dessus de la moyenne nationale. C'est un bon positionnement qui refl√®te une expertise ou un secteur valorisant.`;
      } else if (result.median < 80000) {
        marketAnalysis = `Excellent positionnement ! Ton salaire m√©dian de ${Math.round(result.median).toLocaleString()} ‚Ç¨ te place dans le top 20% du march√© fran√ßais. Cela t√©moigne d'une forte valeur ajout√©e.`;
      } else {
        marketAnalysis = `Profil exceptionnel ! Avec ${Math.round(result.median).toLocaleString()} ‚Ç¨ de salaire m√©dian, tu fais partie des profils les mieux r√©mun√©r√©s en France (top 5%). Cela correspond g√©n√©ralement √† des postes de direction ou d'expertise rare.`;
      }
      document.getElementById('analysis-market').textContent = marketAnalysis;

      // 2. FACTEURS VALORISANTS
      const positiveFactors = [];
      
      if (school && school.p50 > 45000) {
        positiveFactors.push(`√âcole prestigieuse (${school.Ecole}) avec un salaire de sortie √©lev√© (${Math.round(school.p50).toLocaleString()} ‚Ç¨)`);
      }
      
      // ===== AJOUT M√âTIER =====
      if (profile.jobFunction && allFunctions[profile.jobFunction]) {
        const jobData = allFunctions[profile.jobFunction];
        if (jobData.p50 > 45000) {
          positiveFactors.push(`M√©tier valoris√© : ${profile.jobFunction} (m√©dian march√© ${Math.round(jobData.p50).toLocaleString()} ‚Ç¨)`);
        }
      } 
      
      if (profile.experience > 10) {
        positiveFactors.push(`Exp√©rience significative (${profile.experience} ans) qui valorise fortement ton profil`);
      }
      
      if (profile.region === 'IDF') {
        positiveFactors.push('Localisation √éle-de-France (+14% de prime r√©gionale)');
      }
      
      if (profile.englishLevel === 'bilingual' || profile.englishLevel === 'advanced') {
        positiveFactors.push(`Niveau d'anglais ${profile.englishLevel === 'bilingual' ? 'bilingue' : 'avanc√©'} (fort atout international)`);
      }
      
      if (profile.classification && profile.classification.startsWith('M')) {
        positiveFactors.push(`Poste manag√©rial (${profile.classification}) avec responsabilit√©s d'√©quipe`);
      }
      
      if (profile.teamSize === 'large' || profile.teamSize === 'xl') {
        positiveFactors.push(`Management d'une grande √©quipe (${profile.teamSize === 'xl' ? '50+' : '16-50'} personnes)`);
      }
      
      if (profile.packageLevel === 'actions' || profile.packageLevel === 'bonusplus') {
        positiveFactors.push(`Package r√©mun√©ration avantageux (${profile.packageLevel === 'actions' ? 'actions/BSPCE' : 'variable 15-25%'})`);
      }
      
      if (profile.subdomain && subdomainCoef[profile.subdomain] > 1.03) {
        positiveFactors.push(`Sp√©cialisation technique valoris√©e : ${profile.subdomain} (+${Math.round((subdomainCoef[profile.subdomain] - 1) * 100)}%)`);
      }
      
      if (profile.companySize === 'grand-groupe') {
        positiveFactors.push('Grand groupe (+6% de stabilit√© et avantages sociaux)');
      }

      const positiveHTML = positiveFactors.length > 0 
        ? positiveFactors.map(f => `<li>${f}</li>`).join('') 
        : '<li>Profil standard sans facteurs exceptionnels identifi√©s</li>';
      document.getElementById('analysis-positive').innerHTML = positiveHTML;

      // 3. POINTS D'ATTENTION
      const attentionPoints = [];
      
      if (profile.experience < 3) {
        attentionPoints.push('D√©but de carri√®re : la progression salariale sera rapide dans les 5 prochaines ann√©es');
      }
      
      // ===== AJOUT M√âTIER =====
      if (profile.jobFunction && allFunctions[profile.jobFunction]) {
        const jobData = allFunctions[profile.jobFunction];
        if (jobData.p50 < 35000) {
          attentionPoints.push(`M√©tier ${profile.jobFunction} : salaire d'entr√©e modeste (m√©dian ${Math.round(jobData.p50).toLocaleString()} ‚Ç¨), mais √©volution possible avec l'exp√©rience`);
        }
      }
      
      if (profile.region === 'hors') {
        attentionPoints.push('Localisation hors IDF : salaire ajust√© au co√ªt de la vie local (-14% vs Paris)');
      }
      
      if (profile.englishLevel === 'basic') {
        attentionPoints.push('Niveau d\'anglais basique : investir dans la formation linguistique pourrait augmenter ton potentiel (+10%)');
      }
      
      if (profile.companySize === 'startup') {
        attentionPoints.push('Startup : salaire d\'entr√©e inf√©rieur mais potentiel de croissance rapide (actions, promotions)');
      }
      
      if (profile.contractType === 'cdd') {
        attentionPoints.push('CDD : salaire l√©g√®rement inf√©rieur au CDI (-4%), viser une stabilisation en CDI');
      }
      
      if (profile.subdomain && subdomainCoef[profile.subdomain] < 1.00) {
        attentionPoints.push(`Sp√©cialisation moins valoris√©e : ${profile.subdomain} (${Math.round((subdomainCoef[profile.subdomain] - 1) * 100)}%)`);
      }
      
      if (profile.teamSize === 'none' && profile.experience > 5) {
        attentionPoints.push('Pas de management d\'√©quipe : envisager d\'√©voluer vers des responsabilit√©s manag√©riales pour booster ton salaire');
      }

      if (attentionPoints.length === 0) {
        attentionPoints.push('Profil bien √©quilibr√© sans points bloquants majeurs identifi√©s');
      }

      const attentionHTML = attentionPoints.map(p => `<li>${p}</li>`).join('');
      document.getElementById('analysis-attention').innerHTML = attentionHTML;

      // 4. PROJECTION CARRI√àRE
      const salary5y = Math.round(result.median * Math.pow(1.023, 5));
      const salary10y = Math.round(result.median * Math.pow(1.023, 10));
      const salary20y = Math.round(result.median * Math.pow(1.023, 20));
      
      const projectionHTML = `
        <p><strong>Dans 5 ans :</strong> ${salary5y.toLocaleString()} ‚Ç¨ (progression +${Math.round(((salary5y/result.median)-1)*100)}%)</p>
        <p><strong>Dans 10 ans :</strong> ${salary10y.toLocaleString()} ‚Ç¨ (progression +${Math.round(((salary10y/result.median)-1)*100)}%)</p>
        <p><strong>Dans 20 ans :</strong> ${salary20y.toLocaleString()} ‚Ç¨ (progression +${Math.round(((salary20y/result.median)-1)*100)}%)</p>
        <p class="mt-2 text-xs italic">Projection bas√©e sur une augmentation annuelle moyenne de 2,3% (hors promotions et changements de poste)</p>
      `;
      document.getElementById('analysis-projection').innerHTML = projectionHTML;

      // 5. RECOMMANDATIONS
      const recommendations = [];
      
      if (profile.experience < 5 && profile.englishLevel !== 'bilingual') {
        recommendations.push('Investir dans la certification anglais (TOEIC 900+ ou √©quivalent) pour d√©bloquer +10% de potentiel');
      }
      
       // ===== AJOUT M√âTIER =====
      if (!profile.jobFunction) {
        recommendations.push('Sp√©cialise-toi dans un m√©tier pr√©cis pour mieux te positionner sur le march√© et n√©gocier ton salaire');
      } else if (profile.jobFunction && allFunctions[profile.jobFunction]) {
        const jobData = allFunctions[profile.jobFunction];
        if (jobData.p50 < 40000 && profile.experience > 3) {
          recommendations.push(`Avec ${profile.experience} ans d'exp√©rience en ${profile.jobFunction}, envisage une √©volution vers un poste de management ou de sp√©cialisation pour augmenter ton salaire`);
        }
      }
      
      
      if (profile.companySize === 'startup' && profile.experience > 5) {
        recommendations.push('Avec ton exp√©rience, envisager un passage en ETI/Grand Groupe pour s√©curiser et augmenter ton salaire (+10-15%)');
      }
      
      if (profile.region === 'hors' && result.median > 50000) {
        recommendations.push('Ton profil pourrait pr√©tendre √† +14% en IDF si tu es mobile g√©ographiquement');
      }
      
      if (profile.teamSize === 'none' && profile.experience > 3) {
        recommendations.push('√âvoluer vers un poste avec management d\'√©quipe (m√™me petite) pour acc√©l√©rer ta progression (+10-20%)');
      }
      
      if (profile.packageLevel === 'standard') {
        recommendations.push('N√©gocier un variable ou des actions lors de ta prochaine √©volution (+7 √† +30% de package total)');
      }
      
      if (recommendations.length === 0) {
        recommendations.push('Continue sur ta lanc√©e ! Ton profil est bien optimis√©. Vise des certifications techniques ou un √©largissement de p√©rim√®tre pour la prochaine √©tape.');
      }

      const recommendationsHTML = recommendations.map(r => `<li>${r}</li>`).join('');
      document.getElementById('analysis-recommendations').innerHTML = recommendationsHTML;
    }
    
    // ===== CALCUL COMPARATEUR + ANALYSE PEAUFIN√âE =====
    function calculateComparison() {
      const profileA = {
        sector: document.getElementById('sectorA').value,
        school: parseInt(document.getElementById('schoolA').value),
        experience: parseInt(document.getElementById('experienceA').value),
        region: document.getElementById('regionA').value,
        companySize: document.getElementById('companySizeA').value,
        classification: document.getElementById('classificationA').value,
        subdomain: document.getElementById('subdomainA').value,
        educationLevel: document.getElementById('educationLevelA').value,
        englishLevel: document.getElementById('englishLevelA').value,
        contractType: document.getElementById('contractTypeA').value,
        industry: document.getElementById('industryA').value,
        teamSize: document.getElementById('teamSizeA').value,
        packageLevel: document.getElementById('packageLevelA').value,
        jobFunction: document.getElementById('jobFunctionA').value,
        source: document.getElementById('sourceA').value
      };

      const profileB = {
        sector: document.getElementById('sectorB').value,
        school: parseInt(document.getElementById('schoolB').value),
        experience: parseInt(document.getElementById('experienceB').value),
        region: document.getElementById('regionB').value,
        companySize: document.getElementById('companySizeB').value,
        classification: document.getElementById('classificationB').value,
        subdomain: document.getElementById('subdomainB').value,
        educationLevel: document.getElementById('educationLevelB').value,
        englishLevel: document.getElementById('englishLevelB').value,
        contractType: document.getElementById('contractTypeB').value,
        industry: document.getElementById('industryB').value,
        teamSize: document.getElementById('teamSizeB').value,
        packageLevel: document.getElementById('packageLevelB').value,
        jobFunction: document.getElementById('jobFunctionB').value,
        source: document.getElementById('sourceB').value
      };

      const resultA = calculateSalaryForProfile(profileA);
      const resultB = calculateSalaryForProfile(profileB);

      if (!resultA || !resultB) return;

      // Affichage r√©sultats
document.getElementById('resultA-median').textContent = Math.round(resultA.median).toLocaleString() + ' ‚Ç¨';
document.getElementById('resultA-range').textContent = 
  Math.round(resultA.low).toLocaleString() + ' ‚Ç¨ ‚Äì ' + Math.round(resultA.high).toLocaleString() + ' ‚Ç¨';

document.getElementById('resultB-median').textContent = Math.round(resultB.median).toLocaleString() + ' ‚Ç¨';
document.getElementById('resultB-range').textContent = 
  Math.round(resultB.low).toLocaleString() + ' ‚Ç¨ ‚Äì ' + Math.round(resultB.high).toLocaleString() + ' ‚Ç¨';


// Calcul diff√©rences
const diff = resultA.median - resultB.median;
const percentDiff = (diff / resultB.median) * 100;
const ratio = resultA.median / resultB.median;

      document.getElementById('diff-absolute').textContent = 
        (diff > 0 ? '+' : '') + Math.round(diff).toLocaleString() + ' ‚Ç¨';
      document.getElementById('diff-absolute').className = 
        'text-3xl font-bold ' + (diff > 0 ? 'text-green-600' : 'text-red-600');

      document.getElementById('diff-percent').textContent = 
        (percentDiff > 0 ? '+' : '') + percentDiff.toFixed(1) + ' %';
      document.getElementById('diff-percent').className = 
        'text-3xl font-bold ' + (percentDiff > 0 ? 'text-green-600' : 'text-red-600');

      document.getElementById('diff-ratio').textContent = '√ó' + ratio.toFixed(2);

      // Barres
      const total = resultA.median + resultB.median;
      const widthA = (resultA.median / total) * 100;
      const widthB = (resultB.median / total) * 100;

      document.getElementById('bar-A').style.width = widthA + '%';
      document.getElementById('bar-B').style.width = widthB + '%';
      document.getElementById('bar-A-text').textContent = Math.round(resultA.median).toLocaleString() + ' ‚Ç¨';
      document.getElementById('bar-B-text').textContent = Math.round(resultB.median).toLocaleString() + ' ‚Ç¨';

      // ===== ANALYSE D√âTAILL√âE PEAUFIN√âE =====
      generateDetailedInsight(profileA, profileB, resultA, resultB, diff, percentDiff);
    
      
      // ===== GRAPHIQUE COMPARATIF =====
generateComparisonChart(resultA.median, resultB.median);
      
    }
    
    function generateDetailedInsight(profileA, profileB, resultA, resultB, diff, percentDiff) {
      // Insight principal
      let mainInsight = '';
      if (Math.abs(diff) < 2000) {
        mainInsight = 'Les deux profils sont pratiquement √©quivalents sur le march√© actuel, avec un √©cart n√©gligeable de ' + Math.round(Math.abs(diff)).toLocaleString() + ' ‚Ç¨.';
      } else if (diff > 0) {
        mainInsight = `Le Profil A g√©n√®re ${Math.round(diff).toLocaleString()} ‚Ç¨ de plus que le Profil B (soit +${percentDiff.toFixed(1)}%). `;
        
        if (profileA.region === 'IDF' && profileB.region === 'hors') {
          mainInsight += 'La prime r√©gionale √éle-de-France (+14%) joue un r√¥le majeur dans cet √©cart.';
        } else if (profileA.experience - profileB.experience > 3) {
          mainInsight += `L'√©cart d'exp√©rience (${profileA.experience - profileB.experience} ans) explique principalement cette diff√©rence.`;
        } else {
          mainInsight += 'La combinaison des facteurs acad√©miques et professionnels favorise nettement le Profil A.';
        }
      } else {
        mainInsight = `Le Profil B g√©n√®re ${Math.round(Math.abs(diff)).toLocaleString()} ‚Ç¨ de plus que le Profil A (soit ${Math.abs(percentDiff).toFixed(1)}%). `;
        
        if (profileB.region === 'IDF' && profileA.region === 'hors') {
          mainInsight += 'La prime r√©gionale √éle-de-France (+14%) joue un r√¥le majeur dans cet √©cart.';
        } else if (profileB.experience - profileA.experience > 3) {
          mainInsight += `L'√©cart d'exp√©rience (${profileB.experience - profileA.experience} ans) explique principalement cette diff√©rence.`;
        } else {
          mainInsight += 'La combinaison des facteurs acad√©miques et professionnels favorise nettement le Profil B.';
        }
      }

      document.getElementById('insight-main').textContent = mainInsight;

      // Analyse acad√©mique
      const schoolsA = allSchools[profileA.sector] || [];
      const schoolsB = allSchools[profileB.sector] || [];
      const schoolA = schoolsA[profileA.school];
      const schoolB = schoolsB[profileB.school];

      let academicInsight = '';
      if (schoolA && schoolB) {
        const schoolDiff = schoolA.p50 - schoolB.p50;
        academicInsight = `√âcole A: ${schoolA.Ecole} (${Math.round(schoolA.p50).toLocaleString()} ‚Ç¨ sortie) vs √âcole B: ${schoolB.Ecole} (${Math.round(schoolB.p50).toLocaleString()} ‚Ç¨ sortie). `;
        
        if (Math.abs(schoolDiff) > 5000) {
          academicInsight += `√âcart scolaire significatif de ${Math.round(Math.abs(schoolDiff)).toLocaleString()} ‚Ç¨. `;
        }

        if (profileA.educationLevel !== profileB.educationLevel) {
          const eduA = { technicien: 'Bac+2', bac3: 'Bac+3', bac5: 'Bac+5', doctorat: 'PhD' }[profileA.educationLevel];
          const eduB = { technicien: 'Bac+2', bac3: 'Bac+3', bac5: 'Bac+5', doctorat: 'PhD' }[profileB.educationLevel];
          academicInsight += `Niveau d'√©tudes diff√©rent (${eduA} vs ${eduB}). `;
        }

        if (profileA.englishLevel !== profileB.englishLevel) {
          academicInsight += `Niveau d'anglais: ${profileA.englishLevel} vs ${profileB.englishLevel}.`;
        }
      }

      document.getElementById('insight-academic').textContent = academicInsight || 'Facteurs acad√©miques similaires.';

      // Analyse professionnelle
      let professionalInsight = '';
      
      if (profileA.region !== profileB.region) {
        professionalInsight += `R√©gion: ${profileA.region === 'IDF' ? 'IDF (+14%)' : 'Province'} vs ${profileB.region === 'IDF' ? 'IDF (+14%)' : 'Province'}. `;
      }

      if (profileA.companySize !== profileB.companySize) {
        professionalInsight += `Taille entreprise: ${profileA.companySize} vs ${profileB.companySize}. `;
      }

      if (profileA.classification !== profileB.classification) {
        const classA = profileA.classification || 'Standard';
        const classB = profileB.classification || 'Standard';
        professionalInsight += `Classification: ${classA} vs ${classB}. `;
      }

      if (profileA.packageLevel !== profileB.packageLevel) {
        professionalInsight += `Package: ${profileA.packageLevel} vs ${profileB.packageLevel}. `;
      }

      if (profileA.teamSize !== profileB.teamSize) {
        const teamA = { none: 'Aucune', small: '1-5', medium: '6-15', large: '16-50', xl: '50+' }[profileA.teamSize];
        const teamB = { none: 'Aucune', small: '1-5', medium: '6-15', large: '16-50', xl: '50+' }[profileB.teamSize];
        professionalInsight += `√âquipe encadr√©e: ${teamA} vs ${teamB}.`;
      }

      document.getElementById('insight-professional').textContent = professionalInsight || 'Contexte professionnel similaire.';
    }
    


function exportSimulatorPDF() {
  const btn = event.target;
  btn.textContent = 'Generation en cours...';
  btn.disabled = true;

  setTimeout(() => {
    try {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      
      // Fonction utilitaire pour formater les salaires
      const formatSalary = (text) => {
        if (!text) return 'N/A';
        // Remplace tous les / par des espaces
        return text.toString().replace(/\//g, ' ').trim();
      };
      
      let yPos = 20;

      // ========== PAGE 1: PAGE DE GARDE ==========
      doc.setFillColor(0, 51, 102);
      doc.rect(0, 0, 210, 297, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(28);
      doc.setFont('helvetica', 'bold');
      doc.text('ANALYSE SALARIALE DETAILLEE', 105, 130, { align: 'center' });
      
      doc.setDrawColor(0, 174, 239);
      doc.setLineWidth(1.5);
      doc.line(60, 140, 150, 140);
      
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      const today = new Date().toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric' });
      doc.text(today, 105, 152, { align: 'center' });
      
      doc.setFillColor(255, 255, 255);
      doc.roundedRect(50, 250, 110, 25, 3, 3, 'F');
      doc.setTextColor(0, 51, 102);
      doc.setFontSize(12);
      doc.setFont('helvetica', 'bold');
      doc.text('DOCUMENT CONFIDENTIEL', 105, 258, { align: 'center' });
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      doc.text('Simulateur Flying Whales', 105, 265, { align: 'center' });
      doc.text('Analyse personnalisee', 105, 270, { align: 'center' });
      
      // ========== PAGE 2: TOUT LE CONTENU ==========
      doc.addPage();
      yPos = 15;
      
      // === SECTION 1: PROFIL ===
      doc.setFillColor(0, 51, 102);
      doc.rect(15, yPos, 180, 7, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(11);
      doc.setFont('helvetica', 'bold');
      doc.text('VOTRE PROFIL', 18, yPos + 5);
      yPos += 10;
      
      // R√©cup√©ration donn√©es profil avec v√©rifications
      const getSafeValue = (id) => {
        const el = document.getElementById(id);
        return el ? el.value : 'N/A';
      };
      
      const getSafeText = (selector) => {
        const el = document.querySelector(selector);
        return el ? el.text : 'N/A';
      };
      
      const profile = {
        sector: getSafeValue('sector'),
        school: getSafeText('#school option:checked'),
        experience: getSafeValue('experience'),
        region: getSafeValue('region') === 'IDF' ? 'Ile-de-France' : 'Hors IDF',
        company: getSafeText('#companySize option:checked'),
        classification: getSafeText('#classification option:checked') || 'Standard',
        source: 'Marche'
      };
      
      doc.setDrawColor(200, 200, 200);
      doc.setLineWidth(0.3);
      doc.roundedRect(18, yPos, 174, 28, 2, 2);
      
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(8);
      
      const profileLines = [
        ['Secteur:', profile.sector, 'Experience:', profile.experience + ' ans'],
        ['Ecole:', profile.school, 'Entreprise:', profile.company],
        ['Localisation:', profile.region, 'Classification:', profile.classification],
        ['Source:', profile.source, '', '']
      ];
      
      let lineY = yPos + 5;
      profileLines.forEach(([label1, val1, label2, val2]) => {
        doc.setFont('helvetica', 'bold');
        doc.text(label1, 22, lineY);
        doc.setFont('helvetica', 'normal');
        doc.text(val1, 45, lineY);
        
        if (label2) {
          doc.setFont('helvetica', 'bold');
          doc.text(label2, 110, lineY);
          doc.setFont('helvetica', 'normal');
          doc.text(val2, 140, lineY);
        }
        lineY += 6;
      });
      
      yPos += 32;
      
      // === SECTION 2: ESTIMATION SALARIALE ===
      doc.setFillColor(230, 245, 255);
      doc.setDrawColor(0, 123, 255);
      doc.setLineWidth(0.8);
      doc.roundedRect(18, yPos, 174, 22, 2, 2, 'FD');
      
      doc.setTextColor(0, 51, 102);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text('ESTIMATION SALARIALE', 105, yPos + 5, { align: 'center' });
      
      // R√©cup√©ration et formatage ROBUSTE des salaires
      const medianEl = document.getElementById('median');
      const lowEl = document.getElementById('low');
      const highEl = document.getElementById('high');
      
      const median = formatSalary(medianEl ? medianEl.textContent : '');
      const low = formatSalary(lowEl ? lowEl.textContent : '');
      const high = formatSalary(highEl ? highEl.textContent : '');
      
      doc.setFontSize(18);
      doc.setTextColor(0, 123, 255);
      doc.text(median, 105, yPos + 13, { align: 'center' });
      
      doc.setFontSize(7);
      doc.setTextColor(100, 100, 100);
      doc.setFont('helvetica', 'normal');
      const fourchette = 'Fourchette : ' + low + ' - ' + high;
      doc.text(fourchette, 105, yPos + 18, { align: 'center' });
      
      yPos += 25;
      
      // Positionnement march√© - SANS JUSTIFICATION
      const marketEl = document.getElementById('analysis-market');
      const marketText = marketEl ? marketEl.textContent : '';
      
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(8);
      doc.setFont('helvetica', 'normal');
      
      const fullText = marketText + ' Cette estimation prend en compte votre profil complet (ecole, experience, localisation, type entreprise) et reflete les pratiques actuelles du marche francais. Les fourchettes indiquent la variance observee selon les negociations et benefices complementaires.';
      
      // D√©coupage ligne par ligne SANS justification automatique
      const maxWidth = 174;
      const words = fullText.split(' ');
      let currentLine = '';
      
      words.forEach((word, index) => {
        const testLine = currentLine + (currentLine ? ' ' : '') + word;
        const lineWidth = doc.getTextWidth(testLine);
        
        if (lineWidth > maxWidth && currentLine) {
          doc.text(currentLine, 18, yPos);
          currentLine = word;
          yPos += 4;
        } else {
          currentLine = testLine;
        }
        
        if (index === words.length - 1 && currentLine) {
          doc.text(currentLine, 18, yPos);
          yPos += 4;
        }
      });
      
      yPos += 5;
      
      // === SECTION 3: ANALYSE EN 2 COLONNES ===
      doc.setFillColor(34, 139, 34);
      doc.rect(15, yPos, 87, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('FACTEURS VALORISANTS', 18, yPos + 4);
      
      doc.setFillColor(255, 140, 0);
      doc.rect(108, yPos, 87, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.text('POINTS D\'ATTENTION', 111, yPos + 4);
      yPos += 9;
      
      const startY = yPos;
      
      // Colonne gauche
      const positiveItems = Array.from(document.querySelectorAll('#analysis-positive li'));
      let leftY = startY;
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(7);
      positiveItems.forEach((item, index) => {
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(34, 139, 34);
        doc.text((index + 1) + '.', 18, leftY);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(0, 0, 0);
        
        // D√©coupage manuel sans justification
        const words = item.textContent.split(' ');
        let line = '';
        words.forEach((word, idx) => {
          const test = line + (line ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 80 && line) {
            doc.text(line, 23, leftY);
            line = word;
            leftY += 3.5;
          } else {
            line = test;
          }
          if (idx === words.length - 1 && line) {
            doc.text(line, 23, leftY);
            leftY += 3.5;
          }
        });
        leftY += 2;
      });
      
      // Colonne droite
      const attentionItems = Array.from(document.querySelectorAll('#analysis-attention li'));
      let rightY = startY;
      attentionItems.forEach((item, index) => {
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(255, 140, 0);
        doc.text((index + 1) + '.', 111, rightY);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(0, 0, 0);
        
        // D√©coupage manuel sans justification
        const words = item.textContent.split(' ');
        let line = '';
        words.forEach((word, idx) => {
          const test = line + (line ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 80 && line) {
            doc.text(line, 116, rightY);
            line = word;
            rightY += 3.5;
          } else {
            line = test;
          }
          if (idx === words.length - 1 && line) {
            doc.text(line, 116, rightY);
            rightY += 3.5;
          }
        });
        rightY += 2;
      });
      
      yPos = Math.max(leftY, rightY) + 5;
      
      // === SECTION 4: RECOMMANDATIONS ===
      doc.setFillColor(255, 193, 7);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('RECOMMANDATIONS PERSONNALISEES', 18, yPos + 4);
      yPos += 9;
      
      const recommendationItems = Array.from(document.querySelectorAll('#analysis-recommendations li'));
      doc.setFontSize(7);
      recommendationItems.forEach((item, index) => {
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(255, 140, 0);
        doc.text((index + 1) + '.', 18, yPos);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(0, 0, 0);
        
        // D√©coupage manuel
        const words = item.textContent.split(' ');
        let line = '';
        words.forEach((word, idx) => {
          const test = line + (line ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 170 && line) {
            doc.text(line, 23, yPos);
            line = word;
            yPos += 3.5;
          } else {
            line = test;
          }
          if (idx === words.length - 1 && line) {
            doc.text(line, 23, yPos);
            yPos += 3.5;
          }
        });
        yPos += 2;
      });
      
      yPos += 3;
      
      // === SECTION 5: PROJECTION ===
      doc.setFillColor(138, 43, 226);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('PROJECTION DE CARRIERE', 18, yPos + 4);
      yPos += 9;
      
      const projectionEl = document.getElementById('analysis-projection');
      const projectionText = projectionEl ? projectionEl.innerText : '';
      const projectionLines = projectionText.split('\n').filter(line => line.trim());
      
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(7);
      doc.setFont('helvetica', 'normal');
      
      projectionLines.forEach(line => {
        const words = line.split(' ');
        let currentLine = '';
        words.forEach((word, idx) => {
          const test = currentLine + (currentLine ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 174 && currentLine) {
            doc.text(currentLine, 18, yPos);
            currentLine = word;
            yPos += 3.5;
          } else {
            currentLine = test;
          }
          if (idx === words.length - 1 && currentLine) {
            doc.text(currentLine, 18, yPos);
            yPos += 3.5;
          }
        });
      });
      
      yPos += 3;
      
      // === SECTION 6: GRAPHIQUE ===
      doc.setFillColor(0, 51, 102);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('EVOLUTION SALARIALE PROJETEE (40 ans)', 18, yPos + 4);
      yPos += 9;
      
      const canvas = document.getElementById('salaryChart');
      if (canvas) {
        html2canvas(canvas, { 
          scale: 1.5, 
          backgroundColor: '#ffffff',
          width: canvas.offsetWidth,
          height: canvas.offsetHeight
        }).then(canvasImg => {
          const imgData = canvasImg.toDataURL('image/png');
          doc.addImage(imgData, 'PNG', 45, yPos, 120, 55);
          yPos += 58;
          
          doc.setFontSize(7);
          doc.setTextColor(100, 100, 100);
          doc.setFont('helvetica', 'italic');
          doc.text('Projection basee sur +2,3%/an (hors promotions). L\'evolution reelle depend de vos performances,', 105, yPos, { align: 'center' });
          doc.text('negociations et changements de poste. Ces hypotheses sont indicatives.', 105, yPos + 3, { align: 'center' });
          
          // ===== FOOTER =====
          const pageCount = doc.internal.getNumberOfPages();
          for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            
            doc.setDrawColor(0, 174, 239);
            doc.setLineWidth(0.5);
            doc.line(15, 285, 195, 285);
            
            doc.setTextColor(150, 150, 150);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            doc.text('Simulateur Flying Whales - Document confidentiel', 15, 290);
            doc.text('Page ' + i + ' / ' + pageCount, 195, 290, { align: 'right' });
          }
          
          doc.save('analyse_salariale_flying_whales.pdf');
          btn.textContent = 'Exporter en PDF';
          btn.disabled = false;
        }).catch(error => {
          console.error('Erreur canvas:', error);
          alert('Erreur lors de la generation du PDF');
          btn.textContent = 'Exporter en PDF';
          btn.disabled = false;
        });
      } else {
        console.error('Canvas salaryChart non trouv√©');
        alert('Graphique non trouve');
        btn.textContent = 'Exporter en PDF';
        btn.disabled = false;
      }

    } catch (error) {
      console.error('Erreur PDF:', error);
      alert('Erreur lors de la generation du PDF');
      btn.textContent = 'Exporter en PDF';
      btn.disabled = false;
    }
  }, 100);
}


    function exportComparisonPDF() {
  const btn = event.target;
  btn.textContent = 'Generation en cours...';
  btn.disabled = true;

  setTimeout(() => {
    try {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      
      // Fonction utilitaire pour formater les salaires
      const formatSalary = (text) => {
        if (!text) return 'N/A';
        return text.toString().replace(/\//g, ' ').trim();
      };
      
      // Fonction utilitaire s√©curis√©e
      const getSafeValue = (id) => {
        const el = document.getElementById(id);
        return el ? el.value : 'N/A';
      };
      
      const getSafeText = (selector) => {
        const el = document.querySelector(selector);
        return el ? el.text : 'N/A';
      };
      
      const getSafeContent = (id) => {
        const el = document.getElementById(id);
        return el ? el.textContent : 'N/A';
      };
      
      let yPos = 20;

      // ========== PAGE 1: PAGE DE GARDE ==========
      doc.setFillColor(0, 51, 102);
      doc.rect(0, 0, 210, 297, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(28);
      doc.setFont('helvetica', 'bold');
      doc.text('COMPARAISON SALARIALE', 105, 130, { align: 'center' });
      
      doc.setDrawColor(0, 174, 239);
      doc.setLineWidth(1.5);
      doc.line(60, 140, 150, 140);
      
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      const today = new Date().toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric' });
      doc.text(today, 105, 152, { align: 'center' });
      
      doc.setFillColor(255, 255, 255);
      doc.roundedRect(50, 250, 110, 25, 3, 3, 'F');
      doc.setTextColor(0, 51, 102);
      doc.setFontSize(12);
      doc.setFont('helvetica', 'bold');
      doc.text('DOCUMENT CONFIDENTIEL', 105, 258, { align: 'center' });
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      doc.text('Simulateur Flying Whales', 105, 265, { align: 'center' });
      doc.text('Analyse comparative', 105, 270, { align: 'center' });
      
      // ========== PAGE 2: COMPARAISON ==========
      doc.addPage();
      yPos = 15;
      
      // === TITRE PRINCIPAL ===
      doc.setFillColor(0, 51, 102);
      doc.rect(15, yPos, 180, 7, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(11);
      doc.setFont('helvetica', 'bold');
      doc.text('COMPARAISON DE PROFILS', 18, yPos + 5);
      yPos += 10;
      
      // === PROFILS EN 2 COLONNES ===
      const startProfileY = yPos;
      
      // PROFIL A (Colonne gauche)
      doc.setFillColor(0, 123, 255);
      doc.rect(15, yPos, 87, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('PROFIL A', 18, yPos + 4);
      
      // PROFIL B (Colonne droite)
      doc.setFillColor(255, 140, 0);
      doc.rect(108, yPos, 87, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.text('PROFIL B', 111, yPos + 4);
      yPos += 9;
      
      // Donn√©es PROFIL A
      const profileA = {
        sector: getSafeValue('sectorA'),
        school: getSafeText('#schoolA option:checked'),
        experience: getSafeValue('experienceA'),
        region: getSafeValue('regionA') === 'IDF' ? 'IDF' : 'Hors IDF',
        company: getSafeText('#companySizeA option:checked'),
        classification: getSafeText('#classificationA option:checked') || 'Standard',
        jobFunction: getSafeText('#jobFunctionA option:checked') || 'N/A',
        source: 'Marche'
      };
      
      // Donn√©es PROFIL B
      const profileB = {
        sector: getSafeValue('sectorB'),
        school: getSafeText('#schoolB option:checked'),
        experience: getSafeValue('experienceB'),
        region: getSafeValue('regionB') === 'IDF' ? 'IDF' : 'Hors IDF',
        company: getSafeText('#companySizeB option:checked'),
        classification: getSafeText('#classificationB option:checked') || 'Standard',
        jobFunction: getSafeText('#jobFunctionB option:checked') || 'N/A',
        source: 'Marche'
      };
      
      // Affichage colonne gauche (Profil A)
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(7);
      doc.setFont('helvetica', 'normal');
      
      let leftY = yPos;
      const profileFields = [
        ['Secteur:', 'sector'],
        ['Ecole:', 'school'],
        ['Experience:', 'experience'],
        ['Metier:', 'jobFunction'],
        ['Localisation:', 'region'],
        ['Entreprise:', 'company'],
        ['Classification:', 'classification'],
        ['Source:', 'source']
      ];
      
      profileFields.forEach(([label, key]) => {
        doc.setFont('helvetica', 'bold');
        doc.text(label, 18, leftY);
        doc.setFont('helvetica', 'normal');
        let value = profileA[key];
        if (key === 'experience') value += ' ans';
        const wrapped = doc.splitTextToSize(value, 65);
        wrapped.forEach(line => {
          doc.text(line, 18, leftY + 3);
          leftY += 3;
        });
        leftY += 1;
      });
      
      // Affichage colonne droite (Profil B)
      let rightY = yPos;
      profileFields.forEach(([label, key]) => {
        doc.setFont('helvetica', 'bold');
        doc.text(label, 111, rightY);
        doc.setFont('helvetica', 'normal');
        let value = profileB[key];
        if (key === 'experience') value += ' ans';
        const wrapped = doc.splitTextToSize(value, 65);
        wrapped.forEach(line => {
          doc.text(line, 111, rightY + 3);
          rightY += 3;
        });
        rightY += 1;
      });
      
      yPos = Math.max(leftY, rightY) + 5;
      
      // === ESTIMATIONS SALARIALES EN 2 COLONNES ===
      doc.setFillColor(230, 245, 255);
      doc.setDrawColor(0, 123, 255);
      doc.setLineWidth(0.8);
      doc.roundedRect(15, yPos, 87, 25, 2, 2, 'FD');
      
      doc.setFillColor(255, 245, 230);
      doc.setDrawColor(255, 140, 0);
      doc.roundedRect(108, yPos, 87, 25, 2, 2, 'FD');
      
      // Salaire PROFIL A
      const medianA = formatSalary(getSafeContent('medianA'));
      const rangeA = formatSalary(getSafeContent('resultA-range'));
      
      doc.setTextColor(0, 51, 102);
      doc.setFontSize(8);
      doc.setFont('helvetica', 'bold');
      doc.text('ESTIMATION', 58, yPos + 4, { align: 'center' });
      
      doc.setFontSize(14);
      doc.setTextColor(0, 123, 255);
      doc.text(medianA, 58, yPos + 12, { align: 'center' });
      
      doc.setFontSize(6);
      doc.setTextColor(80, 80, 80);
      doc.setFont('helvetica', 'normal');
      const rangeAWrapped = doc.splitTextToSize(rangeA, 80);
      let rangeAY = yPos + 17;
      rangeAWrapped.forEach(line => {
        doc.text(line, 58, rangeAY, { align: 'center' });
        rangeAY += 3;
      });
      
      // Salaire PROFIL B
      const medianB = formatSalary(getSafeContent('medianB'));
      const rangeB = formatSalary(getSafeContent('resultB-range'));
      
      doc.setTextColor(0, 51, 102);
      doc.setFontSize(8);
      doc.setFont('helvetica', 'bold');
      doc.text('ESTIMATION', 151, yPos + 4, { align: 'center' });
      
      doc.setFontSize(14);
      doc.setTextColor(255, 140, 0);
      doc.text(medianB, 151, yPos + 12, { align: 'center' });
      
      doc.setFontSize(6);
      doc.setTextColor(80, 80, 80);
      doc.setFont('helvetica', 'normal');
      const rangeBWrapped = doc.splitTextToSize(rangeB, 80);
      let rangeBY = yPos + 17;
      rangeBWrapped.forEach(line => {
        doc.text(line, 151, rangeBY, { align: 'center' });
        rangeBY += 3;
      });
      
      yPos += 30;
      
      // === ANALYSE COMPARATIVE ===
      doc.setFillColor(138, 43, 226);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('ANALYSE COMPARATIVE', 18, yPos + 4);
      yPos += 9;
      
      // Diff√©rence salariale
      const differenceEl = document.getElementById('salary-difference');
      if (differenceEl) {
        const differenceText = differenceEl.textContent;
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(8);
        doc.setFont('helvetica', 'bold');
        
        // D√©coupage manuel sans justification
        const words = differenceText.split(' ');
        let currentLine = '';
        words.forEach((word, idx) => {
          const test = currentLine + (currentLine ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 174 && currentLine) {
            doc.text(currentLine, 18, yPos);
            currentLine = word;
            yPos += 4;
          } else {
            currentLine = test;
          }
          if (idx === words.length - 1 && currentLine) {
            doc.text(currentLine, 18, yPos);
            yPos += 4;
          }
        });
      }
      
      yPos += 3;
      
      // Analyse d√©taill√©e
      const analysisEl = document.getElementById('comparison-analysis');
      if (analysisEl) {
        const analysisText = analysisEl.textContent;
        doc.setFontSize(7);
        doc.setFont('helvetica', 'normal');
        
        const words = analysisText.split(' ');
        let currentLine = '';
        words.forEach((word, idx) => {
          const test = currentLine + (currentLine ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 174 && currentLine) {
            doc.text(currentLine, 18, yPos);
            currentLine = word;
            yPos += 3.5;
          } else {
            currentLine = test;
          }
          if (idx === words.length - 1 && currentLine) {
            doc.text(currentLine, 18, yPos);
            yPos += 3.5;
          }
        });
      }
      
      yPos += 5;
      
      // === FACTEURS DIFFERENCIANTS ===
      doc.setFillColor(34, 139, 34);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('FACTEURS DIFFERENCIANTS', 18, yPos + 4);
      yPos += 9;
      
      const keyFactorsEl = document.getElementById('key-factors');
      if (keyFactorsEl) {
        const items = Array.from(keyFactorsEl.querySelectorAll('li'));
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(7);
        
        items.forEach((item, index) => {
          doc.setFont('helvetica', 'bold');
          doc.setTextColor(34, 139, 34);
          doc.text((index + 1) + '.', 18, yPos);
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(0, 0, 0);
          
          const words = item.textContent.split(' ');
          let line = '';
          words.forEach((word, idx) => {
            const test = line + (line ? ' ' : '') + word;
            if (doc.getTextWidth(test) > 170 && line) {
              doc.text(line, 23, yPos);
              line = word;
              yPos += 3.5;
            } else {
              line = test;
            }
            if (idx === words.length - 1 && line) {
              doc.text(line, 23, yPos);
              yPos += 3.5;
            }
          });
          yPos += 2;
        });
      }
      
      yPos += 3;
      
      // === RECOMMANDATIONS ===
      doc.setFillColor(255, 193, 7);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('RECOMMANDATIONS', 18, yPos + 4);
      yPos += 9;
      
      const recommendationsEl = document.getElementById('comparison-recommendations');
      if (recommendationsEl) {
        const items = Array.from(recommendationsEl.querySelectorAll('li'));
        doc.setFontSize(7);
        
        items.forEach((item, index) => {
          doc.setFont('helvetica', 'bold');
          doc.setTextColor(255, 140, 0);
          doc.text((index + 1) + '.', 18, yPos);
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(0, 0, 0);
          
          const words = item.textContent.split(' ');
          let line = '';
          words.forEach((word, idx) => {
            const test = line + (line ? ' ' : '') + word;
            if (doc.getTextWidth(test) > 170 && line) {
              doc.text(line, 23, yPos);
              line = word;
              yPos += 3.5;
            } else {
              line = test;
            }
            if (idx === words.length - 1 && line) {
              doc.text(line, 23, yPos);
              yPos += 3.5;
            }
          });
          yPos += 2;
        });
      }
      
      // ===== FOOTER =====
      const pageCount = doc.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        
        doc.setDrawColor(0, 174, 239);
        doc.setLineWidth(0.5);
        doc.line(15, 285, 195, 285);
        
        doc.setTextColor(150, 150, 150);
        doc.setFontSize(7);
        doc.setFont('helvetica', 'normal');
        doc.text('Simulateur Flying Whales - Document confidentiel', 15, 290);
        doc.text('Page ' + i + ' / ' + pageCount, 195, 290, { align: 'right' });
      }
      
      doc.save('comparaison_salariale_flying_whales.pdf');
      btn.textContent = 'Exporter en PDF';
      btn.disabled = false;

    } catch (error) {
      console.error('Erreur PDF:', error);
      alert('Erreur lors de la generation du PDF');
      btn.textContent = 'Exporter en PDF';
      btn.disabled = false;
    }
  }, 100);
}

 // ===== INITIALISATION =====
    window.onload = function() {
      // Optimisations mobile
      if (isMobile()) {
        preventDoubleTabZoom();
        optimizeSliders();
        addTouchFeedback();
      }

      // Simulateur
      document.getElementById('sector').addEventListener('change', populateSchools);
      document.getElementById('school').addEventListener('change', function() {
        updateSchoolInfo();
        calculateSimulator();
      });
      document.getElementById('experience').addEventListener('input', function(e) {
        document.getElementById('expVal').textContent = e.target.value;
        calculateSimulator();
      });
      
      // Event listener pour les certifications (checkboxes)
document.querySelectorAll('input[name="certifications"]').forEach(checkbox => {
  checkbox.addEventListener('change', calculateSimulator);
});
      
      ['region', 'companySize', 'classification', 'educationLevel', 'englishLevel', 
       'contractType', 'industry', 'teamSize', 'packageLevel', 'subdomain', 'jobFunction', 'source'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculateSimulator);
      });
      
// ============================================
// EVENT LISTENERS JURIDIQUES AVEC AUTO-CALCUL
// ============================================

document.getElementById('juridique-domaine').addEventListener('change', function() {
  updateMetiersJuridiques();
});

document.getElementById('juridique-metier').addEventListener('change', function() {
  toggleBlocsJuridiques();
  if (this.value) {
    calculateJuridique();
  }
});

document.getElementById('juridique-statut').addEventListener('change', function() {
  toggleBlocsJuridiques();
  calculateJuridique();
});

// Recalcul automatique sur changement d'exp√©rience
document.getElementById('juridique-experience').addEventListener('input', function() {
  document.getElementById('juridique-exp-val').textContent = this.value;
  calculateJuridique();
});

// Recalcul automatique sur changement de localisation
document.getElementById('juridique-localisation').addEventListener('change', function() {
  calculateJuridique();
});

// Recalcul automatique sur changement de temps partiel
document.getElementById('juridique-temps-partiel').addEventListener('change', function() {
  calculateJuridique();
});

// ========================================
// BLOC AVOCAT - RECALCUL AUTOMATIQUE
// ========================================

document.getElementById('juridique-avocat-structure').addEventListener('change', calculateJuridique);
document.getElementById('juridique-avocat-tarif').addEventListener('input', calculateJuridique);
document.getElementById('juridique-avocat-heures').addEventListener('input', calculateJuridique);

document.getElementById('juridique-avocat-realisation').addEventListener('input', function() {
  document.getElementById('juridique-realisation-val').textContent = this.value;
  calculateJuridique();
});

document.getElementById('juridique-avocat-retro').addEventListener('input', function() {
  document.getElementById('juridique-retro-val').textContent = this.value;
  calculateJuridique();
});

// ========================================
// BLOC ASSOCI√â - RECALCUL AUTOMATIQUE
// ========================================

document.getElementById('juridique-associe-ca').addEventListener('input', calculateJuridique);
document.getElementById('juridique-associe-frais').addEventListener('input', calculateJuridique);

document.getElementById('juridique-associe-part').addEventListener('input', function() {
  document.getElementById('juridique-part-val').textContent = this.value;
  calculateJuridique();
});

// ========================================
// BLOC JURISTE - RECALCUL AUTOMATIQUE
// ========================================

document.getElementById('juridique-seniorite').addEventListener('change', calculateJuridique);
document.getElementById('juridique-secteur-activite').addEventListener('change', calculateJuridique);
document.getElementById('juridique-taille').addEventListener('change', calculateJuridique);
document.getElementById('juridique-stock').addEventListener('input', calculateJuridique);

document.getElementById('juridique-bonus').addEventListener('input', function() {
  document.getElementById('juridique-bonus-val').textContent = this.value;
  calculateJuridique();
});

// ========================================
// BLOC ENSEIGNEMENT - RECALCUL AUTOMATIQUE
// ========================================

document.getElementById('juridique-grade').addEventListener('change', calculateJuridique);
document.getElementById('juridique-heures-td').addEventListener('input', calculateJuridique);
document.getElementById('juridique-heures-cm').addEventListener('input', calculateJuridique);
document.getElementById('juridique-prime-recherche').addEventListener('input', calculateJuridique);
document.getElementById('juridique-hdr').addEventListener('change', calculateJuridique);

      // Comparateur A
      document.getElementById('sectorA').addEventListener('change', function() {
        populateSchoolsComparator();
        calculateComparison();
      });
      document.getElementById('schoolA').addEventListener('change', function() {
        updateSchoolInfoComparator('A');
        calculateComparison();
      });
      document.getElementById('experienceA').addEventListener('input', function(e) {
        document.getElementById('expValA').textContent = e.target.value;
        calculateComparison();
      });
      
      ['regionA', 'companySizeA', 'classificationA', 'subdomainA', 'educationLevelA', 'englishLevelA',
 'contractTypeA', 'industryA', 'teamSizeA', 'packageLevelA', 'sourceA'].forEach(id => {
  document.getElementById(id).addEventListener('change', calculateComparison);
});
      
      document.getElementById('jobFunctionA').addEventListener('change', calculateComparison);

      // Comparateur B
      document.getElementById('sectorB').addEventListener('change', function() {
        populateSchoolsComparator();
        calculateComparison();
      });
      document.getElementById('schoolB').addEventListener('change', function() {
        updateSchoolInfoComparator('B');
        calculateComparison();
      });
      document.getElementById('experienceB').addEventListener('input', function(e) {
        document.getElementById('expValB').textContent = e.target.value;
        calculateComparison();
      });
      
      ['regionB', 'companySizeB', 'classificationB', 'subdomainB', 'educationLevelB', 'englishLevelB',
 'contractTypeB', 'industryB', 'teamSizeB', 'packageLevelB', 'sourceB'].forEach(id => {
  document.getElementById(id).addEventListener('change', calculateComparison);
});
      
      document.getElementById('jobFunctionB').addEventListener('change', calculateComparison);

      // Init
      populateSchools();
      populateSchoolsComparator();

      // Ajustements initiaux mobile
      if (isMobile()) {
        adjustChartHeight();
      }

      // R√©ajuster lors du resize / rotation
      window.addEventListener('resize', function() {
        if (chart) {
          chart.resize();
          adjustChartHeight();
        }
      });
    };
  </script>
</body>
</html>
