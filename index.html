<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulateur Salaire + Comparateur Complet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    body { 
  font-family: 'Poppins', sans-serif;
  overflow-x: hidden;
}

.tab-active {
  background: linear-gradient(135deg, #00AEEF 0%, #003366 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 174, 239, 0.3);
}

.tab-inactive {
  background: white;
  color: #003366;
  border: 2px solid #e5e7eb;
}

.dark .tab-inactive {
  background: #1f2937;
  color: #e5e7eb;
  border-color: #374151;
}

.comparison-bar {
  transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}

.dark input, .dark select {
  background-color: #374151 !important;
  color: #f9fafb !important;
  border-color: #4b5563 !important;
}

.school-info-box {
  transition: all 0.3s ease;
  opacity: 0;
  max-height: 0;
  overflow: hidden;
}

.school-info-box.show {
  opacity: 1;
  max-height: 200px;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.02); }
}

.pulse-btn {
  animation: pulse 2s infinite;
}

/* ====================================
   üì± RESPONSIVE MOBILE
   ==================================== */

/* Tablette et mobile */
@media (max-width: 1024px) {
  header h1 {
    font-size: 1.5rem !important;
  }

  .max-w-7xl, .max-w-5xl {
    padding-left: 1rem;
    padding-right: 1rem;
  }

  /* Tabs responsive */
  .tab-active, .tab-inactive {
    padding: 0.5rem 1rem !important;
    font-size: 0.875rem;
  }

  /* Grilles responsive */
  .grid {
    grid-template-columns: 1fr !important;
  }

  /* Profils comparateur c√¥te √† c√¥te sur tablette */
  @media (min-width: 768px) {
    .grid.lg\\:grid-cols-2 {
      grid-template-columns: repeat(2, 1fr) !important;
    }
  }
}

/* Mobile strict */
@media (max-width: 640px) {
  body {
    font-size: 14px;
  }

  header {
    padding: 1rem 0 !important;
  }

  header h1 {
    font-size: 1.25rem !important;
  }

  header button {
    padding: 0.5rem 0.75rem !important;
    font-size: 0.875rem;
  }

  /* Tabs mobile */
  .flex.gap-4 {
    gap: 0.5rem !important;
  }

  .tab-active, .tab-inactive {
    padding: 0.5rem 0.75rem !important;
    font-size: 0.75rem;
    flex: 1;
    text-align: center;
  }

  /* Cartes */
  .rounded-2xl {
    border-radius: 1rem !important;
  }

  .p-8 {
    padding: 1rem !important;
  }

  .p-6 {
    padding: 0.875rem !important;
  }

  /* Inputs et selects plus grands (touch-friendly) */
  select, input[type="range"] {
    padding: 0.75rem !important;
    font-size: 1rem !important;
    min-height: 44px; /* Taille minimum Apple */
  }

  /* Boutons plus grands */
  button {
    padding: 0.75rem 1.25rem !important;
    font-size: 1rem !important;
    min-height: 44px;
  }

  /* Titres */
  h2 {
    font-size: 1.25rem !important;
  }

  h1 {
    font-size: 1.5rem !important;
  }

  /* R√©sultats m√©dians */
  .text-3xl {
    font-size: 1.75rem !important;
  }

  .text-4xl {
    font-size: 2rem !important;
  }

  /* Labels plus petits */
  label {
    font-size: 0.8rem !important;
  }

  /* Espacement r√©duit */
  .space-y-4 > * + * {
    margin-top: 0.75rem !important;
  }

  .space-y-3 > * + * {
    margin-top: 0.5rem !important;
  }

  .gap-6 {
    gap: 1rem !important;
  }

  .gap-4 {
    gap: 0.75rem !important;
  }

  /* Scroll optimis√© pour profils comparateur */
  .max-h-\\[650px\\] {
    max-height: 400px !important;
  }

  /* School info box */
  .school-info-box {
    padding: 0.5rem !important;
    font-size: 0.75rem !important;
  }

  /* Barre de comparaison */
  .h-12 {
    height: 3rem !important;
  }

  .comparison-bar span {
    font-size: 0.75rem !important;
    padding: 0 0.5rem !important;
  }

  /* Graphique Chart.js */
  canvas {
    max-height: 200px !important;
  }

  /* Insights */
  #comparison-insight p,
  #insight-main,
  #insight-academic,
  #insight-professional {
    font-size: 0.875rem !important;
    line-height: 1.4 !important;
  }

  /* Grid colonnes forc√©es */
  .grid.md\\:grid-cols-2,
  .grid.md\\:grid-cols-3 {
    grid-template-columns: 1fr !important;
  }

  /* Cartes r√©sultats empil√©es */
  .bg-gradient-to-br {
    padding: 1rem !important;
  }

  /* Padding g√©n√©ral r√©duit */
  .px-8 {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }

  .pb-12 {
    padding-bottom: 2rem !important;
  }

  /* Range slider plus visible */
  input[type="range"] {
    height: 8px;
  }

  input[type="range"]::-webkit-slider-thumb {
    width: 24px;
    height: 24px;
  }

  input[type="range"]::-moz-range-thumb {
    width: 24px;
    height: 24px;
  }
}

/* Tr√®s petit mobile (iPhone SE, etc.) */
@media (max-width: 375px) {
  header h1 {
    font-size: 1rem !important;
  }

  .tab-active, .tab-inactive {
    font-size: 0.7rem;
    padding: 0.4rem 0.5rem !important;
  }

  .text-4xl {
    font-size: 1.5rem !important;
  }

  .text-3xl {
    font-size: 1.25rem !important;
  }

  .text-2xl {
    font-size: 1.125rem !important;
  }
}

/* Mode paysage mobile */
@media (max-width: 896px) and (orientation: landscape) {
  header {
    padding: 0.5rem 0 !important;
  }

  .max-h-\\[650px\\],
  .max-h-\\[600px\\] {
    max-height: 300px !important;
  }
}
  </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
  
  <!-- Header -->
  <header class="w-full py-6 bg-gradient-to-r from-[#00AEEF] to-[#003366] text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-8 flex justify-between items-center">
      <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold">‚úàÔ∏è Simulateur Salaire</h1>
      <button onclick="toggleDarkMode()" class="px-3 py-2 sm:px-4 bg-white/20 hover:bg-white/30 rounded-lg transition text-sm sm:text-base">
        üåô/‚òÄÔ∏è
      </button>
    </div>
  </header>

<!-- Navigation Tabs -->
  <div class="max-w-7xl mx-auto px-4 sm:px-8 mt-6">
    <div class="flex gap-2 sm:gap-4 mb-6">
      <button 
        id="tab-simulator" 
        onclick="switchTab('simulator')" 
        class="tab-active flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
        <span class="hidden sm:inline">üìä </span>Simulateur
      </button>
      <button 
        id="tab-comparator" 
        onclick="switchTab('comparator')" 
        class="tab-inactive flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
        <span class="hidden sm:inline">üë• </span>Comparateur
      </button>
    </div>
  </div>>
  
<!-- ============================================= -->
  <!-- CONTENU : SIMULATEUR -->
  <!-- ============================================= -->
  <div id="content-simulator" class="max-w-5xl mx-auto px-4 sm:px-8 pb-8 sm:pb-12">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8 mb-6">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìù Renseigne ton profil</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
        
        <!-- Secteur -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè∑Ô∏è Secteur</label>
          <select id="sector" class="w-full p-2 border rounded-lg">
            <option value="ingenieur">Ing√©nierie</option>
            <option value="commerce">Grande √©cole de commerce</option>
            <option value="scpo">Sciences Po</option>
            <option value="universite">Universit√©</option>
            <option value="it">Informatique / IT</option>
            <option value="design">Design / UX / UI</option>
            <option value="fonction">Fonctions transverses</option>
          </select>
        </div>

        <!-- √âcole -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìö √âcole</label>
          <select id="school" class="w-full p-2 border rounded-lg"></select>
        </div>
      </div>

<!-- Fourchette sortie d'√©cole -->
      <div id="schoolInfo" class="school-info-box mt-3 p-2 sm:p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500">
        <p class="text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Salaire sortie d'√©cole</p>
        <div class="grid grid-cols-3 gap-2 text-xs">
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">P25:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP25">‚Äî</span>
          </div>
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">M√©d:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP50">‚Äî</span>
          </div>
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">P75:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP75">‚Äî</span>
          </div>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-4 mt-4">
        <!-- Niveau d'anglais -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üåé Niveau d'anglais</label>
          <select id="englishLevel" class="w-full p-2 border rounded-lg">
            <option value="basic">Basique (A2‚ÄìB1)</option>
            <option value="intermediate">Interm√©diaire (B2)</option>
            <option value="advanced">Avanc√© (C1)</option>
            <option value="bilingual">Bilingue / International (C2)</option>
          </select>
        </div>

        <!-- Niveau d'√©tudes -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üéì Niveau d'√©tudes</label>
          <select id="educationLevel" class="w-full p-2 border rounded-lg">
            <option value="technicien">Technicien / Bac +2</option>
            <option value="bac3">Licence / Bac +3</option>
            <option value="bac5" selected>Master / Ing√©nieur / Bac +5</option>
            <option value="doctorat">Doctorat / PhD</option>
          </select>
        </div>

        <!-- Type de contrat -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìú Type de contrat</label>
          <select id="contractType" class="w-full p-2 border rounded-lg">
            <option value="cdi">CDI</option>
            <option value="cdd">CDD</option>
            <option value="alternance">Alternance</option>
            <option value="freelance">Freelance / Ind√©pendant</option>
            <option value="expatriation">Expatri√© / D√©tach√© √† l'√©tranger</option>
          </select>
        </div>

        <!-- Secteur industriel -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè≠ Secteur industriel</label>
          <select id="industry" class="w-full p-2 border rounded-lg">
            <option value="aero">A√©ronautique / Spatial</option>
            <option value="auto">Automobile / Mobilit√©</option>
            <option value="energie">√ânergie / Nucl√©aire</option>
            <option value="num√©rique">Num√©rique / IT</option>
            <option value="sante">Sant√© / Biotech</option>
            <option value="luxe">Luxe / Design</option>
            <option value="public">Secteur public</option>
          </select>
        </div>

        <!-- Taille d'√©quipe -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üë• Taille d'√©quipe encadr√©e (Manager)</label>
          <select id="teamSize" class="w-full p-2 border rounded-lg">
            <option value="none">Aucune</option>
            <option value="small">1 √† 5 personnes</option>
            <option value="medium">6 √† 15 personnes</option>
            <option value="large">16 √† 50 personnes</option>
            <option value="xl">Plus de 50 personnes</option>
          </select>
        </div>

        <!-- Package global -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üéÅ Package global</label>
          <select id="packageLevel" class="w-full p-2 border rounded-lg">
            <option value="standard">Salaire fixe</option>
            <option value="bonus">Fixe + bonus (5‚Äì10%)</option>
            <option value="bonusplus">Fixe + bonus (15‚Äì25%)</option>
            <option value="actions">(Fixe + bonus)Package + actions / BSPCE</option>
          </select>
        </div>

        <!-- Exp√©rience -->
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">
            üìÖ Exp√©rience: <span id="expVal">3</span> ans
          </label>
          <input type="range" id="experience" min="0" max="40" value="3" class="w-full accent-blue-600">
        </div>

        <!-- R√©gion -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üåç R√©gion</label>
          <select id="region" class="w-full p-2 border rounded-lg">
            <option value="IDF">√éle-de-France</option>
            <option value="hors">Hors √éle-de-France</option>
          </select>
        </div>

        <!-- Taille entreprise -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè¢ Taille entreprise</label>
          <select id="companySize" class="w-full p-2 border rounded-lg">
            <option value="startup">Startup</option>
            <option value="PME">PME</option>
            <option value="ETI">ETI</option>
            <option value="grand-groupe">Grand Groupe</option>
          </select>
        </div>

        <!-- Classification interne -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè∑Ô∏è Classification interne</label>
          <select id="classification" class="w-full p-2 border rounded-lg">
            <option value="">-- Optionnelle --</option>
            <option value="I1">I1 - Ing√©nieur D√©butant</option>
            <option value="I2">I2 - Ing√©nieur Confirm√©</option>
            <option value="I3">I3 - Ing√©nieur Senior</option>
            <option value="I4">I4 - Ing√©nieur Expert</option>
            <option value="M1">M1 - Manager Niveau 1</option>
            <option value="M2">M2 - Manager Niveau 2</option>
            <option value="M3">M3 - Leader D√©partement</option>
          </select>
        </div>

        <!-- Source des donn√©es -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìä Source des donn√©es</label>
          <select id="source" class="w-full p-2 border rounded-lg">
            <option value="marche">üåç March√©</option>
            <option value="fw">üè¢ Flying Whales (interne)</option>
            <option value="croisee">‚öñÔ∏è Donn√©es crois√©es</option>
          </select>
        </div>
        <!-- Sous-domaine technique -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üî¨ Sous-domaine technique</label>
          <select id="subdomain" class="w-full p-2 border rounded-lg">
            <option value="">-- Aucun --</option>
            <option value="Calculs & Simulation">Calculs & Simulation (+5%)</option>
            <option value="Conception">Conception (+2%)</option>
            <option value="√âlectronique">√âlectronique (+4%)</option>
            <option value="Avionique">Avionique (+4%)</option>
            <option value="Mat√©riaux">Mat√©riaux (+2%)</option>
            <option value="Propulsion">Propulsion (+4%)</option>
            <option value="M√©thodes">M√©thodes (neutre)</option>
            <option value="Production">Production (neutre)</option>
            <option value="Maintenance">Maintenance (-2%)</option>
            <option value="Qualit√©">Qualit√© (+2%)</option>
            <option value="Supply Chain">Supply Chain (+2%)</option>
            <option value="Gestion de Projet">Gestion de Projet (+3%)</option>
            <option value="Ing√©nierie Syst√®mes">Ing√©nierie Syst√®mes (+4%)</option>
            <option value="Gestion de Programme">Gestion de Programme (+4%)</option>
            <option value="Support Client">Support Client (-4%)</option>
            <option value="Thermique">Thermique (+6%)</option>
            <option value="Dynamique de Vol">Dynamique de Vol (+6%)</option>
            <option value="√âlectrique">√âlectrique (+6%)</option>
            <option value="Test">Test (+1%)</option>
          </select>
        </div>
        
        <!-- M√©tier / Fonction -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üíº M√©tier / Fonction</label>
          <select id="jobFunction" class="w-full p-2 border rounded-lg">
            <option value="">-- Aucun --</option>
            <optgroup label="üíª IT / Tech">
              <option value="D√©veloppeur Front-End">D√©veloppeur Front-End</option>
              <option value="D√©veloppeur Back-End">D√©veloppeur Back-End</option>
              <option value="D√©veloppeur Full-Stack">D√©veloppeur Full-Stack</option>
              <option value="Data Engineer">Data Engineer</option>
              <option value="Data Scientist">Data Scientist</option>
              <option value="DevOps / SRE">DevOps / SRE</option>
              <option value="Infra / R√©seau">Infra / R√©seau</option>
              <option value="Cloud Architect">Cloud Architect</option>
              <option value="Cybersecurity Engineer">Cybersecurity Engineer</option>
              <option value="Admin Syst√®mes">Admin Syst√®mes</option>
              <option value="Product Owner">Product Owner</option>
              <option value="Product Manager">Product Manager</option>
            </optgroup>
            <optgroup label="üé® Design / UX">
              <option value="UX Designer">UX Designer</option>
              <option value="UI Designer">UI Designer</option>
              <option value="UX/UI Designer">UX/UI Designer</option>
              <option value="Product Designer">Product Designer</option>
              <option value="Motion Designer">Motion Designer</option>
              <option value="Graphiste / Branding">Graphiste / Branding</option>
              <option value="Interaction Designer">Interaction Designer</option>
            </optgroup>
            <optgroup label="üõí Achats">
              <option value="Acheteur Junior">Acheteur Junior</option>
              <option value="Acheteur Confirm√©">Acheteur Confirm√©</option>
              <option value="Responsable Achats">Responsable Achats</option>
              <option value="Directeur Achats">Directeur Achats</option>
            </optgroup>
            <optgroup label="üè¢ Immobilier">
              <option value="Charg√© de Gestion Immobili√®re">Charg√© de Gestion Immobili√®re</option>
              <option value="Property Manager">Property Manager</option>
              <option value="Responsable Immobilier">Responsable Immobilier</option>
              <option value="Directeur Immobilier">Directeur Immobilier</option>
            </optgroup>
            <optgroup label="üë• Ressources Humaines">
              <option value="Charg√© RH">Charg√© RH</option>
              <option value="Talent Acquisition">Talent Acquisition</option>
              <option value="Senior Talent Acquisition">Senior Talent Acquisition</option>
              <option value="Talent Acquisition Manager">Talent Acquisition Manager</option>
              <option value="Responsable RH / HRBP">Responsable RH / HRBP</option>
              <option value="Directeur des Ressources Humaines">Directeur des Ressources Humaines</option>
            </optgroup>
            <optgroup label="üí∞ Finance / Gestion">
              <option value="Comptable">Comptable</option>
              <option value="Contr√¥leur de Gestion">Contr√¥leur de Gestion</option>
              <option value="Auditeur Interne">Auditeur Interne</option>
              <option value="Tr√©sorier">Tr√©sorier</option>
              <option value="Responsable Financier">Responsable Financier</option>
              <option value="Directeur Administratif et Financier (DAF)">Directeur Administratif et Financier (DAF)</option>
            </optgroup>
            <optgroup label="üìà Commercial / Business">
              <option value="Business Developer Junior">Business Developer Junior</option>
              <option value="Business Developer Confirm√©">Business Developer Confirm√©</option>
              <option value="Ing√©nieur d'Affaires">Ing√©nieur d'Affaires</option>
              <option value="Responsable Commercial">Responsable Commercial</option>
              <option value="Directeur Commercial">Directeur Commercial</option>
            </optgroup>
            <optgroup label="üì¢ Communication">
              <option value="Charg√© de communication">Charg√© de communication</option>
              <option value="Responsable de communication">Responsable de communication</option>
              <option value="Directeur de la communication">Directeur de la communication</option>
            </optgroup>
            <optgroup label="‚úàÔ∏è Ing√©nieurs Ops">
              <option value="Ing√©nieur Op√©ration">Ing√©nieur Op√©ration</option>
              <option value="Ing√©nieur Op√©ration Senior">Ing√©nieur Op√©ration Senior</option>
              <option value="Ing√©nieur Mission">Ing√©nieur Mission</option>
              <option value="Ing√©nieur Mission Senior">Ing√©nieur Mission Senior</option>
            </optgroup>
          </select>
          
          
        </div>
        
      </div>
    </div>

<!-- R√©sultats Simulateur -->
    <div id="result" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8 hidden">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìä R√©sultats</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-4 sm:mb-6">
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Salaire M√©dian</p>
          <p class="text-2xl sm:text-3xl font-bold text-blue-600" id="median">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Fourchette Basse</p>
          <p class="text-2xl sm:text-3xl font-bold text-green-600" id="low">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Fourchette Haute</p>
          <p class="text-2xl sm:text-3xl font-bold text-purple-600" id="high">‚Äî</p>
        </div>
      </div>
      
      <!-- Synth√®se d'analyse d√©taill√©e -->
      <div id="detailedAnalysis" class="mb-6 space-y-4">
        
        <!-- Positionnement march√© -->
        <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl border-l-4 border-blue-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">üìä Positionnement sur le march√©</h3>
          <p id="analysis-market" class="text-sm text-gray-700 dark:text-gray-300">‚Äî</p>
        </div>

        <!-- Facteurs valorisants -->
        <div class="p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl border-l-4 border-green-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">‚úÖ Facteurs valorisants</h3>
          <ul id="analysis-positive" class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-disc list-inside">
            <li>En cours d'analyse...</li>
          </ul>
        </div>

        <!-- Points d'attention -->
        <div class="p-4 bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-xl border-l-4 border-orange-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">‚ö†Ô∏è Points d'attention</h3>
          <ul id="analysis-attention" class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-disc list-inside">
            <li>En cours d'analyse...</li>
          </ul>
        </div>

        <!-- Projection carri√®re -->
        <div class="p-4 bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 rounded-xl border-l-4 border-purple-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">üöÄ Projection de carri√®re</h3>
          <div id="analysis-projection" class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
            <p>‚Äî</p>
          </div>
        </div>

        <!-- Recommandations -->
        <div class="p-4 bg-gradient-to-r from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 rounded-xl border-l-4 border-yellow-500">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">üí° Recommandations</h3>
          <ul id="analysis-recommendations" class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-disc list-inside">
            <li>En cours d'analyse...</li>
          </ul>
        </div>

      </div>
      <canvas id="salaryChart" class="mt-4 sm:mt-6"></canvas>

      <!-- Bouton Export PDF -->
      <button onclick="exportSimulatorPDF()" class="mt-4 sm:mt-6 w-full sm:w-auto px-4 sm:px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition pulse-btn text-sm sm:text-base">
        üìÑ Exporter en PDF
      </button>
    </div>
  </div>
  
<!-- ============================================= -->
  <!-- CONTENU : COMPARATEUR -->
  <!-- ============================================= -->
  <div id="content-comparator" class="max-w-7xl mx-auto px-4 sm:px-8 pb-8 sm:pb-12 hidden">
    
    <!-- Grille de comparaison -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
      
      <!-- ========== PROFIL A ========== -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 sm:p-6 text-white">
          <h2 class="text-xl sm:text-2xl font-bold mb-2">Profil A</h2>
          <p class="text-2xl sm:text-4xl font-bold" id="resultA-median">‚Äî</p>
        </div>
        <div class="p-4 sm:p-6 space-y-2 sm:space-y-3 max-h-[400px] sm:max-h-[650px] overflow-y-auto">
          
          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur</label>
            <select id="sectorA" class="w-full p-2 text-sm border rounded-lg">
              <option value="ingenieur">Ing√©nierie</option>
              <option value="commerce">Commerce</option>
              <option value="scpo">Sciences Po</option>
              <option value="universite">Universit√©</option>
              <option value="it">IT</option>
              <option value="design">Design</option>
              <option value="fonction">Fonctions transverses</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">√âcole</label>
            <select id="schoolA" class="w-full p-2 text-sm border rounded-lg"></select>
          </div>

          <!-- Fourchette √âcole A -->
          <div id="schoolInfoA" class="school-info-box p-2 bg-blue-50 dark:bg-blue-900/20 rounded border-l-4 border-blue-500">
            <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Sortie d'√©cole</p>
            <div class="flex justify-between text-xs">
              <div><span class="text-gray-600 dark:text-gray-400">P25:</span> <span class="font-bold text-blue-600" id="schoolP25A">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">M√©d:</span> <span class="font-bold text-blue-600" id="schoolP50A">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">P75:</span> <span class="font-bold text-blue-600" id="schoolP75A">‚Äî</span></div>
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'anglais</label>
            <select id="englishLevelA" class="w-full p-2 text-sm border rounded-lg">
              <option value="basic">Basique (A2‚ÄìB1)</option>
              <option value="intermediate">Interm√©diaire (B2)</option>
              <option value="advanced">Avanc√© (C1)</option>
              <option value="bilingual">Bilingue (C2)</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'√©tudes</label>
            <select id="educationLevelA" class="w-full p-2 text-sm border rounded-lg">
              <option value="technicien">Bac +2</option>
              <option value="bac3">Bac +3</option>
              <option value="bac5" selected>Bac +5</option>
              <option value="doctorat">Doctorat</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Type de contrat</label>
            <select id="contractTypeA" class="w-full p-2 text-sm border rounded-lg">
              <option value="cdi">CDI</option>
              <option value="cdd">CDD</option>
              <option value="alternance">Alternance</option>
              <option value="freelance">Freelance</option>
              <option value="expatriation">Expatri√©</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur industriel</label>
            <select id="industryA" class="w-full p-2 text-sm border rounded-lg">
              <option value="aero">A√©ronautique</option>
              <option value="auto">Automobile</option>
              <option value="energie">√ânergie</option>
              <option value="num√©rique">Num√©rique</option>
              <option value="sante">Sant√©</option>
              <option value="luxe">Luxe</option>
              <option value="public">Public</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille √©quipe</label>
            <select id="teamSizeA" class="w-full p-2 text-sm border rounded-lg">
              <option value="none">Aucune</option>
              <option value="small">1-5</option>
              <option value="medium">6-15</option>
              <option value="large">16-50</option>
              <option value="xl">50+</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Package</label>
            <select id="packageLevelA" class="w-full p-2 text-sm border rounded-lg">
              <option value="standard">Standard</option>
              <option value="bonus">Bonus 5-10%</option>
              <option value="bonusplus">Variable 15-25%</option>
              <option value="actions">Actions/BSPCE</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">
              Exp√©rience: <span id="expValA">3</span> ans
            </label>
            <input type="range" id="experienceA" min="0" max="40" value="3" class="w-full accent-blue-600">
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">R√©gion</label>
            <select id="regionA" class="w-full p-2 text-sm border rounded-lg">
              <option value="IDF">√éle-de-France</option>
              <option value="hors">Hors IDF</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille entreprise</label>
            <select id="companySizeA" class="w-full p-2 text-sm border rounded-lg">
              <option value="startup">Startup</option>
              <option value="PME">PME</option>
              <option value="ETI">ETI</option>
              <option value="grand-groupe" selected>Grand Groupe</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Classification</label>
            <select id="classificationA" class="w-full p-2 text-sm border rounded-lg">
              <option value="">Standard</option>
              <option value="I1">I1</option>
              <option value="I2">I2</option>
              <option value="I3">I3</option>
              <option value="I4">I4</option>
              <option value="M1">M1</option>
              <option value="M2">M2</option>
              <option value="M3">M3</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Source</label>
            <select id="sourceA" class="w-full p-2 text-sm border rounded-lg">
              <option value="marche">March√©</option>
              <option value="fw">FW</option>
              <option value="croisee">Crois√©e</option>
            </select>
          </div>
          
          <div>
  <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">üíº M√©tier</label>
  <select id="jobFunctionA" class="w-full p-2 text-sm border rounded-lg">
    <option value="">-- Aucun --</option>
    <optgroup label="üíª IT / Tech">
      <option value="D√©veloppeur Front-End">D√©veloppeur Front-End</option>
      <option value="D√©veloppeur Back-End">D√©veloppeur Back-End</option>
      <option value="D√©veloppeur Full-Stack">D√©veloppeur Full-Stack</option>
      <option value="Data Engineer">Data Engineer</option>
      <option value="Data Scientist">Data Scientist</option>
      <option value="DevOps / SRE">DevOps / SRE</option>
      <option value="Infra / R√©seau">Infra / R√©seau</option>
      <option value="Cloud Architect">Cloud Architect</option>
      <option value="Cybersecurity Engineer">Cybersecurity Engineer</option>
      <option value="Admin Syst√®mes">Admin Syst√®mes</option>
      <option value="Product Owner">Product Owner</option>
      <option value="Product Manager">Product Manager</option>
    </optgroup>
    <optgroup label="üé® Design / UX">
      <option value="UX Designer">UX Designer</option>
      <option value="UI Designer">UI Designer</option>
      <option value="UX/UI Designer">UX/UI Designer</option>
      <option value="Product Designer">Product Designer</option>
      <option value="Motion Designer">Motion Designer</option>
      <option value="Graphiste / Branding">Graphiste / Branding</option>
      <option value="Interaction Designer">Interaction Designer</option>
    </optgroup>
    <optgroup label="üõí Achats">
      <option value="Acheteur Junior">Acheteur Junior</option>
      <option value="Acheteur Confirm√©">Acheteur Confirm√©</option>
      <option value="Responsable Achats">Responsable Achats</option>
      <option value="Directeur Achats">Directeur Achats</option>
    </optgroup>
    <optgroup label="üè¢ Immobilier">
      <option value="Charg√© de Gestion Immobili√®re">Charg√© de Gestion Immobili√®re</option>
      <option value="Property Manager">Property Manager</option>
      <option value="Responsable Immobilier">Responsable Immobilier</option>
      <option value="Directeur Immobilier">Directeur Immobilier</option>
    </optgroup>
    <optgroup label="üë• Ressources Humaines">
      <option value="Charg√© RH">Charg√© RH</option>
      <option value="Talent Acquisition">Talent Acquisition</option>
      <option value="Senior Talent Acquisition">Senior Talent Acquisition</option>
      <option value="Talent Acquisition Manager">Talent Acquisition Manager</option>
      <option value="Responsable RH / HRBP">Responsable RH / HRBP</option>
      <option value="Directeur des Ressources Humaines">Directeur des Ressources Humaines</option>
    </optgroup>
    <optgroup label="üí∞ Finance / Gestion">
      <option value="Comptable">Comptable</option>
      <option value="Contr√¥leur de Gestion">Contr√¥leur de Gestion</option>
      <option value="Auditeur Interne">Auditeur Interne</option>
      <option value="Tr√©sorier">Tr√©sorier</option>
      <option value="Responsable Financier">Responsable Financier</option>
      <option value="Directeur Administratif et Financier (DAF)">Directeur Administratif et Financier (DAF)</option>
    </optgroup>
    <optgroup label="üìà Commercial / Business">
      <option value="Business Developer Junior">Business Developer Junior</option>
      <option value="Business Developer Confirm√©">Business Developer Confirm√©</option>
      <option value="Ing√©nieur d'Affaires">Ing√©nieur d'Affaires</option>
      <option value="Responsable Commercial">Responsable Commercial</option>
      <option value="Directeur Commercial">Directeur Commercial</option>
    </optgroup>
    <optgroup label="üì¢ Communication">
      <option value="Charg√© de communication">Charg√© de communication</option>
      <option value="Responsable de communication">Responsable de communication</option>
      <option value="Directeur de la communication">Directeur de la communication</option>
    </optgroup>
    <optgroup label="‚úàÔ∏è Ing√©nieurs Ops">
      <option value="Ing√©nieur Op√©ration">Ing√©nieur Op√©ration</option>
      <option value="Ing√©nieur Op√©ration Senior">Ing√©nieur Op√©ration Senior</option>
      <option value="Ing√©nieur Mission">Ing√©nieur Mission</option>
      <option value="Ing√©nieur Mission Senior">Ing√©nieur Mission Senior</option>
    </optgroup>
  </select>
</div>

          <div class="pt-3 border-t">
            <p class="text-xs text-gray-600 dark:text-gray-400">
              Fourchette: <span class="font-semibold text-gray-800 dark:text-white" id="resultA-range">‚Äî</span>
            </p>
          </div>
        </div>
      </div>

      <!-- ========== PROFIL B ========== -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 sm:p-6 text-white">
          <h2 class="text-xl sm:text-2xl font-bold mb-2">Profil B</h2>
          <p class="text-2xl sm:text-4xl font-bold" id="resultB-median">‚Äî</p>
        </div>
        <div class="p-4 sm:p-6 space-y-2 sm:space-y-3 max-h-[400px] sm:max-h-[650px] overflow-y-auto">
          
          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur</label>
            <select id="sectorB" class="w-full p-2 text-sm border rounded-lg">
              <option value="ingenieur">Ing√©nierie</option>
              <option value="commerce">Commerce</option>
              <option value="scpo">Sciences Po</option>
              <option value="universite">Universit√©</option>
              <option value="it">IT</option>
              <option value="design">Design</option>
              <option value="fonction">Fonctions transverses</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">√âcole</label>
            <select id="schoolB" class="w-full p-2 text-sm border rounded-lg"></select>
          </div>

          <!-- Fourchette √âcole B -->
          <div id="schoolInfoB" class="school-info-box p-2 bg-green-50 dark:bg-green-900/20 rounded border-l-4 border-green-500">
            <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Sortie d'√©cole</p>
            <div class="flex justify-between text-xs">
              <div><span class="text-gray-600 dark:text-gray-400">P25:</span> <span class="font-bold text-green-600" id="schoolP25B">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">M√©d:</span> <span class="font-bold text-green-600" id="schoolP50B">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">P75:</span> <span class="font-bold text-green-600" id="schoolP75B">‚Äî</span></div>
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'anglais</label>
            <select id="englishLevelB" class="w-full p-2 text-sm border rounded-lg">
              <option value="basic">Basique (A2‚ÄìB1)</option>
              <option value="intermediate">Interm√©diaire (B2)</option>
              <option value="advanced">Avanc√© (C1)</option>
              <option value="bilingual">Bilingue (C2)</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'√©tudes</label>
            <select id="educationLevelB" class="w-full p-2 text-sm border rounded-lg">
              <option value="technicien">Bac +2</option>
              <option value="bac3">Bac +3</option>
              <option value="bac5" selected>Bac +5</option>
              <option value="doctorat">Doctorat</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Type de contrat</label>
            <select id="contractTypeB" class="w-full p-2 text-sm border rounded-lg">
              <option value="cdi">CDI</option>
              <option value="cdd">CDD</option>
              <option value="alternance">Alternance</option>
              <option value="freelance">Freelance</option>
              <option value="expatriation">Expatri√©</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur industriel</label>
            <select id="industryB" class="w-full p-2 text-sm border rounded-lg">
              <option value="aero">A√©ronautique</option>
              <option value="auto">Automobile</option>
              <option value="energie">√ânergie</option>
              <option value="num√©rique">Num√©rique</option>
              <option value="sante">Sant√©</option>
              <option value="luxe">Luxe</option>
              <option value="public">Public</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille √©quipe</label>
            <select id="teamSizeB" class="w-full p-2 text-sm border rounded-lg">
              <option value="none">Aucune</option>
              <option value="small">1-5</option>
              <option value="medium">6-15</option>
              <option value="large">16-50</option>
              <option value="xl">50+</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Package</label>
            <select id="packageLevelB" class="w-full p-2 text-sm border rounded-lg">
              <option value="standard">Standard</option>
              <option value="bonus">Bonus 5-10%</option>
              <option value="bonusplus">Variable 15-25%</option>
              <option value="actions">Actions/BSPCE</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">
              Exp√©rience: <span id="expValB">5</span> ans
            </label>
            <input type="range" id="experienceB" min="0" max="40" value="5" class="w-full accent-green-600">
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">R√©gion</label>
            <select id="regionB" class="w-full p-2 text-sm border rounded-lg">
              <option value="IDF">√éle-de-France</option>
              <option value="hors" selected>Hors IDF</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille entreprise</label>
            <select id="companySizeB" class="w-full p-2 text-sm border rounded-lg">
              <option value="startup">Startup</option>
              <option value="PME" selected>PME</option>
              <option value="ETI">ETI</option>
              <option value="grand-groupe">Grand Groupe</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Classification</label>
            <select id="classificationB" class="w-full p-2 text-sm border rounded-lg">
              <option value="">Standard</option>
              <option value="I1">I1</option>
              <option value="I2">I2</option>
              <option value="I3">I3</option>
              <option value="I4">I4</option>
              <option value="M1">M1</option>
              <option value="M2">M2</option>
              <option value="M3">M3</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Source</label>
            <select id="sourceB" class="w-full p-2 text-sm border rounded-lg">
              <option value="marche">March√©</option>
              <option value="fw">FW</option>
              <option value="croisee">Crois√©e</option>
            </select>
          </div>
          
          <div>
  <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">üíº M√©tier</label>
  <select id="jobFunctionB" class="w-full p-2 text-sm border rounded-lg">
    <option value="">-- Aucun --</option>
    <optgroup label="üíª IT / Tech">
      <option value="D√©veloppeur Front-End">D√©veloppeur Front-End</option>
      <option value="D√©veloppeur Back-End">D√©veloppeur Back-End</option>
      <option value="D√©veloppeur Full-Stack">D√©veloppeur Full-Stack</option>
      <option value="Data Engineer">Data Engineer</option>
      <option value="Data Scientist">Data Scientist</option>
      <option value="DevOps / SRE">DevOps / SRE</option>
      <option value="Infra / R√©seau">Infra / R√©seau</option>
      <option value="Cloud Architect">Cloud Architect</option>
      <option value="Cybersecurity Engineer">Cybersecurity Engineer</option>
      <option value="Admin Syst√®mes">Admin Syst√®mes</option>
      <option value="Product Owner">Product Owner</option>
      <option value="Product Manager">Product Manager</option>
    </optgroup>
    <optgroup label="üé® Design / UX">
      <option value="UX Designer">UX Designer</option>
      <option value="UI Designer">UI Designer</option>
      <option value="UX/UI Designer">UX/UI Designer</option>
      <option value="Product Designer">Product Designer</option>
      <option value="Motion Designer">Motion Designer</option>
      <option value="Graphiste / Branding">Graphiste / Branding</option>
      <option value="Interaction Designer">Interaction Designer</option>
    </optgroup>
    <optgroup label="üõí Achats">
      <option value="Acheteur Junior">Acheteur Junior</option>
      <option value="Acheteur Confirm√©">Acheteur Confirm√©</option>
      <option value="Responsable Achats">Responsable Achats</option>
      <option value="Directeur Achats">Directeur Achats</option>
    </optgroup>
    <optgroup label="üè¢ Immobilier">
      <option value="Charg√© de Gestion Immobili√®re">Charg√© de Gestion Immobili√®re</option>
      <option value="Property Manager">Property Manager</option>
      <option value="Responsable Immobilier">Responsable Immobilier</option>
      <option value="Directeur Immobilier">Directeur Immobilier</option>
    </optgroup>
    <optgroup label="üë• Ressources Humaines">
      <option value="Charg√© RH">Charg√© RH</option>
      <option value="Talent Acquisition">Talent Acquisition</option>
      <option value="Senior Talent Acquisition">Senior Talent Acquisition</option>
      <option value="Talent Acquisition Manager">Talent Acquisition Manager</option>
      <option value="Responsable RH / HRBP">Responsable RH / HRBP</option>
      <option value="Directeur des Ressources Humaines">Directeur des Ressources Humaines</option>
    </optgroup>
    <optgroup label="üí∞ Finance / Gestion">
      <option value="Comptable">Comptable</option>
      <option value="Contr√¥leur de Gestion">Contr√¥leur de Gestion</option>
      <option value="Auditeur Interne">Auditeur Interne</option>
      <option value="Tr√©sorier">Tr√©sorier</option>
      <option value="Responsable Financier">Responsable Financier</option>
      <option value="Directeur Administratif et Financier (DAF)">Directeur Administratif et Financier (DAF)</option>
    </optgroup>
    <optgroup label="üìà Commercial / Business">
      <option value="Business Developer Junior">Business Developer Junior</option>
      <option value="Business Developer Confirm√©">Business Developer Confirm√©</option>
      <option value="Ing√©nieur d'Affaires">Ing√©nieur d'Affaires</option>
      <option value="Responsable Commercial">Responsable Commercial</option>
      <option value="Directeur Commercial">Directeur Commercial</option>
    </optgroup>
    <optgroup label="üì¢ Communication">
      <option value="Charg√© de communication">Charg√© de communication</option>
      <option value="Responsable de communication">Responsable de communication</option>
      <option value="Directeur de la communication">Directeur de la communication</option>
    </optgroup>
    <optgroup label="‚úàÔ∏è Ing√©nieurs Ops">
      <option value="Ing√©nieur Op√©ration">Ing√©nieur Op√©ration</option>
      <option value="Ing√©nieur Op√©ration Senior">Ing√©nieur Op√©ration Senior</option>
      <option value="Ing√©nieur Mission">Ing√©nieur Mission</option>
      <option value="Ing√©nieur Mission Senior">Ing√©nieur Mission Senior</option>
    </optgroup>
  </select>
</div>

          <div class="pt-3 border-t">
            <p class="text-xs text-gray-600 dark:text-gray-400">
              Fourchette: <span class="font-semibold text-gray-800 dark:text-white" id="resultB-range">‚Äî</span>
            </p>
          </div>
          
        </div>
      </div>
    </div>

<!-- ========== ANALYSE COMPARATIVE PEAUFIN√âE ========== -->
    <div id="comparison-results" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìä Analyse Comparative</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Diff√©rence (A - B)</p>
          <p id="diff-absolute" class="text-2xl sm:text-3xl font-bold">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">√âcart relatif</p>
          <p id="diff-percent" class="text-2xl sm:text-3xl font-bold">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Ratio A/B</p>
          <p id="diff-ratio" class="text-2xl sm:text-3xl font-bold text-blue-600">‚Äî</p>
        </div>
      </div>

      <!-- Visualisation barre -->
      <div class="mb-4 sm:mb-6">
        <div class="flex items-center justify-between mb-2 sm:mb-3">
          <span class="text-xs sm:text-sm font-semibold text-blue-600">Profil A</span>
          <span class="text-xs sm:text-sm font-semibold text-green-600">Profil B</span>
        </div>
        <div class="relative h-10 sm:h-12 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
          <div id="bar-A" class="comparison-bar absolute top-0 left-0 h-full bg-blue-500 flex items-center justify-end pr-2 sm:pr-3" style="width: 50%">
            <span class="text-white text-xs sm:text-sm font-bold" id="bar-A-text">‚Äî</span>
          </div>
          <div id="bar-B" class="comparison-bar absolute top-0 right-0 h-full bg-green-500 flex items-center justify-start pl-2 sm:pl-3" style="width: 50%">
            <span class="text-white text-xs sm:text-sm font-bold" id="bar-B-text">‚Äî</span>
          </div>
        </div>
      </div>

      <!-- Analyse d√©taill√©e multi-facteurs -->
      <div id="comparison-insight" class="space-y-3 sm:space-y-4">
        <!-- Insight principal -->
        <div class="p-3 sm:p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
          <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">
            üí° <strong>Synth√®se :</strong> <span id="insight-main">Configure les deux profils pour voir l'analyse.</span>
          </p>
        </div>

        <!-- D√©tails comparatifs -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
          <div class="p-3 sm:p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
            <p class="text-xs font-semibold text-blue-700 dark:text-blue-300 mb-2">üéì Facteurs acad√©miques</p>
            <p id="insight-academic" class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">‚Äî</p>
          </div>
          <div class="p-3 sm:p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
            <p class="text-xs font-semibold text-green-700 dark:text-green-300 mb-2">üíº Facteurs professionnels</p>
            <p id="insight-professional" class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">‚Äî</p>
          </div>
        </div>
      </div>

      <!-- Bouton Export PDF Comparaison -->
      <button onclick="exportComparisonPDF()" class="mt-4 sm:mt-6 w-full sm:w-auto px-4 sm:px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition pulse-btn text-sm sm:text-base">
        üìÑ Exporter la comparaison en PDF
      </button>
    </div>
  </div>
  
  <!-- ============================================= -->
  <!-- SCRIPT COMPLET : DONN√âES + LOGIQUE -->
  <!-- ============================================= -->
  <script>
    // ===== TOUTES LES √âCOLES (DONN√âES COMPL√àTES) =====
    
    // 71 √âcoles d'ing√©nieurs
    const schoolsIngenieur = [
      { Ecole:"AgroParisTech", p25:41135, p50:43290, p75:44881 },
      { Ecole:"CENTRALE LILLE", p25:44886, p50:47528, p75:49058 },
      { Ecole:"Centrale Lyon", p25:46209, p50:48572, p75:50405 },
      { Ecole:"CENTRALE MARSEILLE", p25:44069, p50:46526, p75:48343 },
      { Ecole:"CENTRALE NANTES", p25:44069, p50:46526, p75:48343 },
      { Ecole:"CNAM", p25:42399, p50:44470, p75:46186 },
      { Ecole:"CPE LYON", p25:44354, p50:47226, p75:48952 },
      { Ecole:"ECAM LASALLE", p25:42327, p50:44639, p75:46354 },
      { Ecole:"EFREI PARIS", p25:46376, p50:48826, p75:50707 },
      { Ecole:"EI PURPAN", p25:37773, p50:40245, p75:42122 },
      { Ecole:"ENAC", p25:46878, p50:49601, p75:51537 },
      { Ecole:"ENGEES", p25:41546, p50:43956, p75:46258 },
      { Ecole:"ENI BREST", p25:40131, p50:42413, p75:44348 },
      { Ecole:"ENIM", p25:40788, p50:43661, p75:44789 },
      { Ecole:"ENISE", p25:40583, p50:43105, p75:44897 },
      { Ecole:"ENPC", p25:51562, p50:54355, p75:56797 },
      { Ecole:"ENSAIA", p25:41083, p50:43093, p75:45132 },
      { Ecole:"ENSAM", p25:44787, p50:46788, p75:48322 },
      { Ecole:"ENSC LILLE", p25:42070, p50:44533, p75:46408 },
      { Ecole:"ENSC MONTPELLIER", p25:42008, p50:44482, p75:46379 },
      { Ecole:"ENSC MULHOUSE", p25:41534, p50:44526, p75:46946 },
      { Ecole:"ENSC RENNES", p25:40159, p50:42815, p75:44974 },
      { Ecole:"ENSEA", p25:41829, p50:44221, p75:45882 },
      { Ecole:"ENSEIRB MATMECA", p25:44556, p50:47002, p75:48898 },
      { Ecole:"ENSEM", p25:42859, p50:45524, p75:47467 },
      { Ecole:"ENSGTI PAU", p25:44512, p50:46900, p75:48768 },
      { Ecole:"ENSI POITIERS", p25:39851, p50:42102, p75:43728 },
      { Ecole:"ENSIC", p25:44084, p50:46515, p75:48535 },
      { Ecole:"ENSICAEN", p25:41455, p50:44169, p75:45726 },
      { Ecole:"ENSIIE", p25:47536, p50:50298, p75:52473 },
      { Ecole:"ENSIL ENSCI", p25:40977, p50:43344, p75:44941 },
      { Ecole:"ENSMA", p25:40579, p50:43065, p75:44609 },
      { Ecole:"ENSMM", p25:41995, p50:44264, p75:46176 },
      { Ecole:"ENSTA", p25:46261, p50:48833, p75:50734 },
      { Ecole:"ENSTA BRETAGNE", p25:41949, p50:44081, p75:46198 },
      { Ecole:"ENTPE", p25:46289, p50:49067, p75:50863 },
      { Ecole:"ESA", p25:38334, p50:40900, p75:42233 },
      { Ecole:"ESCOM", p25:42003, p50:44499, p75:46560 },
      { Ecole:"ESEO", p25:42635, p50:45151, p75:46890 },
      { Ecole:"ESIEA", p25:43286, p50:45885, p75:47485 },
      { Ecole:"ESME SUDRIA", p25:42420, p50:44687, p75:46350 },
      { Ecole:"ESTP PARIS", p25:45163, p50:47416, p75:49305 },
      { Ecole:"Grenoble INP ense3", p25:42963, p50:45276, p75:46845 },
      { Ecole:"Grenoble INP ENSIMAG", p25:47093, p50:49721, p75:52230 },
      { Ecole:"Grenoble INP Pagora", p25:44597, p50:47520, p75:49835 },
      { Ecole:"Grenoble INP Phelma", p25:44178, p50:46881, p75:48593 },
      { Ecole:"HEI Junia", p25:41979, p50:44569, p75:46193 },
      { Ecole:"ICAM", p25:42159, p50:44262, p75:45939 },
      { Ecole:"INSA Lyon", p25:43733, p50:46209, p75:47758 },
      { Ecole:"INSA Rennes", p25:41703, p50:43841, p75:45798 },
      { Ecole:"INSA Rouen", p25:41747, p50:43887, p75:45750 },
      { Ecole:"INSA Strasbourg", p25:41718, p50:44200, p75:45847 },
      { Ecole:"INSA Val de Loire", p25:41330, p50:43640, p75:45632 },
      { Ecole:"IOTA", p25:44010, p50:46591, p75:48917 },
      { Ecole:"ISA JUNIA", p25:37427, p50:39511, p75:41236 },
      { Ecole:"ISAE SUPAERO", p25:47058, p50:49747, p75:51463 },
      { Ecole:"ISEN Lille", p25:43171, p50:45961, p75:48194 },
      { Ecole:"ISEP", p25:44546, p50:47223, p75:49110 },
      { Ecole:"ISMEP-SUPMECA", p25:41055, p50:43450, p75:45175 },
      { Ecole:"ITECH", p25:43641, p50:46534, p75:48523 },
      { Ecole:"Mines St Etienne", p25:48369, p50:50744, p75:52868 },
      { Ecole:"Polytech Grenoble", p25:43344, p50:46061, p75:48346 },
      { Ecole:"POLYTECHNIQUE", p25:57013, p50:59835, p75:62105 },
      { Ecole:"SIGMA", p25:43111, p50:45484, p75:47341 },
      { Ecole:"SUPELEC", p25:49405, p50:52285, p75:54153 },
      { Ecole:"Toulouse INP ENSEEIHT", p25:42714, p50:44978, p75:46697 },
      { Ecole:"Toulouse INP ENSIACET", p25:42714, p50:44978, p75:46697 },
      { Ecole:"UTC", p25:43177, p50:45658, p75:47442 },
      { Ecole:"Hors liste", p25:41840, p50:43726, p75:45414 }
    ];

    // 30 √âcoles de commerce
    const schoolsCommerce = [
      {Ecole:"HEC Paris", p25:45600, p50:52250, p75:61750},
      {Ecole:"ESSEC Business School", p25:42750, p50:49400, p75:58900},
      {Ecole:"ESCP Business School", p25:41800, p50:48450, p75:57000},
      {Ecole:"EDHEC Business School", p25:39900, p50:46600, p75:55100},
      {Ecole:"emlyon Business School", p25:40850, p50:47500, p75:56050},
      {Ecole:"Audencia Business School", p25:38000, p50:44650, p75:53200},
      {Ecole:"Skema Business School", p25:36100, p50:42750, p75:50350},
      {Ecole:"NEOMA Business School", p25:35150, p50:41800, p75:49400},
      {Ecole:"Kedge Business School", p25:33250, p50:39900, p75:47500},
      {Ecole:"TBS Education", p25:34200, p50:40850, p75:48450},
      {Ecole:"Grenoble EM", p25:35150, p50:41800, p75:49400},
      {Ecole:"Montpellier BS", p25:33250, p50:39900, p75:47500},
      {Ecole:"Rennes SB", p25:32300, p50:38950, p75:46550},
      {Ecole:"ICN Business School", p25:32300, p50:38000, p75:45600},
      {Ecole:"EM Strasbourg", p25:32300, p50:38000, p75:45600},
      {Ecole:"Excelia Business School", p25:31350, p50:37050, p75:44650},
      {Ecole:"ISC Paris", p25:31350, p50:37050, p75:43700},
      {Ecole:"INSEEC Grande √âcole", p25:30400, p50:36100, p75:42750},
      {Ecole:"PSB (Paris School of Business)", p25:30400, p50:36100, p75:42750},
      {Ecole:"EMLV", p25:30000, p50:36500, p75:43000},
      {Ecole:"ISG", p25:29450, p50:35150, p75:40850},
      {Ecole:"ESC Clermont BS", p25:29450, p50:34200, p75:39900},
      {Ecole:"Burgundy School of Business", p25:29450, p50:34200, p75:39900},
      {Ecole:"IMT-BS", p25:28500, p50:34200, p75:39900},
      {Ecole:"ESC Pau Business School", p25:28500, p50:33300, p75:38950},
      {Ecole:"SCBS", p25:28500, p50:33300, p75:38000},
      {Ecole:"Brest Business School", p25:27550, p50:32300, p75:37050},
      {Ecole:"ISCID-CO", p25:26600, p50:31350, p75:36100},
      {Ecole:"ICD Business School", p25:26600, p50:31350, p75:36100},
      {Ecole:"ESLSCA Business School Paris", p25:26600, p50:31350, p75:36100}
    ];

    // 10 Sciences Po
    const schoolsScPo = [
      {Ecole:"Sciences Po Paris", p25:35000, p50:39000, p75:44000},
      {Ecole:"Sciences Po Bordeaux", p25:32500, p50:35500, p75:40500},
      {Ecole:"Sciences Po Grenoble", p25:33000, p50:35500, p75:40500},
      {Ecole:"Sciences Po Lille", p25:32500, p50:35500, p75:40500},
      {Ecole:"Sciences Po Lyon", p25:33000, p50:36000, p75:41000},
      {Ecole:"Sciences Po Rennes", p25:31500, p50:34500, p75:39500},
      {Ecole:"Sciences Po Strasbourg", p25:32000, p50:35000, p75:40000},
      {Ecole:"Sciences Po Toulouse", p25:32000, p50:35000, p75:40000},
      {Ecole:"Sciences Po Saint-Germain-en-Laye", p25:30500, p50:33500, p75:38500},
      {Ecole:"Sciences Po Aix", p25:31500, p50:34500, p75:39500}
    ];

    // 20 Universit√©s
    const schoolsUniversite = [
      {Ecole:"Sorbonne Universit√©", p25:33250, p50:37000, p75:40850},
      {Ecole:"Universit√© Paris-Saclay", p25:33250, p50:37000, p75:40850},
      {Ecole:"Universit√© PSL", p25:33250, p50:37500, p75:41350},
      {Ecole:"Universit√© Paris Cit√©", p25:32300, p50:36100, p75:39900},
      {Ecole:"Universit√© de Montpellier", p25:31800, p50:35600, p75:39400},
      {Ecole:"Universit√© de Strasbourg", p25:31800, p50:35600, p75:39400},
      {Ecole:"Universit√© Grenoble Alpes", p25:31800, p50:35600, p75:39400},
      {Ecole:"Aix-Marseille Universit√©", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Bordeaux", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Lyon", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Lille", p25:30800, p50:34600, p75:38400},
      {Ecole:"Universit√© Toulouse III", p25:30800, p50:34600, p75:38400},
      {Ecole:"Universit√© de Nantes", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© de Rennes 1", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© de Lorraine", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© C√¥te d'Azur", p25:30500, p50:34500, p75:38500},
      {Ecole:"Universit√© de Tours", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© d'Angers", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© de Clermont Auvergne", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© de Reims", p25:29000, p50:32800, p75:36600}
    ];

    // 33 √âcoles IT
    const schoolsIT = [
      { Ecole:"√âcole 42", p25:30000, p50:35000, p75:42000 },
      { Ecole:"EPITA", p25:34000, p50:39000, p75:46000 },
      { Ecole:"Epitech", p25:33000, p50:38000, p75:45000 },
      { Ecole:"ENSIMAG / Grenoble INP", p25:35000, p50:40000, p75:47000 },
      { Ecole:"T√©l√©com Paris", p25:36000, p50:42000, p75:50000 },
      { Ecole:"T√©l√©com SudParis", p25:32000, p50:37000, p75:44000 },
      { Ecole:"T√©l√©com Nancy", p25:30000, p50:35000, p75:40000 },
      { Ecole:"INSA Lyon (informatique)", p25:32000, p50:37000, p75:43000 },
      { Ecole:"INSA Toulouse (informatique)", p25:31000, p50:36000, p75:42000 },
      { Ecole:"INSA Rennes (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"INSA Strasbourg (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"INSA Rouen (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"EFREI Paris", p25:30000, p50:35000, p75:42000 },
      { Ecole:"ISEP Paris", p25:30000, p50:35000, p75:42000 },
      { Ecole:"ESGI", p25:28000, p50:33000, p75:39000 },
      { Ecole:"EfreiTech", p25:27000, p50:32000, p75:37000 },
      { Ecole:"Polytech Grenoble (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Polytech Lyon (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Universit√© Paris Cit√© (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Strasbourg (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Bordeaux (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Lille (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Sup√©lec / Centrale (info)", p25:35000, p50:41000, p75:48000 },
      { Ecole:"IUT Informatique", p25:26000, p50:30000, p75:35000 },
      { Ecole:"Licence Info (Sorbonne/Saclay)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"IESA / EIGSI Info", p25:27000, p50:32000, p75:38000 },
      { Ecole:"ESEO Angers (info)", p25:28000, p50:33000, p75:39000 },
      { Ecole:"ENIB Brest (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Data ScienceTech Institute", p25:30000, p50:35000, p75:42000 },
      { Ecole:"IA School Paris", p25:28000, p50:33000, p75:40000 },
      { Ecole:"Supinfo", p25:26000, p50:30000, p75:36000 },
      { Ecole:"YNOV Informatique", p25:27000, p50:32000, p75:38000 },
      { Ecole:"YNOV Cyber-s√©curit√©", p25:28000, p50:33000, p75:40000 }
    ];

    // 9 √âcoles Design
    const schoolsDesign = [
      { Ecole:"Strate √âcole de Design", p25:32000, p50:36000, p75:40000 },
      { Ecole:"ENSAD (Arts D√©cos)", p25:32000, p50:36000, p75:40000 },
      { Ecole:"√âcole Estienne", p25:32000, p50:36000, p75:40000 },
      { Ecole:"√âcole de Design Nantes Atlantique", p25:32000, p50:36000, p75:40000 },
      { Ecole:"Gobelins", p25:32000, p50:36000, p75:40000 },
      { Ecole:"ENSCI-Les Ateliers", p25:25000, p50:30000, p75:35000 },
      { Ecole:"LISAA", p25:32000, p50:36000, p75:40000 },
      { Ecole:"Universit√© (arts appliqu√©s)", p25:27000, p50:31000, p75:35000 },
      { Ecole:"Hors liste Design", p25:28000, p50:32000, p75:36000 }
    ];

    // 11 √âcoles Communication
    const schoolsCom = [
      { Ecole:"CELSA", p25:33250, p50:37000, p75:40850 },
      { Ecole:"ISCOM", p25:30000, p50:33000, p75:37000 },
      { Ecole:"Sup de Pub (INSEEC)", p25:28000, p50:31000, p75:35000 },
      { Ecole:"EFAP", p25:28000, p50:31000, p75:34000 },
      { Ecole:"ESP", p25:27000, p50:30000, p75:33000 },
      { Ecole:"ISEG", p25:27000, p50:30000, p75:33000 },
      { Ecole:"ECS", p25:26000, p50:29000, p75:32000 },
      { Ecole:"Sup de Com", p25:27000, p50:30000, p75:34000 },
      { Ecole:"Audencia SciencesCom", p25:31000, p50:34000, p75:38000 },
      { Ecole:"ISCPA", p25:26000, p50:29000, p75:32000 },
      { Ecole:"Hors liste Communication", p25:25000, p50:28000, p75:31000 }
    ];

    // 17 √âcoles RH
    const schoolsRH = [
      { Ecole:"IGS RH", p25:31350, p50:35150, p75:40850 },
      { Ecole:"ESGRH", p25:30400, p50:34200, p75:39900 },
      { Ecole:"Sup des RH", p25:28500, p50:32300, p75:38000 },
      { Ecole:"ISFOGEP", p25:29450, p50:33250, p75:38000 },
      { Ecole:"ICD Business School (RH)", p25:29450, p50:33250, p75:38950 },
      { Ecole:"ESSCA RH & Management", p25:30400, p50:34200, p75:39900 },
      { Ecole:"ISCG Paris (RH & Paie)", p25:28500, p50:32300, p75:37050 },
      { Ecole:"IAE Paris-Sorbonne (Master RH)", p25:32300, p50:36100, p75:42750 },
      { Ecole:"IAE Lyon (Master GRH)", p25:31350, p50:35150, p75:40850 },
      { Ecole:"IAE Aix-Marseille (Master RH)", p25:31350, p50:36100, p75:41800 },
      { Ecole:"IAE Grenoble (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"IAE Lille (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"IAE Nantes (Master GRH)", p25:29450, p50:33250, p75:38950 },
      { Ecole:"IAE Nice (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"Toulouse School of Management", p25:30400, p50:34200, p75:38950 },
      { Ecole:"Hors liste RH", p25:26600, p50:30400, p75:35150 }
    ];

    // Regroupement
    const allSchools = {
      ingenieur: schoolsIngenieur,
      commerce: schoolsCommerce,
      scpo: schoolsScPo,
      universite: schoolsUniversite,
      it: schoolsIT,
      design: schoolsDesign,
      fonction: [...schoolsCom, ...schoolsRH]
    };
    
    // Coefficients sous-domaines techniques
    const subdomainCoef = {
      "Calculs & Simulation": 1.05,
      "Conception": 1.02,
      "√âlectronique": 1.04,
      "Avionique": 1.04,
      "Mat√©riaux": 1.02,
      "Propulsion": 1.04,
      "M√©thodes": 1.00,
      "Production": 1.00,
      "Maintenance": 0.98,
      "Qualit√©": 1.02,
      "Supply Chain": 1.02,
      "Gestion de Projet": 1.03,
      "Ing√©nierie Syst√®mes": 1.04,
      "Gestion de Programme": 1.04,
      "Support Client": 0.96,
      "Thermique": 1.06,
      "Dynamique de Vol": 1.06,
      "√âlectrique": 1.06,
      "Test": 1.01
    };
    
    // ===============================
    // M√âTIERS PAR SECTEUR
    // ===============================

    // M√©tiers IT
    const functionsIT = {
      "D√©veloppeur Front-End": { p25: 30000, p50: 38000, p75: 46000 },
      "D√©veloppeur Back-End": { p25: 32000, p50: 40000, p75: 48000 },
      "D√©veloppeur Full-Stack": { p25: 33000, p50: 42000, p75: 52000 },
      "Data Engineer": { p25: 35000, p50: 45000, p75: 58000 },
      "Data Scientist": { p25: 37000, p50: 48000, p75: 62000 },
      "DevOps / SRE": { p25: 36000, p50: 47000, p75: 60000 },
      "Infra / R√©seau": { p25: 32000, p50: 42000, p75: 54000 },
      "Cloud Architect": { p25: 45000, p50: 60000, p75: 80000 },
      "Cybersecurity Engineer": { p25: 38000, p50: 42000, p75: 46000 },
      "Admin Syst√®mes": { p25: 31000, p50: 40000, p75: 52000 },
      "Product Owner": { p25: 42000, p50: 49000, p75: 58000 },
      "Product Manager": { p25: 50000, p50: 60000, p75: 75000 }
    };

    // M√©tiers Design
    const functionsDesign = {
      "UX Designer": { p25: 30000, p50: 38000, p75: 48000 },
      "UI Designer": { p25: 32000, p50: 40000, p75: 50000 },
      "UX/UI Designer": { p25: 35000, p50: 42000, p75: 50000 },
      "Product Designer": { p25: 33000, p50: 42000, p75: 55000 },
      "Motion Designer": { p25: 28000, p50: 35000, p75: 45000 },
      "Graphiste / Branding": { p25: 26000, p50: 33000, p75: 42000 },
      "Interaction Designer": { p25: 30000, p50: 38000, p75: 47000 }
    };

    // Achats
    const functionsAchats = {
      "Acheteur Junior": { p25: 38000, p50: 42000, p75: 47000 },
      "Acheteur Confirm√©": { p25: 45000, p50: 50000, p75: 55000 },
      "Responsable Achats": { p25: 55000, p50: 65000, p75: 80000 },
      "Directeur Achats": { p25: 80000, p50: 95000, p75: 120000 }
    };

    // Immobilier
    const functionsImmo = {
      "Charg√© de Gestion Immobili√®re": { p25: 32000, p50: 38000, p75: 45000 },
      "Property Manager": { p25: 40000, p50: 52000, p75: 65000 },
      "Responsable Immobilier": { p25: 55000, p50: 72000, p75: 90000 },
      "Directeur Immobilier": { p25: 80000, p50: 100000, p75: 125000 }
    };

    // Ressources Humaines
    const functionsRH = {
      "Charg√© RH": { p25: 34000, p50: 39000, p75: 45000 },
      "Talent Acquisition": { p25: 33000, p50: 37000, p75: 42000 },
      "Senior Talent Acquisition": { p25: 42000, p50: 48000, p75: 54000 },
      "Talent Acquisition Manager": { p25: 50000, p50: 58000, p75: 66000 },
      "Responsable RH / HRBP": { p25: 47000, p50: 55250, p75: 66000 },
      "Directeur des Ressources Humaines": { p25: 70000, p50: 95000, p75: 120000 }
    };

    // Finance
    const functionsFinance = {
      "Comptable": { p25: 32000, p50: 37000, p75: 42000 },
      "Contr√¥leur de Gestion": { p25: 42000, p50: 49400, p75: 60000 },
      "Auditeur Interne": { p25: 40000, p50: 47000, p75: 55000 },
      "Tr√©sorier": { p25: 45000, p50: 52000, p75: 60000 },
      "Responsable Financier": { p25: 55000, p50: 65000, p75: 80000 },
      "Directeur Administratif et Financier (DAF)": { p25: 80000, p50: 110000, p75: 140000 }
    };

    // Commerciaux
    const functionsCommerciaux = {
      "Business Developer Junior": { p25: 30000, p50: 35000, p75: 40000 },
      "Business Developer Confirm√©": { p25: 38000, p50: 42000, p75: 48000 },
      "Ing√©nieur d'Affaires": { p25: 45000, p50: 50000, p75: 60000 },
      "Responsable Commercial": { p25: 55000, p50: 60000, p75: 75000 },
      "Directeur Commercial": { p25: 75000, p50: 85000, p75: 110000 }
    };

    // Communication
    const functionsCommunication = {
      "Charg√© de communication": { p25: 28000, p50: 32000, p75: 37000 },
      "Responsable de communication": { p25: 40000, p50: 46000, p75: 52000 },
      "Directeur de la communication": { p25: 65000, p50: 75000, p75: 90000 }
    };

    // Ing√©nieurs Ops
    const functionsOps = {
      "Ing√©nieur Op√©ration": { p25: 35500, p50: 38500, p75: 44000 },
      "Ing√©nieur Op√©ration Senior": { p25: 62000, p50: 68900, p75: 78000 },
      "Ing√©nieur Mission": { p25: 38500, p50: 42000, p75: 47000 },
      "Ing√©nieur Mission Senior": { p25: 68000, p50: 73950, p75: 83000 }
    };

    // Regroupement de toutes les fonctions
    const allFunctions = {
      ...functionsIT,
      ...functionsDesign,
      ...functionsAchats,
      ...functionsImmo,
      ...functionsRH,
      ...functionsFinance,
      ...functionsCommerciaux,
      ...functionsCommunication,
      ...functionsOps
    };

    // ===== GESTION DES TABS =====
    let currentTab = 'simulator';

    function switchTab(tab) {
      currentTab = tab;
      
      document.getElementById('tab-simulator').className = tab === 'simulator' ? 
        'tab-active px-6 py-3 rounded-xl font-semibold transition-all duration-300' : 
        'tab-inactive px-6 py-3 rounded-xl font-semibold transition-all duration-300';
      
      document.getElementById('tab-comparator').className = tab === 'comparator' ? 
        'tab-active px-6 py-3 rounded-xl font-semibold transition-all duration-300' : 
        'tab-inactive px-6 py-3 rounded-xl font-semibold transition-all duration-300';
      
      document.getElementById('content-simulator').classList.toggle('hidden', tab !== 'simulator');
      document.getElementById('content-comparator').classList.toggle('hidden', tab !== 'comparator');

      if (tab === 'comparator') {
        populateSchoolsComparator();
        calculateComparison();
      }
    }

    // ===== DARK MODE =====
    function toggleDarkMode() {
      document.documentElement.classList.toggle('dark');
    }

    // ===== D√âTECTION MOBILE & OPTIMISATIONS =====
    function isMobile() {
      return window.innerWidth <= 768;
    }

    function isSmallMobile() {
      return window.innerWidth <= 640;
    }

    // Ajuster la hauteur du graphique selon device
    function adjustChartHeight() {
      const canvas = document.getElementById('salaryChart');
      if (canvas && isMobile()) {
        canvas.style.maxHeight = '250px';
      }
    }

    // Scroll smooth vers r√©sultat sur mobile
    function scrollToResult(elementId) {
      if (isMobile()) {
        const element = document.getElementById(elementId);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    }

    // Optimiser les events touch pour les sliders
    function optimizeSliders() {
      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        // Touch events pour mobile
        slider.addEventListener('touchstart', function() {
          this.classList.add('active-slider');
        }, { passive: true });

        slider.addEventListener('touchend', function() {
          this.classList.remove('active-slider');
        }, { passive: true });
      });
    }

    // Pr√©venir le zoom accidentel sur double-tap
    function preventDoubleTabZoom() {
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);
    }

    // Feedback visuel pour les touches
    function addTouchFeedback() {
      const touchElements = document.querySelectorAll('button, select, input[type="range"]');
      touchElements.forEach(elem => {
        elem.addEventListener('touchstart', function() {
          this.style.opacity = '0.7';
        }, { passive: true });

        elem.addEventListener('touchend', function() {
          setTimeout(() => {
            this.style.opacity = '1';
          }, 100);
        }, { passive: true });
      });
    }
    
    // ===== CALCUL SALAIRE (logique compl√®te) =====
    function calculateSalaryForProfile(profile) {
      const schools = allSchools[profile.sector] || [];
      const school = schools[profile.school];
      
      if (!school) return null;

      let { p25, p50, p75 } = school;
      
      // ===== INT√âGRATION M√âTIER (si s√©lectionn√©) =====
      if (profile.jobFunction && allFunctions[profile.jobFunction]) {
        const jobData = allFunctions[profile.jobFunction];
        // Pond√©ration : 50% √©cole + 50% m√©tier
        p25 = (p25 * 0.5) + (jobData.p25 * 0.5);
        p50 = (p50 * 0.5) + (jobData.p50 * 0.5);
        p75 = (p75 * 0.5) + (jobData.p75 * 0.5);
      }

      // Exp√©rience (+2.3%/an)
      const expFactor = Math.pow(1.023, profile.experience);
      p25 *= expFactor;
      p50 *= expFactor;
      p75 *= expFactor;

      // Coefficients individuels
      const educationCoef = {
        technicien: 0.80, bac3: 0.89, bac5: 1.00, doctorat: 1.07
      }[profile.educationLevel] || 1;

      const englishCoef = {
        basic: 1.00, intermediate: 1.03, advanced: 1.06, bilingual: 1.10
      }[profile.englishLevel] || 1;

      const contractCoef = {
        cdi: 1.00, cdd: 0.96, alternance: 0.70, freelance: 1.20, expatriation: 1.15
      }[profile.contractType] || 1;

      const industryCoef = {
        aero: 1.04, auto: 1.00, energie: 1.02, numerique: 1.05, sante: 1.04, luxe: 1.05, public: 0.88
      }[profile.industry] || 1;

      const teamCoef = {
        none: 1.00, small: 1.05, medium: 1.10, large: 1.18, xl: 1.25
      }[profile.teamSize] || 1;

      const packageCoef = {
        standard: 1.00, bonus: 1.07, bonusplus: 1.18, actions: 1.30
      }[profile.packageLevel] || 1;

      const regionCoef = profile.region === 'IDF' ? 1.14 : 1.00;
      
      const sizeCoef = {
        'startup': 0.95, 'PME': 0.96, 'ETI': 1.00, 'grand-groupe': 1.06
      }[profile.companySize] || 1;
      
      // Sous-domaine technique
      const subdomainCoefValue = subdomainCoef[profile.subdomain] || 1;

      // Classification
      let classCoef = 1;
      if (profile.classification === 'M1') classCoef = 1.10;
      if (profile.classification === 'M2') classCoef = 1.15;
      if (profile.classification === 'M3') classCoef = 1.20;
      if (profile.classification === 'I1') classCoef = 0.95;
      if (profile.classification === 'I2') classCoef = 1.00;
      if (profile.classification === 'I3') classCoef = 1.10;
      if (profile.classification === 'I4') classCoef = 1.20;

      // Moyenne g√©om√©trique des raffinements
      const refinements = [educationCoef, englishCoef, contractCoef, industryCoef, teamCoef];
      const geoMean = Math.pow(refinements.reduce((a, b) => a * b, 1), 1 / refinements.length);
      const refinementCoef = Math.min(Math.max(geoMean, 0.85), 1.25);

      // Source
      let sourceCoef = 1;
      if (profile.source === 'fw') sourceCoef = 0.95;
      if (profile.source === 'croisee') sourceCoef = 0.97;

      const median = p50 * regionCoef * sizeCoef * classCoef * refinementCoef * packageCoef * sourceCoef * subdomainCoefValue;
      const low = p25 * regionCoef * sizeCoef * classCoef * refinementCoef * packageCoef * sourceCoef * subdomainCoefValue;
      const high = p75 * regionCoef * sizeCoef * classCoef * refinementCoef * packageCoef * sourceCoef * subdomainCoefValue;

      return { median, low, high };
    }

    // ===== POPULATE SCHOOLS + AFFICHER FOURCHETTES =====
    function populateSchools() {
      const sector = document.getElementById('sector').value;
      const schoolSel = document.getElementById('school');
      schoolSel.innerHTML = '';
      
      const schools = allSchools[sector] || [];
      schools.forEach((s, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = s.Ecole;
        schoolSel.appendChild(opt);
      });
      
      updateSchoolInfo();
      calculateSimulator();
    }

    function updateSchoolInfo() {
      const sector = document.getElementById('sector').value;
      const schoolIndex = parseInt(document.getElementById('school').value);
      const schools = allSchools[sector] || [];
      const school = schools[schoolIndex];

      if (school) {
        document.getElementById('schoolP25').textContent = Math.round(school.p25).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP50').textContent = Math.round(school.p50).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP75').textContent = Math.round(school.p75).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolInfo').classList.add('show');
      }
    }

    function populateSchoolsComparator() {
      ['A', 'B'].forEach(profile => {
        const sector = document.getElementById('sector' + profile).value;
        const schoolSel = document.getElementById('school' + profile);
        schoolSel.innerHTML = '';
        
        const schools = allSchools[sector] || [];
        schools.forEach((s, i) => {
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = s.Ecole;
          schoolSel.appendChild(opt);
        });

        updateSchoolInfoComparator(profile);
      });
    }

    function updateSchoolInfoComparator(profile) {
      const sector = document.getElementById('sector' + profile).value;
      const schoolIndex = parseInt(document.getElementById('school' + profile).value);
      const schools = allSchools[sector] || [];
      const school = schools[schoolIndex];

      if (school) {
        document.getElementById('schoolP25' + profile).textContent = Math.round(school.p25).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP50' + profile).textContent = Math.round(school.p50).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP75' + profile).textContent = Math.round(school.p75).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolInfo' + profile).classList.add('show');
      }
    }

// ===== CALCUL SIMULATEUR =====
    let chart;
    function calculateSimulator() {
      const profile = {
        sector: document.getElementById('sector').value,
        school: parseInt(document.getElementById('school').value),
        experience: parseInt(document.getElementById('experience').value),
        region: document.getElementById('region').value,
        companySize: document.getElementById('companySize').value,
        classification: document.getElementById('classification').value,
        educationLevel: document.getElementById('educationLevel').value,
        englishLevel: document.getElementById('englishLevel').value,
        contractType: document.getElementById('contractType').value,
        industry: document.getElementById('industry').value,
        teamSize: document.getElementById('teamSize').value,
        packageLevel: document.getElementById('packageLevel').value,
        subdomain: document.getElementById('subdomain').value,
        jobFunction: document.getElementById('jobFunction').value,
        source: document.getElementById('source').value
      
        
      };

      const result = calculateSalaryForProfile(profile);
      
      if (!result) return;

      document.getElementById('median').textContent = Math.round(result.median).toLocaleString() + ' ‚Ç¨';
      document.getElementById('low').textContent = Math.round(result.low).toLocaleString() + ' ‚Ç¨';
      document.getElementById('high').textContent = Math.round(result.high).toLocaleString() + ' ‚Ç¨';
      
      document.getElementById('result').classList.remove('hidden');


      // Graphique
      const ctx = document.getElementById('salaryChart').getContext('2d');
      if (chart) chart.destroy();
      
      const years = [...Array(41).keys()];
      const projection = years.map(y => result.median * Math.pow(1.023, y));
      
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: [{
            label: 'Salaire projet√© (‚Ç¨)',
            data: projection,
            borderColor: '#00AEEF',
            backgroundColor: 'rgba(0, 174, 239, 0.1)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: !isMobile(), // D√©sactiver ratio fixe sur mobile
          plugins: { 
            legend: { 
              display: true,
              labels: {
                font: {
                  size: isMobile() ? 10 : 12
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value) {
                  return value.toLocaleString() + ' ‚Ç¨';
                },
                font: {
                  size: isMobile() ? 9 : 11
                }
              }
            },
            x: {
              ticks: {
                font: {
                  size: isMobile() ? 9 : 11
                }
              }
            }
          }
        }
      });

      adjustChartHeight();
      
     // ===== G√âN√âRER L'ANALYSE D√âTAILL√âE =====
      generateDetailedAnalysis(profile, result);
    }

// ===== ANALYSE D√âTAILL√âE DU PROFIL =====
    function generateDetailedAnalysis(profile, result) {
      const schools = allSchools[profile.sector] || [];
      const school = schools[profile.school];

      // 1. POSITIONNEMENT MARCH√â
      let marketAnalysis = '';
      if (result.median < 35000) {
        marketAnalysis = `Avec un salaire m√©dian de ${Math.round(result.median).toLocaleString()} ‚Ç¨, ton profil se situe dans la tranche basse du march√©. Cela correspond g√©n√©ralement √† un d√©but de carri√®re ou √† un secteur moins r√©mun√©rateur.`;
      } else if (result.median < 45000) {
        marketAnalysis = `Ton salaire m√©dian de ${Math.round(result.median).toLocaleString()} ‚Ç¨ correspond √† un profil junior √† interm√©diaire. Tu es dans la moyenne du march√© fran√ßais pour ton niveau.`;
      } else if (result.median < 60000) {
        marketAnalysis = `Avec ${Math.round(result.median).toLocaleString()} ‚Ç¨ de salaire m√©dian, tu te situes au-dessus de la moyenne nationale. C'est un bon positionnement qui refl√®te une expertise ou un secteur valorisant.`;
      } else if (result.median < 80000) {
        marketAnalysis = `Excellent positionnement ! Ton salaire m√©dian de ${Math.round(result.median).toLocaleString()} ‚Ç¨ te place dans le top 20% du march√© fran√ßais. Cela t√©moigne d'une forte valeur ajout√©e.`;
      } else {
        marketAnalysis = `Profil exceptionnel ! Avec ${Math.round(result.median).toLocaleString()} ‚Ç¨ de salaire m√©dian, tu fais partie des profils les mieux r√©mun√©r√©s en France (top 5%). Cela correspond g√©n√©ralement √† des postes de direction ou d'expertise rare.`;
      }
      document.getElementById('analysis-market').textContent = marketAnalysis;

      // 2. FACTEURS VALORISANTS
      const positiveFactors = [];
      
      if (school && school.p50 > 45000) {
        positiveFactors.push(`√âcole prestigieuse (${school.Ecole}) avec un salaire de sortie √©lev√© (${Math.round(school.p50).toLocaleString()} ‚Ç¨)`);
      }
      
      // ===== AJOUT M√âTIER =====
      if (profile.jobFunction && allFunctions[profile.jobFunction]) {
        const jobData = allFunctions[profile.jobFunction];
        if (jobData.p50 > 45000) {
          positiveFactors.push(`M√©tier valoris√© : ${profile.jobFunction} (m√©dian march√© ${Math.round(jobData.p50).toLocaleString()} ‚Ç¨)`);
        }
      } 
      
      if (profile.experience > 10) {
        positiveFactors.push(`Exp√©rience significative (${profile.experience} ans) qui valorise fortement ton profil`);
      }
      
      if (profile.region === 'IDF') {
        positiveFactors.push('Localisation √éle-de-France (+14% de prime r√©gionale)');
      }
      
      if (profile.englishLevel === 'bilingual' || profile.englishLevel === 'advanced') {
        positiveFactors.push(`Niveau d'anglais ${profile.englishLevel === 'bilingual' ? 'bilingue' : 'avanc√©'} (fort atout international)`);
      }
      
      if (profile.classification && profile.classification.startsWith('M')) {
        positiveFactors.push(`Poste manag√©rial (${profile.classification}) avec responsabilit√©s d'√©quipe`);
      }
      
      if (profile.teamSize === 'large' || profile.teamSize === 'xl') {
        positiveFactors.push(`Management d'une grande √©quipe (${profile.teamSize === 'xl' ? '50+' : '16-50'} personnes)`);
      }
      
      if (profile.packageLevel === 'actions' || profile.packageLevel === 'bonusplus') {
        positiveFactors.push(`Package r√©mun√©ration avantageux (${profile.packageLevel === 'actions' ? 'actions/BSPCE' : 'variable 15-25%'})`);
      }
      
      if (profile.subdomain && subdomainCoef[profile.subdomain] > 1.03) {
        positiveFactors.push(`Sp√©cialisation technique valoris√©e : ${profile.subdomain} (+${Math.round((subdomainCoef[profile.subdomain] - 1) * 100)}%)`);
      }
      
      if (profile.companySize === 'grand-groupe') {
        positiveFactors.push('Grand groupe (+6% de stabilit√© et avantages sociaux)');
      }

      const positiveHTML = positiveFactors.length > 0 
        ? positiveFactors.map(f => `<li>${f}</li>`).join('') 
        : '<li>Profil standard sans facteurs exceptionnels identifi√©s</li>';
      document.getElementById('analysis-positive').innerHTML = positiveHTML;

      // 3. POINTS D'ATTENTION
      const attentionPoints = [];
      
      if (profile.experience < 3) {
        attentionPoints.push('D√©but de carri√®re : la progression salariale sera rapide dans les 5 prochaines ann√©es');
      }
      
      // ===== AJOUT M√âTIER =====
      if (profile.jobFunction && allFunctions[profile.jobFunction]) {
        const jobData = allFunctions[profile.jobFunction];
        if (jobData.p50 < 35000) {
          attentionPoints.push(`M√©tier ${profile.jobFunction} : salaire d'entr√©e modeste (m√©dian ${Math.round(jobData.p50).toLocaleString()} ‚Ç¨), mais √©volution possible avec l'exp√©rience`);
        }
      }
      
      if (profile.region === 'hors') {
        attentionPoints.push('Localisation hors IDF : salaire ajust√© au co√ªt de la vie local (-14% vs Paris)');
      }
      
      if (profile.englishLevel === 'basic') {
        attentionPoints.push('Niveau d\'anglais basique : investir dans la formation linguistique pourrait augmenter ton potentiel (+10%)');
      }
      
      if (profile.companySize === 'startup') {
        attentionPoints.push('Startup : salaire d\'entr√©e inf√©rieur mais potentiel de croissance rapide (actions, promotions)');
      }
      
      if (profile.contractType === 'cdd') {
        attentionPoints.push('CDD : salaire l√©g√®rement inf√©rieur au CDI (-4%), viser une stabilisation en CDI');
      }
      
      if (profile.subdomain && subdomainCoef[profile.subdomain] < 1.00) {
        attentionPoints.push(`Sp√©cialisation moins valoris√©e : ${profile.subdomain} (${Math.round((subdomainCoef[profile.subdomain] - 1) * 100)}%)`);
      }
      
      if (profile.teamSize === 'none' && profile.experience > 5) {
        attentionPoints.push('Pas de management d\'√©quipe : envisager d\'√©voluer vers des responsabilit√©s manag√©riales pour booster ton salaire');
      }

      if (attentionPoints.length === 0) {
        attentionPoints.push('Profil bien √©quilibr√© sans points bloquants majeurs identifi√©s');
      }

      const attentionHTML = attentionPoints.map(p => `<li>${p}</li>`).join('');
      document.getElementById('analysis-attention').innerHTML = attentionHTML;

      // 4. PROJECTION CARRI√àRE
      const salary5y = Math.round(result.median * Math.pow(1.023, 5));
      const salary10y = Math.round(result.median * Math.pow(1.023, 10));
      const salary20y = Math.round(result.median * Math.pow(1.023, 20));
      
      const projectionHTML = `
        <p><strong>Dans 5 ans :</strong> ${salary5y.toLocaleString()} ‚Ç¨ (progression +${Math.round(((salary5y/result.median)-1)*100)}%)</p>
        <p><strong>Dans 10 ans :</strong> ${salary10y.toLocaleString()} ‚Ç¨ (progression +${Math.round(((salary10y/result.median)-1)*100)}%)</p>
        <p><strong>Dans 20 ans :</strong> ${salary20y.toLocaleString()} ‚Ç¨ (progression +${Math.round(((salary20y/result.median)-1)*100)}%)</p>
        <p class="mt-2 text-xs italic">Projection bas√©e sur une augmentation annuelle moyenne de 2,3% (hors promotions et changements de poste)</p>
      `;
      document.getElementById('analysis-projection').innerHTML = projectionHTML;

      // 5. RECOMMANDATIONS
      const recommendations = [];
      
      if (profile.experience < 5 && profile.englishLevel !== 'bilingual') {
        recommendations.push('Investir dans la certification anglais (TOEIC 900+ ou √©quivalent) pour d√©bloquer +10% de potentiel');
      }
      
       // ===== AJOUT M√âTIER =====
      if (!profile.jobFunction) {
        recommendations.push('Sp√©cialise-toi dans un m√©tier pr√©cis pour mieux te positionner sur le march√© et n√©gocier ton salaire');
      } else if (profile.jobFunction && allFunctions[profile.jobFunction]) {
        const jobData = allFunctions[profile.jobFunction];
        if (jobData.p50 < 40000 && profile.experience > 3) {
          recommendations.push(`Avec ${profile.experience} ans d'exp√©rience en ${profile.jobFunction}, envisage une √©volution vers un poste de management ou de sp√©cialisation pour augmenter ton salaire`);
        }
      }
      
      
      if (profile.companySize === 'startup' && profile.experience > 5) {
        recommendations.push('Avec ton exp√©rience, envisager un passage en ETI/Grand Groupe pour s√©curiser et augmenter ton salaire (+10-15%)');
      }
      
      if (profile.region === 'hors' && result.median > 50000) {
        recommendations.push('Ton profil pourrait pr√©tendre √† +14% en IDF si tu es mobile g√©ographiquement');
      }
      
      if (profile.teamSize === 'none' && profile.experience > 3) {
        recommendations.push('√âvoluer vers un poste avec management d\'√©quipe (m√™me petite) pour acc√©l√©rer ta progression (+10-20%)');
      }
      
      if (profile.packageLevel === 'standard') {
        recommendations.push('N√©gocier un variable ou des actions lors de ta prochaine √©volution (+7 √† +30% de package total)');
      }
      
      if (recommendations.length === 0) {
        recommendations.push('Continue sur ta lanc√©e ! Ton profil est bien optimis√©. Vise des certifications techniques ou un √©largissement de p√©rim√®tre pour la prochaine √©tape.');
      }

      const recommendationsHTML = recommendations.map(r => `<li>${r}</li>`).join('');
      document.getElementById('analysis-recommendations').innerHTML = recommendationsHTML;
    }
    
    // ===== CALCUL COMPARATEUR + ANALYSE PEAUFIN√âE =====
    function calculateComparison() {
      const profileA = {
        sector: document.getElementById('sectorA').value,
        school: parseInt(document.getElementById('schoolA').value),
        experience: parseInt(document.getElementById('experienceA').value),
        region: document.getElementById('regionA').value,
        companySize: document.getElementById('companySizeA').value,
        classification: document.getElementById('classificationA').value,
        educationLevel: document.getElementById('educationLevelA').value,
        englishLevel: document.getElementById('englishLevelA').value,
        contractType: document.getElementById('contractTypeA').value,
        industry: document.getElementById('industryA').value,
        teamSize: document.getElementById('teamSizeA').value,
        packageLevel: document.getElementById('packageLevelA').value,
        jobFunction: document.getElementById('jobFunctionA').value,
        source: document.getElementById('sourceA').value
      };

      const profileB = {
        sector: document.getElementById('sectorB').value,
        school: parseInt(document.getElementById('schoolB').value),
        experience: parseInt(document.getElementById('experienceB').value),
        region: document.getElementById('regionB').value,
        companySize: document.getElementById('companySizeB').value,
        classification: document.getElementById('classificationB').value,
        educationLevel: document.getElementById('educationLevelB').value,
        englishLevel: document.getElementById('englishLevelB').value,
        contractType: document.getElementById('contractTypeB').value,
        industry: document.getElementById('industryB').value,
        teamSize: document.getElementById('teamSizeB').value,
        packageLevel: document.getElementById('packageLevelB').value,
        jobFunction: document.getElementById('jobFunctionB').value,
        source: document.getElementById('sourceB').value
      };

      const resultA = calculateSalaryForProfile(profileA);
      const resultB = calculateSalaryForProfile(profileB);

      if (!resultA || !resultB) return;

      // Affichage r√©sultats
document.getElementById('resultA-median').textContent = Math.round(resultA.median).toLocaleString() + ' ‚Ç¨';
document.getElementById('resultA-range').textContent = 
  Math.round(resultA.low).toLocaleString() + ' ‚Ç¨ ‚Äì ' + Math.round(resultA.high).toLocaleString() + ' ‚Ç¨';

document.getElementById('resultB-median').textContent = Math.round(resultB.median).toLocaleString() + ' ‚Ç¨';
document.getElementById('resultB-range').textContent = 
  Math.round(resultB.low).toLocaleString() + ' ‚Ç¨ ‚Äì ' + Math.round(resultB.high).toLocaleString() + ' ‚Ç¨';


// Calcul diff√©rences
const diff = resultA.median - resultB.median;
const percentDiff = (diff / resultB.median) * 100;
const ratio = resultA.median / resultB.median;

      document.getElementById('diff-absolute').textContent = 
        (diff > 0 ? '+' : '') + Math.round(diff).toLocaleString() + ' ‚Ç¨';
      document.getElementById('diff-absolute').className = 
        'text-3xl font-bold ' + (diff > 0 ? 'text-green-600' : 'text-red-600');

      document.getElementById('diff-percent').textContent = 
        (percentDiff > 0 ? '+' : '') + percentDiff.toFixed(1) + ' %';
      document.getElementById('diff-percent').className = 
        'text-3xl font-bold ' + (percentDiff > 0 ? 'text-green-600' : 'text-red-600');

      document.getElementById('diff-ratio').textContent = '√ó' + ratio.toFixed(2);

      // Barres
      const total = resultA.median + resultB.median;
      const widthA = (resultA.median / total) * 100;
      const widthB = (resultB.median / total) * 100;

      document.getElementById('bar-A').style.width = widthA + '%';
      document.getElementById('bar-B').style.width = widthB + '%';
      document.getElementById('bar-A-text').textContent = Math.round(resultA.median).toLocaleString() + ' ‚Ç¨';
      document.getElementById('bar-B-text').textContent = Math.round(resultB.median).toLocaleString() + ' ‚Ç¨';

      // ===== ANALYSE D√âTAILL√âE PEAUFIN√âE =====
      generateDetailedInsight(profileA, profileB, resultA, resultB, diff, percentDiff);
    }

    function generateDetailedInsight(profileA, profileB, resultA, resultB, diff, percentDiff) {
      // Insight principal
      let mainInsight = '';
      if (Math.abs(diff) < 2000) {
        mainInsight = 'Les deux profils sont pratiquement √©quivalents sur le march√© actuel, avec un √©cart n√©gligeable de ' + Math.round(Math.abs(diff)).toLocaleString() + ' ‚Ç¨.';
      } else if (diff > 0) {
        mainInsight = `Le Profil A g√©n√®re ${Math.round(diff).toLocaleString()} ‚Ç¨ de plus que le Profil B (soit +${percentDiff.toFixed(1)}%). `;
        
        if (profileA.region === 'IDF' && profileB.region === 'hors') {
          mainInsight += 'La prime r√©gionale √éle-de-France (+14%) joue un r√¥le majeur dans cet √©cart.';
        } else if (profileA.experience - profileB.experience > 3) {
          mainInsight += `L'√©cart d'exp√©rience (${profileA.experience - profileB.experience} ans) explique principalement cette diff√©rence.`;
        } else {
          mainInsight += 'La combinaison des facteurs acad√©miques et professionnels favorise nettement le Profil A.';
        }
      } else {
        mainInsight = `Le Profil B g√©n√®re ${Math.round(Math.abs(diff)).toLocaleString()} ‚Ç¨ de plus que le Profil A (soit ${Math.abs(percentDiff).toFixed(1)}%). `;
        
        if (profileB.region === 'IDF' && profileA.region === 'hors') {
          mainInsight += 'La prime r√©gionale √éle-de-France (+14%) joue un r√¥le majeur dans cet √©cart.';
        } else if (profileB.experience - profileA.experience > 3) {
          mainInsight += `L'√©cart d'exp√©rience (${profileB.experience - profileA.experience} ans) explique principalement cette diff√©rence.`;
        } else {
          mainInsight += 'La combinaison des facteurs acad√©miques et professionnels favorise nettement le Profil B.';
        }
      }

      document.getElementById('insight-main').textContent = mainInsight;

      // Analyse acad√©mique
      const schoolsA = allSchools[profileA.sector] || [];
      const schoolsB = allSchools[profileB.sector] || [];
      const schoolA = schoolsA[profileA.school];
      const schoolB = schoolsB[profileB.school];

      let academicInsight = '';
      if (schoolA && schoolB) {
        const schoolDiff = schoolA.p50 - schoolB.p50;
        academicInsight = `√âcole A: ${schoolA.Ecole} (${Math.round(schoolA.p50).toLocaleString()} ‚Ç¨ sortie) vs √âcole B: ${schoolB.Ecole} (${Math.round(schoolB.p50).toLocaleString()} ‚Ç¨ sortie). `;
        
        if (Math.abs(schoolDiff) > 5000) {
          academicInsight += `√âcart scolaire significatif de ${Math.round(Math.abs(schoolDiff)).toLocaleString()} ‚Ç¨. `;
        }

        if (profileA.educationLevel !== profileB.educationLevel) {
          const eduA = { technicien: 'Bac+2', bac3: 'Bac+3', bac5: 'Bac+5', doctorat: 'PhD' }[profileA.educationLevel];
          const eduB = { technicien: 'Bac+2', bac3: 'Bac+3', bac5: 'Bac+5', doctorat: 'PhD' }[profileB.educationLevel];
          academicInsight += `Niveau d'√©tudes diff√©rent (${eduA} vs ${eduB}). `;
        }

        if (profileA.englishLevel !== profileB.englishLevel) {
          academicInsight += `Niveau d'anglais: ${profileA.englishLevel} vs ${profileB.englishLevel}.`;
        }
      }

      document.getElementById('insight-academic').textContent = academicInsight || 'Facteurs acad√©miques similaires.';

      // Analyse professionnelle
      let professionalInsight = '';
      
      if (profileA.region !== profileB.region) {
        professionalInsight += `R√©gion: ${profileA.region === 'IDF' ? 'IDF (+14%)' : 'Province'} vs ${profileB.region === 'IDF' ? 'IDF (+14%)' : 'Province'}. `;
      }

      if (profileA.companySize !== profileB.companySize) {
        professionalInsight += `Taille entreprise: ${profileA.companySize} vs ${profileB.companySize}. `;
      }

      if (profileA.classification !== profileB.classification) {
        const classA = profileA.classification || 'Standard';
        const classB = profileB.classification || 'Standard';
        professionalInsight += `Classification: ${classA} vs ${classB}. `;
      }

      if (profileA.packageLevel !== profileB.packageLevel) {
        professionalInsight += `Package: ${profileA.packageLevel} vs ${profileB.packageLevel}. `;
      }

      if (profileA.teamSize !== profileB.teamSize) {
        const teamA = { none: 'Aucune', small: '1-5', medium: '6-15', large: '16-50', xl: '50+' }[profileA.teamSize];
        const teamB = { none: 'Aucune', small: '1-5', medium: '6-15', large: '16-50', xl: '50+' }[profileB.teamSize];
        professionalInsight += `√âquipe encadr√©e: ${teamA} vs ${teamB}.`;
      }

      document.getElementById('insight-professional').textContent = professionalInsight || 'Contexte professionnel similaire.';
    }

function exportSimulatorPDF() {
  const btn = event.target;
  btn.textContent = 'Generation en cours...';
  btn.disabled = true;

  setTimeout(() => {
    try {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      
      // Fonction utilitaire pour formater les salaires
      const formatSalary = (text) => {
        if (!text) return 'N/A';
        // Remplace tous les / par des espaces
        return text.toString().replace(/\//g, ' ').trim();
      };
      
      let yPos = 20;

      // ========== PAGE 1: PAGE DE GARDE ==========
      doc.setFillColor(0, 51, 102);
      doc.rect(0, 0, 210, 297, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(28);
      doc.setFont('helvetica', 'bold');
      doc.text('ANALYSE SALARIALE DETAILLEE', 105, 130, { align: 'center' });
      
      doc.setDrawColor(0, 174, 239);
      doc.setLineWidth(1.5);
      doc.line(60, 140, 150, 140);
      
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      const today = new Date().toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric' });
      doc.text(today, 105, 152, { align: 'center' });
      
      doc.setFillColor(255, 255, 255);
      doc.roundedRect(50, 250, 110, 25, 3, 3, 'F');
      doc.setTextColor(0, 51, 102);
      doc.setFontSize(12);
      doc.setFont('helvetica', 'bold');
      doc.text('DOCUMENT CONFIDENTIEL', 105, 258, { align: 'center' });
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      doc.text('Simulateur Flying Whales', 105, 265, { align: 'center' });
      doc.text('Analyse personnalisee', 105, 270, { align: 'center' });
      
      // ========== PAGE 2: TOUT LE CONTENU ==========
      doc.addPage();
      yPos = 15;
      
      // === SECTION 1: PROFIL ===
      doc.setFillColor(0, 51, 102);
      doc.rect(15, yPos, 180, 7, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(11);
      doc.setFont('helvetica', 'bold');
      doc.text('VOTRE PROFIL', 18, yPos + 5);
      yPos += 10;
      
      // R√©cup√©ration donn√©es profil avec v√©rifications
      const getSafeValue = (id) => {
        const el = document.getElementById(id);
        return el ? el.value : 'N/A';
      };
      
      const getSafeText = (selector) => {
        const el = document.querySelector(selector);
        return el ? el.text : 'N/A';
      };
      
      const profile = {
        sector: getSafeValue('sector'),
        school: getSafeText('#school option:checked'),
        experience: getSafeValue('experience'),
        region: getSafeValue('region') === 'IDF' ? 'Ile-de-France' : 'Hors IDF',
        company: getSafeText('#companySize option:checked'),
        classification: getSafeText('#classification option:checked') || 'Standard',
        source: 'Marche'
      };
      
      doc.setDrawColor(200, 200, 200);
      doc.setLineWidth(0.3);
      doc.roundedRect(18, yPos, 174, 28, 2, 2);
      
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(8);
      
      const profileLines = [
        ['Secteur:', profile.sector, 'Experience:', profile.experience + ' ans'],
        ['Ecole:', profile.school, 'Entreprise:', profile.company],
        ['Localisation:', profile.region, 'Classification:', profile.classification],
        ['Source:', profile.source, '', '']
      ];
      
      let lineY = yPos + 5;
      profileLines.forEach(([label1, val1, label2, val2]) => {
        doc.setFont('helvetica', 'bold');
        doc.text(label1, 22, lineY);
        doc.setFont('helvetica', 'normal');
        doc.text(val1, 45, lineY);
        
        if (label2) {
          doc.setFont('helvetica', 'bold');
          doc.text(label2, 110, lineY);
          doc.setFont('helvetica', 'normal');
          doc.text(val2, 140, lineY);
        }
        lineY += 6;
      });
      
      yPos += 32;
      
      // === SECTION 2: ESTIMATION SALARIALE ===
      doc.setFillColor(230, 245, 255);
      doc.setDrawColor(0, 123, 255);
      doc.setLineWidth(0.8);
      doc.roundedRect(18, yPos, 174, 22, 2, 2, 'FD');
      
      doc.setTextColor(0, 51, 102);
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text('ESTIMATION SALARIALE', 105, yPos + 5, { align: 'center' });
      
      // R√©cup√©ration et formatage ROBUSTE des salaires
      const medianEl = document.getElementById('median');
      const lowEl = document.getElementById('low');
      const highEl = document.getElementById('high');
      
      const median = formatSalary(medianEl ? medianEl.textContent : '');
      const low = formatSalary(lowEl ? lowEl.textContent : '');
      const high = formatSalary(highEl ? highEl.textContent : '');
      
      doc.setFontSize(18);
      doc.setTextColor(0, 123, 255);
      doc.text(median, 105, yPos + 13, { align: 'center' });
      
      doc.setFontSize(7);
      doc.setTextColor(100, 100, 100);
      doc.setFont('helvetica', 'normal');
      const fourchette = 'Fourchette : ' + low + ' - ' + high;
      doc.text(fourchette, 105, yPos + 18, { align: 'center' });
      
      yPos += 25;
      
      // Positionnement march√© - SANS JUSTIFICATION
      const marketEl = document.getElementById('analysis-market');
      const marketText = marketEl ? marketEl.textContent : '';
      
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(8);
      doc.setFont('helvetica', 'normal');
      
      const fullText = marketText + ' Cette estimation prend en compte votre profil complet (ecole, experience, localisation, type entreprise) et reflete les pratiques actuelles du marche francais. Les fourchettes indiquent la variance observee selon les negociations et benefices complementaires.';
      
      // D√©coupage ligne par ligne SANS justification automatique
      const maxWidth = 174;
      const words = fullText.split(' ');
      let currentLine = '';
      
      words.forEach((word, index) => {
        const testLine = currentLine + (currentLine ? ' ' : '') + word;
        const lineWidth = doc.getTextWidth(testLine);
        
        if (lineWidth > maxWidth && currentLine) {
          doc.text(currentLine, 18, yPos);
          currentLine = word;
          yPos += 4;
        } else {
          currentLine = testLine;
        }
        
        if (index === words.length - 1 && currentLine) {
          doc.text(currentLine, 18, yPos);
          yPos += 4;
        }
      });
      
      yPos += 5;
      
      // === SECTION 3: ANALYSE EN 2 COLONNES ===
      doc.setFillColor(34, 139, 34);
      doc.rect(15, yPos, 87, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('FACTEURS VALORISANTS', 18, yPos + 4);
      
      doc.setFillColor(255, 140, 0);
      doc.rect(108, yPos, 87, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.text('POINTS D\'ATTENTION', 111, yPos + 4);
      yPos += 9;
      
      const startY = yPos;
      
      // Colonne gauche
      const positiveItems = Array.from(document.querySelectorAll('#analysis-positive li'));
      let leftY = startY;
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(7);
      positiveItems.forEach((item, index) => {
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(34, 139, 34);
        doc.text((index + 1) + '.', 18, leftY);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(0, 0, 0);
        
        // D√©coupage manuel sans justification
        const words = item.textContent.split(' ');
        let line = '';
        words.forEach((word, idx) => {
          const test = line + (line ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 80 && line) {
            doc.text(line, 23, leftY);
            line = word;
            leftY += 3.5;
          } else {
            line = test;
          }
          if (idx === words.length - 1 && line) {
            doc.text(line, 23, leftY);
            leftY += 3.5;
          }
        });
        leftY += 2;
      });
      
      // Colonne droite
      const attentionItems = Array.from(document.querySelectorAll('#analysis-attention li'));
      let rightY = startY;
      attentionItems.forEach((item, index) => {
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(255, 140, 0);
        doc.text((index + 1) + '.', 111, rightY);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(0, 0, 0);
        
        // D√©coupage manuel sans justification
        const words = item.textContent.split(' ');
        let line = '';
        words.forEach((word, idx) => {
          const test = line + (line ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 80 && line) {
            doc.text(line, 116, rightY);
            line = word;
            rightY += 3.5;
          } else {
            line = test;
          }
          if (idx === words.length - 1 && line) {
            doc.text(line, 116, rightY);
            rightY += 3.5;
          }
        });
        rightY += 2;
      });
      
      yPos = Math.max(leftY, rightY) + 5;
      
      // === SECTION 4: RECOMMANDATIONS ===
      doc.setFillColor(255, 193, 7);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('RECOMMANDATIONS PERSONNALISEES', 18, yPos + 4);
      yPos += 9;
      
      const recommendationItems = Array.from(document.querySelectorAll('#analysis-recommendations li'));
      doc.setFontSize(7);
      recommendationItems.forEach((item, index) => {
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(255, 140, 0);
        doc.text((index + 1) + '.', 18, yPos);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(0, 0, 0);
        
        // D√©coupage manuel
        const words = item.textContent.split(' ');
        let line = '';
        words.forEach((word, idx) => {
          const test = line + (line ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 170 && line) {
            doc.text(line, 23, yPos);
            line = word;
            yPos += 3.5;
          } else {
            line = test;
          }
          if (idx === words.length - 1 && line) {
            doc.text(line, 23, yPos);
            yPos += 3.5;
          }
        });
        yPos += 2;
      });
      
      yPos += 3;
      
      // === SECTION 5: PROJECTION ===
      doc.setFillColor(138, 43, 226);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('PROJECTION DE CARRIERE', 18, yPos + 4);
      yPos += 9;
      
      const projectionEl = document.getElementById('analysis-projection');
      const projectionText = projectionEl ? projectionEl.innerText : '';
      const projectionLines = projectionText.split('\n').filter(line => line.trim());
      
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(7);
      doc.setFont('helvetica', 'normal');
      
      projectionLines.forEach(line => {
        const words = line.split(' ');
        let currentLine = '';
        words.forEach((word, idx) => {
          const test = currentLine + (currentLine ? ' ' : '') + word;
          if (doc.getTextWidth(test) > 174 && currentLine) {
            doc.text(currentLine, 18, yPos);
            currentLine = word;
            yPos += 3.5;
          } else {
            currentLine = test;
          }
          if (idx === words.length - 1 && currentLine) {
            doc.text(currentLine, 18, yPos);
            yPos += 3.5;
          }
        });
      });
      
      yPos += 3;
      
      // === SECTION 6: GRAPHIQUE ===
      doc.setFillColor(0, 51, 102);
      doc.rect(15, yPos, 180, 6, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.text('EVOLUTION SALARIALE PROJETEE (40 ans)', 18, yPos + 4);
      yPos += 9;
      
      const canvas = document.getElementById('salaryChart');
      if (canvas) {
        html2canvas(canvas, { 
          scale: 1.5, 
          backgroundColor: '#ffffff',
          width: canvas.offsetWidth,
          height: canvas.offsetHeight
        }).then(canvasImg => {
          const imgData = canvasImg.toDataURL('image/png');
          doc.addImage(imgData, 'PNG', 45, yPos, 120, 55);
          yPos += 58;
          
          doc.setFontSize(7);
          doc.setTextColor(100, 100, 100);
          doc.setFont('helvetica', 'italic');
          doc.text('Projection basee sur +2,3%/an (hors promotions). L\'evolution reelle depend de vos performances,', 105, yPos, { align: 'center' });
          doc.text('negociations et changements de poste. Ces hypotheses sont indicatives.', 105, yPos + 3, { align: 'center' });
          
          // ===== FOOTER =====
          const pageCount = doc.internal.getNumberOfPages();
          for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            
            doc.setDrawColor(0, 174, 239);
            doc.setLineWidth(0.5);
            doc.line(15, 285, 195, 285);
            
            doc.setTextColor(150, 150, 150);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            doc.text('Simulateur Flying Whales - Document confidentiel', 15, 290);
            doc.text('Page ' + i + ' / ' + pageCount, 195, 290, { align: 'right' });
          }
          
          doc.save('analyse_salariale_flying_whales.pdf');
          btn.textContent = 'Exporter en PDF';
          btn.disabled = false;
        }).catch(error => {
          console.error('Erreur canvas:', error);
          alert('Erreur lors de la generation du PDF');
          btn.textContent = 'Exporter en PDF';
          btn.disabled = false;
        });
      } else {
        console.error('Canvas salaryChart non trouv√©');
        alert('Graphique non trouve');
        btn.textContent = 'Exporter en PDF';
        btn.disabled = false;
      }

    } catch (error) {
      console.error('Erreur PDF:', error);
      alert('Erreur lors de la generation du PDF');
      btn.textContent = 'Exporter en PDF';
      btn.disabled = false;
    }
  }, 100);
}
    // ===== EXPORT PDF COMPARAISON PROFESSIONNEL =====
    function exportComparisonPDF() {
      const btn = event.target;
      btn.textContent = '‚è≥ G√©n√©ration en cours...';
      btn.disabled = true;

      setTimeout(() => {
        try {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF('p', 'mm', 'a4');
          let yPos = 20;

          // ===== HEADER =====
          doc.setFillColor(138, 43, 226);
          doc.rect(0, 0, 210, 35, 'F');
          
          doc.setTextColor(255, 255, 255);
          doc.setFont("helvetica", "bold");
          doc.setFontSize(22);
          doc.text("üë• Comparaison de Profils", 105, 15, { align: 'center' });
          
          doc.setFontSize(11);
          doc.setFont("helvetica", "normal");
          const today = new Date().toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric' });
          doc.text(`G√©n√©r√© le ${today}`, 105, 25, { align: 'center' });

          yPos = 50;

          // ===== VUE D'ENSEMBLE =====
          doc.setFont("helvetica", "bold");
          doc.setFontSize(14);
          doc.setTextColor(0, 51, 102);
          doc.text("üìä Vue d'ensemble", 15, yPos);

          yPos += 10;

          // Cadre Profil A
          doc.setFillColor(59, 130, 246);
          doc.rect(15, yPos, 85, 8, 'F');
          doc.setTextColor(255, 255, 255);
          doc.setFont("helvetica", "bold");
          doc.setFontSize(12);
          doc.text("Profil A", 20, yPos + 6);

          yPos += 12;
          doc.setTextColor(0, 0, 0);
          doc.setFont("helvetica", "normal");
          doc.setFontSize(10);
          
          const schoolA = document.querySelector('#schoolA option:checked')?.text || 'N/A';
          const expA = document.getElementById('experienceA').value;
          const regionA = document.getElementById('regionA').value === 'IDF' ? 'IDF' : 'Province';
          const salaryA = document.getElementById('resultA-median').textContent;
          const rangeA = document.getElementById('resultA-range').textContent;

          doc.text(`√âcole : ${schoolA}`, 20, yPos);
          yPos += 5;
          doc.text(`Exp√©rience : ${expA} ans`, 20, yPos);
          yPos += 5;
          doc.text(`R√©gion : ${regionA}`, 20, yPos);
          yPos += 8;
          doc.setFont("helvetica", "bold");
          doc.setTextColor(59, 130, 246);
          doc.setFontSize(14);
          doc.text(`Salaire : ${salaryA}`, 20, yPos);
          yPos += 5;
          doc.setFont("helvetica", "normal");
          doc.setFontSize(9);
          doc.setTextColor(100, 100, 100);
          doc.text(`Fourchette : ${rangeA}`, 20, yPos);

          // Cadre Profil B
          yPos = 60;
          doc.setFillColor(34, 197, 94);
          doc.rect(110, yPos, 85, 8, 'F');
          doc.setTextColor(255, 255, 255);
          doc.setFont("helvetica", "bold");
          doc.setFontSize(12);
          doc.text("Profil B", 115, yPos + 6);

          yPos += 12;
          doc.setTextColor(0, 0, 0);
          doc.setFont("helvetica", "normal");
          doc.setFontSize(10);
          
          const schoolB = document.querySelector('#schoolB option:checked')?.text || 'N/A';
          const expB = document.getElementById('experienceB').value;
          const regionB = document.getElementById('regionB').value === 'IDF' ? 'IDF' : 'Province';
          const salaryB = document.getElementById('resultB-median').textContent;
          const rangeB = document.getElementById('resultB-range').textContent;

          doc.text(`√âcole : ${schoolB}`, 115, yPos);
          yPos += 5;
          doc.text(`Exp√©rience : ${expB} ans`, 115, yPos);
          yPos += 5;
          doc.text(`R√©gion : ${regionB}`, 115, yPos);
          yPos += 8;
          doc.setFont("helvetica", "bold");
          doc.setTextColor(34, 197, 94);
          doc.setFontSize(14);
          doc.text(`Salaire : ${salaryB}`, 115, yPos);
          yPos += 5;
          doc.setFont("helvetica", "normal");
          doc.setFontSize(9);
          doc.setTextColor(100, 100, 100);
          doc.text(`Fourchette : ${rangeB}`, 115, yPos);

          yPos += 20;

          // ===== ANALYSE COMPARATIVE =====
          doc.setFont("helvetica", "bold");
          doc.setFontSize(14);
          doc.setTextColor(0, 51, 102);
          doc.text("‚öñÔ∏è Analyse comparative", 15, yPos);

          yPos += 10;
          doc.setFillColor(245, 245, 245);
          doc.rect(15, yPos, 180, 30, 'F');

          doc.setFont("helvetica", "normal");
          doc.setFontSize(11);
          doc.setTextColor(0, 0, 0);

          const diff = document.getElementById('diff-absolute').textContent;
          const percent = document.getElementById('diff-percent').textContent;
          const ratio = document.getElementById('diff-ratio').textContent;

          doc.text(`Diff√©rence salariale : ${diff}`, 20, yPos + 8);
          doc.text(`√âcart relatif : ${percent}`, 20, yPos + 15);
          doc.text(`Ratio A/B : ${ratio}`, 20, yPos + 22);

          yPos += 40;

          // ===== SYNTH√àSE =====
          doc.setFont("helvetica", "bold");
          doc.setFontSize(13);
          doc.setTextColor(138, 43, 226);
          doc.text("üí° Synth√®se", 15, yPos);

          yPos += 7;
          doc.setFont("helvetica", "normal");
          doc.setFontSize(9);
          doc.setTextColor(0, 0, 0);

          const mainInsight = document.getElementById('insight-main').textContent;
          const mainLines = doc.splitTextToSize(mainInsight, 180);
          doc.text(mainLines, 15, yPos);
          yPos += mainLines.length * 5 + 10;

          // ===== FACTEURS ACAD√âMIQUES =====
          if (yPos > 240) { doc.addPage(); yPos = 20; }

          doc.setFont("helvetica", "bold");
          doc.setFontSize(12);
          doc.setTextColor(59, 130, 246);
          doc.text("üéì Facteurs acad√©miques", 15, yPos);

          yPos += 6;
          doc.setFont("helvetica", "normal");
          doc.setFontSize(9);
          doc.setTextColor(0, 0, 0);

          const academicText = document.getElementById('insight-academic').textContent;
          const academicLines = doc.splitTextToSize(academicText, 180);
          doc.text(academicLines, 15, yPos);
          yPos += academicLines.length * 5 + 8;

          // ===== FACTEURS PROFESSIONNELS =====
          if (yPos > 240) { doc.addPage(); yPos = 20; }

          doc.setFont("helvetica", "bold");
          doc.setFontSize(12);
          doc.setTextColor(34, 197, 94);
          doc.text("üíº Facteurs professionnels", 15, yPos);

          yPos += 6;
          doc.setFont("helvetica", "normal");
          doc.setFontSize(9);
          doc.setTextColor(0, 0, 0);

          const professionalText = document.getElementById('insight-professional').textContent;
          const professionalLines = doc.splitTextToSize(professionalText, 180);
          doc.text(professionalLines, 15, yPos);
          yPos += professionalLines.length * 5 + 10;

          // ===== CONCLUSION =====
          if (yPos > 230) { doc.addPage(); yPos = 20; }

          doc.setFillColor(255, 249, 196);
          doc.rect(15, yPos, 180, 35, 'F');

          doc.setFont("helvetica", "bold");
          doc.setFontSize(12);
          doc.setTextColor(0, 0, 0);
          doc.text("üìå Conclusion", 20, yPos + 8);

          doc.setFont("helvetica", "normal");
          doc.setFontSize(9);

          let conclusion = '';
          const diffNum = parseInt(diff.replace(/[^\d-]/g, ''));
          if (Math.abs(diffNum) < 2000) {
            conclusion = 'Les deux profils sont √©quivalents sur le march√©. Le choix d√©pendra d\'autres crit√®res (projet, √©quipe, localisation).';
          } else if (diffNum > 0) {
            conclusion = `Le Profil A pr√©sente un avantage salarial significatif. Cet √©cart s'explique principalement par les diff√©rences de formation, d'exp√©rience et de contexte professionnel.`;
          } else {
            conclusion = `Le Profil B est mieux positionn√© financi√®rement. Les facteurs cl√©s sont visibles dans l'analyse acad√©mique et professionnelle ci-dessus.`;
          }

          const conclusionLines = doc.splitTextToSize(conclusion, 170);
          doc.text(conclusionLines, 20, yPos + 17);

          // ===== FOOTER =====
          const pageCount = doc.internal.getNumberOfPages();
          for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text(`Page ${i} / ${pageCount}`, 105, 290, { align: 'center' });
            doc.text('Simulateur Flying Whales - Comparaison confidentielle', 105, 285, { align: 'center' });
          }

          doc.save('comparaison_profils_complete.pdf');
          btn.textContent = 'üìÑ Exporter la comparaison en PDF';
          btn.disabled = false;

        } catch (error) {
          console.error('Erreur PDF:', error);
          alert('Erreur lors de la g√©n√©ration du PDF');
          btn.textContent = 'üìÑ Exporter la comparaison en PDF';
          btn.disabled = false;
        }
      }, 100);
    }

 // ===== INITIALISATION =====
    window.onload = function() {
      // Optimisations mobile
      if (isMobile()) {
        preventDoubleTabZoom();
        optimizeSliders();
        addTouchFeedback();
      }

      // Simulateur
      document.getElementById('sector').addEventListener('change', populateSchools);
      document.getElementById('school').addEventListener('change', function() {
        updateSchoolInfo();
        calculateSimulator();
      });
      document.getElementById('experience').addEventListener('input', function(e) {
        document.getElementById('expVal').textContent = e.target.value;
        calculateSimulator();
      });
      
      ['region', 'companySize', 'classification', 'educationLevel', 'englishLevel', 
       'contractType', 'industry', 'teamSize', 'packageLevel', 'subdomain', 'jobFunction', 'source'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculateSimulator);
      });

      // Comparateur A
      document.getElementById('sectorA').addEventListener('change', function() {
        populateSchoolsComparator();
        calculateComparison();
      });
      document.getElementById('schoolA').addEventListener('change', function() {
        updateSchoolInfoComparator('A');
        calculateComparison();
      });
      document.getElementById('experienceA').addEventListener('input', function(e) {
        document.getElementById('expValA').textContent = e.target.value;
        calculateComparison();
      });
      
      ['regionA', 'companySizeA', 'classificationA', 'educationLevelA', 'englishLevelA',
       'contractTypeA', 'industryA', 'teamSizeA', 'packageLevelA', 'sourceA'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculateComparison);
      });
      
      document.getElementById('jobFunctionA').addEventListener('change', calculateComparison);

      // Comparateur B
      document.getElementById('sectorB').addEventListener('change', function() {
        populateSchoolsComparator();
        calculateComparison();
      });
      document.getElementById('schoolB').addEventListener('change', function() {
        updateSchoolInfoComparator('B');
        calculateComparison();
      });
      document.getElementById('experienceB').addEventListener('input', function(e) {
        document.getElementById('expValB').textContent = e.target.value;
        calculateComparison();
      });
      
      ['regionB', 'companySizeB', 'classificationB', 'educationLevelB', 'englishLevelB',
       'contractTypeB', 'industryB', 'teamSizeB', 'packageLevelB', 'sourceB'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculateComparison);
      });
      
      document.getElementById('jobFunctionB').addEventListener('change', calculateComparison);

      // Init
      populateSchools();
      populateSchoolsComparator();

      // Ajustements initiaux mobile
      if (isMobile()) {
        adjustChartHeight();
      }

      // R√©ajuster lors du resize / rotation
      window.addEventListener('resize', function() {
        if (chart) {
          chart.resize();
          adjustChartHeight();
        }
      });
    };
  </script>
</body>
</html>
