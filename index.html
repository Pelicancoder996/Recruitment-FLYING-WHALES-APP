<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
  <link rel="stylesheet" href="style-premium.css">
  <meta name="theme-color" content="#00AEEF">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulateur Salaire</title>

  <!-- ‚úÖ Tailwind avec dark mode activ√© -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>

  <!-- ‚úÖ Librairies -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- ‚úÖ Police + PWA -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">

  <!-- ‚úÖ Service Worker + DarkMode persist√© -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("‚úÖ Service Worker enregistr√©"))
        .catch(err => console.error("Erreur SW:", err));
    }
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }
  </script>
<!-- üíé Nouveau style visuel premium -->
  <link rel="stylesheet" href="style-premium.css">
</head>

  <style>
  body { font-family: 'Poppins', sans-serif; }

  .modal { 
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0, 0, 0, 0.6); 
    align-items: center; 
    justify-content: center; 
    z-index: 50; 
  }

  .modal-content { 
    background: white; 
    padding: 2rem; 
    border-radius: 1rem; 
    max-width: 700px; 
  }

  .dark .modal-content { 
    background: #1f2937; 
    color: white; 
  }

  /* ‚úÖ Lisibilit√© en dark mode */
  .dark select,
  .dark input,
  .dark label,
  .dark span,
  .dark p,
  .dark h1,
  .dark h2,
  .dark h3,
  .dark h4,
  .dark h5 {
    color: #f9fafb !important; /* gris tr√®s clair lisible */
  }

/* üåô Exception : texte noir sur fond clair dans la box d'analyse */
.dark #insightBox,
.dark #insightBox * {
  color: #000 !important;
}

  /* ‚úÖ Arri√®re-plan et bordure sur inputs et s√©lecteurs */
  .dark select,
  .dark input {
    background-color: #1f2937 !important; /* gris fonc√© √©l√©gant */
    border-color: #374151 !important; /* gris moyen */
  }

  /* ‚úÖ Couleur sp√©cifique aux valeurs de salaires */
  .dark #median,
  .dark #range,
  .dark #schoolMedian,
  .dark #schoolRange {
    color: #00AEEF !important;
  }

  /* ‚úÖ Transition douce clair ‚Üî sombre */
  body, select, input, label, span, p, h1, h2, h3, h4, h5 {
    transition: color 0.3s ease, background-color 0.3s ease;
  }

  /* ‚úÖ Animation clignotante bouton Export PDF */
  @keyframes pulse {
    0% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(1.05); }
    100% { opacity: 1; transform: scale(1); }
  }

  .highlight {
    animation: pulse 1.5s infinite;
  }

  /* üåô Optionnel : fond d√©grad√© en dark mode */
  .dark body {
    background: linear-gradient(180deg, #0f172a, #1e293b);
  }
  
  /* =========================
   ‚ú® DESIGN PREMIUM
   ========================= */

/* üåà Effets de survol & focus */
select, input[type="range"], button {
  transition: all 0.25s ease-in-out;
}

select:hover, select:focus,
input:hover, input:focus {
  border-color: #00AEEF;
  box-shadow: 0 0 8px rgba(0, 174, 239, 0.25);
}

/* üéöÔ∏è Slider moderne */
input[type="range"] {
  accent-color: #00AEEF;
  cursor: pointer;
}
input[type="range"]::-webkit-slider-thumb {
  background: #00AEEF;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  transition: all 0.2s ease;
}
input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.15);
}

/* üåô/‚òÄÔ∏è Bouton toggle styl√© */
button[onclick="toggleDarkMode()"] {
  border-radius: 50%;
  width: 35px;
  height: 35px;
  font-size: 15px;
  line-height: 1;
  background: white;
  color: #003366;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}
button[onclick="toggleDarkMode()"]:hover {
  transform: scale(1.1);
  background: #00AEEF;
  color: white;
}

/* üßä Cartes (√©cole / r√©sultat) */
#schoolInfo, #result {
  border: 1px solid rgba(0,0,0,0.1);
  box-shadow: 0 2px 12px rgba(0,0,0,0.05);
  backdrop-filter: blur(6px);
}

.dark #schoolInfo, .dark #result {
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 2px 12px rgba(255,255,255,0.03);
}

/* ‚úçÔ∏è Titres mieux hi√©rarchis√©s */
h2 {
  letter-spacing: 0.3px;
}
h3 {
  font-weight: 600;
  margin-bottom: 0.25rem;
}

/* üïäÔ∏è Transitions globales plus douces */
* {
  transition: background-color 0.25s ease, color 0.25s ease, border-color 0.25s ease;
}

/* =========================
   ‚ú® Effets d'apparition et couleur dynamique de la box d'analyse
   ========================= */

#insightBox {
  transition: 
    background 0.6s ease, 
    border-left 0.4s ease, 
    transform 0.4s ease, 
    opacity 0.4s ease;
  border-radius: 7px;
  padding: 16px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
  margin-top: 12px;
}

/* üåô Am√©lioration dark mode */
.dark #insightBox {
  color: #f9fafb;
  box-shadow: 0 3px 6px rgba(255,255,255,0.05);
  
 /* üåô Correction finale ‚Äì priorit√© absolue */
.dark #insightBox,
.dark #insightBox * {
  color: #000 !important; /* texte noir */
  text-shadow: none !important;
}

/* ==========================================================
   üíé STYLE PREMIUM ‚Äî Corporate clair & a√©rien
   ========================================================== */

* {
  transition: all 0.25s ease-in-out;
  font-family: 'Inter', sans-serif;
}

/* ======== Base ======== */
body {
  background: #f8fafc;
  color: #1e293b;
}

.dark body {
  background: #0f172a;
  color: #e2e8f0;
}

/* ======== Header ======== */
header h1 {
  color: #0f172a;
}
.dark header h1 {
  color: #e2e8f0;
}

/* ======== Cards ======== */
.card {
  background: white;
  border-radius: 16px;
  padding: 2rem;
  box-shadow: 0 6px 20px rgba(0,0,0,0.05);
  border: 1px solid rgba(0,0,0,0.05);
}

.card:hover {
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
  transform: translateY(-2px);
}

.dark .card {
  background: rgba(30, 41, 59, 0.8);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
}

/* ======== Inputs ======== */
.input {
  width: 100%;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 10px;
  background: #fff;
  font-size: 15px;
  color: #1e293b;
}

.input:focus {
  outline: none;
  border-color: #00AEEF;
  box-shadow: 0 0 6px rgba(0,174,239,0.3);
}

.dark .input {
  background: rgba(31,41,55,0.9);
  border: 1px solid rgba(255,255,255,0.1);
  color: #f9fafb;
}

/* ======== Sliders ======== */
.slider {
  accent-color: #00AEEF;
}

/* ======== Buttons ======== */
.btn-primary {
  background: #00AEEF;
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 10px;
  font-weight: 600;
  font-size: 15px;
  box-shadow: 0 4px 12px rgba(0,174,239,0.25);
}

.btn-primary:hover {
  background: #0094cc;
  transform: translateY(-2px);
}

.dark .btn-primary {
  background: #0284c7;
  color: white;
}

/* ======== Titles ======== */
.section-title {
  font-size: 1.15rem;
  font-weight: 600;
  color: #0f172a;
  margin-bottom: 0.75rem;
}
.dark .section-title {
  color: #e2e8f0;
}

/* ======== Modal ======== */
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);
  align-items: center;
  justify-content: center;
  z-index: 100;
}
.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}
.dark .modal-content {
  background: #1f2937;
  color: #f9fafb;
}

/* ======== Animation PDF ======== */
@keyframes pulse {
  0% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.7; transform: scale(1.05); }
  100% { opacity: 1; transform: scale(1); }
}
.highlight {
  animation: pulse 2s infinite;
}





</style>

</head>

<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
  <!-- Header -->
  <header class="w-full py-6 bg-[#00AEEF] text-white dark:bg-[#003366] flex justify-between px-8 items-center transition-colors duration-300">
    <h1 class="text-2xl font-bold">‚úàÔ∏è Simulateur de Salaire Avanc√©</h1>
    <div class="flex gap-2">
      <button onclick="toggleDarkMode()" class="px-3 py-1 bg-white text-[#003366] rounded-lg">üåô/‚òÄÔ∏è</button>
      <button onclick="openModal()" class="px-3 py-1 bg-white text-[#003366] rounded-lg">‚ùì Aide</button>
    </div>
  </header>

  <!-- Modal d'aide -->
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4 transition-colors duration-300">‚ÑπÔ∏è Aide & FAQ</h2>
      <p><b>üåç March√© :</b> donn√©es nationales (√©coles, universit√©s, IT, A√©ronautique, Industrie, Design, Fonctions transverses, +2,3%/an, coefficients).</p>
      <p><b>üè¢ Flying Whales :</b> packages internes FW.</p>
      <p><b>‚öñÔ∏è Crois√©e :</b> combinaison 50% FW, 50% march√©.</p>
      <p><b>üìä Graphique :</b> √©volution projet√©e sur 40 ans.</p>
      <p><b>‚ÅÇ Sous-domaine :</b> Co√©fficient en fonction de la sp√©cialit√©.</p>
      <p><b>Classification interne</b> Pond√©ration en fonction du niveau de responsabilit√© en interne (seulement pour Flying Whales) </p>
      <p><b> Profil comp√©titif</b> La jauge de comp√©titivit√© d√©termine √† la fois le niveau de r√©mun√©ration & de raret√© du profil.</p>
      <button onclick="closeModal()" class="mt-2 px-2 py-1 bg-[#00AEEF] text-white rounded">Fermer</button>
    </div>
  </div>

  <!-- Formulaire principal -->
  <main class="max-w-5xl mx-auto p-6">
    <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow mb-6 transition-colors duration-300">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìù Renseigne ton profil</h2>

      <label>üè∑Ô∏è Secteur</label>
      <select id="sector" class="w-full mb-4 p-2 border rounded">
        <option value="ingenieur">Ing√©nierie</option>
        <option value="commerce">Grande √©cole de commerce</option>
        <option value="scpo">Sciences Po</option>
        <option value="universite">Universit√©</option>
        <option value="it">Informatique / IT</option>
        <option value="design">Design / UX / UI</option>
        <option value="fonction">Fonctions transverses</option>
      </select>

      <label>üìö √âcole</label>
      <select id="school" class="w-full mb-4 p-2 border rounded"></select>
      <!-- üí° R√©sum√© dynamique √©cole -->
<div id="schoolInfo"
     class="hidden mt-[-6px] p-0.5 border border-gray-200 rounded-md bg-gray-100 dark:bg-gray-800 text-xs text-gray-700 dark:text-gray-300 transition-all duration-500 opacity-0 translate-y-0.5">
  <h3 class="font-semibold text-[#003366] dark:text-[#00AEEF] mb-0.5 text-sm">
    üìò Sortie d‚Äô√©cole
  </h3>
  <p class="leading-tight"><b>M√©dian :</b> <span id="schoolLiveMedian">‚Äî</span></p>
  <p class="leading-tight"><b>Fourchette :</b> <span id="schoolLiveRange">‚Äî</span></p>
</div>

<!-- üåç Niveau d‚Äôanglais -->
<label>üåé Niveau d‚Äôanglais</label>
<select id="englishLevel" class="w-full mb-4 p-2 border rounded">
  <option value="basic">Basique (A2‚ÄìB1)</option>
  <option value="intermediate">Interm√©diaire (B2)</option>
  <option value="advanced">Avanc√© (C1)</option>
  <option value="bilingual">Bilingue / International (C2)</option>
</select>

<!-- üéì Niveau d‚Äô√©tudes -->
<label>üéì Niveau d‚Äô√©tudes</label>
<select id="educationLevel" class="w-full mb-4 p-2 border rounded">
  <option value="technicien">Technicien / Bac +2</option>
  <option value="bac3">Licence / Bac +3</option>
  <option value="bac5">Master / Ing√©nieur / Bac +5</option>
  <option value="doctorat">Doctorat / PhD</option>
</select>


<!-- üìú Type de contrat -->
<label>üìú Type de contrat</label>
<select id="contractType" class="w-full mb-4 p-2 border rounded">
  <option value="cdi">CDI</option>
  <option value="cdd">CDD</option>
  <option value="alternance">Alternance</option>
  <option value="freelance">Freelance / Ind√©pendant</option>
  <option value="expatriation">Expatri√© / D√©tach√© √† l‚Äô√©tranger</option>
</select>

<!-- üè≠ Secteur industriel -->
<label>üè≠ Secteur industriel</label>
<select id="industry" class="w-full mb-4 p-2 border rounded">
  <option value="aero">A√©ronautique / Spatial</option>
  <option value="auto">Automobile / Mobilit√©</option>
  <option value="energie">√ânergie / Nucl√©aire</option>
  <option value="num√©rique">Num√©rique / IT</option>
  <option value="sante">Sant√© / Biotech</option>
  <option value="luxe">Luxe / Design</option>
  <option value="public">Secteur public</option>
</select>

<!-- üë• Taille d‚Äô√©quipe -->
<label>üë• Taille d‚Äô√©quipe encadr√©e</label>
<select id="teamSize" class="w-full mb-4 p-2 border rounded">
  <option value="none">Aucune</option>
  <option value="small">1 √† 5 personnes</option>
  <option value="medium">6 √† 15 personnes</option>
  <option value="large">16 √† 50 personnes</option>
  <option value="xl">Plus de 50 personnes</option>
</select>

<!-- üéÅ Package global -->
<label>üéÅ Package global</label>
<select id="packageLevel" class="w-full mb-4 p-2 border rounded">
  <option value="standard">Salaire fixe uniquement</option>
  <option value="bonus">Fixe + bonus (5‚Äì10%)</option>
  <option value="bonusplus">Fixe + variable (15‚Äì25%)</option>
  <option value="actions">Variable + actions / BSPCE</option>
</select>


      <label>üíº Fonction / M√©tier</label>
      <select id="fonction" class="w-full mb-4 p-2 border rounded"></select>

      <label>üìÖ Exp√©rience: <span id="expVal">3</span> ans</label>
      <input type="range" id="experience" min="0" max="40" value="3" class="w-full mb-4">

      <label>üî¨ Sous-domaine (ing√©nierie uniquement)</label>
      <select id="subdomain" class="w-full mb-4 p-2 border rounded"></select>
      
      

      <select id="role" class="hidden">
  <option value="default" selected>Valeur par d√©faut</option>
</select>


      <label>üè∑Ô∏è Classification interne</label>
      <select id="classification" class="w-full mb-4 p-2 border rounded">
        <option value="">-- Optionnelle --</option>
        <option value="I1">I1 - Ing√©nieur D√©butant</option>
        <option value="I2">I2 - Ing√©nieur Confirm√©</option>
        <option value="I3">I3 - Ing√©nieur Senior</option>
        <option value="I4">I4 - Ing√©nieur Expert</option>
        <option value="M1">M1 - Manager Niveau 1</option>
        <option value="M2">M2 - Manager Niveau 2</option>
        <option value="M3">M3 - Leader D√©partement</option>
        <option value="RLot">Responsable de Lot</option>
        <option value="DirecteurTechnique">Directeur Technique</option>
      </select>

      <label>üåç R√©gion</label>
      <select id="region" class="w-full mb-4 p-2 border rounded">
        <option value="IDF">√éle-de-France</option>
        <option value="hors">Hors √éle-de-France</option>
      </select>

      <label>üè¢ Taille entreprise</label>
      <select id="companySize" class="w-full mb-4 p-2 border rounded">
        <option value="startup">Startup</option>
        <option value="PME">PME</option>
        <option value="ETI">ETI</option>
        <option value="grand-groupe">Grand Groupe</option>
      </select>

      <label>üìä Source des donn√©es</label>
      <select id="source" class="w-full mb-4 p-2 border rounded">
        <option value="marche">üåç March√©</option>
        <option value="fw">üè¢ Flying Whales (interne)</option>
        <option value="croisee">‚öñÔ∏è Donn√©es crois√©es</option>
      </select>
    </section>

        <!-- Section R√©sultats -->
    <section id="result" class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hidden">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìä R√©sultats</h2>
      <p><b>R√©f√©rence √©cole :</b> <span id="schoolRange"></span></p>
      <p><b>M√©dian √©cole :</b> <span id="schoolMedian"></span></p>
      <hr class="my-4">
      <p><b>Estimation personnalis√©e :</b></p>
      <p>M√©dian: <span id="median"></span></p>
      <p>Fourchette: <span id="range"></span></p>
      <!-- üå°Ô∏è Jauge Profil comp√©titif -->
<div id="competitivenessGauge" class="mt-4 hidden">
  <p class="font-semibold mb-1">üèÅ Profil comp√©titif :</p>
  <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 relative overflow-hidden">
    <div id="gaugeBar" class="h-4 rounded-full transition-all duration-500"></div>
  </div>
  <p id="gaugeLabel" class="text-sm mt-1 text-gray-600 dark:text-gray-300"></p>
</div>

      <canvas id="salaryChart" class="mt-6"></canvas>
      <!-- üß† Analyse dynamique -->
<div id="insightBox" 
     class="mt-4 p-4 border rounded-lg bg-blue-50 dark:bg-gray-700 hidden transition-all duration-500">
  <h3 class="font-semibold text-[#003366] dark:text-[#00AEEF] mb-1">üí° Analyse personnalis√©e</h3>
  <p id="insightText">Ton profil est en cours d‚Äôanalyse...</p>
</div>

      <!-- ‚úÖ Pr√©visualisation PDF -->
<iframe id="pdfPreview" style="width:100%; height:500px; border:1px solid #ccc; margin-top:20px;"></iframe>

      <!-- üöÄ Bouton Export PDF avec effet clignotant -->
      <button onclick="exportPDF()" 
        class="mt-4 px-4 py-2 bg-green-600 text-white rounded highlight">
        üìë Exporter en PDF
      </button>
    </section>
  </main>
  <script>
    // ===============================
    // Bloc 3 : √âcoles d‚Äôing√©nieurs (71 + Hors liste)
    // Donn√©es = salaires sortie d‚Äô√©cole (brut annuel) avec mini-fourchette
    // ===============================

    const schoolsIngenieur = [
       { Ecole:"Polytechnique", p25:51300, p50:54150, p75:57000 },
  { Ecole:"Mines Paris", p25:41800, p50:43460, p75:45100 },
  { Ecole:"CentraleSup√©lec", p25:42750, p50:44650, p75:46550 },
  { Ecole:"ISAE-Supa√©ro", p25:39900, p50:41325, p75:42750 },
  { Ecole:"T√©l√©com Paris", p25:42750, p50:43985, p75:45600 },
  { Ecole:"ESTP", p25:41800, p50:43700, p75:45600 },
  { Ecole:"ESTACA", p25:39900, p50:42370, p75:44650 },
  { Ecole:"Efrei", p25:44650, p50:46265, p75:47975 },
  { Ecole:"IMT Atlantique", p25:41800, p50:42655, p75:43700 },
  { Ecole:"Centrale Nantes", p25:37525, p50:39100, p75:40850 },
  { Ecole:"Centrale Lyon", p25:40850, p50:42275, p75:43700 },
  { Ecole:"Centrale Marseille", p25:39900, p50:41800, p75:43700 },
  { Ecole:"Centrale Lille", p25:39900, p50:41800, p75:43700 },
  { Ecole:"Centrale Paris", p25:42750, p50:44650, p75:46550 },
  { Ecole:"ENSAM Arts et M√©tiers", p25:37050, p50:38950, p75:40850 },
  { Ecole:"Mines Nancy", p25:38000, p50:39900, p75:41800 },
  { Ecole:"Mines Saint-√âtienne", p25:38000, p50:39900, p75:41800 },
  { Ecole:"Mines Al√®s", p25:36100, p50:38000, p75:39900 },
  { Ecole:"Mines Douai", p25:36100, p50:38000, p75:39900 },
  { Ecole:"ENSTA Paris", p25:40850, p50:42750, p75:44650 },
  { Ecole:"ENSTA Bretagne", p25:36100, p50:38000, p75:39900 },
  { Ecole:"T√©l√©com SudParis", p25:37050, p50:38950, p75:40850 },
  { Ecole:"T√©l√©com Nancy", p25:36100, p50:38000, p75:39900 },
  { Ecole:"INSA Lyon", p25:36100, p50:38000, p75:39900 },
  { Ecole:"INSA Toulouse", p25:35150, p50:37050, p75:38950 },
  { Ecole:"INSA Rennes", p25:35150, p50:37050, p75:38950 },
  { Ecole:"INSA Strasbourg", p25:35150, p50:37050, p75:38950 },
  { Ecole:"INSA Rouen", p25:34200, p50:36100, p75:38000 },
  { Ecole:"UTC Compi√®gne", p25:35150, p50:37050, p75:38950 },
  { Ecole:"UTT Troyes", p25:34200, p50:36100, p75:38000 },
  { Ecole:"UTBM Belfort", p25:34200, p50:36100, p75:38000 },
  { Ecole:"Polytech Grenoble", p25:33250, p50:35150, p75:37050 },
  { Ecole:"Polytech Nantes", p25:33250, p50:35150, p75:37050 },
  { Ecole:"Polytech Orl√©ans", p25:33250, p50:35150, p75:37050 },
  { Ecole:"Polytech Sorbonne", p25:33250, p50:35150, p75:37050 },
  { Ecole:"Polytech Nice", p25:33250, p50:35150, p75:37050 },
  { Ecole:"Polytech Lyon", p25:33250, p50:35150, p75:37050 },
  { Ecole:"Polytech Lille", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ESILV", p25:42750, p50:44460, p75:46075 },
  { Ecole:"ESME Sudria", p25:35150, p50:37050, p75:38950 },
  { Ecole:"EPF", p25:34200, p50:36100, p75:38000 },
  { Ecole:"ECE Paris", p25:34200, p50:36100, p75:38000 },
  { Ecole:"ESIEA", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ESIEE Paris", p25:34200, p50:36100, p75:38000 },
  { Ecole:"ISEN", p25:34200, p50:36100, p75:38000 },
  { Ecole:"HEI Lille", p25:34200, p50:36100, p75:38000 },
  { Ecole:"EIGSI La Rochelle", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ENSTA", p25:39900, p50:41800, p75:43700 },
  { Ecole:"ENSICAEN", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ENSC Rennes", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ENSAM Metz", p25:35150, p50:37050, p75:38950 },
  { Ecole:"ENSAIA", p25:32300, p50:34200, p75:36100 },
  { Ecole:"AgroParisTech", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ISA Lille", p25:32300, p50:34200, p75:36100 },
  { Ecole:"EI Purpan", p25:32300, p50:34200, p75:36100 },
  { Ecole:"ESA Angers", p25:32300, p50:34200, p75:36100 },
  { Ecole:"ESIGELEC", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ENSEA", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ESEO Angers", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ENSMA Poitiers", p25:34200, p50:36100, p75:38000 },
  { Ecole:"ENSI Poitiers", p25:33250, p50:35150, p75:37050 },
  { Ecole:"ENISE Saint-√âtienne", p25:32300, p50:34200, p75:36100 },
  { Ecole:"SUPAERO Toulouse", p25:39900, p50:41325, p75:42750 },
  { Ecole:"ENAC Toulouse", p25:38000, p50:39900, p75:41800 },
  { Ecole:"ENSGTI Pau", p25:32300, p50:34200, p75:36100 },
  { Ecole:"ENSGSI Nancy", p25:32300, p50:34200, p75:36100 },
  { Ecole:"ESPCI Paris", p25:40850, p50:42750, p75:44650 },
  { Ecole:"ENS Cachan", p25:39900, p50:41800, p75:43700 },
  { Ecole:"ENS Lyon", p25:39900, p50:41800, p75:43700 },
  { Ecole:"ENS Paris-Saclay", p25:39900, p50:41800, p75:43700 },
  { Ecole:"ENS Ulm", p25:40850, p50:42750, p75:44650 },
  { Ecole:"Hors liste", p25:33000, p50:35000, p75:37000 }
];
    // ===============================
    // Bloc 4 : Grandes √©coles de commerce (30)
    // ===============================

    const schoolsCommerce = [
  {Ecole:"HEC Paris", p25:45600, p50:52250, p75:61750},
  {Ecole:"ESSEC Business School", p25:42750, p50:49400, p75:58900},
  {Ecole:"ESCP Business School", p25:41800, p50:48450, p75:57000},
  {Ecole:"EDHEC Business School", p25:39900, p50:46600, p75:55100},
  {Ecole:"emlyon Business School", p25:40850, p50:47500, p75:56050},
  {Ecole:"Audencia Business School", p25:38000, p50:44650, p75:53200},
  {Ecole:"Skema Business School", p25:36100, p50:42750, p75:50350},
  {Ecole:"NEOMA Business School", p25:35150, p50:41800, p75:49400},
  {Ecole:"Kedge Business School", p25:33250, p50:39900, p75:47500},
  {Ecole:"TBS Education", p25:34200, p50:40850, p75:48450},
  {Ecole:"Grenoble EM", p25:35150, p50:41800, p75:49400},
  {Ecole:"Montpellier BS", p25:33250, p50:39900, p75:47500},
  {Ecole:"Rennes SB", p25:32300, p50:38950, p75:46550},
  {Ecole:"ICN Business School", p25:32300, p50:38000, p75:45600},
  {Ecole:"EM Strasbourg", p25:32300, p50:38000, p75:45600},
  {Ecole:"Excelia Business School", p25:31350, p50:37050, p75:44650},
  {Ecole:"ISC Paris", p25:31350, p50:37050, p75:43700},
  {Ecole:"INSEEC Grande √âcole", p25:30400, p50:36100, p75:42750},
  {Ecole:"PSB (Paris School of Business)", p25:30400, p50:36100, p75:42750},
  {Ecole:"EMLV (√âcole de Management L√©onard de Vinci)", p25:29450, p50:35150, p75:41800},
  {Ecole:"ISG (Institut Sup√©rieur de Gestion)", p25:29450, p50:35150, p75:40850},
  {Ecole:"ESC Clermont BS", p25:29450, p50:34200, p75:39900},
  {Ecole:"Burgundy School of Business (BSB Dijon)", p25:29450, p50:34200, p75:39900},
  {Ecole:"IMT-BS (Institut Mines-T√©l√©com Business School)", p25:28500, p50:34200, p75:39900},
  {Ecole:"ESC Pau Business School", p25:28500, p50:33300, p75:38950},
  {Ecole:"SCBS (South Champagne Business School)", p25:28500, p50:33300, p75:38000},
  {Ecole:"Brest Business School", p25:27550, p50:32300, p75:37050},
  {Ecole:"ISCID-CO (Boulogne/Calais)", p25:26600, p50:31350, p75:36100},
  {Ecole:"ICD Business School", p25:26600, p50:31350, p75:36100},
  {Ecole:"ESLSCA Business School Paris", p25:26600, p50:31350, p75:36100}
];
        // ===============================
    // Bloc 5 : Sciences Po (10 IEP)
    // ===============================

    const schoolsScPo = [
  {Ecole:"Sciences Po Paris", p25:34200, p50:38000, p75:42750},
  {Ecole:"Sciences Po Bordeaux", p25:32300, p50:35150, p75:39900},
  {Ecole:"Sciences Po Grenoble", p25:31825, p50:34675, p75:38950},
  {Ecole:"Sciences Po Lille", p25:32300, p50:35150, p75:39900},
  {Ecole:"Sciences Po Lyon", p25:32775, p50:35625, p75:40375},
  {Ecole:"Sciences Po Rennes", p25:31350, p50:34200, p75:38950},
  {Ecole:"Sciences Po Strasbourg", p25:31825, p50:34675, p75:39425},
  {Ecole:"Sciences Po Toulouse", p25:31825, p50:34675, p75:39425},
  {Ecole:"Sciences Po Saint-Germain-en-Laye", p25:30400, p50:33250, p75:38000},
  {Ecole:"Sciences Po Aix", p25:31350, p50:34200, p75:38950}
];
    // ===============================
    // Bloc 6 : Universit√©s (Top 20)
    // ===============================

    const schoolsUniversite = [
    
  {Ecole:"Sorbonne Universit√©", p25:33250, p50:37000, p75:40850},
  {Ecole:"Universit√© Paris-Saclay", p25:33250, p50:37000, p75:40850},
  {Ecole:"Universit√© PSL (Paris Sciences & Lettres)", p25:33250, p50:37500, p75:41350},
  {Ecole:"Universit√© Paris Cit√©", p25:32300, p50:36100, p75:39900},
  {Ecole:"Universit√© de Montpellier", p25:31800, p50:35600, p75:39400},
  {Ecole:"Universit√© de Strasbourg", p25:31800, p50:35600, p75:39400},
  {Ecole:"Universit√© Grenoble Alpes", p25:31800, p50:35600, p75:39400},
  {Ecole:"Aix-Marseille Universit√©", p25:31300, p50:35100, p75:38900},
  {Ecole:"Universit√© de Bordeaux", p25:31300, p50:35100, p75:38900},
  {Ecole:"Universit√© de Lyon", p25:31300, p50:35100, p75:38900},
  {Ecole:"Universit√© de Lille", p25:30800, p50:34600, p75:38400},
  {Ecole:"Universit√© Toulouse III - Paul Sabatier", p25:30800, p50:34600, p75:38400},
  {Ecole:"Universit√© de Nantes", p25:30400, p50:34200, p75:38000},
  {Ecole:"Universit√© de Rennes 1", p25:30400, p50:34200, p75:38000},
  {Ecole:"Universit√© de Lorraine", p25:30400, p50:34200, p75:38000},
  {Ecole:"Universit√© C√¥te d‚ÄôAzur (Nice)", p25:29900, p50:33800, p75:37600},
  {Ecole:"Universit√© de Tours", p25:29500, p50:33300, p75:37100},
  {Ecole:"Universit√© d‚ÄôAngers", p25:29500, p50:33300, p75:37100},
  {Ecole:"Universit√© de Clermont Auvergne", p25:29500, p50:33300, p75:37100},
  {Ecole:"Universit√© de Reims Champagne-Ardenne", p25:29000, p50:32800, p75:36600}
];

    // ===============================
    // Bloc 7 : √âcoles Informatique / IT (Top 15 + hors liste)
    // ===============================

    const schoolsIT = [
      { Ecole: "√âcole 42", p25: 30000, p50: 35000, p75: 42000 },
      { Ecole: "EPITA", p25: 32000, p50: 37000, p75: 43000 },
      { Ecole: "Epitech", p25: 31000, p50: 36000, p75: 42000 },
      { Ecole: "ENSIMAG / Grenoble INP (informatique)", p25: 30000, p50: 35000, p75: 41000 },
      { Ecole: "T√©l√©com Paris (informatique)", p25: 33000, p50: 38000, p75: 44000 },
      { Ecole: "T√©l√©com SudParis (informatique)", p25: 31000, p50: 36000, p75: 42000 },
      { Ecole: "T√©l√©com Nancy (informatique)", p25: 29000, p50: 34000, p75: 39000 },
      { Ecole: "ENSIIE (informatique)", p25: 28000, p50: 33000, p75: 38000 },
      { Ecole: "ISIMA (informatique)", p25: 27000, p50: 32000, p75: 37000 },
      { Ecole: "Polytech Grenoble (informatique)", p25: 27000, p50: 32000, p75: 37000 },
      { Ecole: "Polytech Lyon (informatique)", p25: 27000, p50: 32000, p75: 37000 },
      { Ecole: "Universit√© Paris Cit√© (informatique)", p25: 25000, p50: 30000, p75: 35000 },
      { Ecole: "Universit√© de Strasbourg (informatique)", p25: 24000, p50: 29000, p75: 34000 },
      { Ecole: "Universit√© de Bordeaux (informatique)", p25: 24000, p50: 29000, p75: 34000 },
      { Ecole: "Universit√© de Lille (informatique)", p25: 23000, p50: 28000, p75: 33000 },
      { Ecole: "Sup√©lec / Centrale (informatique)", p25: 32000, p50: 37000, p75: 43000 },
      { Ecole: "Hors liste IT", p25: 22000, p50: 27000, p75: 32000 }
    ];
    
    // ===============================
// Bloc 7.1 : √âcoles de Communication (Top 10)
// ===============================

const schoolsCom = [
  { Ecole: "CELSA (Sorbonne Universit√©)", p25: 33000, p50: 36000, p75: 40000 },
  { Ecole: "ISCOM", p25: 30000, p50: 33000, p75: 37000 },
  { Ecole: "Sup de Pub (INSEEC)", p25: 28000, p50: 31000, p75: 35000 },
  { Ecole: "EFAP", p25: 28000, p50: 31000, p75: 34000 },
  { Ecole: "ESP (√âcole Sup√©rieure de Publicit√©)", p25: 27000, p50: 30000, p75: 33000 },
  { Ecole: "ISEG", p25: 27000, p50: 30000, p75: 33000 },
  { Ecole: "ECS (European Communication School)", p25: 26000, p50: 29000, p75: 32000 },
  { Ecole: "Sup de Com", p25: 27000, p50: 30000, p75: 34000 },
  { Ecole: "Audencia SciencesCom", p25: 31000, p50: 34000, p75: 38000 },
  { Ecole: "ISCPA", p25: 26000, p50: 29000, p75: 32000 },
  { Ecole: "Hors liste Communication", p25: 25000, p50: 28000, p75: 31000 }
];


// ===============================
// Bloc 7.2 : √âcoles RH / Management du Personnel (Top 10)
// ===============================

const schoolsRH = [
  { Ecole: "IGS RH (Institut de Gestion Sociale)", p25: 31350, p50: 35150, p75: 40850 },
  { Ecole: "ESGRH (√âcole Sup√©rieure de Gestion des RH)", p25: 30400, p50: 34200, p75: 39900 },
  { Ecole: "Sup des RH", p25: 28500, p50: 32300, p75: 38000 },
  { Ecole: "ISFOGEP (Clermont Auvergne)", p25: 29450, p50: 33250, p75: 38000 },
  { Ecole: "ICD Business School (RH)", p25: 29450, p50: 33250, p75: 38950 },
  { Ecole: "ESSCA RH & Management", p25: 30400, p50: 34200, p75: 39900 },
  { Ecole: "ISCG Paris (RH & Paie)", p25: 28500, p50: 32300, p75: 37050 },
  { Ecole: "IAE Paris-Sorbonne (Master RH)", p25: 32300, p50: 36100, p75: 42750 },
  { Ecole: "IAE Lyon (Master GRH)", p25: 31350, p50: 35150, p75: 40850 },
  { Ecole: "IAE Aix-Marseille (Master Management RH)", p25: 31350, p50: 36100, p75: 41800 },
  { Ecole: "IAE Grenoble (Master RH & Organisation)", p25: 30400, p50: 34200, p75: 39900 },
  { Ecole: "IAE Lille (Master RH & Management Social)", p25: 30400, p50: 34200, p75: 39900 },
  { Ecole: "IAE Nantes (Master Gestion des RH)", p25: 29450, p50: 33250, p75: 38950 },
  { Ecole: "IAE Nice (Master Management RH)", p25: 30400, p50: 34200, p75: 39900 },
  { Ecole: "Toulouse School of Management (Master RH)", p25: 30400, p50: 34200, p75: 38950 },
  { Ecole: "Hors liste RH", p25: 26600, p50: 30400, p75: 35150 }
];



    // ===============================
    // M√©tiers IT
    // ===============================

    const functionsIT = {
      "D√©veloppeur Front-End": { p25: 30000, p50: 38000, p75: 46000 },
      "D√©veloppeur Back-End": { p25: 32000, p50: 40000, p75: 48000 },
      "D√©veloppeur Full-Stack": { p25: 33000, p50: 42000, p75: 52000 },
      "Data Engineer": { p25: 35000, p50: 45000, p75: 58000 },
      "Data Scientist": { p25: 37000, p50: 48000, p75: 62000 },
      "DevOps / SRE": { p25: 36000, p50: 47000, p75: 60000 },
      "Infra / R√©seau": { p25: 32000, p50: 42000, p75: 54000 },
      "Cloud Architect": { p25: 45000, p50: 60000, p75: 80000 },
      "Cybersecurity": { p25: 38000, p50: 50000, p75: 65000 },
      "Admin Syst√®mes": { p25: 31000, p50: 40000, p75: 52000 }
    };
    // ===============================
    // Bloc 8 : √âcoles Design (Top 8 + hors liste)
    // ===============================

    const schoolsDesign = [
      { Ecole: "Strate √âcole de Design", p25: 28000, p50: 33000, p75: 40000 },
      { Ecole: "ENSAD (Arts D√©cos)", p25: 26000, p50: 31000, p75: 38000 },
      { Ecole: "√âcole Estienne", p25: 25000, p50: 30000, p75: 35000 },
      { Ecole: "√âcole de Design Nantes Atlantique", p25: 26000, p50: 31000, p75: 36000 },
      { Ecole: "Gobelins", p25: 27000, p50: 32000, p75: 38000 },
      { Ecole: "ENSCI-Les Ateliers", p25: 25000, p50: 30000, p75: 35000 },
      { Ecole: "LISAA", p25: 23000, p50: 28000, p75: 33000 },
      { Ecole: "Universit√© (arts appliqu√©s)", p25: 22000, p50: 27000, p75: 32000 },
      { Ecole: "Hors liste Design", p25: 20000, p50: 25000, p75: 30000 }
    ];

    // ===============================
    // M√©tiers Design
    // ===============================

    const functionsDesign = {
      "UX Designer": { p25: 30000, p50: 38000, p75: 48000 },
      "UI Designer": { p25: 32000, p50: 40000, p75: 50000 },
      "Product Designer": { p25: 33000, p50: 42000, p75: 55000 },
      "Motion Designer": { p25: 28000, p50: 35000, p75: 45000 },
      "Graphiste / Branding": { p25: 26000, p50: 33000, p75: 42000 },
      "Interaction Designer": { p25: 30000, p50: 38000, p75: 47000 }
    };
    // ===============================
    // Bloc 9 : Fonctions transverses
    // ===============================

    // Achats
    const functionsAchats = {
      "Acheteur Junior": { p25:38000, p50:42000, p75:47000 },
      "Acheteur Confirm√©": { p25:45000, p50:50000, p75:55000 },
      "Responsable Achats": { p25:55000, p50:65000, p75:80000 },
      "Directeur Achats": { p25:80000, p50:95000, p75:120000 }
    };

    // Immobilier
    const functionsImmo = {
      "Charg√© de Gestion Immobili√®re": { p25:32000, p50:38000, p75:45000 },
      "Property Manager": { p25:40000, p50:52000, p75:65000 },
      "Responsable Immobilier": { p25:55000, p50:72000, p75:90000 },
      "Directeur Immobilier": { p25:80000, p50:100000, p75:125000 }
    };

    // Ressources Humaines
    const functionsRH = {
      "Charg√© RH": { p25:34000, p50:39000, p75:45000 },
      "Charg√© de Recrutement": { 
        p25:37000, 
        p50:42000, 
        p75:47000,
        fwBase: { exp: 5, salaire: 46987 } // Donn√©e FW interne
      },
      "Responsable Recrutement": { p25:45000, p50:53000, p75:60000 },
      "Responsable RH / HRBP": { p25:47000, p50:55250, p75:66000 },
      "Directeur des Ressources Humaines": { p25:70000, p50:95000, p75:120000 }
      
    };

    // Finance
    const functionsFinance = {
      "Comptable": { p25:32000, p50:37000, p75:42000 },
      "Contr√¥leur de Gestion": { p25:42000, p50:49400, p75:60000 },
      "Auditeur Interne": { p25:40000, p50:47000, p75:55000 },
      "Tr√©sorier": { p25:45000, p50:52000, p75:60000 },
      "Responsable Financier": { p25:55000, p50:65000, p75:80000 },
      "Directeur Administratif et Financier (DAF)": { p25:80000, p50:110000, p75:140000 }
    };

    // Commerciaux
    const functionsCommerciaux = {
      "Business Developer Junior": { p25:30000, p50:35000, p75:40000 },
      "Business Developer Confirm√©": { p25:38000, p50:42000, p75:48000 },
      "Ing√©nieur d‚ÄôAffaires": { p25:45000, p50:50000, p75:60000 },
      "Responsable Commercial": { p25:55000, p50:60000, p75:75000 },
      "Directeur Commercial": { p25:75000, p50:85000, p75:110000 }
    };
    
    // ==============================================
// M√©tiers Communication (int√©gr√© dans Fonctions transverses)
// ==============================================
const functionsCommunication = {
  "Charg√© de communication": { p25: 28000, p50: 32000, p75: 37000 },
  "Responsable de communication": { p25: 40000, p50: 46000, p75: 52000 },
  "Directeur de la communication": { p25: 65000, p50: 75000, p75: 90000 }
};

// ===============================
// Bloc : Ing√©nieurs Ops (Op√©rations & Missions)
// Ajust√© -10.5% (package + anglais B2)
// ===============================

const functionsOps = {
  "Ing√©nieur Op√©ration": {
    p25: 35500,
    p50: 38500,  // sortie √©cole ~38.5k‚Ç¨
    p75: 44000
  },
  "Ing√©nieur Op√©ration Senior": {
    p25: 62000,
    p50: 68900,  // m√©dian 2025
    p75: 78000
  },
  "Ing√©nieur Mission": {
    p25: 38500,
    p50: 42000,
    p75: 47000
  },
  "Ing√©nieur Mission Senior": {
    p25: 68000,
    p50: 73950,  // m√©dian 2025
    p75: 83000
  }
};

    
    // ===============================
    // Bloc 10 : Coefficients / r√¥les
    // ===============================

    const subdomainCoef = {
      "Calculs & Simulation": 1.10,
      "Conception": 1.05,
      "√âlectronique": 1.08,
      "Avionique": 1.08,
      "Mat√©riaux": 1.05,
      "Propulsion": 1.08,
      "M√©thodes": 1.02,         
      "Production": 1.02,
      "Maintenance": 1.05,      
      "Qualit√©": 1.06,          
      "Supply Chain": 1.06,     
      "Gestion de Projet": 1.05,
      "Ing√©nierie Syst√®mes": 1.08,
      "Gestion de Programme": 1.08,
      "Support Client": 1.02,   
      "Thermique": 1.09,
      "Dynamique de Vol": 1.11,
      "√âlectrique": 1.11,
      "Test": 1.05
    };

    const roles = [
      "Ing√©nieur Standard",
      "Expert Technique",
      "Architecte Syst√®me",
      "Chef de Projet",
      "Manager d‚Äô√âquipe",
      "Directeur de Programme"
    ];
    // ===============================
    // Bloc 11 : Logique principale
    // ===============================

    function populateMenus() {
      const sectorSel=document.getElementById("sector");
      const schoolSel=document.getElementById("school");
      const fonctionSel=document.getElementById("fonction");
      const subSel=document.getElementById("subdomain");
      const roleSel=document.getElementById("role");

      // === √âcoles dynamiques selon secteur ===
      function updateSchoolList() {
        schoolSel.innerHTML="";
        if(sectorSel.value==="ingenieur") schoolsIngenieur.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if(sectorSel.value==="commerce") schoolsCommerce.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if(sectorSel.value==="scpo") schoolsScPo.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if(sectorSel.value==="universite") schoolsUniversite.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if(sectorSel.value==="it") schoolsIT.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if(sectorSel.value==="design") schoolsDesign.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
        if (sectorSel.value === "fonction" || sectorSel.value === "transverse" || sectorSel.value === "fonctions") {
  // üß© Fusion des deux cat√©gories d‚Äô√©coles (Com + RH)
  const allTransverseSchools = [...schoolsCom, ...schoolsRH];
  schoolSel.innerHTML = ""; // on vide d‚Äôabord
  allTransverseSchools.forEach((s, i) => {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = s.Ecole;
    schoolSel.appendChild(opt);
  });
}

      }
      sectorSel.addEventListener("change", ()=>{updateSchoolList(); calculateSalary();});
      updateSchoolList();
      
      
      

      // === Fonctions disponibles ===
fonctionSel.innerHTML = "";
fonctionSel.add(new Option("-- S√©lectionnez une fonction --", ""));

const allFunctions = {
  ...functionsAchats,
  ...functionsImmo,
  ...functionsRH,
  ...functionsFinance,
  ...functionsCommerciaux,
  ...functionsIT,
  ...functionsDesign,
  ...functionsCommunication,   // üÜï ajout Communication ici
  ...functionsOps
};

Object.keys(allFunctions).forEach(k => fonctionSel.add(new Option(k, k)));

// === Ajout des m√©tiers Communication & RH (si secteur = Fonctions transverses)
const sectorSelValue = document.getElementById("sector").value;
if (sectorSelValue === "fonction" || sectorSelValue === "transverse" || sectorSelValue === "fonctions") {
  fonctionSel.innerHTML = ""; // on vide les fonctions standard
  fonctionSel.add(new Option("-- S√©lectionnez un m√©tier --", "")); // on garde une option neutre

  // On ajoute les m√©tiers sp√©cifiques
  jobsFonction.forEach(job => {
    const opt = document.createElement("option");
    opt.value = job.nom;
    opt.textContent = job.nom;
    fonctionSel.appendChild(opt);
  });
}


      // === Sous-domaines ing√©nierie ===
      subSel.innerHTML="";
      subSel.add(new Option("-- Pas de sous-domaine --",""));
      Object.keys(subdomainCoef).forEach(k=>subSel.add(new Option(k,k)));

      // === R√¥les ===
      roles.forEach(r=>roleSel.add(new Option(r,r)));

      // === Events ===
      document.querySelectorAll("#school, #fonction, #subdomain, #role, #classification, #region, #companySize, #source, #educationLevel, #englishLevel, #contractType, #industry, #teamSize, #packageLevel")
  .forEach(el => el.addEventListener("change", calculateSalary));

      document.getElementById("experience").addEventListener("input", e=>{
        document.getElementById("expVal").innerText=e.target.value; 
        calculateSalary();
      });

      calculateSalary();
    }

    let chart;

    function interpolateFW(exp, minExp, maxExp, minVal, maxVal) {
      if (exp <= minExp) return minVal;
      if (exp >= maxExp) return maxVal;
      const ratio = (exp - minExp) / (maxExp - minExp);
      return minVal + ratio * (maxVal - minVal);
    }

    function calculateSalary() {
      const sector=document.getElementById("sector").value;
      const exp=parseInt(document.getElementById("experience").value);
      let p25=0,p50=0,p75=0;
      let refP25=0,refP50=0,refP75=0; // ‚úÖ sortie √©cole brute

      // === Cas 1 : √âcole ===
      const sch=document.getElementById("school").value;
      if(sch){
        if(sector==="ingenieur"){ const school=schoolsIngenieur[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
        if(sector==="commerce"){ const school=schoolsCommerce[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
        if(sector==="scpo"){ const school=schoolsScPo[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
        if(sector==="universite"){ const school=schoolsUniversite[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
        if(sector==="it"){ const school=schoolsIT[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
        if(sector==="design"){ const school=schoolsDesign[sch]; p25=school.p25; p50=school.p50; p75=school.p75; refP25=school.p25; refP50=school.p50; refP75=school.p75; }
        if (sector === "fonction" || sector === "transverse" || sector === "fonctions") {
    const allTransverseSchools = [...schoolsCom, ...schoolsRH];
    const school = allTransverseSchools[sch];
    p25 = school.p25; p50 = school.p50; p75 = school.p75;
    refP25 = school.p25; refP50 = school.p50; refP75 = school.p75;
  }
      }

      // === Cas 2 : Fonction transverse ===
      const fn=document.getElementById("fonction").value;
      if(fn){
        const allFunctions={...functionsAchats,...functionsImmo,...functionsRH,...functionsFinance,...functionsCommerciaux,...functionsIT,...functionsDesign,...functionsOps};
        const f=allFunctions[fn];
        if(f){
          if(p25>0 && p50>0){ // hybride √©cole + fonction
            p25 = 0.6*p25 + 0.4*f.p25;
            p50 = 0.6*p50 + 0.4*f.p50;
            p75 = 0.6*p75 + 0.4*f.p75;
          } else { // fonction seule
            p25=f.p25; p50=f.p50; p75=f.p75;
            if(f.fwBase){
              const baseExp=f.fwBase.exp;
              const baseSalary=f.fwBase.salaire;
              const factor=Math.pow(1.023,exp-baseExp);
              p25=baseSalary*0.9*factor;
              p50=baseSalary*factor;
              p75=baseSalary*1.1*factor;
            }
          }
        }
      }

      // ‚úÖ Affichage r√©f√©rence sortie √©cole brute
      if(refP50>0){
        document.getElementById("schoolRange").innerText=Math.round(refP25)+"‚Ç¨ ‚Äì "+Math.round(refP75)+"‚Ç¨";
        document.getElementById("schoolMedian").innerText=Math.round(refP50)+"‚Ç¨";
      } else {
        document.getElementById("schoolRange").innerText="N/A";
        document.getElementById("schoolMedian").innerText="N/A";
      }

      // Exp√©rience (+2,3%/an)
      let factor=Math.pow(1.023,exp);
      p25*=factor; p50*=factor; p75*=factor;

      // Coeffs r√©gion/entreprise
      const sd=subdomainCoef[document.getElementById("subdomain").value]||1;
      const regionCoef=document.getElementById("region").value==="hors"?0.86:1.14; 
      const sizeCoef={startup:0.9,PME:1.0,ETI:1.05,"grand-groupe":1.15}[document.getElementById("companySize").value]||1;
      let coef=sd*regionCoef*sizeCoef;

      // R√¥le / classification
      const classification=document.getElementById("classification").value;
      let roleCoef=1;
      if (classification==="M1") roleCoef=1.10;
      if (classification==="M2") roleCoef=1.15;
      if (classification==="M3") roleCoef=1.20; 
      if (classification==="RLot") roleCoef=1.07;
      if (classification==="DirecteurTechnique") roleCoef=1.25;

      // Source
      const source=document.getElementById("source").value;
      let median,low,high;
      if(source==="marche"){
        median=p50; low=p25; high=p75;
      }else if(source==="fw"){
        median=p50*0.95; low=p25*0.95; high=p75*0.95;
      }else{
        median=(p50*0.4 + p50*0.95*0.6);
        low=(p25*0.4 + p25*0.95*0.6);
        high=(p75*0.4 + p75*0.95*0.6);
      }
      

// ===============================
// üéØ COEFFICIENTS DE RAFFINEMENT (version √©quilibr√©e)
// ===============================

// --- coefficients individuels ---
const educationCoef = {
  technicien: 0.80,
  bac3: 0.89,
  bac5: 1.00,
  doctorat: 1.15
}[document.getElementById("educationLevel")?.value] || 1;

console.log("‚öôÔ∏è Coefficient √©ducation appliqu√© :", educationCoef);


const englishCoef   = { basic: 1.00, intermediate: 1.03, advanced: 1.06, bilingual: 1.10 }[document.getElementById("englishLevel")?.value] || 1;
const contractCoef  = { cdi: 1.00, cdd: 0.96, alternance: 0.70, freelance: 1.20, expatriation: 1.15 }[document.getElementById("contractType")?.value] || 1;
const industryCoef  = { aero: 1.05, auto: 1.00, energie: 1.06, numerique: 1.07, sante: 1.05, luxe: 1.08, public: 0.88 }[document.getElementById("industry")?.value] || 1;
const teamCoef      = { none: 1.00, small: 1.05, medium: 1.10, large: 1.18, xl: 1.25 }[document.getElementById("teamSize")?.value] || 1;

// --- package ---
const packageMap = {
  standard: 1.00, bonus: 1.07, bonusplus: 1.18, actions: 1.30
};
const packageCoef = packageMap[document.getElementById("packageLevel")?.value] || 1;

// ===============================
// ‚öñÔ∏è CALCUL ADAPTATIF
// ===============================

// ‚Üí moyenne g√©om√©trique des coefficients = effet doux et naturel
const refinements = [educationCoef, englishCoef, contractCoef, industryCoef, teamCoef];
const geoMean = Math.pow(refinements.reduce((a, b) => a * b, 1), 1 / refinements.length);

// ‚Üí limitation globale pour √©viter inflation (¬±25%)
const refinementCoef = Math.min(Math.max(geoMean, 0.85), 1.25);

// üéì Ajustement final selon niveau d'√©tudes (comme IDF vs hors IDF)
let educationAdjust = 1.00; // valeur par d√©faut (Bac+5)

const eduLevel = document.getElementById("educationLevel")?.value;
if (eduLevel === "technicien") educationAdjust = 0.80; // -20%
else if (eduLevel === "bac3")  educationAdjust = 0.89; // -11%
else if (eduLevel === "doctorat") educationAdjust = 1.05; // +5%

// Application du correctif apr√®s le refinement global
let medianFixed = median * coef * roleCoef * refinementCoef * educationAdjust;
let lowFixed    = low    * coef * roleCoef * refinementCoef * educationAdjust;
let highFixed   = high   * coef * roleCoef * refinementCoef * educationAdjust;


// ‚Üí ajout du package
median = medianFixed * packageCoef;
low    = lowFixed * packageCoef;
high   = highFixed * packageCoef;

      // Planchers FW I1‚ÄìI4
      let fwP25=null, fwP50=null, fwP75=null;
      if (classification==="I1") {
        fwP25 = interpolateFW(exp,1,3,38000,44000);
        fwP50 = interpolateFW(exp,1,3,38000,48000);
        fwP75 = interpolateFW(exp,1,3,40000,50000);
      }
      if (classification==="I2") {
        fwP25 = interpolateFW(exp,3,5,48000,53000);
        fwP50 = interpolateFW(exp,3,5,48000,59000);
        fwP75 = interpolateFW(exp,3,5,50000,61000);
      }
      if (classification==="I3") {
        fwP25 = interpolateFW(exp,6,8,59000,68000);
        fwP50 = interpolateFW(exp,6,8,59000,73330);
        fwP75 = interpolateFW(exp,6,8,61000,76000);
      }
      if (classification==="I4") {
        const base = 73330*1.02;
        const factorI4 = Math.pow(1.023,Math.max(0,exp-10));
        fwP25 = base*0.95*factorI4;
        fwP50 = base*factorI4;
        fwP75 = base*1.10*factorI4;
      }

      if(fwP25&&fwP50&&fwP75){
        fwP25 *= regionCoef*sizeCoef;
        fwP50 *= regionCoef*sizeCoef;
        fwP75 *= regionCoef*sizeCoef;
        low=Math.max(low,fwP25);
        median=Math.max(median,fwP50);
        high=Math.max(high,fwP75);
      }

      // ‚úÖ Affichage estimation personnalis√©e
      document.getElementById("median").innerText=Math.round(median)+"‚Ç¨";
      document.getElementById("range").innerText=Math.round(low)+"‚Ç¨ ‚Äì "+Math.round(high)+"‚Ç¨";
      document.getElementById("result").classList.remove("hidden");
      
// üå°Ô∏è Jauge de comp√©titivit√© ‚Äî version sensible
const gauge = document.getElementById("competitivenessGauge");
const gaugeBar = document.getElementById("gaugeBar");
const gaugeLabel = document.getElementById("gaugeLabel");

if (gauge && gaugeBar && gaugeLabel) {
  if (typeof refinementCoef !== "undefined" && typeof packageCoef !== "undefined") {
    gauge.classList.remove("hidden");

    // üîß sensibilit√© augment√©e (x2)
    const globalBoost = ((refinementCoef - 1) + (packageCoef - 1)) * 2;
    const score = Math.min(Math.max(1 + globalBoost, 0.5), 1.5);

    let color, label;
    if (score < 0.95) { color = "#3B82F6"; label = "üîµ Profil √©quilibr√© / March√© m√©dian"; }
    else if (score < 1.10) { color = "#16A34A"; label = "üü¢ Profil comp√©titif"; }
    else if (score < 1.25) { color = "#EAB308"; label = "üü° Profil tendu (haut du march√©)"; }
    else { color = "#DC2626"; label = "üî¥ Sur√©valu√© (au-del√† du march√©)"; }

    gaugeBar.style.width = Math.min(score * 100, 100) + "%";
    gaugeBar.style.background = color;
    gaugeLabel.textContent = `${label} ‚Äî Score ${score.toFixed(2)}`;
  }
}


      // Graphique
      const ctx=document.getElementById("salaryChart").getContext("2d");
      if(chart) chart.destroy();
      const years=[...Array(41).keys()];
      const projection=years.map(y=>median*Math.pow(1.023,y));
      chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: years,
    datasets: [{
      label: "Salaire m√©dian projet√© (‚Ç¨)",
      data: projection,
      borderColor: "#003366",
      backgroundColor: "rgba(0, 51, 102, 0.1)",
      fill: true,
      tension: 0.3, // courbe liss√©e
      pointBackgroundColor: "#003366",
      pointRadius: 3
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        display: true,
        position: "top",
        labels: {
          color: "#003366",
          font: { size: 9 }
        }
      },
      tooltip: {
        callbacks: {
          label: function(context) {
            return context.formattedValue + " ‚Ç¨";
          }
        }
      }
    },
    scales: {
      y: {
        beginAtZero: false,
        ticks: {
          callback: function(value) {
            return value.toLocaleString("fr-FR") + " ‚Ç¨";
          }
        }
      }
    }
  }
});

// === üí° Analyse dynamique ===
const insightBox = document.getElementById("insightBox");
const insightText = document.getElementById("insightText");

if (median > 0) {
  const growth20 = Math.round(median * Math.pow(1.023, 20));
  const growth40 = Math.round(median * Math.pow(1.023, 40));

  let msg = `Avec un salaire m√©dian actuel de ${Math.round(median).toLocaleString()} ‚Ç¨, `;
  msg += `tu atteindrais environ ${growth20.toLocaleString()} ‚Ç¨ √† 20 ans `;
  msg += `et ${growth40.toLocaleString()} ‚Ç¨ √† 40 ans d‚Äôexp√©rience. `;
  msg += `Cela repr√©sente une croissance totale de +${Math.round(((growth40/median)-1)*100)}% sur ta carri√®re.`;

  insightText.textContent = msg;

  insightBox.classList.remove("hidden");
  requestAnimationFrame(() => {
    insightBox.style.opacity = "1";
    insightBox.style.transform = "translateY(0)";
    
  });
  generateInsight(median, low, high);
}

function generateInsight(median, low, high) {
  const sector = document.getElementById("sector").value;
  const exp = parseInt(document.getElementById("experience").value);
  const role = document.getElementById("role").value;
  const classification = document.getElementById("classification").value;
  const region = document.getElementById("region").value;
  const size = document.getElementById("companySize").value;
  const source = document.getElementById("source").value;

  let msg = "";

  // 1Ô∏è‚É£ Contexte g√©n√©ral
  if (source === "fw") msg += "üî∑ Donn√©es internes Flying Whales : ";
  else if (source === "marche") msg += "üåç Donn√©es march√© : ";
  else msg += "‚öñÔ∏è Donn√©es crois√©es (60% FW / 40% march√©) : ";

  msg += `salaire m√©dian estim√© √† ${Math.round(median).toLocaleString()} ‚Ç¨. `;

  // 2Ô∏è‚É£ Exp√©rience
  if (exp < 3) msg += "Tu es en d√©but de carri√®re ‚Äî la progression sera rapide les 5 premi√®res ann√©es. ";
  else if (exp < 10) msg += "Tu es dans la phase de consolidation de ton expertise. ";
  else msg += "Ton profil est exp√©riment√© : la progression salariale d√©pendra surtout des changements de r√¥le. ";

  // 3Ô∏è‚É£ Classification & r√¥le
  if (classification.startsWith("I")) msg += `Position actuelle : ${classification}, ing√©nieur technique. `;
  if (classification.startsWith("M")) msg += `R√¥le manag√©rial (${classification}), avec impact fort sur la r√©mun√©ration. `;
  if (classification === "RLot" || role.includes("Chef")) msg += "Profil orient√© gestion de projet. ";
  if (role.includes("Directeur")) msg += "Profil direction confirm√©, tr√®s au-dessus de la m√©diane march√©. ";

  // 4Ô∏è‚É£ R√©gion & taille entreprise
  if (region === "IDF") msg += "R√©gion : √éle-de-France, majoration moyenne de +14%. ";
  else msg += "R√©gion hors IDF : r√©mun√©ration ajust√©e -14% en moyenne. ";

  if (size === "grand-groupe") msg += "Grand groupe : politique salariale stable mais √©volutions plus lentes. ";
  if (size === "startup") msg += "Startup : salaires d‚Äôentr√©e plus bas, mais forte croissance possible avec responsabilit√©s. ";

  // 5Ô∏è‚É£ Analyse comparative simple
  const growth20 = Math.round(median * Math.pow(1.023, 20));
  const growth40 = Math.round(median * Math.pow(1.023, 40));
  const growthPercent = Math.round(((growth40 / median) - 1) * 100);

  msg += `Projection : environ ${growth20.toLocaleString()} ‚Ç¨ √† 20 ans, ${growth40.toLocaleString()} ‚Ç¨ √† 40 ans, soit +${growthPercent}% sur carri√®re. `;

 // ‚ú® Rendu
const insightText = document.getElementById("insightText");
const insightBox = document.getElementById("insightBox");

// 6Ô∏è‚É£ Insight qualitatif selon niveau de salaire 
if (median < 40000) msg += "üí¨ Niveau inf√©rieur √† la moyenne nationale, mais am√©liorable via sp√©cialisation ou mobilit√©.";
else if (median < 60000) msg += "üí¨ Niveau correct et comp√©titif sur le march√© actuel.";
else if (median < 90000) msg += "üí¨ Tr√®s bon niveau de r√©mun√©ration, dans le top 20% du march√©.";
else msg += "üí¨ Excellent positionnement : profil √† tr√®s forte valeur ajout√©e.";

// üé® Couleur selon le niveau de salaire (plac√© APR√àS la d√©claration d'insightBox)
if (median < 40000) {
  insightBox.style.background = "#fee2e2"; // rouge clair
  insightBox.style.borderLeft = "6px solid #dc2626"; // rouge vif
} else if (median < 60000) {
  insightBox.style.background = "#fef9c3"; // jaune clair
  insightBox.style.borderLeft = "6px solid #eab308"; // jaune vif
} else if (median < 90000) {
  insightBox.style.background = "#dcfce7"; // vert clair
  insightBox.style.borderLeft = "6px solid #16a34a"; // vert moyen
} else {
  insightBox.style.background = "#dbeafe"; // bleu clair
  insightBox.style.borderLeft = "6px solid #2563eb"; // bleu vif
}

insightText.textContent = msg;
insightBox.classList.remove("hidden");
}

    }
      // ===============================
  // Export PDF avec jsPDF + chart
  // ===============================

  // Ajout du script jsPDF + plugin html2canvas pour capturer le graphique

  function exportPDF() {
    const jsPDF = window.jspdf ? window.jspdf.jsPDF : window.jsPDF;


    if (!jsPDF) {
      alert("‚ö†Ô∏è jsPDF n'est pas encore charg√©, r√©essaie dans 2 secondes.");
      return;
    }

    const doc = new jsPDF();

    // Titre
    doc.setFontSize(18);
    doc.text("üìë R√©sultats - Simulateur Salaire Flying Whales", 10, 20);

    // Infos principales
    doc.setFontSize(12);
    doc.text("√âcole (r√©f√©rence) : " + document.getElementById("schoolRange").innerText, 10, 40);
    doc.text("M√©dian √©cole : " + document.getElementById("schoolMedian").innerText, 10, 50);
    doc.text("Estimation personnalis√©e :", 10, 70);
    doc.text("M√©dian : " + document.getElementById("median").innerText, 10, 80);
    doc.text("Fourchette : " + document.getElementById("range").innerText, 10, 90);

    // Ajout du graphique via html2canvas
    const chartCanvas = document.getElementById("salaryChart");
    html2canvas(chartCanvas).then((canvas) => {
      const imgData = canvas.toDataURL("image/png");
      doc.addImage(imgData, "PNG", 10, 110, 180, 80); // x, y, largeur, hauteur
      doc.save("simulateur_salaire.pdf");
    });
  }


    // üåô/‚òÄÔ∏è Dark/Light toggle
    function toggleDarkMode() {
      const html=document.documentElement;
      if(html.classList.contains('dark')){
        html.classList.remove('dark');
        localStorage.setItem('theme','light');
      } else {
        html.classList.add('dark');
        localStorage.setItem('theme','dark');
      }
    }

    // ‚úÖ Fix modal
    function openModal(){document.getElementById("helpModal").style.display="flex";}
    function closeModal(){document.getElementById("helpModal").style.display="none";}

// === üéì R√©sum√© dynamique √©cole (affiche les fourchettes selon l'√©cole choisie) ===
function updateSchoolInfo() {
  const sector = document.getElementById("sector").value;
  const schoolIndex = document.getElementById("school").value;
  const box = document.getElementById("schoolInfo");
  const med = document.getElementById("schoolLiveMedian");
  const range = document.getElementById("schoolLiveRange");

  // üß† D√©finition des datasets selon le secteur s√©lectionn√©
  const datasets = {
    ingenieur: schoolsIngenieur,
    commerce: schoolsCommerce,
    scpo: schoolsScPo,
    universite: schoolsUniversite,
    it: schoolsIT,
    design: schoolsDesign,
    rhcom: [...schoolsCom, ...schoolsRH],       // ‚úÖ Nouveau bloc fusion RH + Communication
    fonction: [...schoolsCom, ...schoolsRH],    // (pour compatibilit√© ancienne version)
    fonctions: [...schoolsCom, ...schoolsRH],
    transverse: [...schoolsCom, ...schoolsRH]
  };

  const list = datasets[sector];
  const data = list ? list[schoolIndex] : null;

  // üéØ Affichage dynamique
  if (data) {
    med.textContent = `${Math.round(data.p50).toLocaleString()} ‚Ç¨`;
    range.textContent = `${Math.round(data.p25).toLocaleString()} ‚Ç¨ ‚Äì ${Math.round(data.p75).toLocaleString()} ‚Ç¨`;

    box.classList.remove("hidden");
    requestAnimationFrame(() => {
      box.style.opacity = "1";
      box.style.transform = "translateY(0)";
    });
  } else {
    box.style.opacity = "0";
    box.style.transform = "translateY(10px)";
    setTimeout(() => box.classList.add("hidden"), 300);
  }
}

// === üîÑ Activation automatique au chargement ===
document.addEventListener("DOMContentLoaded", () => {
  const schoolSel = document.getElementById("school");
  const sectorSel = document.getElementById("sector");

  if (schoolSel && sectorSel) {
    // Quand on change de secteur ‚Üí recharge les √©coles
    sectorSel.addEventListener("change", updateSchoolInfo);
    // Quand on change d'√©cole ‚Üí met √† jour la fourchette
    schoolSel.addEventListener("change", updateSchoolInfo);
  }
});


    window.onload=populateMenus;
    // ===============================
    // Bloc 12 : Tests rapides
    // ===============================

    function runTests() {
      console.log("=== Lancement des tests simulateur ===");

      // 1. V√©rification √©coles ing√©nieurs
      console.assert(schoolsIngenieur.length > 0, "‚ö†Ô∏è Pas d'√©coles ing√©nieurs d√©tect√©es");
      console.log("‚úÖ Ing√©nieurs:", schoolsIngenieur.length);

      // 2. V√©rification √©coles commerce
      console.assert(schoolsCommerce.length > 0, "‚ö†Ô∏è Pas d'√©coles commerce d√©tect√©es");
      console.log("‚úÖ Commerce:", schoolsCommerce.length);

      // 3. V√©rification Sciences Po
      console.assert(schoolsScPo.length === 10, "‚ö†Ô∏è Sciences Po doit avoir 10 entr√©es");
      console.log("‚úÖ Sciences Po:", schoolsScPo.length);

      // 4. V√©rification universit√©s
      console.assert(schoolsUniversite.length === 20, "‚ö†Ô∏è Universit√©s doit avoir 20 entr√©es");
      console.log("‚úÖ Universit√©s:", schoolsUniversite.length);

      // 5. V√©rification IT
      console.assert(schoolsIT.length > 0, "‚ö†Ô∏è Pas d'√©coles IT d√©tect√©es");
      console.assert(Object.keys(functionsIT).length > 0, "‚ö†Ô∏è Pas de fonctions IT d√©tect√©es");
      console.log("‚úÖ IT √âcoles:", schoolsIT.length, "| M√©tiers IT:", Object.keys(functionsIT).length);

      // 6. V√©rification Design
      console.assert(schoolsDesign.length > 0, "‚ö†Ô∏è Pas d'√©coles Design d√©tect√©es");
      console.assert(Object.keys(functionsDesign).length > 0, "‚ö†Ô∏è Pas de fonctions Design d√©tect√©es");
      console.log("‚úÖ Design √âcoles:", schoolsDesign.length, "| M√©tiers Design:", Object.keys(functionsDesign).length);

      // 7. V√©rification Fonctions transverses
      const totalFunctions = {
        ...functionsAchats,
        ...functionsImmo,
        ...functionsRH,
        ...functionsFinance,
        ...functionsCommerciaux,
        ...functionsIT,
        ...functionsDesign,
        ...functionsOps
        
      };
      console.assert(Object.keys(totalFunctions).length > 0, "‚ö†Ô∏è Aucune fonction d√©tect√©e");
      console.log("‚úÖ Fonctions globales:", Object.keys(totalFunctions).length);

      // 8. Test calcul d‚Äôun cas simple
      document.getElementById("sector").value = "ingenieur";
      document.getElementById("school").value = 0; // Polytechnique
      document.getElementById("experience").value = 5;
      calculateSalary();
      console.log("‚úÖ Test calcul simple effectu√© (Polytechnique, 5 ans exp)");

      console.log("=== Fin des tests ===");
    }

    // Lancement auto apr√®s chargement
    window.onload = () => {
      populateMenus();
      setTimeout(runTests, 1000); // laisse le temps au DOM de charger
    }
  </script>


<script>
async function exportPDF() {
  console.log("üëâ Export PDF lanc√©");

  try {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: "a4" });

    // === POLICE ET STYLE DE BASE ===
    doc.setFont("helvetica", "normal");
    doc.setFontSize(9);
    doc.setTextColor(0, 0, 0);

    // === HEADER ===
    doc.setFillColor(0, 51, 102);
    doc.rect(0, 0, 210, 30, "F");
    doc.setFont("helvetica", "bold");
    doc.setFontSize(15);
    doc.setTextColor(255, 255, 255);
    doc.text("Rapport Salaire - Flying Whales", 15, 18);

    // === INFOS PROFIL ===
    const school = document.querySelector("#school option:checked")?.text || "N/A";
    const job = document.querySelector("#fonction option:checked")?.text || "N/A";
    const classification = document.querySelector("#classification option:checked")?.text || "Classique";
    const experience = (document.querySelector("#experience")?.value || "0") + " ans";
    const subdomain = document.querySelector("#subdomain option:checked")?.text || "";
    const sourceVal = document.querySelector("#source")?.value || "marche";
    const median = document.getElementById("median")?.innerText || "N/A";
    const range = document.getElementById("range")?.innerText || "N/A";
    const insightText = document.getElementById("insightText")?.innerText || "";

    // === TEXTE SOURCE CLEAN ===
    let sourceClean = "March√©";
    if (sourceVal === "fw") sourceClean = "Flying Whales (interne)";
    if (sourceVal === "croisee") sourceClean = "Donn√©es crois√©es";

    // === HEADER SOUS-TITRE ===
    doc.setFontSize(9);
    doc.setTextColor(230, 230, 230);
    doc.text(
      `${job} | ${school} | ${classification} | ${experience}${subdomain ? " | " + subdomain : ""}`,
      15,
      27
    );

    // === TABLEAU √âCOLE ===
    let y = 45;
    doc.setFont("helvetica", "bold");
    doc.setFontSize(11);
    doc.setTextColor(0, 0, 0);
    doc.text("R√©f√©rence √©cole :", 15, y);

    y += 8;
    doc.setFillColor(230, 236, 245);
    doc.rect(15, y, 180, 10, "F");
    doc.setFontSize(9);
    doc.text("√âcole", 20, y + 7);
    doc.text("P25 (‚Ç¨)", 95, y + 7);
    doc.text("M√©dian (‚Ç¨)", 130, y + 7);
    doc.text("P75 (‚Ç¨)", 165, y + 7);

    // === LIGNE √âCOLE ===
    y += 12;
    const dataset = [
      ...Object.values(schoolsIngenieur),
      ...Object.values(schoolsCommerce),
      ...Object.values(schoolsScPo),
      ...Object.values(schoolsUniversite),
      ...Object.values(schoolsIT),
      ...Object.values(schoolsDesign)
    ];
    const data = dataset.find(e => e.Ecole === school);
    const formatNumber = n => (n ? n.toLocaleString("fr-FR", { useGrouping: true }).replace(/\s/g, " ") + " ‚Ç¨" : "N/A");


    const p25 = data ? formatNumber(data.p25) : "N/A";
    const p50 = data ? formatNumber(data.p50) : "N/A";
    const p75 = data ? formatNumber(data.p75) : "N/A";

    doc.setFillColor(250, 250, 250);
    doc.rect(15, y, 180, 10, "F");
    doc.setFont("helvetica", "normal");
    doc.text(school, 20, y + 7);
    doc.text(p25, 105, y + 7, { align: "right" });
    doc.text(p50, 145, y + 7, { align: "right" });
    doc.text(p75, 185, y + 7, { align: "right" });

    // === CARTES KPI ===
    y += 25;
    const cardY = y;
    const cardHeight = 25;

    doc.setFont("helvetica", "bold");
    doc.setTextColor(255, 255, 255);

    // M√©dian
    doc.setFillColor(46, 204, 113);
    doc.roundedRect(15, cardY, 60, cardHeight, 3, 3, "F");
    doc.setFontSize(12);
    doc.text("M√©dian", 20, cardY + 10);
    doc.setFontSize(13);
    doc.text(median, 20, cardY + 20);

    // Fourchette
    doc.setFillColor(52, 152, 219);
    doc.roundedRect(85, cardY, 70, cardHeight, 3, 3, "F");
    doc.setFontSize(12);
    doc.text("Fourchette", 90, cardY + 10);
    doc.setFontSize(13);
    doc.text(range, 90, cardY + 20);

    // Source
    doc.setFillColor(255, 165, 100);
    doc.roundedRect(165, cardY, 30, cardHeight, 3, 3, "F");
    doc.setFontSize(12);
    doc.text("Source", 168, cardY + 10);
    doc.setFontSize(10);
    doc.text(sourceClean, 168, cardY + 20);

    // === GRAPH ===
    y += 45;
    doc.setFont("helvetica", "bold");
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    doc.text("Projection salariale sur 40 ans", 15, y);

    const chartCanvas = document.getElementById("salaryChart");
    if (chartCanvas) {
      const imgData = chartCanvas.toDataURL("image/png", 1.0);
      doc.addImage(imgData, "PNG", 12, y + 7, 155,65);
      y += 95;
    }

    // === ANALYSE PERSONNALIS√âE ===
    const insightBox = document.getElementById("insightBox");
    const bgColor = window.getComputedStyle(insightBox).backgroundColor;
    const rgbMatch = bgColor.match(/\d+/g);
    const [r, g, b] = rgbMatch ? rgbMatch.map(Number) : [230, 250, 230];
    const cleanInsight = insightText
      .replace(/\s+/g, " ")
      .replace(/[^\p{L}\p{N}\p{P}\p{Z}‚Ç¨]/gu, "") // supprime caract√®res bizarres
      .trim();

    const wrappedInsight = doc.splitTextToSize(cleanInsight, 165);
    const blockHeight = Math.max(30, wrappedInsight.length * 5.5 + 15);

    y += 10;
    doc.setFillColor(r, g, b);
    doc.roundedRect(15, y, 180, blockHeight, 3, 3, "F");
    doc.setFont("helvetica", "bold");
    doc.setTextColor(0, 0, 0);
    doc.text("Analyse personnalis√©e :", 20, y + 10);

    doc.setFont("helvetica", "normal");
    doc.setFontSize(10);
    doc.text(wrappedInsight, 20, y + 18, { maxWidth: 165 });
    y += blockHeight + 10;

    // === FOOTER ===
    doc.setFontSize(7);
    doc.setFont("helvetica", "italic");
    doc.setTextColor(100);
    let disclaimer = "Estimation indicative bas√©e sur le simulateur Flying Whales.";
    if (sourceVal === "marche") disclaimer = "Bas√©e sur les donn√©es march√©.";
    else if (sourceVal === "fw") disclaimer = "Bas√©e sur les packages internes Flying Whales.";
    else if (sourceVal === "croisee") disclaimer = "Combinaison march√© (40%) et FW (60%).";

    doc.text(disclaimer, 15, 280);
    const today = new Date();
    const dateStr = today.toLocaleDateString("fr-FR");
    doc.text("Export√© le " + dateStr, 195, 280, { align: "right" });

    // === SAVE ===
    doc.save("simulateur_salaire.pdf");
    console.log("‚úÖ PDF g√©n√©r√© et t√©l√©charg√©");
  } catch (err) {
    console.error("‚ùå Erreur export PDF :", err);
    alert("Erreur lors de l'export PDF !");
  }
}
</script>
</body>
</html>
