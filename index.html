<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulateur Salaire + Comparateur Complet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    body { 
  font-family: 'Poppins', sans-serif;
  overflow-x: hidden;
}

.tab-active {
  background: linear-gradient(135deg, #00AEEF 0%, #003366 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 174, 239, 0.3);
}

.tab-inactive {
  background: white;
  color: #003366;
  border: 2px solid #e5e7eb;
}

.dark .tab-inactive {
  background: #1f2937;
  color: #e5e7eb;
  border-color: #374151;
}

.comparison-bar {
  transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}

.dark input, .dark select {
  background-color: #374151 !important;
  color: #f9fafb !important;
  border-color: #4b5563 !important;
}

.school-info-box {
  transition: all 0.3s ease;
  opacity: 0;
  max-height: 0;
  overflow: hidden;
}

.school-info-box.show {
  opacity: 1;
  max-height: 200px;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.02); }
}

.pulse-btn {
  animation: pulse 2s infinite;
}

/* ====================================
   üì± RESPONSIVE MOBILE
   ==================================== */

/* Tablette et mobile */
@media (max-width: 1024px) {
  header h1 {
    font-size: 1.5rem !important;
  }

  .max-w-7xl, .max-w-5xl {
    padding-left: 1rem;
    padding-right: 1rem;
  }

  /* Tabs responsive */
  .tab-active, .tab-inactive {
    padding: 0.5rem 1rem !important;
    font-size: 0.875rem;
  }

  /* Grilles responsive */
  .grid {
    grid-template-columns: 1fr !important;
  }

  /* Profils comparateur c√¥te √† c√¥te sur tablette */
  @media (min-width: 768px) {
    .grid.lg\\:grid-cols-2 {
      grid-template-columns: repeat(2, 1fr) !important;
    }
  }
}

/* Mobile strict */
@media (max-width: 640px) {
  body {
    font-size: 14px;
  }

  header {
    padding: 1rem 0 !important;
  }

  header h1 {
    font-size: 1.25rem !important;
  }

  header button {
    padding: 0.5rem 0.75rem !important;
    font-size: 0.875rem;
  }

  /* Tabs mobile */
  .flex.gap-4 {
    gap: 0.5rem !important;
  }

  .tab-active, .tab-inactive {
    padding: 0.5rem 0.75rem !important;
    font-size: 0.75rem;
    flex: 1;
    text-align: center;
  }

  /* Cartes */
  .rounded-2xl {
    border-radius: 1rem !important;
  }

  .p-8 {
    padding: 1rem !important;
  }

  .p-6 {
    padding: 0.875rem !important;
  }

  /* Inputs et selects plus grands (touch-friendly) */
  select, input[type="range"] {
    padding: 0.75rem !important;
    font-size: 1rem !important;
    min-height: 44px; /* Taille minimum Apple */
  }

  /* Boutons plus grands */
  button {
    padding: 0.75rem 1.25rem !important;
    font-size: 1rem !important;
    min-height: 44px;
  }

  /* Titres */
  h2 {
    font-size: 1.25rem !important;
  }

  h1 {
    font-size: 1.5rem !important;
  }

  /* R√©sultats m√©dians */
  .text-3xl {
    font-size: 1.75rem !important;
  }

  .text-4xl {
    font-size: 2rem !important;
  }

  /* Labels plus petits */
  label {
    font-size: 0.8rem !important;
  }

  /* Espacement r√©duit */
  .space-y-4 > * + * {
    margin-top: 0.75rem !important;
  }

  .space-y-3 > * + * {
    margin-top: 0.5rem !important;
  }

  .gap-6 {
    gap: 1rem !important;
  }

  .gap-4 {
    gap: 0.75rem !important;
  }

  /* Scroll optimis√© pour profils comparateur */
  .max-h-\\[650px\\] {
    max-height: 400px !important;
  }

  /* School info box */
  .school-info-box {
    padding: 0.5rem !important;
    font-size: 0.75rem !important;
  }

  /* Barre de comparaison */
  .h-12 {
    height: 3rem !important;
  }

  .comparison-bar span {
    font-size: 0.75rem !important;
    padding: 0 0.5rem !important;
  }

  /* Graphique Chart.js */
  canvas {
    max-height: 200px !important;
  }

  /* Insights */
  #comparison-insight p,
  #insight-main,
  #insight-academic,
  #insight-professional {
    font-size: 0.875rem !important;
    line-height: 1.4 !important;
  }

  /* Grid colonnes forc√©es */
  .grid.md\\:grid-cols-2,
  .grid.md\\:grid-cols-3 {
    grid-template-columns: 1fr !important;
  }

  /* Cartes r√©sultats empil√©es */
  .bg-gradient-to-br {
    padding: 1rem !important;
  }

  /* Padding g√©n√©ral r√©duit */
  .px-8 {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }

  .pb-12 {
    padding-bottom: 2rem !important;
  }

  /* Range slider plus visible */
  input[type="range"] {
    height: 8px;
  }

  input[type="range"]::-webkit-slider-thumb {
    width: 24px;
    height: 24px;
  }

  input[type="range"]::-moz-range-thumb {
    width: 24px;
    height: 24px;
  }
}

/* Tr√®s petit mobile (iPhone SE, etc.) */
@media (max-width: 375px) {
  header h1 {
    font-size: 1rem !important;
  }

  .tab-active, .tab-inactive {
    font-size: 0.7rem;
    padding: 0.4rem 0.5rem !important;
  }

  .text-4xl {
    font-size: 1.5rem !important;
  }

  .text-3xl {
    font-size: 1.25rem !important;
  }

  .text-2xl {
    font-size: 1.125rem !important;
  }
}

/* Mode paysage mobile */
@media (max-width: 896px) and (orientation: landscape) {
  header {
    padding: 0.5rem 0 !important;
  }

  .max-h-\\[650px\\],
  .max-h-\\[600px\\] {
    max-height: 300px !important;
  }
}
  </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
  
  <!-- Header -->
  <header class="w-full py-6 bg-gradient-to-r from-[#00AEEF] to-[#003366] text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-8 flex justify-between items-center">
      <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold">‚úàÔ∏è Simulateur Salaire</h1>
      <button onclick="toggleDarkMode()" class="px-3 py-2 sm:px-4 bg-white/20 hover:bg-white/30 rounded-lg transition text-sm sm:text-base">
        üåô/‚òÄÔ∏è
      </button>
    </div>
  </header>

<!-- Navigation Tabs -->
  <div class="max-w-7xl mx-auto px-4 sm:px-8 mt-6">
    <div class="flex gap-2 sm:gap-4 mb-6">
      <button 
        id="tab-simulator" 
        onclick="switchTab('simulator')" 
        class="tab-active flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
        <span class="hidden sm:inline">üìä </span>Simulateur
      </button>
      <button 
        id="tab-comparator" 
        onclick="switchTab('comparator')" 
        class="tab-inactive flex-1 sm:flex-none px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base">
        <span class="hidden sm:inline">üë• </span>Comparateur
      </button>
    </div>
  </div>>
  
<!-- ============================================= -->
  <!-- CONTENU : SIMULATEUR -->
  <!-- ============================================= -->
  <div id="content-simulator" class="max-w-5xl mx-auto px-4 sm:px-8 pb-8 sm:pb-12">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8 mb-6">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìù Renseigne ton profil</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
        
        <!-- Secteur -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè∑Ô∏è Secteur</label>
          <select id="sector" class="w-full p-2 border rounded-lg">
            <option value="ingenieur">Ing√©nierie</option>
            <option value="commerce">Grande √©cole de commerce</option>
            <option value="scpo">Sciences Po</option>
            <option value="universite">Universit√©</option>
            <option value="it">Informatique / IT</option>
            <option value="design">Design / UX / UI</option>
            <option value="fonction">Fonctions transverses</option>
          </select>
        </div>

        <!-- √âcole -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìö √âcole</label>
          <select id="school" class="w-full p-2 border rounded-lg"></select>
        </div>
      </div>

<!-- Fourchette sortie d'√©cole -->
      <div id="schoolInfo" class="school-info-box mt-3 p-2 sm:p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500">
        <p class="text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Salaire sortie d'√©cole</p>
        <div class="grid grid-cols-3 gap-2 text-xs">
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">P25:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP25">‚Äî</span>
          </div>
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">M√©d:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP50">‚Äî</span>
          </div>
          <div>
            <span class="text-gray-600 dark:text-gray-400 block sm:inline">P75:</span>
            <span class="font-bold text-blue-600 dark:text-blue-400 block sm:inline" id="schoolP75">‚Äî</span>
          </div>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-4 mt-4">
        <!-- Niveau d'anglais -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üåé Niveau d'anglais</label>
          <select id="englishLevel" class="w-full p-2 border rounded-lg">
            <option value="basic">Basique (A2‚ÄìB1)</option>
            <option value="intermediate">Interm√©diaire (B2)</option>
            <option value="advanced">Avanc√© (C1)</option>
            <option value="bilingual">Bilingue / International (C2)</option>
          </select>
        </div>

        <!-- Niveau d'√©tudes -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üéì Niveau d'√©tudes</label>
          <select id="educationLevel" class="w-full p-2 border rounded-lg">
            <option value="technicien">Technicien / Bac +2</option>
            <option value="bac3">Licence / Bac +3</option>
            <option value="bac5" selected>Master / Ing√©nieur / Bac +5</option>
            <option value="doctorat">Doctorat / PhD</option>
          </select>
        </div>

        <!-- Type de contrat -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìú Type de contrat</label>
          <select id="contractType" class="w-full p-2 border rounded-lg">
            <option value="cdi">CDI</option>
            <option value="cdd">CDD</option>
            <option value="alternance">Alternance</option>
            <option value="freelance">Freelance / Ind√©pendant</option>
            <option value="expatriation">Expatri√© / D√©tach√© √† l'√©tranger</option>
          </select>
        </div>

        <!-- Secteur industriel -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè≠ Secteur industriel</label>
          <select id="industry" class="w-full p-2 border rounded-lg">
            <option value="aero">A√©ronautique / Spatial</option>
            <option value="auto">Automobile / Mobilit√©</option>
            <option value="energie">√ânergie / Nucl√©aire</option>
            <option value="num√©rique">Num√©rique / IT</option>
            <option value="sante">Sant√© / Biotech</option>
            <option value="luxe">Luxe / Design</option>
            <option value="public">Secteur public</option>
          </select>
        </div>

        <!-- Taille d'√©quipe -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üë• Taille d'√©quipe encadr√©e</label>
          <select id="teamSize" class="w-full p-2 border rounded-lg">
            <option value="none">Aucune</option>
            <option value="small">1 √† 5 personnes</option>
            <option value="medium">6 √† 15 personnes</option>
            <option value="large">16 √† 50 personnes</option>
            <option value="xl">Plus de 50 personnes</option>
          </select>
        </div>

        <!-- Package global -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üéÅ Package global</label>
          <select id="packageLevel" class="w-full p-2 border rounded-lg">
            <option value="standard">Salaire fixe + variable (Package)</option>
            <option value="bonus">Package + bonus (5‚Äì10%)</option>
            <option value="bonusplus">Package + variable (15‚Äì25%)</option>
            <option value="actions">Package + actions / BSPCE</option>
          </select>
        </div>

        <!-- Exp√©rience -->
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">
            üìÖ Exp√©rience: <span id="expVal">3</span> ans
          </label>
          <input type="range" id="experience" min="0" max="40" value="3" class="w-full accent-blue-600">
        </div>

        <!-- R√©gion -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üåç R√©gion</label>
          <select id="region" class="w-full p-2 border rounded-lg">
            <option value="IDF">√éle-de-France</option>
            <option value="hors">Hors √éle-de-France</option>
          </select>
        </div>

        <!-- Taille entreprise -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè¢ Taille entreprise</label>
          <select id="companySize" class="w-full p-2 border rounded-lg">
            <option value="startup">Startup</option>
            <option value="PME">PME</option>
            <option value="ETI">ETI</option>
            <option value="grand-groupe">Grand Groupe</option>
          </select>
        </div>

        <!-- Classification interne -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üè∑Ô∏è Classification interne</label>
          <select id="classification" class="w-full p-2 border rounded-lg">
            <option value="">-- Optionnelle --</option>
            <option value="I1">I1 - Ing√©nieur D√©butant</option>
            <option value="I2">I2 - Ing√©nieur Confirm√©</option>
            <option value="I3">I3 - Ing√©nieur Senior</option>
            <option value="I4">I4 - Ing√©nieur Expert</option>
            <option value="M1">M1 - Manager Niveau 1</option>
            <option value="M2">M2 - Manager Niveau 2</option>
            <option value="M3">M3 - Leader D√©partement</option>
          </select>
        </div>

        <!-- Source des donn√©es -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">üìä Source des donn√©es</label>
          <select id="source" class="w-full p-2 border rounded-lg">
            <option value="marche">üåç March√©</option>
            <option value="fw">üè¢ Flying Whales (interne)</option>
            <option value="croisee">‚öñÔ∏è Donn√©es crois√©es</option>
          </select>
        </div>
      </div>
    </div>

<!-- R√©sultats Simulateur -->
    <div id="result" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8 hidden">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìä R√©sultats</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-4 sm:mb-6">
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Salaire M√©dian</p>
          <p class="text-2xl sm:text-3xl font-bold text-blue-600" id="median">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Fourchette Basse</p>
          <p class="text-2xl sm:text-3xl font-bold text-green-600" id="low">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Fourchette Haute</p>
          <p class="text-2xl sm:text-3xl font-bold text-purple-600" id="high">‚Äî</p>
        </div>
      </div>
      
      <canvas id="salaryChart" class="mt-4 sm:mt-6"></canvas>

      <!-- Bouton Export PDF -->
      <button onclick="exportSimulatorPDF()" class="mt-4 sm:mt-6 w-full sm:w-auto px-4 sm:px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition pulse-btn text-sm sm:text-base">
        üìÑ Exporter en PDF
      </button>
    </div>
  </div>
  
<!-- ============================================= -->
  <!-- CONTENU : COMPARATEUR -->
  <!-- ============================================= -->
  <div id="content-comparator" class="max-w-7xl mx-auto px-4 sm:px-8 pb-8 sm:pb-12 hidden">
    
    <!-- Grille de comparaison -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
      
      <!-- ========== PROFIL A ========== -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 sm:p-6 text-white">
          <h2 class="text-xl sm:text-2xl font-bold mb-2">Profil A</h2>
          <p class="text-2xl sm:text-4xl font-bold" id="resultA-median">‚Äî</p>
        </div>
        <div class="p-4 sm:p-6 space-y-2 sm:space-y-3 max-h-[400px] sm:max-h-[650px] overflow-y-auto">
          
          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur</label>
            <select id="sectorA" class="w-full p-2 text-sm border rounded-lg">
              <option value="ingenieur">Ing√©nierie</option>
              <option value="commerce">Commerce</option>
              <option value="scpo">Sciences Po</option>
              <option value="universite">Universit√©</option>
              <option value="it">IT</option>
              <option value="design">Design</option>
              <option value="fonction">Fonctions transverses</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">√âcole</label>
            <select id="schoolA" class="w-full p-2 text-sm border rounded-lg"></select>
          </div>

          <!-- Fourchette √âcole A -->
          <div id="schoolInfoA" class="school-info-box p-2 bg-blue-50 dark:bg-blue-900/20 rounded border-l-4 border-blue-500">
            <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Sortie d'√©cole</p>
            <div class="flex justify-between text-xs">
              <div><span class="text-gray-600 dark:text-gray-400">P25:</span> <span class="font-bold text-blue-600" id="schoolP25A">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">M√©d:</span> <span class="font-bold text-blue-600" id="schoolP50A">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">P75:</span> <span class="font-bold text-blue-600" id="schoolP75A">‚Äî</span></div>
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'anglais</label>
            <select id="englishLevelA" class="w-full p-2 text-sm border rounded-lg">
              <option value="basic">Basique (A2‚ÄìB1)</option>
              <option value="intermediate">Interm√©diaire (B2)</option>
              <option value="advanced">Avanc√© (C1)</option>
              <option value="bilingual">Bilingue (C2)</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'√©tudes</label>
            <select id="educationLevelA" class="w-full p-2 text-sm border rounded-lg">
              <option value="technicien">Bac +2</option>
              <option value="bac3">Bac +3</option>
              <option value="bac5" selected>Bac +5</option>
              <option value="doctorat">Doctorat</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Type de contrat</label>
            <select id="contractTypeA" class="w-full p-2 text-sm border rounded-lg">
              <option value="cdi">CDI</option>
              <option value="cdd">CDD</option>
              <option value="alternance">Alternance</option>
              <option value="freelance">Freelance</option>
              <option value="expatriation">Expatri√©</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur industriel</label>
            <select id="industryA" class="w-full p-2 text-sm border rounded-lg">
              <option value="aero">A√©ronautique</option>
              <option value="auto">Automobile</option>
              <option value="energie">√ânergie</option>
              <option value="num√©rique">Num√©rique</option>
              <option value="sante">Sant√©</option>
              <option value="luxe">Luxe</option>
              <option value="public">Public</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille √©quipe</label>
            <select id="teamSizeA" class="w-full p-2 text-sm border rounded-lg">
              <option value="none">Aucune</option>
              <option value="small">1-5</option>
              <option value="medium">6-15</option>
              <option value="large">16-50</option>
              <option value="xl">50+</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Package</label>
            <select id="packageLevelA" class="w-full p-2 text-sm border rounded-lg">
              <option value="standard">Standard</option>
              <option value="bonus">Bonus 5-10%</option>
              <option value="bonusplus">Variable 15-25%</option>
              <option value="actions">Actions/BSPCE</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">
              Exp√©rience: <span id="expValA">3</span> ans
            </label>
            <input type="range" id="experienceA" min="0" max="40" value="3" class="w-full accent-blue-600">
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">R√©gion</label>
            <select id="regionA" class="w-full p-2 text-sm border rounded-lg">
              <option value="IDF">√éle-de-France</option>
              <option value="hors">Hors IDF</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille entreprise</label>
            <select id="companySizeA" class="w-full p-2 text-sm border rounded-lg">
              <option value="startup">Startup</option>
              <option value="PME">PME</option>
              <option value="ETI">ETI</option>
              <option value="grand-groupe" selected>Grand Groupe</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Classification</label>
            <select id="classificationA" class="w-full p-2 text-sm border rounded-lg">
              <option value="">Standard</option>
              <option value="I1">I1</option>
              <option value="I2">I2</option>
              <option value="I3">I3</option>
              <option value="I4">I4</option>
              <option value="M1">M1</option>
              <option value="M2">M2</option>
              <option value="M3">M3</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Source</label>
            <select id="sourceA" class="w-full p-2 text-sm border rounded-lg">
              <option value="marche">March√©</option>
              <option value="fw">FW</option>
              <option value="croisee">Crois√©e</option>
            </select>
          </div>

          <div class="pt-3 border-t">
            <p class="text-xs text-gray-600 dark:text-gray-400">
              Fourchette: <span class="font-semibold text-gray-800 dark:text-white" id="resultA-range">‚Äî</span>
            </p>
          </div>
        </div>
      </div>

      <!-- ========== PROFIL B ========== -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 sm:p-6 text-white">
          <h2 class="text-xl sm:text-2xl font-bold mb-2">Profil B</h2>
          <p class="text-2xl sm:text-4xl font-bold" id="resultB-median">‚Äî</p>
        </div>
        <div class="p-4 sm:p-6 space-y-2 sm:space-y-3 max-h-[400px] sm:max-h-[650px] overflow-y-auto">
          
          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur</label>
            <select id="sectorB" class="w-full p-2 text-sm border rounded-lg">
              <option value="ingenieur">Ing√©nierie</option>
              <option value="commerce">Commerce</option>
              <option value="scpo">Sciences Po</option>
              <option value="universite">Universit√©</option>
              <option value="it">IT</option>
              <option value="design">Design</option>
              <option value="fonction">Fonctions transverses</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">√âcole</label>
            <select id="schoolB" class="w-full p-2 text-sm border rounded-lg"></select>
          </div>

          <!-- Fourchette √âcole B -->
          <div id="schoolInfoB" class="school-info-box p-2 bg-green-50 dark:bg-green-900/20 rounded border-l-4 border-green-500">
            <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">üìò Sortie d'√©cole</p>
            <div class="flex justify-between text-xs">
              <div><span class="text-gray-600 dark:text-gray-400">P25:</span> <span class="font-bold text-green-600" id="schoolP25B">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">M√©d:</span> <span class="font-bold text-green-600" id="schoolP50B">‚Äî</span></div>
              <div><span class="text-gray-600 dark:text-gray-400">P75:</span> <span class="font-bold text-green-600" id="schoolP75B">‚Äî</span></div>
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'anglais</label>
            <select id="englishLevelB" class="w-full p-2 text-sm border rounded-lg">
              <option value="basic">Basique (A2‚ÄìB1)</option>
              <option value="intermediate">Interm√©diaire (B2)</option>
              <option value="advanced">Avanc√© (C1)</option>
              <option value="bilingual">Bilingue (C2)</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Niveau d'√©tudes</label>
            <select id="educationLevelB" class="w-full p-2 text-sm border rounded-lg">
              <option value="technicien">Bac +2</option>
              <option value="bac3">Bac +3</option>
              <option value="bac5" selected>Bac +5</option>
              <option value="doctorat">Doctorat</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Type de contrat</label>
            <select id="contractTypeB" class="w-full p-2 text-sm border rounded-lg">
              <option value="cdi">CDI</option>
              <option value="cdd">CDD</option>
              <option value="alternance">Alternance</option>
              <option value="freelance">Freelance</option>
              <option value="expatriation">Expatri√©</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Secteur industriel</label>
            <select id="industryB" class="w-full p-2 text-sm border rounded-lg">
              <option value="aero">A√©ronautique</option>
              <option value="auto">Automobile</option>
              <option value="energie">√ânergie</option>
              <option value="num√©rique">Num√©rique</option>
              <option value="sante">Sant√©</option>
              <option value="luxe">Luxe</option>
              <option value="public">Public</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille √©quipe</label>
            <select id="teamSizeB" class="w-full p-2 text-sm border rounded-lg">
              <option value="none">Aucune</option>
              <option value="small">1-5</option>
              <option value="medium">6-15</option>
              <option value="large">16-50</option>
              <option value="xl">50+</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Package</label>
            <select id="packageLevelB" class="w-full p-2 text-sm border rounded-lg">
              <option value="standard">Standard</option>
              <option value="bonus">Bonus 5-10%</option>
              <option value="bonusplus">Variable 15-25%</option>
              <option value="actions">Actions/BSPCE</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">
              Exp√©rience: <span id="expValB">5</span> ans
            </label>
            <input type="range" id="experienceB" min="0" max="40" value="5" class="w-full accent-green-600">
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">R√©gion</label>
            <select id="regionB" class="w-full p-2 text-sm border rounded-lg">
              <option value="IDF">√éle-de-France</option>
              <option value="hors" selected>Hors IDF</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Taille entreprise</label>
            <select id="companySizeB" class="w-full p-2 text-sm border rounded-lg">
              <option value="startup">Startup</option>
              <option value="PME" selected>PME</option>
              <option value="ETI">ETI</option>
              <option value="grand-groupe">Grand Groupe</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Classification</label>
            <select id="classificationB" class="w-full p-2 text-sm border rounded-lg">
              <option value="">Standard</option>
              <option value="I1">I1</option>
              <option value="I2">I2</option>
              <option value="I3">I3</option>
              <option value="I4">I4</option>
              <option value="M1">M1</option>
              <option value="M2">M2</option>
              <option value="M3">M3</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold mb-1 text-gray-700 dark:text-gray-300">Source</label>
            <select id="sourceB" class="w-full p-2 text-sm border rounded-lg">
              <option value="marche">March√©</option>
              <option value="fw">FW</option>
              <option value="croisee">Crois√©e</option>
            </select>
          </div>

          <div class="pt-3 border-t">
            <p class="text-xs text-gray-600 dark:text-gray-400">
              Fourchette: <span class="font-semibold text-gray-800 dark:text-white" id="resultB-range">‚Äî</span>
            </p>
          </div>
        </div>
      </div>
    </div>

<!-- ========== ANALYSE COMPARATIVE PEAUFIN√âE ========== -->
    <div id="comparison-results" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">üìä Analyse Comparative</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Diff√©rence (A - B)</p>
          <p id="diff-absolute" class="text-2xl sm:text-3xl font-bold">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">√âcart relatif</p>
          <p id="diff-percent" class="text-2xl sm:text-3xl font-bold">‚Äî</p>
        </div>
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 sm:p-6">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-2">Ratio A/B</p>
          <p id="diff-ratio" class="text-2xl sm:text-3xl font-bold text-blue-600">‚Äî</p>
        </div>
      </div>

      <!-- Visualisation barre -->
      <div class="mb-4 sm:mb-6">
        <div class="flex items-center justify-between mb-2 sm:mb-3">
          <span class="text-xs sm:text-sm font-semibold text-blue-600">Profil A</span>
          <span class="text-xs sm:text-sm font-semibold text-green-600">Profil B</span>
        </div>
        <div class="relative h-10 sm:h-12 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
          <div id="bar-A" class="comparison-bar absolute top-0 left-0 h-full bg-blue-500 flex items-center justify-end pr-2 sm:pr-3" style="width: 50%">
            <span class="text-white text-xs sm:text-sm font-bold" id="bar-A-text">‚Äî</span>
          </div>
          <div id="bar-B" class="comparison-bar absolute top-0 right-0 h-full bg-green-500 flex items-center justify-start pl-2 sm:pl-3" style="width: 50%">
            <span class="text-white text-xs sm:text-sm font-bold" id="bar-B-text">‚Äî</span>
          </div>
        </div>
      </div>

      <!-- Analyse d√©taill√©e multi-facteurs -->
      <div id="comparison-insight" class="space-y-3 sm:space-y-4">
        <!-- Insight principal -->
        <div class="p-3 sm:p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
          <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">
            üí° <strong>Synth√®se :</strong> <span id="insight-main">Configure les deux profils pour voir l'analyse.</span>
          </p>
        </div>

        <!-- D√©tails comparatifs -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
          <div class="p-3 sm:p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
            <p class="text-xs font-semibold text-blue-700 dark:text-blue-300 mb-2">üéì Facteurs acad√©miques</p>
            <p id="insight-academic" class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">‚Äî</p>
          </div>
          <div class="p-3 sm:p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
            <p class="text-xs font-semibold text-green-700 dark:text-green-300 mb-2">üíº Facteurs professionnels</p>
            <p id="insight-professional" class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">‚Äî</p>
          </div>
        </div>
      </div>

      <!-- Bouton Export PDF Comparaison -->
      <button onclick="exportComparisonPDF()" class="mt-4 sm:mt-6 w-full sm:w-auto px-4 sm:px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition pulse-btn text-sm sm:text-base">
        üìÑ Exporter la comparaison en PDF
      </button>
    </div>
  </div>
  
  <!-- ============================================= -->
  <!-- SCRIPT COMPLET : DONN√âES + LOGIQUE -->
  <!-- ============================================= -->
  <script>
    // ===== TOUTES LES √âCOLES (DONN√âES COMPL√àTES) =====
    
    // 71 √âcoles d'ing√©nieurs
    const schoolsIngenieur = [
      { Ecole:"AgroParisTech", p25:41135, p50:43290, p75:44881 },
      { Ecole:"CENTRALE LILLE", p25:44886, p50:47528, p75:49058 },
      { Ecole:"Centrale Lyon", p25:46209, p50:48572, p75:50405 },
      { Ecole:"CENTRALE MARSEILLE", p25:44069, p50:46526, p75:48343 },
      { Ecole:"CENTRALE NANTES", p25:44069, p50:46526, p75:48343 },
      { Ecole:"CNAM", p25:42399, p50:44470, p75:46186 },
      { Ecole:"CPE LYON", p25:44354, p50:47226, p75:48952 },
      { Ecole:"ECAM LASALLE", p25:42327, p50:44639, p75:46354 },
      { Ecole:"EFREI PARIS", p25:46376, p50:48826, p75:50707 },
      { Ecole:"EI PURPAN", p25:37773, p50:40245, p75:42122 },
      { Ecole:"ENAC", p25:46878, p50:49601, p75:51537 },
      { Ecole:"ENGEES", p25:41546, p50:43956, p75:46258 },
      { Ecole:"ENI BREST", p25:40131, p50:42413, p75:44348 },
      { Ecole:"ENIM", p25:40788, p50:43661, p75:44789 },
      { Ecole:"ENISE", p25:40583, p50:43105, p75:44897 },
      { Ecole:"ENPC", p25:51562, p50:54355, p75:56797 },
      { Ecole:"ENSAIA", p25:41083, p50:43093, p75:45132 },
      { Ecole:"ENSAM", p25:44787, p50:46788, p75:48322 },
      { Ecole:"ENSC LILLE", p25:42070, p50:44533, p75:46408 },
      { Ecole:"ENSC MONTPELLIER", p25:42008, p50:44482, p75:46379 },
      { Ecole:"ENSC MULHOUSE", p25:41534, p50:44526, p75:46946 },
      { Ecole:"ENSC RENNES", p25:40159, p50:42815, p75:44974 },
      { Ecole:"ENSEA", p25:41829, p50:44221, p75:45882 },
      { Ecole:"ENSEIRB MATMECA", p25:44556, p50:47002, p75:48898 },
      { Ecole:"ENSEM", p25:42859, p50:45524, p75:47467 },
      { Ecole:"ENSGTI PAU", p25:44512, p50:46900, p75:48768 },
      { Ecole:"ENSI POITIERS", p25:39851, p50:42102, p75:43728 },
      { Ecole:"ENSIC", p25:44084, p50:46515, p75:48535 },
      { Ecole:"ENSICAEN", p25:41455, p50:44169, p75:45726 },
      { Ecole:"ENSIIE", p25:47536, p50:50298, p75:52473 },
      { Ecole:"ENSIL ENSCI", p25:40977, p50:43344, p75:44941 },
      { Ecole:"ENSMA", p25:40579, p50:43065, p75:44609 },
      { Ecole:"ENSMM", p25:41995, p50:44264, p75:46176 },
      { Ecole:"ENSTA", p25:46261, p50:48833, p75:50734 },
      { Ecole:"ENSTA BRETAGNE", p25:41949, p50:44081, p75:46198 },
      { Ecole:"ENTPE", p25:46289, p50:49067, p75:50863 },
      { Ecole:"ESA", p25:38334, p50:40900, p75:42233 },
      { Ecole:"ESCOM", p25:42003, p50:44499, p75:46560 },
      { Ecole:"ESEO", p25:42635, p50:45151, p75:46890 },
      { Ecole:"ESIEA", p25:43286, p50:45885, p75:47485 },
      { Ecole:"ESME SUDRIA", p25:42420, p50:44687, p75:46350 },
      { Ecole:"ESTP PARIS", p25:45163, p50:47416, p75:49305 },
      { Ecole:"Grenoble INP ense3", p25:42963, p50:45276, p75:46845 },
      { Ecole:"Grenoble INP ENSIMAG", p25:47093, p50:49721, p75:52230 },
      { Ecole:"Grenoble INP Pagora", p25:44597, p50:47520, p75:49835 },
      { Ecole:"Grenoble INP Phelma", p25:44178, p50:46881, p75:48593 },
      { Ecole:"HEI Junia", p25:41979, p50:44569, p75:46193 },
      { Ecole:"ICAM", p25:42159, p50:44262, p75:45939 },
      { Ecole:"INSA Lyon", p25:43733, p50:46209, p75:47758 },
      { Ecole:"INSA Rennes", p25:41703, p50:43841, p75:45798 },
      { Ecole:"INSA Rouen", p25:41747, p50:43887, p75:45750 },
      { Ecole:"INSA Strasbourg", p25:41718, p50:44200, p75:45847 },
      { Ecole:"INSA Val de Loire", p25:41330, p50:43640, p75:45632 },
      { Ecole:"IOTA", p25:44010, p50:46591, p75:48917 },
      { Ecole:"ISA JUNIA", p25:37427, p50:39511, p75:41236 },
      { Ecole:"ISAE SUPAERO", p25:47058, p50:49747, p75:51463 },
      { Ecole:"ISEN Lille", p25:43171, p50:45961, p75:48194 },
      { Ecole:"ISEP", p25:44546, p50:47223, p75:49110 },
      { Ecole:"ISMEP-SUPMECA", p25:41055, p50:43450, p75:45175 },
      { Ecole:"ITECH", p25:43641, p50:46534, p75:48523 },
      { Ecole:"Mines St Etienne", p25:48369, p50:50744, p75:52868 },
      { Ecole:"Polytech Grenoble", p25:43344, p50:46061, p75:48346 },
      { Ecole:"POLYTECHNIQUE", p25:57013, p50:59835, p75:62105 },
      { Ecole:"SIGMA", p25:43111, p50:45484, p75:47341 },
      { Ecole:"SUPELEC", p25:49405, p50:52285, p75:54153 },
      { Ecole:"Toulouse INP ENSEEIHT", p25:42714, p50:44978, p75:46697 },
      { Ecole:"Toulouse INP ENSIACET", p25:42714, p50:44978, p75:46697 },
      { Ecole:"UTC", p25:43177, p50:45658, p75:47442 },
      { Ecole:"Hors liste", p25:41840, p50:43726, p75:45414 }
    ];

    // 30 √âcoles de commerce
    const schoolsCommerce = [
      {Ecole:"HEC Paris", p25:45600, p50:52250, p75:61750},
      {Ecole:"ESSEC Business School", p25:42750, p50:49400, p75:58900},
      {Ecole:"ESCP Business School", p25:41800, p50:48450, p75:57000},
      {Ecole:"EDHEC Business School", p25:39900, p50:46600, p75:55100},
      {Ecole:"emlyon Business School", p25:40850, p50:47500, p75:56050},
      {Ecole:"Audencia Business School", p25:38000, p50:44650, p75:53200},
      {Ecole:"Skema Business School", p25:36100, p50:42750, p75:50350},
      {Ecole:"NEOMA Business School", p25:35150, p50:41800, p75:49400},
      {Ecole:"Kedge Business School", p25:33250, p50:39900, p75:47500},
      {Ecole:"TBS Education", p25:34200, p50:40850, p75:48450},
      {Ecole:"Grenoble EM", p25:35150, p50:41800, p75:49400},
      {Ecole:"Montpellier BS", p25:33250, p50:39900, p75:47500},
      {Ecole:"Rennes SB", p25:32300, p50:38950, p75:46550},
      {Ecole:"ICN Business School", p25:32300, p50:38000, p75:45600},
      {Ecole:"EM Strasbourg", p25:32300, p50:38000, p75:45600},
      {Ecole:"Excelia Business School", p25:31350, p50:37050, p75:44650},
      {Ecole:"ISC Paris", p25:31350, p50:37050, p75:43700},
      {Ecole:"INSEEC Grande √âcole", p25:30400, p50:36100, p75:42750},
      {Ecole:"PSB (Paris School of Business)", p25:30400, p50:36100, p75:42750},
      {Ecole:"EMLV", p25:30000, p50:36500, p75:43000},
      {Ecole:"ISG", p25:29450, p50:35150, p75:40850},
      {Ecole:"ESC Clermont BS", p25:29450, p50:34200, p75:39900},
      {Ecole:"Burgundy School of Business", p25:29450, p50:34200, p75:39900},
      {Ecole:"IMT-BS", p25:28500, p50:34200, p75:39900},
      {Ecole:"ESC Pau Business School", p25:28500, p50:33300, p75:38950},
      {Ecole:"SCBS", p25:28500, p50:33300, p75:38000},
      {Ecole:"Brest Business School", p25:27550, p50:32300, p75:37050},
      {Ecole:"ISCID-CO", p25:26600, p50:31350, p75:36100},
      {Ecole:"ICD Business School", p25:26600, p50:31350, p75:36100},
      {Ecole:"ESLSCA Business School Paris", p25:26600, p50:31350, p75:36100}
    ];

    // 10 Sciences Po
    const schoolsScPo = [
      {Ecole:"Sciences Po Paris", p25:35000, p50:39000, p75:44000},
      {Ecole:"Sciences Po Bordeaux", p25:32500, p50:35500, p75:40500},
      {Ecole:"Sciences Po Grenoble", p25:33000, p50:35500, p75:40500},
      {Ecole:"Sciences Po Lille", p25:32500, p50:35500, p75:40500},
      {Ecole:"Sciences Po Lyon", p25:33000, p50:36000, p75:41000},
      {Ecole:"Sciences Po Rennes", p25:31500, p50:34500, p75:39500},
      {Ecole:"Sciences Po Strasbourg", p25:32000, p50:35000, p75:40000},
      {Ecole:"Sciences Po Toulouse", p25:32000, p50:35000, p75:40000},
      {Ecole:"Sciences Po Saint-Germain-en-Laye", p25:30500, p50:33500, p75:38500},
      {Ecole:"Sciences Po Aix", p25:31500, p50:34500, p75:39500}
    ];

    // 20 Universit√©s
    const schoolsUniversite = [
      {Ecole:"Sorbonne Universit√©", p25:33250, p50:37000, p75:40850},
      {Ecole:"Universit√© Paris-Saclay", p25:33250, p50:37000, p75:40850},
      {Ecole:"Universit√© PSL", p25:33250, p50:37500, p75:41350},
      {Ecole:"Universit√© Paris Cit√©", p25:32300, p50:36100, p75:39900},
      {Ecole:"Universit√© de Montpellier", p25:31800, p50:35600, p75:39400},
      {Ecole:"Universit√© de Strasbourg", p25:31800, p50:35600, p75:39400},
      {Ecole:"Universit√© Grenoble Alpes", p25:31800, p50:35600, p75:39400},
      {Ecole:"Aix-Marseille Universit√©", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Bordeaux", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Lyon", p25:31300, p50:35100, p75:38900},
      {Ecole:"Universit√© de Lille", p25:30800, p50:34600, p75:38400},
      {Ecole:"Universit√© Toulouse III", p25:30800, p50:34600, p75:38400},
      {Ecole:"Universit√© de Nantes", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© de Rennes 1", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© de Lorraine", p25:30400, p50:34200, p75:38000},
      {Ecole:"Universit√© C√¥te d'Azur", p25:30500, p50:34500, p75:38500},
      {Ecole:"Universit√© de Tours", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© d'Angers", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© de Clermont Auvergne", p25:29500, p50:33300, p75:37100},
      {Ecole:"Universit√© de Reims", p25:29000, p50:32800, p75:36600}
    ];

    // 33 √âcoles IT
    const schoolsIT = [
      { Ecole:"√âcole 42", p25:30000, p50:35000, p75:42000 },
      { Ecole:"EPITA", p25:34000, p50:39000, p75:46000 },
      { Ecole:"Epitech", p25:33000, p50:38000, p75:45000 },
      { Ecole:"ENSIMAG / Grenoble INP", p25:35000, p50:40000, p75:47000 },
      { Ecole:"T√©l√©com Paris", p25:36000, p50:42000, p75:50000 },
      { Ecole:"T√©l√©com SudParis", p25:32000, p50:37000, p75:44000 },
      { Ecole:"T√©l√©com Nancy", p25:30000, p50:35000, p75:40000 },
      { Ecole:"INSA Lyon (informatique)", p25:32000, p50:37000, p75:43000 },
      { Ecole:"INSA Toulouse (informatique)", p25:31000, p50:36000, p75:42000 },
      { Ecole:"INSA Rennes (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"INSA Strasbourg (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"INSA Rouen (informatique)", p25:30000, p50:35000, p75:41000 },
      { Ecole:"EFREI Paris", p25:30000, p50:35000, p75:42000 },
      { Ecole:"ISEP Paris", p25:30000, p50:35000, p75:42000 },
      { Ecole:"ESGI", p25:28000, p50:33000, p75:39000 },
      { Ecole:"EfreiTech", p25:27000, p50:32000, p75:37000 },
      { Ecole:"Polytech Grenoble (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Polytech Lyon (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Universit√© Paris Cit√© (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Strasbourg (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Bordeaux (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Universit√© de Lille (info)", p25:28000, p50:32000, p75:36000 },
      { Ecole:"Sup√©lec / Centrale (info)", p25:35000, p50:41000, p75:48000 },
      { Ecole:"IUT Informatique", p25:26000, p50:30000, p75:35000 },
      { Ecole:"Licence Info (Sorbonne/Saclay)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"IESA / EIGSI Info", p25:27000, p50:32000, p75:38000 },
      { Ecole:"ESEO Angers (info)", p25:28000, p50:33000, p75:39000 },
      { Ecole:"ENIB Brest (info)", p25:28000, p50:33000, p75:38000 },
      { Ecole:"Data ScienceTech Institute", p25:30000, p50:35000, p75:42000 },
      { Ecole:"IA School Paris", p25:28000, p50:33000, p75:40000 },
      { Ecole:"Supinfo", p25:26000, p50:30000, p75:36000 },
      { Ecole:"YNOV Informatique", p25:27000, p50:32000, p75:38000 },
      { Ecole:"YNOV Cyber-s√©curit√©", p25:28000, p50:33000, p75:40000 }
    ];

    // 9 √âcoles Design
    const schoolsDesign = [
      { Ecole:"Strate √âcole de Design", p25:32000, p50:36000, p75:40000 },
      { Ecole:"ENSAD (Arts D√©cos)", p25:32000, p50:36000, p75:40000 },
      { Ecole:"√âcole Estienne", p25:32000, p50:36000, p75:40000 },
      { Ecole:"√âcole de Design Nantes Atlantique", p25:32000, p50:36000, p75:40000 },
      { Ecole:"Gobelins", p25:32000, p50:36000, p75:40000 },
      { Ecole:"ENSCI-Les Ateliers", p25:25000, p50:30000, p75:35000 },
      { Ecole:"LISAA", p25:32000, p50:36000, p75:40000 },
      { Ecole:"Universit√© (arts appliqu√©s)", p25:27000, p50:31000, p75:35000 },
      { Ecole:"Hors liste Design", p25:28000, p50:32000, p75:36000 }
    ];

    // 11 √âcoles Communication
    const schoolsCom = [
      { Ecole:"CELSA", p25:33250, p50:37000, p75:40850 },
      { Ecole:"ISCOM", p25:30000, p50:33000, p75:37000 },
      { Ecole:"Sup de Pub (INSEEC)", p25:28000, p50:31000, p75:35000 },
      { Ecole:"EFAP", p25:28000, p50:31000, p75:34000 },
      { Ecole:"ESP", p25:27000, p50:30000, p75:33000 },
      { Ecole:"ISEG", p25:27000, p50:30000, p75:33000 },
      { Ecole:"ECS", p25:26000, p50:29000, p75:32000 },
      { Ecole:"Sup de Com", p25:27000, p50:30000, p75:34000 },
      { Ecole:"Audencia SciencesCom", p25:31000, p50:34000, p75:38000 },
      { Ecole:"ISCPA", p25:26000, p50:29000, p75:32000 },
      { Ecole:"Hors liste Communication", p25:25000, p50:28000, p75:31000 }
    ];

    // 17 √âcoles RH
    const schoolsRH = [
      { Ecole:"IGS RH", p25:31350, p50:35150, p75:40850 },
      { Ecole:"ESGRH", p25:30400, p50:34200, p75:39900 },
      { Ecole:"Sup des RH", p25:28500, p50:32300, p75:38000 },
      { Ecole:"ISFOGEP", p25:29450, p50:33250, p75:38000 },
      { Ecole:"ICD Business School (RH)", p25:29450, p50:33250, p75:38950 },
      { Ecole:"ESSCA RH & Management", p25:30400, p50:34200, p75:39900 },
      { Ecole:"ISCG Paris (RH & Paie)", p25:28500, p50:32300, p75:37050 },
      { Ecole:"IAE Paris-Sorbonne (Master RH)", p25:32300, p50:36100, p75:42750 },
      { Ecole:"IAE Lyon (Master GRH)", p25:31350, p50:35150, p75:40850 },
      { Ecole:"IAE Aix-Marseille (Master RH)", p25:31350, p50:36100, p75:41800 },
      { Ecole:"IAE Grenoble (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"IAE Lille (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"IAE Nantes (Master GRH)", p25:29450, p50:33250, p75:38950 },
      { Ecole:"IAE Nice (Master RH)", p25:30400, p50:34200, p75:39900 },
      { Ecole:"Toulouse School of Management", p25:30400, p50:34200, p75:38950 },
      { Ecole:"Hors liste RH", p25:26600, p50:30400, p75:35150 }
    ];

    // Regroupement
    const allSchools = {
      ingenieur: schoolsIngenieur,
      commerce: schoolsCommerce,
      scpo: schoolsScPo,
      universite: schoolsUniversite,
      it: schoolsIT,
      design: schoolsDesign,
      fonction: [...schoolsCom, ...schoolsRH]
    };

    // ===== GESTION DES TABS =====
    let currentTab = 'simulator';

    function switchTab(tab) {
      currentTab = tab;
      
      document.getElementById('tab-simulator').className = tab === 'simulator' ? 
        'tab-active px-6 py-3 rounded-xl font-semibold transition-all duration-300' : 
        'tab-inactive px-6 py-3 rounded-xl font-semibold transition-all duration-300';
      
      document.getElementById('tab-comparator').className = tab === 'comparator' ? 
        'tab-active px-6 py-3 rounded-xl font-semibold transition-all duration-300' : 
        'tab-inactive px-6 py-3 rounded-xl font-semibold transition-all duration-300';
      
      document.getElementById('content-simulator').classList.toggle('hidden', tab !== 'simulator');
      document.getElementById('content-comparator').classList.toggle('hidden', tab !== 'comparator');

      if (tab === 'comparator') {
        populateSchoolsComparator();
        calculateComparison();
      }
    }

    // ===== DARK MODE =====
    function toggleDarkMode() {
      document.documentElement.classList.toggle('dark');
    }

    // ===== D√âTECTION MOBILE & OPTIMISATIONS =====
    function isMobile() {
      return window.innerWidth <= 768;
    }

    function isSmallMobile() {
      return window.innerWidth <= 640;
    }

    // Ajuster la hauteur du graphique selon device
    function adjustChartHeight() {
      const canvas = document.getElementById('salaryChart');
      if (canvas && isMobile()) {
        canvas.style.maxHeight = '250px';
      }
    }

    // Scroll smooth vers r√©sultat sur mobile
    function scrollToResult(elementId) {
      if (isMobile()) {
        const element = document.getElementById(elementId);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    }

    // Optimiser les events touch pour les sliders
    function optimizeSliders() {
      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        // Touch events pour mobile
        slider.addEventListener('touchstart', function() {
          this.classList.add('active-slider');
        }, { passive: true });

        slider.addEventListener('touchend', function() {
          this.classList.remove('active-slider');
        }, { passive: true });
      });
    }

    // Pr√©venir le zoom accidentel sur double-tap
    function preventDoubleTabZoom() {
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);
    }

    // Feedback visuel pour les touches
    function addTouchFeedback() {
      const touchElements = document.querySelectorAll('button, select, input[type="range"]');
      touchElements.forEach(elem => {
        elem.addEventListener('touchstart', function() {
          this.style.opacity = '0.7';
        }, { passive: true });

        elem.addEventListener('touchend', function() {
          setTimeout(() => {
            this.style.opacity = '1';
          }, 100);
        }, { passive: true });
      });
    }
    
    // ===== CALCUL SALAIRE (logique compl√®te) =====
    function calculateSalaryForProfile(profile) {
      const schools = allSchools[profile.sector] || [];
      const school = schools[profile.school];
      
      if (!school) return null;

      let { p25, p50, p75 } = school;

      // Exp√©rience (+2.3%/an)
      const expFactor = Math.pow(1.023, profile.experience);
      p25 *= expFactor;
      p50 *= expFactor;
      p75 *= expFactor;

      // Coefficients individuels
      const educationCoef = {
        technicien: 0.80, bac3: 0.89, bac5: 1.00, doctorat: 1.07
      }[profile.educationLevel] || 1;

      const englishCoef = {
        basic: 1.00, intermediate: 1.03, advanced: 1.06, bilingual: 1.10
      }[profile.englishLevel] || 1;

      const contractCoef = {
        cdi: 1.00, cdd: 0.96, alternance: 0.70, freelance: 1.20, expatriation: 1.15
      }[profile.contractType] || 1;

      const industryCoef = {
        aero: 1.04, auto: 1.00, energie: 1.02, numerique: 1.05, sante: 1.04, luxe: 1.05, public: 0.88
      }[profile.industry] || 1;

      const teamCoef = {
        none: 1.00, small: 1.05, medium: 1.10, large: 1.18, xl: 1.25
      }[profile.teamSize] || 1;

      const packageCoef = {
        standard: 1.00, bonus: 1.07, bonusplus: 1.18, actions: 1.30
      }[profile.packageLevel] || 1;

      const regionCoef = profile.region === 'IDF' ? 1.14 : 1.00;
      
      const sizeCoef = {
        'startup': 0.95, 'PME': 0.96, 'ETI': 1.00, 'grand-groupe': 1.06
      }[profile.companySize] || 1;

      // Classification
      let classCoef = 1;
      if (profile.classification === 'M1') classCoef = 1.10;
      if (profile.classification === 'M2') classCoef = 1.15;
      if (profile.classification === 'M3') classCoef = 1.20;
      if (profile.classification === 'I1') classCoef = 0.95;
      if (profile.classification === 'I2') classCoef = 1.00;
      if (profile.classification === 'I3') classCoef = 1.10;
      if (profile.classification === 'I4') classCoef = 1.20;

      // Moyenne g√©om√©trique des raffinements
      const refinements = [educationCoef, englishCoef, contractCoef, industryCoef, teamCoef];
      const geoMean = Math.pow(refinements.reduce((a, b) => a * b, 1), 1 / refinements.length);
      const refinementCoef = Math.min(Math.max(geoMean, 0.85), 1.25);

      // Source
      let sourceCoef = 1;
      if (profile.source === 'fw') sourceCoef = 0.95;
      if (profile.source === 'croisee') sourceCoef = 0.97;

      const median = p50 * regionCoef * sizeCoef * classCoef * refinementCoef * packageCoef * sourceCoef;
      const low = p25 * regionCoef * sizeCoef * classCoef * refinementCoef * packageCoef * sourceCoef;
      const high = p75 * regionCoef * sizeCoef * classCoef * refinementCoef * packageCoef * sourceCoef;

      return { median, low, high };
    }

    // ===== POPULATE SCHOOLS + AFFICHER FOURCHETTES =====
    function populateSchools() {
      const sector = document.getElementById('sector').value;
      const schoolSel = document.getElementById('school');
      schoolSel.innerHTML = '';
      
      const schools = allSchools[sector] || [];
      schools.forEach((s, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = s.Ecole;
        schoolSel.appendChild(opt);
      });
      
      updateSchoolInfo();
      calculateSimulator();
    }

    function updateSchoolInfo() {
      const sector = document.getElementById('sector').value;
      const schoolIndex = parseInt(document.getElementById('school').value);
      const schools = allSchools[sector] || [];
      const school = schools[schoolIndex];

      if (school) {
        document.getElementById('schoolP25').textContent = Math.round(school.p25).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP50').textContent = Math.round(school.p50).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP75').textContent = Math.round(school.p75).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolInfo').classList.add('show');
      }
    }

    function populateSchoolsComparator() {
      ['A', 'B'].forEach(profile => {
        const sector = document.getElementById('sector' + profile).value;
        const schoolSel = document.getElementById('school' + profile);
        schoolSel.innerHTML = '';
        
        const schools = allSchools[sector] || [];
        schools.forEach((s, i) => {
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = s.Ecole;
          schoolSel.appendChild(opt);
        });

        updateSchoolInfoComparator(profile);
      });
    }

    function updateSchoolInfoComparator(profile) {
      const sector = document.getElementById('sector' + profile).value;
      const schoolIndex = parseInt(document.getElementById('school' + profile).value);
      const schools = allSchools[sector] || [];
      const school = schools[schoolIndex];

      if (school) {
        document.getElementById('schoolP25' + profile).textContent = Math.round(school.p25).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP50' + profile).textContent = Math.round(school.p50).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolP75' + profile).textContent = Math.round(school.p75).toLocaleString() + ' ‚Ç¨';
        document.getElementById('schoolInfo' + profile).classList.add('show');
      }
    }

// ===== CALCUL SIMULATEUR =====
    let chart;
    function calculateSimulator() {
      const profile = {
        sector: document.getElementById('sector').value,
        school: parseInt(document.getElementById('school').value),
        experience: parseInt(document.getElementById('experience').value),
        region: document.getElementById('region').value,
        companySize: document.getElementById('companySize').value,
        classification: document.getElementById('classification').value,
        educationLevel: document.getElementById('educationLevel').value,
        englishLevel: document.getElementById('englishLevel').value,
        contractType: document.getElementById('contractType').value,
        industry: document.getElementById('industry').value,
        teamSize: document.getElementById('teamSize').value,
        packageLevel: document.getElementById('packageLevel').value,
        source: document.getElementById('source').value
      };

      const result = calculateSalaryForProfile(profile);
      
      if (!result) return;

      document.getElementById('median').textContent = Math.round(result.median).toLocaleString() + ' ‚Ç¨';
      document.getElementById('low').textContent = Math.round(result.low).toLocaleString() + ' ‚Ç¨';
      document.getElementById('high').textContent = Math.round(result.high).toLocaleString() + ' ‚Ç¨';
      
      document.getElementById('result').classList.remove('hidden');

      // Scroll automatique sur mobile
      setTimeout(() => {
        scrollToResult('result');
      }, 300);

      // Graphique
      const ctx = document.getElementById('salaryChart').getContext('2d');
      if (chart) chart.destroy();
      
      const years = [...Array(41).keys()];
      const projection = years.map(y => result.median * Math.pow(1.023, y));
      
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: [{
            label: 'Salaire projet√© (‚Ç¨)',
            data: projection,
            borderColor: '#00AEEF',
            backgroundColor: 'rgba(0, 174, 239, 0.1)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: !isMobile(), // D√©sactiver ratio fixe sur mobile
          plugins: { 
            legend: { 
              display: true,
              labels: {
                font: {
                  size: isMobile() ? 10 : 12
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value) {
                  return value.toLocaleString() + ' ‚Ç¨';
                },
                font: {
                  size: isMobile() ? 9 : 11
                }
              }
            },
            x: {
              ticks: {
                font: {
                  size: isMobile() ? 9 : 11
                }
              }
            }
          }
        }
      });

      adjustChartHeight();
    }

    // ===== CALCUL COMPARATEUR + ANALYSE PEAUFIN√âE =====
    function calculateComparison() {
      const profileA = {
        sector: document.getElementById('sectorA').value,
        school: parseInt(document.getElementById('schoolA').value),
        experience: parseInt(document.getElementById('experienceA').value),
        region: document.getElementById('regionA').value,
        companySize: document.getElementById('companySizeA').value,
        classification: document.getElementById('classificationA').value,
        educationLevel: document.getElementById('educationLevelA').value,
        englishLevel: document.getElementById('englishLevelA').value,
        contractType: document.getElementById('contractTypeA').value,
        industry: document.getElementById('industryA').value,
        teamSize: document.getElementById('teamSizeA').value,
        packageLevel: document.getElementById('packageLevelA').value,
        source: document.getElementById('sourceA').value
      };

      const profileB = {
        sector: document.getElementById('sectorB').value,
        school: parseInt(document.getElementById('schoolB').value),
        experience: parseInt(document.getElementById('experienceB').value),
        region: document.getElementById('regionB').value,
        companySize: document.getElementById('companySizeB').value,
        classification: document.getElementById('classificationB').value,
        educationLevel: document.getElementById('educationLevelB').value,
        englishLevel: document.getElementById('englishLevelB').value,
        contractType: document.getElementById('contractTypeB').value,
        industry: document.getElementById('industryB').value,
        teamSize: document.getElementById('teamSizeB').value,
        packageLevel: document.getElementById('packageLevelB').value,
        source: document.getElementById('sourceB').value
      };

      const resultA = calculateSalaryForProfile(profileA);
      const resultB = calculateSalaryForProfile(profileB);

      if (!resultA || !resultB) return;

      // Affichage r√©sultats
document.getElementById('resultA-median').textContent = Math.round(resultA.median).toLocaleString() + ' ‚Ç¨';
document.getElementById('resultA-range').textContent = 
  Math.round(resultA.low).toLocaleString() + ' ‚Ç¨ ‚Äì ' + Math.round(resultA.high).toLocaleString() + ' ‚Ç¨';

document.getElementById('resultB-median').textContent = Math.round(resultB.median).toLocaleString() + ' ‚Ç¨';
document.getElementById('resultB-range').textContent = 
  Math.round(resultB.low).toLocaleString() + ' ‚Ç¨ ‚Äì ' + Math.round(resultB.high).toLocaleString() + ' ‚Ç¨';

// Scroll automatique vers r√©sultats sur mobile
setTimeout(() => {
  scrollToResult('comparison-results');
}, 300);

// Calcul diff√©rences
const diff = resultA.median - resultB.median;
const percentDiff = (diff / resultB.median) * 100;
const ratio = resultA.median / resultB.median;

      document.getElementById('diff-absolute').textContent = 
        (diff > 0 ? '+' : '') + Math.round(diff).toLocaleString() + ' ‚Ç¨';
      document.getElementById('diff-absolute').className = 
        'text-3xl font-bold ' + (diff > 0 ? 'text-green-600' : 'text-red-600');

      document.getElementById('diff-percent').textContent = 
        (percentDiff > 0 ? '+' : '') + percentDiff.toFixed(1) + ' %';
      document.getElementById('diff-percent').className = 
        'text-3xl font-bold ' + (percentDiff > 0 ? 'text-green-600' : 'text-red-600');

      document.getElementById('diff-ratio').textContent = '√ó' + ratio.toFixed(2);

      // Barres
      const total = resultA.median + resultB.median;
      const widthA = (resultA.median / total) * 100;
      const widthB = (resultB.median / total) * 100;

      document.getElementById('bar-A').style.width = widthA + '%';
      document.getElementById('bar-B').style.width = widthB + '%';
      document.getElementById('bar-A-text').textContent = Math.round(resultA.median).toLocaleString() + ' ‚Ç¨';
      document.getElementById('bar-B-text').textContent = Math.round(resultB.median).toLocaleString() + ' ‚Ç¨';

      // ===== ANALYSE D√âTAILL√âE PEAUFIN√âE =====
      generateDetailedInsight(profileA, profileB, resultA, resultB, diff, percentDiff);
    }

    function generateDetailedInsight(profileA, profileB, resultA, resultB, diff, percentDiff) {
      // Insight principal
      let mainInsight = '';
      if (Math.abs(diff) < 2000) {
        mainInsight = 'Les deux profils sont pratiquement √©quivalents sur le march√© actuel, avec un √©cart n√©gligeable de ' + Math.round(Math.abs(diff)).toLocaleString() + ' ‚Ç¨.';
      } else if (diff > 0) {
        mainInsight = `Le Profil A g√©n√®re ${Math.round(diff).toLocaleString()} ‚Ç¨ de plus que le Profil B (soit +${percentDiff.toFixed(1)}%). `;
        
        if (profileA.region === 'IDF' && profileB.region === 'hors') {
          mainInsight += 'La prime r√©gionale √éle-de-France (+14%) joue un r√¥le majeur dans cet √©cart.';
        } else if (profileA.experience - profileB.experience > 3) {
          mainInsight += `L'√©cart d'exp√©rience (${profileA.experience - profileB.experience} ans) explique principalement cette diff√©rence.`;
        } else {
          mainInsight += 'La combinaison des facteurs acad√©miques et professionnels favorise nettement le Profil A.';
        }
      } else {
        mainInsight = `Le Profil B g√©n√®re ${Math.round(Math.abs(diff)).toLocaleString()} ‚Ç¨ de plus que le Profil A (soit ${Math.abs(percentDiff).toFixed(1)}%). `;
        
        if (profileB.region === 'IDF' && profileA.region === 'hors') {
          mainInsight += 'La prime r√©gionale √éle-de-France (+14%) joue un r√¥le majeur dans cet √©cart.';
        } else if (profileB.experience - profileA.experience > 3) {
          mainInsight += `L'√©cart d'exp√©rience (${profileB.experience - profileA.experience} ans) explique principalement cette diff√©rence.`;
        } else {
          mainInsight += 'La combinaison des facteurs acad√©miques et professionnels favorise nettement le Profil B.';
        }
      }

      document.getElementById('insight-main').textContent = mainInsight;

      // Analyse acad√©mique
      const schoolsA = allSchools[profileA.sector] || [];
      const schoolsB = allSchools[profileB.sector] || [];
      const schoolA = schoolsA[profileA.school];
      const schoolB = schoolsB[profileB.school];

      let academicInsight = '';
      if (schoolA && schoolB) {
        const schoolDiff = schoolA.p50 - schoolB.p50;
        academicInsight = `√âcole A: ${schoolA.Ecole} (${Math.round(schoolA.p50).toLocaleString()} ‚Ç¨ sortie) vs √âcole B: ${schoolB.Ecole} (${Math.round(schoolB.p50).toLocaleString()} ‚Ç¨ sortie). `;
        
        if (Math.abs(schoolDiff) > 5000) {
          academicInsight += `√âcart scolaire significatif de ${Math.round(Math.abs(schoolDiff)).toLocaleString()} ‚Ç¨. `;
        }

        if (profileA.educationLevel !== profileB.educationLevel) {
          const eduA = { technicien: 'Bac+2', bac3: 'Bac+3', bac5: 'Bac+5', doctorat: 'PhD' }[profileA.educationLevel];
          const eduB = { technicien: 'Bac+2', bac3: 'Bac+3', bac5: 'Bac+5', doctorat: 'PhD' }[profileB.educationLevel];
          academicInsight += `Niveau d'√©tudes diff√©rent (${eduA} vs ${eduB}). `;
        }

        if (profileA.englishLevel !== profileB.englishLevel) {
          academicInsight += `Niveau d'anglais: ${profileA.englishLevel} vs ${profileB.englishLevel}.`;
        }
      }

      document.getElementById('insight-academic').textContent = academicInsight || 'Facteurs acad√©miques similaires.';

      // Analyse professionnelle
      let professionalInsight = '';
      
      if (profileA.region !== profileB.region) {
        professionalInsight += `R√©gion: ${profileA.region === 'IDF' ? 'IDF (+14%)' : 'Province'} vs ${profileB.region === 'IDF' ? 'IDF (+14%)' : 'Province'}. `;
      }

      if (profileA.companySize !== profileB.companySize) {
        professionalInsight += `Taille entreprise: ${profileA.companySize} vs ${profileB.companySize}. `;
      }

      if (profileA.classification !== profileB.classification) {
        const classA = profileA.classification || 'Standard';
        const classB = profileB.classification || 'Standard';
        professionalInsight += `Classification: ${classA} vs ${classB}. `;
      }

      if (profileA.packageLevel !== profileB.packageLevel) {
        professionalInsight += `Package: ${profileA.packageLevel} vs ${profileB.packageLevel}. `;
      }

      if (profileA.teamSize !== profileB.teamSize) {
        const teamA = { none: 'Aucune', small: '1-5', medium: '6-15', large: '16-50', xl: '50+' }[profileA.teamSize];
        const teamB = { none: 'Aucune', small: '1-5', medium: '6-15', large: '16-50', xl: '50+' }[profileB.teamSize];
        professionalInsight += `√âquipe encadr√©e: ${teamA} vs ${teamB}.`;
      }

      document.getElementById('insight-professional').textContent = professionalInsight || 'Contexte professionnel similaire.';
    }

  // ===== EXPORT PDF SIMULATEUR (optimis√© mobile) =====
    function exportSimulatorPDF() {
      // Feedback visuel
      const btn = event.target;
      btn.textContent = '‚è≥ G√©n√©ration...';
      btn.disabled = true;

      setTimeout(() => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFont("helvetica", "bold");
        doc.setFontSize(16);
        doc.text("R√©sultats Simulateur", 20, 20);

        doc.setFont("helvetica", "normal");
        doc.setFontSize(11);
        doc.text("M√©dian: " + document.getElementById('median').textContent, 20, 40);
        doc.text("Bas: " + document.getElementById('low').textContent, 20, 50);
        doc.text("Haut: " + document.getElementById('high').textContent, 20, 60);

        const canvas = document.getElementById('salaryChart');
        html2canvas(canvas, { scale: isMobile() ? 1 : 2 }).then(canvasImg => {
          const imgData = canvasImg.toDataURL('image/png');
          doc.addImage(imgData, 'PNG', 20, 75, 170, 80);
          doc.save('simulateur_salaire.pdf');
          
          // Reset bouton
          btn.textContent = 'üìÑ Exporter en PDF';
          btn.disabled = false;
        }).catch(() => {
          btn.textContent = '‚ùå Erreur';
          setTimeout(() => {
            btn.textContent = 'üìÑ Exporter en PDF';
            btn.disabled = false;
          }, 2000);
        });
      }, 100);
    }

    // ===== EXPORT PDF COMPARAISON (optimis√© mobile) =====
    function exportComparisonPDF() {
      // Feedback visuel
      const btn = event.target;
      btn.textContent = '‚è≥ G√©n√©ration...';
      btn.disabled = true;

      setTimeout(() => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFont("helvetica", "bold");
        doc.setFontSize(16);
        doc.text("Comparaison Salaires", 20, 20);

        doc.setFontSize(12);
        doc.setTextColor(59, 130, 246);
        doc.text("Profil A", 20, 35);
        doc.setFont("helvetica", "normal");
        doc.setFontSize(10);
        doc.setTextColor(0, 0, 0);
        doc.text("Salaire: " + document.getElementById('resultA-median').textContent, 20, 43);
        doc.text("Fourchette: " + document.getElementById('resultA-range').textContent, 20, 50);

        doc.setFont("helvetica", "bold");
        doc.setFontSize(12);
        doc.setTextColor(34, 197, 94);
        doc.text("Profil B", 20, 63);
        doc.setFont("helvetica", "normal");
        doc.setFontSize(10);
        doc.setTextColor(0, 0, 0);
        doc.text("Salaire: " + document.getElementById('resultB-median').textContent, 20, 71);
        doc.text("Fourchette: " + document.getElementById('resultB-range').textContent, 20, 78);

        doc.setFont("helvetica", "bold");
        doc.setFontSize(12);
        doc.text("Analyse", 20, 93);
        doc.setFont("helvetica", "normal");
        doc.setFontSize(10);
        doc.text("Diff√©rence: " + document.getElementById('diff-absolute').textContent, 20, 101);
        doc.text("√âcart: " + document.getElementById('diff-percent').textContent, 20, 108);

        const insight = document.getElementById('insight-main').textContent;
        const lines = doc.splitTextToSize(insight, 170);
        doc.text(lines, 20, 120);

        doc.save('comparaison_salaires.pdf');
        
        // Reset bouton
        btn.textContent = 'üìÑ Exporter la comparaison en PDF';
        btn.disabled = false;
      }, 100);
    }

 // ===== INITIALISATION =====
    window.onload = function() {
      // Optimisations mobile
      if (isMobile()) {
        preventDoubleTabZoom();
        optimizeSliders();
        addTouchFeedback();
      }

      // Simulateur
      document.getElementById('sector').addEventListener('change', populateSchools);
      document.getElementById('school').addEventListener('change', function() {
        updateSchoolInfo();
        calculateSimulator();
      });
      document.getElementById('experience').addEventListener('input', function(e) {
        document.getElementById('expVal').textContent = e.target.value;
        calculateSimulator();
      });
      
      ['region', 'companySize', 'classification', 'educationLevel', 'englishLevel', 
       'contractType', 'industry', 'teamSize', 'packageLevel', 'source'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculateSimulator);
      });

      // Comparateur A
      document.getElementById('sectorA').addEventListener('change', function() {
        populateSchoolsComparator();
        calculateComparison();
      });
      document.getElementById('schoolA').addEventListener('change', function() {
        updateSchoolInfoComparator('A');
        calculateComparison();
      });
      document.getElementById('experienceA').addEventListener('input', function(e) {
        document.getElementById('expValA').textContent = e.target.value;
        calculateComparison();
      });
      
      ['regionA', 'companySizeA', 'classificationA', 'educationLevelA', 'englishLevelA',
       'contractTypeA', 'industryA', 'teamSizeA', 'packageLevelA', 'sourceA'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculateComparison);
      });

      // Comparateur B
      document.getElementById('sectorB').addEventListener('change', function() {
        populateSchoolsComparator();
        calculateComparison();
      });
      document.getElementById('schoolB').addEventListener('change', function() {
        updateSchoolInfoComparator('B');
        calculateComparison();
      });
      document.getElementById('experienceB').addEventListener('input', function(e) {
        document.getElementById('expValB').textContent = e.target.value;
        calculateComparison();
      });
      
      ['regionB', 'companySizeB', 'classificationB', 'educationLevelB', 'englishLevelB',
       'contractTypeB', 'industryB', 'teamSizeB', 'packageLevelB', 'sourceB'].forEach(id => {
        document.getElementById(id).addEventListener('change', calculateComparison);
      });

      // Init
      populateSchools();
      populateSchoolsComparator();

      // Ajustements initiaux mobile
      if (isMobile()) {
        adjustChartHeight();
      }

      // R√©ajuster lors du resize / rotation
      window.addEventListener('resize', function() {
        if (chart) {
          chart.resize();
          adjustChartHeight();
        }
      });
    };
  </script>
</body>
</html>
