<!DOCTYPE html>
<html lang="fr" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulateur Salaire - Flying Whales</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("‚úÖ Service Worker enregistr√©"))
        .catch(err => console.error("Erreur SW:", err));
    }
  </script>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:50; }
    .modal-content { background:white; padding:2rem; border-radius:1rem; max-width:700px; }
    .dark .modal-content { background:#1f2937; color:white; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
  <header class="w-full py-6 bg-[#00AEEF] text-white flex justify-between px-8 items-center">
    <h1 class="text-2xl font-bold">‚úàÔ∏è Simulateur Salaire - Flying Whales</h1>
    <div class="flex gap-2">
      <button onclick="toggleDarkMode()" class="px-3 py-1 bg-white text-[#003366] rounded-lg">üåô/‚òÄÔ∏è</button>
      <button onclick="openModal()" class="px-3 py-1 bg-white text-[#003366] rounded-lg">‚ùì Aide</button>
    </div>
  </header>

  <!-- Modal d'aide -->
  <div id="helpModal" class="modal flex">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4">‚ÑπÔ∏è Aide & FAQ</h2>
      <p><b>üåç March√© :</b> bas√© sur les donn√©es nationales (69 √©coles, +2,3%/an, coefficients).</p>
      <p><b>üè¢ Flying Whales :</b> bas√© sur les packages internes FW.</p>
      <p><b>‚öñÔ∏è Crois√©e :</b> combinaison 60% FW, 40% march√©.</p>
      <p><b>Graphique :</b> montre l‚Äô√©volution projet√©e sur 40 ans.</p>
      <h3 class="mt-4 font-bold">FAQ</h3>
      <ul class="list-disc ml-6">
        <li><b>Pourquoi mon salaire projet√© est diff√©rent du march√© ?</b> ‚Üí Car FW paie parfois en dessous ou au-dessus de la m√©diane march√©.</li>
        <li><b>Que veut dire Crois√©e ?</b> ‚Üí Mix 60% interne, 40% march√©.</li>
        <li><b>Pourquoi +2,3%/an ?</b> ‚Üí C‚Äôest la progression moyenne utilis√©e.</li>
        <li><b>Comment sont pris en compte les sous-domaines ?</b> ‚Üí Chaque sp√©cialit√© a un coefficient.</li>
      </ul>
      <button onclick="closeModal()" class="mt-4 px-4 py-2 bg-[#00AEEF] text-white rounded">Fermer</button>
    </div>
  </div>

  <main class="max-w-5xl mx-auto p-6">
    <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow mb-6">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìù Renseigne ton profil</h2>
      <label>üè´ √âcole</label>
      <select id="school" class="w-full mb-4 p-2 border rounded"></select>

      <label>üìÖ Exp√©rience: <span id="expVal">3</span> ans</label>
      <input type="range" id="experience" min="0" max="40" value="3" class="w-full mb-4">

      <label>üî¨ Sous-domaine</label>
      <select id="subdomain" class="w-full mb-4 p-2 border rounded"></select>

      <label>üëî R√¥le / Statut</label>
      <select id="role" class="w-full mb-4 p-2 border rounded"></select>

      <label>üè∑Ô∏è Classification interne</label>
      <select id="classification" class="w-full mb-4 p-2 border rounded">
        <option value="">-- Optionnelle --</option>
        <option value="I1">I1 - Ing√©nieur D√©butant</option>
        <option value="I2">I2 - Ing√©nieur Confirm√©</option>
        <option value="I3">I3 - Ing√©nieur Senior</option>
        <option value="I4">I4 - Ing√©nieur Expert</option>
        <option value="M1">M1 - Manager Niveau 1</option>
        <option value="M2">M2 - Manager Niveau 2</option>
        <option value="M3">M3 - Leader D√©partement</option>
        <option value="RLot">Responsable de Lot</option>
        <option value="RDept">Responsable de D√©partement</option>
      </select>

      <label>üåç R√©gion</label>
      <select id="region" class="w-full mb-4 p-2 border rounded">
        <option value="IDF">√éle-de-France</option>
        <option value="PACA">PACA</option>
        <option value="AuRA">Auvergne-Rh√¥ne-Alpes</option>
        <option value="autres">Autres</option>
      </select>

      <label>üè¢ Taille entreprise</label>
      <select id="companySize" class="w-full mb-4 p-2 border rounded">
        <option value="startup">Startup</option>
        <option value="PME">PME</option>
        <option value="ETI">ETI</option>
        <option value="grand-groupe">Grand Groupe</option>
      </select>

      <label>üìä Source des donn√©es</label>
      <select id="source" class="w-full mb-4 p-2 border rounded">
        <option value="marche">üåç March√©</option>
        <option value="fw">üè¢ Flying Whales (interne)</option>
        <option value="croisee">‚öñÔ∏è Donn√©es crois√©es</option>
      </select>
    </section>

    <section id="result" class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hidden">
      <h2 class="text-xl font-bold text-[#003366] dark:text-[#00AEEF] mb-4">üìä R√©sultats</h2>
      <p><b>Fourchette sortie d‚Äô√©cole (r√©f√©rence)</b>: <span id="schoolRange"></span></p>
      <p><b>Salaire m√©dian √©cole</b>: <span id="schoolMedian"></span></p>
      <hr class="my-4">
      <p><b>Estimation personnalis√©e :</b></p>
      <p>M√©dian: <span id="median"></span></p>
      <p>Fourchette: <span id="range"></span></p>
      <canvas id="salaryChart" class="mt-6"></canvas>
      <div class="mt-4 flex gap-4">
        <button onclick="exportCSV()" class="px-4 py-2 bg-[#00AEEF] text-white rounded">üì• Export CSV</button>
        <button onclick="window.print()" class="px-4 py-2 bg-[#40E0D0] text-white rounded">üñ®Ô∏è Export PDF</button>
      </div>
    </section>
  </main>

  <script>
    const schools = [
      {Ecole:"Hors liste", p25:34000, p50:38000, p75:42000},
      {Ecole:"ISA JUNIA", p25:44563, p50:47045, p75:49098},
      {Ecole:"EI PURPAN", p25:44975, p50:47918, p75:50153},
      {Ecole:"ESA", p25:45643, p50:48698, p75:50285},
      {Ecole:"ENSI POITIERS", p25:47449, p50:50129, p75:52065},
      {Ecole:"ENI BREST", p25:47783, p50:50500, p75:52804},
      {Ecole:"ENSC RENNES", p25:47816, p50:50979, p75:53549},
      {Ecole:"ENSMA", p25:48316, p50:51276, p75:53115},
      {Ecole:"ENSAIA", p25:48916, p50:51310, p75:53737},
      {Ecole:"ENISE", p25:48321, p50:51324, p75:53457},
      {Ecole:"AgroParisTech", p25:48979, p50:51545, p75:53439},
      {Ecole:"POLYTECH ORLEANS", p25:48986, p50:51671, p75:53871},
      {Ecole:"ECAM", p25:49425, p50:51887, p75:54074},
      {Ecole:"ENSE3 GRENOBLE INP", p25:49279, p50:52031, p75:54466},
      {Ecole:"IMT NORD EUROPE", p25:49554, p50:52143, p75:54446},
      {Ecole:"POLYTECH GRENOBLE", p25:49434, p50:52223, p75:54578},
      {Ecole:"POLYTECH SORBONNE", p25:49673, p50:52345, p75:54784},
      {Ecole:"ENSAI", p25:49793, p50:52586, p75:55060},
      {Ecole:"ENSEIRB MATMECA", p25:49864, p50:52673, p75:55122},
      {Ecole:"POLYTECH LYON", p25:50155, p50:52921, p75:55541},
      {Ecole:"POLYTECH LILLE", p25:50419, p50:53201, p75:55722},
      {Ecole:"INSA TOULOUSE", p25:50536, p50:53423, p75:55892},
      {Ecole:"POLYTECH NANTES", p25:50619, p50:53587, p75:56097},
      {Ecole:"POLYTECH NICE", p25:50841, p50:53821, p75:56377},
      {Ecole:"INSA LYON", p25:50987, p50:54002, p75:56514},
      {Ecole:"ESIREM", p25:51154, p50:54232, p75:56780},
      {Ecole:"ENSGSI", p25:51266, p50:54397, p75:57001},
      {Ecole:"ENSGTI", p25:51445, p50:54644, p75:57282},
      {Ecole:"ESIGELEC", p25:51562, p50:54813, p75:57405},
      {Ecole:"ENSEA", p25:51788, p50:55067, p75:57628},
      {Ecole:"ESEO", p25:51890, p50:55234, p75:57800},
      {Ecole:"INSA RENNES", p25:52076, p50:55401, p75:57955},
      {Ecole:"INSA STRASBOURG", p25:52201, p50:55629, p75:58192},
      {Ecole:"UTC COMPIEGNE", p25:52388, p50:55811, p75:58435},
      {Ecole:"UTT TROYES", p25:52516, p50:56024, p75:58674},
      {Ecole:"UTBM BELFORT", p25:52699, p50:56167, p75:58850},
      {Ecole:"SUPELEC", p25:52934, p50:56345, p75:59031},
      {Ecole:"ENSEEIHT", p25:53112, p50:56529, p75:59244},
      {Ecole:"ENSEA PARIS", p25:53284, p50:56711, p75:59461},
      {Ecole:"TELECOM PARIS", p25:53496, p50:56877, p75:59648},
      {Ecole:"TELECOM SUDPARIS", p25:53673, p50:57098, p75:59870},
      {Ecole:"ENSEEIHT TOULOUSE", p25:53845, p50:57212, p75:60065},
      {Ecole:"ENSEIRB", p25:53988, p50:57367, p75:60219},
      {Ecole:"ENSEA CERGY", p25:54111, p50:57499, p75:60352},
      {Ecole:"ENSEM NANCY", p25:54283, p50:57691, p75:60541},
      {Ecole:"ENSAM ARTS ET METIERS", p25:54420, p50:57845, p75:60698},
      {Ecole:"MINES SAINT-ETIENNE", p25:54631, p50:58012, p75:60844},
      {Ecole:"MINES NANCY", p25:54772, p50:58167, p75:61012},
      {Ecole:"MINES DOUAI", p25:54911, p50:58321, p75:61145},
      {Ecole:"CENTRALE LILLE", p25:55128, p50:58545, p75:61372},
      {Ecole:"CENTRALE NANTES", p25:55295, p50:58714, p75:61530},
      {Ecole:"CENTRALE MARSEILLE", p25:55438, p50:58873, p75:61690},
      {Ecole:"CENTRALE LYON", p25:55612, p50:59054, p75:61871},
      {Ecole:"CENTRALE PARIS", p25:55782, p50:59233, p75:62035},
      {Ecole:"CENTRALE SUP√âLEC", p25:55944, p50:59419, p75:62223},
      {Ecole:"MINES PARIS", p25:56122, p50:59598, p75:62419},
      {Ecole:"POLYTECHNIQUE", p25:56291, p50:59771, p75:62608},
      {Ecole:"ISAE-SUPAERO", p25:56462, p50:59955, p75:62891},
      {Ecole:"ENAC", p25:56634, p50:60134, p75:63080},
      {Ecole:"ESPCI", p25:56798, p50:60318, p75:63260},
      {Ecole:"ENS CACHAN", p25:56972, p50:60501, p75:63440},
      {Ecole:"ENS LYON", p25:57133, p50:60682, p75:63625},
      {Ecole:"ENS PARIS-SACLAY", p25:57301, p50:60863, p75:63804},
      {Ecole:"ENS ULM", p25:57472, p50:61048, p75:63986},
      {Ecole:"COLL√àGE DE FRANCE (ex ENS)", p25:57645, p50:61231, p75:64173}
    ];

    const subdomainCoef = {"Calculs & Simulation":1.10,"Conception":1.05,"√âlectronique":1.08,"Avionique":1.07,"Mat√©riaux":1.06,"Propulsion":1.12,"M√©thodes":0.95,"Production":1.0,"Maintenance":0.92,"Qualit√©":0.93,"Supply Chain":0.94,"Gestion de Projet":1.05,"Ing√©nierie Syst√®mes":1.08,"Gestion de Programme":1.12,"Support Client":0.96,"Thermique":1.09,"Dynamique de Vol":1.11};
    const roles = ["Ing√©nieur Standard","Expert Technique","Architecte Syst√®me","Chef de Projet","Manager d‚Äô√âquipe","Directeur de Programme"];

    function populateMenus() {
      const schoolSel = document.getElementById("school");
      schools.forEach((s,i)=>schoolSel.add(new Option(s.Ecole,i)));
      const subSel=document.getElementById("subdomain");
      Object.keys(subdomainCoef).forEach(k=>subSel.add(new Option(k,k)));
      const roleSel=document.getElementById("role");
      roles.forEach(r=>roleSel.add(new Option(r,r)));
      document.querySelectorAll("#school, #subdomain, #role, #classification, #region, #companySize, #source")
        .forEach(el => el.addEventListener("change", calculateSalary));
      document.getElementById("experience").addEventListener("input", e=>{document.getElementById("expVal").innerText=e.target.value; calculateSalary();});
      calculateSalary();
    }

    let chart;
    function calculateSalary() {
      const sch=document.getElementById("school").value;
      if(!sch) return;
      const school=schools[sch];
      const exp=parseInt(document.getElementById("experience").value);
      document.getElementById("schoolRange").innerText=school.p25+"‚Ç¨ ‚Äì "+school.p75+"‚Ç¨";
      document.getElementById("schoolMedian").innerText=school.p50+"‚Ç¨";

      let factor=Math.pow(1.023,exp);
      let p25=school.p25*factor, p50=school.p50*factor, p75=school.p75*factor;

      const sd=subdomainCoef[document.getElementById("subdomain").value]||1;
      const regionCoef={IDF:1.0,PACA:0.86,AuRA:0.86,autres:0.86};
      const sizeCoef={startup:0.9,PME:1.0,ETI:1.05,"grand-groupe":1.15};
      const region=regionCoef[document.getElementById("region").value]||1;
      const size=sizeCoef[document.getElementById("companySize").value]||1;
      let coef=sd*region*size;

      const classification=document.getElementById("classification").value;
      let roleCoef=1;
      if (classification==="M1") roleCoef=1.08;
      if (classification==="M2") roleCoef=1.10;
      if (classification==="M3") roleCoef=1.12;
      if (classification==="RDept") roleCoef=1.15;
      if (classification==="RLot") roleCoef=1.07;

      const source=document.getElementById("source").value;
      let median,low,high;
      if(source==="marche"){
        median=p50*coef; low=p25*coef; high=p75*coef;
      }else if(source==="fw"){
        median=p50*0.95; low=p25*0.95; high=p75*0.95;
      }else{
        median=(p50*coef*0.4 + p50*0.95*0.6);
        low=(p25*coef*0.4 + p25*0.95*0.6);
        high=(p75*coef*0.4 + p75*0.95*0.6);
      }

      median*=roleCoef; low*=roleCoef; high*=roleCoef;

      document.getElementById("median").innerText=Math.round(median)+"‚Ç¨";
      document.getElementById("range").innerText=Math.round(low)+"‚Ç¨ ‚Äì "+Math.round(high)+"‚Ç¨";
      document.getElementById("result").classList.remove("hidden");

      const ctx=document.getElementById("salaryChart").getContext("2d");
      if(chart) chart.destroy();
      const years=[...Array(41).keys()];
      const marche=years.map(y=>school.p50*Math.pow(1.023,y)*coef*roleCoef);
      const interne=years.map(y=>school.p50*Math.pow(1.023,y)*0.95*roleCoef);
      const croisee=years.map((y,i)=>(marche[i]*0.4+interne[i]*0.6));
      chart=new Chart(ctx,{
        type:"line",
        data:{labels:years,datasets:[
          {label:"March√©",data:marche,borderColor:"#003366",fill:false},
          {label:"Interne FW",data:interne,borderColor:"#00AEEF",fill:false},
          {label:"Crois√©e",data:croisee,borderColor:"#40E0D0",fill:false}
        ]},
        options:{responsive:true,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:false}}}
      });
    }

    function toggleDarkMode() {document.body.classList.toggle("dark"); document.documentElement.classList.toggle("dark");}
    function openModal() {document.getElementById("helpModal").style.display="flex";}
    function closeModal() {document.getElementById("helpModal").style.display="none";}
    function exportCSV() {
      let csv = "√âcole,Exp√©rience,Salaire m√©dian,Fourchette\\n";
      csv += document.getElementById("school").selectedOptions[0].text+","+
             document.getElementById("experience").value+" ans,"+
             document.getElementById("median").innerText+","+
             document.getElementById("range").innerText+"\\n";
      const blob = new Blob([csv],{type:"text/csv"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a"); a.href=url; a.download="salaire.csv"; a.click(); URL.revokeObjectURL(url);
    }
    window.onload=populateMenus;
  </script>
</body>
</html>
